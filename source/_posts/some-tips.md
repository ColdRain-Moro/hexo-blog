---
title: 整理一下今天踩的坑
date: 2021-10-31 20:35:08
author: 寒雨
hide: false
summary: 整理了一些在bukkit开发中经常碰到的坑
categories: 笔记
tags:
  - Bukkit
  - Kotlin
  - Coroutine
---

## 其一

今天尝试用Kotlin委托将一个玩家Inventory的所有方法全部委托给了我写的一个CookingInventory类

[![code1](https://camo.githubusercontent.com/55bf43db7aba95bd5ace9c7366cc2ec8e23b8ef3933ecffb5b51287fab56b7c4/68747470733a2f2f67697465652e636f6d2f636f6c647261696e2d6d6f726f2f696d616765735f6265642f7261772f6d61737465722f696d616765732f636f6465312e706e67)](https://camo.githubusercontent.com/55bf43db7aba95bd5ace9c7366cc2ec8e23b8ef3933ecffb5b51287fab56b7c4/68747470733a2f2f67697465652e636f6d2f636f6c647261696e2d6d6f726f2f696d616765735f6265642f7261772f6d61737465722f696d616765732f636f6465312e706e67)

然后我尝试用玩家的openInventory打开一个CookingInventory实例，发现报了这样一个错

[![log1](https://camo.githubusercontent.com/7f2c69bf1260d9b8abac702d8bc11bd43a88ffcb60667faceb3e1eb57c7b6215/68747470733a2f2f67697465652e636f6d2f636f6c647261696e2d6d6f726f2f696d616765735f6265642f7261772f6d61737465722f696d616765732f6c6f67312e706e67)](https://camo.githubusercontent.com/7f2c69bf1260d9b8abac702d8bc11bd43a88ffcb60667faceb3e1eb57c7b6215/68747470733a2f2f67697465652e636f6d2f636f6c647261696e2d6d6f726f2f696d616765735f6265642f7261772f6d61737465722f696d616765732f6c6f67312e706e67)

原来openInventory方法的实现是对CraftInventory类型实例的操作，而不是对一个Inventory实例的操作，也就是说，我需要传入openInventory方法的参数不止应该实现Inventory接口，还应该是一个CraftInventory类型的实例

所以用委托来实现Inventory接口的类实例化得到的实例自然是没办法用这个方法open的

## 其二

今天尝试在协程中打开玩家UI界面，却发现报了个非常熟悉的错

[![log2](https://camo.githubusercontent.com/726d3f1aca9a78f563c95d2ded12860d7e39c4cf5483ec591ca82bce2d514a11/68747470733a2f2f67697465652e636f6d2f636f6c647261696e2d6d6f726f2f696d616765735f6265642f7261772f6d61737465722f696d616765732f6c6f67322e706e67)](https://camo.githubusercontent.com/726d3f1aca9a78f563c95d2ded12860d7e39c4cf5483ec591ca82bce2d514a11/68747470733a2f2f67697465652e636f6d2f636f6c647261696e2d6d6f726f2f696d616765735f6265642f7261772f6d61737465722f696d616765732f6c6f67322e706e67)

但协程不是同步的吗？我才学了协程是并发，而并非并行。难道同一线程上的并发操作也能被称之为异步吗？

之后我发现，我调用协程方法时，无论我是不是async，他们都是在另外一条线程上执行的，而并非在Bukkit的主线程上执行。

github上有一个很有意思的库 - MCCoroutine，能让MC插件开发的大部分操作都能在协程上执行，而且实现原理据说蛮简单，下次试试能不能抄过来。